/*! For license information please see 1454.68f57c63f0e0d272aea7.js.LICENSE.txt */
(window.webpackChunk=window.webpackChunk||[]).push([[1454,34441,48672,42281],{206659:e=>{"use strict";var t=Object.prototype.hasOwnProperty,i="~";function n(){}function s(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function r(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,r||e,o),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,n,s=[];if(0===this._eventsCount)return s;for(n in e=this._events)t.call(e,n)&&s.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,r=n.length,o=new Array(r);s<r;s++)o[s]=n[s].fn;return o},a.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,s,r,o){var a=i?i+e:e;if(!this._events[a])return!1;var l,u,d=this._events[a],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,s),!0;case 5:return d.fn.call(d.context,t,n,s,r),!0;case 6:return d.fn.call(d.context,t,n,s,r,o),!0}for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];d.fn.apply(d.context,l)}else{var _,h=d.length;for(u=0;u<h;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),c){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,n);break;case 4:d[u].fn.call(d[u].context,t,n,s);break;default:if(!l)for(_=1,l=new Array(c-1);_<c;_++)l[_-1]=arguments[_];d[u].fn.apply(d[u].context,l)}}return!0},a.prototype.on=function(e,t,i){return r(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return r(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,n,s){var r=i?i+e:e;if(!this._events[r])return this;if(!t)return o(this,r),this;var a=this._events[r];if(a.fn)a.fn!==t||s&&!a.once||n&&a.context!==n||o(this,r);else{for(var l=0,u=[],d=a.length;l<d;l++)(a[l].fn!==t||s&&!a[l].once||n&&a[l].context!==n)&&u.push(a[l]);u.length?this._events[r]=1===u.length?u[0]:u:o(this,r)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a},152102:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},55857:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(206659),s=i(592906),r=i(755151),o=()=>{},a=new s.TimeoutError;t.default=class extends n{constructor(e){var t,i,n,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=o,this._resolveIdle=o,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:r.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(i=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==i?i:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(s=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==s?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=o,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=o,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((i,n)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const r=void 0===this._timeout&&void 0===t.timeout?e():s.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&n(a)}));i(await r)}catch(e){n(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},978623:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i){let n=0,s=e.length;for(;s>0;){const r=s/2|0;let o=n+r;i(e[o],t)<=0?(n=++o,s-=r+1):s=r}return n}},755151:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(978623);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const i={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(i);const s=n.default(this._queue,i,((e,t)=>t.priority-e.priority));this._queue.splice(s,0,i)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},592906:(e,t,i)=>{"use strict";const n=i(152102);class s extends Error{constructor(e){super(e),this.name="TimeoutError"}}const r=(e,t,i)=>new Promise(((r,o)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void r(e);const a=setTimeout((()=>{if("function"==typeof i){try{r(i())}catch(e){o(e)}return}const n=i instanceof Error?i:new s("string"==typeof i?i:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),o(n)}),t);n(e.then(r,o),(()=>{clearTimeout(a)}))}));e.exports=r,e.exports.default=r,e.exports.TimeoutError=s},811385:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var n=i(661533),s=i.n(n),r=i(629133),o=i.n(r),a=i(389069),l=i.n(a),u=i(313981),d=s()("html"),c=d.hasClass("explorer");function _(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.identifier=t,this.target=e,this.clientX=(i.clientX||0)+n,this.clientY=(i.clientY||0)+s,this.screenX=(i.screenX||0)+n,this.screenY=(i.screenY||0)+s,this.pageX=(i.pageX||0)+n,this.pageY=(i.pageY||0)+s}function h(){var e=[];return e.item=function(e){return this[e]||null},e.identifiedTouch=function(e){return this[e+1]||null},e}document.createTouchList||(document.createTouchList=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,s=new h;for(n=0;n<t.length;n++)s[n]=t[n];return s.length=t.length,s});const p=u.default.extend({subview:null,pipe_stats_animated:null,horizontal_scroll:null,block_inertial_scroll:null,touch_coords:null,hor_scroll_tmid:null,stats_opened:null,blocked_interaction:null,resize_ns:".stats_resize",_selectors:function(){return{list_holder:"#list_holder",headline_stats:"#pipeline__stats",scroller:".pipeline-scroller",pipeline_body:".pipeline__body"}},initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,this.setElement(e.$el||s()("#list_page_holder")),u.default.prototype.initialize.call(this),e.reset_on_init&&this.resetTransform(),this.subview=this._addComponent(e.HeadlineView,o().extend({onInit:o().bind((function(){this.initEvents(),o().isFunction(e.onInitSubview)&&e.onInitSubview()}),this)},e.headline_view_options||{}))},destroy:function(){this._$document.off("page:change:stop".concat(this.ns)),this._$window.off(this.resize_ns),u.default.prototype.destroy.call(this)},initEvents:function(){var e=this.options.scroll_elem?" ".concat(this.options.scroll_elem):"";this.events=this.events||{},this.events[APP.wheel_event+e]="onScroll",APP.is_touch_device?(this.events["touchmove".concat(e)]="onTouchMove",this.events["touchstart".concat(e)]="onTouchStart",this.touch_coords={}):document.getElementById("list_page_holder")&&this._addComponent(l(),{elem:document.getElementById("list_page_holder"),preventMouse:!1,callback:o().bind((function(e){this.page_x=this._elem("scroller").scrollLeft(),!this._isTopScroll()||this.pipe_stats_animated||this._isOverlappingScroll(e)||this.horizontal_scroll||(this.block_inertial_scroll=!1,!0===this._getScrollTrigger(this._getDeltas(e))&&this.showStats(e))}),this)}),this.delegateEvents(),this._$document.on("page:change:stop".concat(this.ns),o().bind(this.resetTransform,this))},onTouchStart:function(e){this.touch_coords.x_start=e.originalEvent.touches[0].screenX,this.touch_coords.y_start=e.originalEvent.touches[0].screenY},onTouchMove:function(e){var t=Math.abs(e.originalEvent.touches[0].screenX-this.touch_coords.x_start),i=Math.abs(e.originalEvent.touches[0].screenY-this.touch_coords.y_start),n=e.originalEvent.touches[0].screenY>this.touch_coords.y_start;i>t&&n&&this._isTopScroll()&&!this.stats_opened&&!this._isOverlappingScroll.apply(this,arguments)&&e.preventDefault()},onScroll:function(e,t,i){var n,s,r=window.TouchEvent&&(n=e.originalEvent,null!=(s=TouchEvent)&&"undefined"!=typeof Symbol&&s[Symbol.hasInstance]?!!s[Symbol.hasInstance](n):n instanceof s),a={deltaY:r?-1*i:e.deltaY,deltaX:r?-1*t:e.deltaX};this._isOverlappingScroll(e)||this._isTopScroll()&&(Math.abs(this._elem("scroller").scrollLeft()-this.page_x)>0&&!c&&(this.horizontal_scroll=!0,clearTimeout(this.hor_scroll_tmid),this.hor_scroll_tmid=setTimeout(o().bind((function(){this.horizontal_scroll=!1}),this),30)),this.pipe_stats_animated||this.block_inertial_scroll||this.stats_opened&&Math.abs(a.deltaX)<=10&&a.deltaY>0?e.preventDefault():!1===this._getScrollTrigger(a)&&this._isSmallPageContent()?(e.preventDefault(),this.hideStats()):this._getScrollTrigger(a)&&r&&this.showStats())},showStats:function(){var e,t=this._isSmallPageContent();this.pipe_stats_animated=!0,this.stats_opened=!0,t&&this._toggleHeight({toggle:t}),this._elem("list_holder").addClass("list__body__holder_stats_opening list__body__holder_stats_opened"),o().delay(o().bind((function(){e=s()(".ui-started"),this.pipe_stats_animated=!1,this._$window.trigger("hs:resize"),t||this.bindHideOnScroll(),o().isFunction(this.options.onStatsShow)&&this.options.onStatsShow(),APP.is_touch_device&&e.length&&function(e,t,i){var n;o().isNull(t)&&(t=0),o().isNull(i)&&(i=0);try{(n=document.createEvent("TouchEvent")).initTouchEvent("touchend",!0,!0)}catch(e){try{(n=document.createEvent("UIEvent")).initUIEvent("touchend",!0,!0)}catch(e){(n=document.createEvent("Event")).initEvent("touchend",!0,!0)}}n.changedTouches=[{pageX:t,pageY:i}],n.touches=new h,n.touches.push(new _(e,1,{},0,0)),e.dispatchEvent(n)}(e.removeClass("ui-started").get(0))}),this),400),this._$window.on("resize".concat(this.resize_ns),o().debounce(o().bind(this.onLayoutChange,this),50))},bindHideOnScroll:function(){this.hide_on_scroll_binded||(this.hide_on_scroll_binded=!0,this._elem("list_holder").removeClass("list__body__holder_stats_opening").css(this._getCssConfig(!0)),this._$window.on("scroll".concat(this.ns),o().bind(o().debounce(this.onPageScroll,350),this)))},hideStats:function(e){this.pipe_stats_animated=!0,this._elem("list_holder").removeClass("h-animation-ff list__body__holder_stats_opening").addClass("list__body__holder_stats_closing"),o().delay(o().bind((function(){this.pipe_stats_animated=!1,this.stats_opened=!1,this._isSmallPageContent()&&(c||APP.is_touch_device||(this.block_inertial_scroll=!0),this._toggleHeight({toggle:!1})),this._elem("list_holder").removeClass("list__body__holder_stats_closing list__body__holder_stats_opened"),o().isFunction(this.options.onStatsHide)&&this.options.onStatsHide(),this._$window.triggerHandler("hs:resize"),this._$window.off(this.resize_ns),o().isFunction(e)&&e()}),this),150)},onPageScroll:function(){var e;this._elem("headline_stats").visible()||(e=this._$window.scrollTop(),this.stats_opened=!1,this._elem("list_holder").removeClass("list__body__holder_stats_opened").css(this._getCssConfig()),this._$window.trigger("hs:resize"),this._$window.scrollTop(e-this._elem("headline_stats").outerHeight()).off(this.ns),this.hide_on_scroll_binded=!1)},_getScrollTrigger:function(e){var t=this.stats_opened,i=e.deltaX,n=e.deltaY;return(0===i||Math.abs(i)<=10&&0!==n)&&!t&&n>=1||!(0===i&&t&&n<0)&&void 0},_getDeltas:function(e){var t,i;return"detail"in e&&(i=-1*e.detail),"wheelDelta"in e&&(i=e.wheelDelta),"wheelDeltaY"in e&&(i=e.wheelDeltaY),"wheelDeltaX"in e&&(t=-1*e.wheelDeltaX),{deltaY:i||(isNaN(e.deltaY)?0:-1*e.deltaY),deltaX:t||(isNaN(e.deltaX)?0:-1*e.deltaX)}},_isTopScroll:function(){return 0===this._$window.scrollTop()},_isOverlappingScroll:function(e){var t=+this._$body.attr("data-body-fixed");return!o().isNaN(t)&&0!==t||this.blocked_interaction||e.ctrlKey||d.hasClass("has-suggest-manager")||!!s()(e.target).closest(".control--suggest--list-opened").length},_isSmallPageContent:function(){return this._elem("list_holder").outerHeight()-(this._elem("headline_stats").visible()&&this._elem("headline_stats").outerHeight())<=window.innerHeight},_toggleHeight:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._elem("pipeline_body").toggleClass("pipeline__body_contracted",e.toggle)},_getCssConfig:function(e){var t={};return t[Modernizr.prefixed("transform")]="translateY(".concat(e?0:"-15px",")"),t.paddingTop=e?65:0,t},_pauseHeadlineStats:function(e){this.blocked_interaction=(e||{}).stop},resetTransform:function(){this._elem("list_holder").removeClass("list__body__holder_stats_opened list__body__holder_stats_opening list__body__holder_stats_closing").css(this._getCssConfig())},onLayoutChange:function(e){if(this.stats_opened){var t=e||this._isSmallPageContent();this._toggleHeight({toggle:t}),t?(this._$window.off(this.ns),this._elem("list_holder").addClass("list__body__holder_stats_opening h-animation-ff").css(this._getCssConfig())):this.bindHideOnScroll()}},stopHeadlineStats:function(){this._pauseHeadlineStats({stop:!0})},startHeadlineStats:function(){this._pauseHeadlineStats({stop:!1})},isOpen:function(){return this.stats_opened},forceClose:function(){return new Promise(o().bind((function(e){this.onLayoutChange(!0),this.hideStats(e),this.hide_on_scroll_binded=!1}),this))}});var f="../build/transpiled/components/base/mousewheel_topbar";window.define(f,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([f])},496406:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var n=i(629133),s=i.n(n),r=i(460159),o=i.n(r),a=i(323344),l=i(481612);const u={PACK_VOLUME:APP.constant("leads_pack_volume")||15,makePackages:function(e){var t,i=this;return e=s().map(e,(function(e){return e.id.toString()})),t=decodeURIComponent((0,a.getQueryString)(),!0),t=(0,l.deserializeFilterParams)((0,a.QStoJSON)(t,!1)),this.filter_statuses_data_key=this.getStatusFilterKey(t),"object"==typeof t[this.filter_statuses_data_key]?e=s().filter(e,(function(e){return s().contains(t[i.filter_statuses_data_key],e)}),this):"string"==typeof t[this.filter_statuses_data_key]&&(e=[t[this.filter_statuses_data_key]]),this.initLeadsByStatusContext(e),e=s().chunk(e,this.PACK_VOLUME),s().map(e,(function(e){var n=s().clone(t);return n[i.filter_statuses_data_key]=e,n}),this)},getStatusFilterKey:function(e){var t;if(e&&e["filter[status_id][]"])return"filter[status_id][]";if(e&&e["filter[pipe]["+this.pipeline_id+"][]"])return"filter[pipe]["+this.pipeline_id+"][]";if(e&&e["filter[status_id][0]"]){for(e["filter[status_id][]"]=[],t=0;e["filter[status_id]["+t+"]"];)e["filter[status_id][]"].push(e["filter[status_id]["+t+"]"]),delete e["filter[status_id]["+t+"]"],t++;return"filter[status_id][]"}if(e&&e["filter[pipe]["+this.pipeline_id+"][0]"])for(e["filter[pipe]["+this.pipeline_id+"][]"]=[],t=0;e["filter[pipe]["+this.pipeline_id+"]["+t+"]"];)e["filter[pipe]["+this.pipeline_id+"][]"].push(e["filter[pipe]["+this.pipeline_id+"]["+t+"]"]),delete e["filter[pipe]["+this.pipeline_id+"]["+t+"]"],t++;return"filter[pipe]["+this.pipeline_id+"][]"},createDataToRenderHeadStatuses:function(e,t){return{all_count:0,leads_by_status:e=s().map(e,(function(e){return{count:e.get("count"),leads_numeral:e.get("leads_numeral"),price_formated:e.get("price_formated"),status:e.get("id").toString(),total_price:e.get("total_price"),type:e.get("type"),loaded:!s().contains(t,e.get("id").toString())}}))}},initLeadsByStatusContext:function(e){var t=this.createDataToRenderHeadStatuses(this.statuses.models,e);this._head_statuses_info_loading=t},updateLeadsByStatusContext:function(e){var t=0;this._head_statuses_info_loading.leads_by_status=s().map(this._head_statuses_info_loading.leads_by_status,(function(i){var n=s().find(e.leads_by_status,(function(e){return Number(i.status)===Number(e.status)}));return n?(t+=n.count,n.loaded=!0,n):(t+=i.count,i)}),this),this._head_statuses_info_loading.all_count=t,this._renderHeadStatuses(this._head_statuses_info_loading)},renderPlugInStatus:function(e){var t=this;s().each(e,(function(e){s().each(e[t.filter_statuses_data_key],(function(e){t._elem("status_items_list",e).html(o()({ref:"/tmpl/leads_pipeline/plug/fake_leads_in_status.twig"}).render({leads:s().range(Math.ceil(20*Math.random()))}))}),t)}),this)},removePlugInStatus:function(e){var t=this;s().each(e[this.filter_statuses_data_key],(function(e){t._elem("status_items_list",e).find(t._selector("pipeline_items__list_plug")).remove()}),this)}};var d="../build/transpiled/interface/leads/mixins/lazy_load_leads";window.define(d,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([d])},322403:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var n=i(629133),s=i.n(n),r=i(661533),o=i.n(r),a=i(323344);const l={events:{"click .js-sort__item":"sortLeads","click .context-menu__item_header":"sortStopPropagation"},sortLeads:function(e){var t=o()(e.currentTarget),i={sort_unread:t.attr("data-sort-unread"),sort_by:t.attr("data-sort-by"),sort_type:t.attr("data-sort-type")},n={sorting:{}},r=(0,a.getQueryParam)("term")||"",l=t.closest(".context-menu-pipeline");s().isUndefined(i.sort_unread)?n.sorting={by:i.sort_by,type:t.hasClass("context-menu__item_active")?"asc"===i.sort_type?"desc":"asc":i.sort_type}:n.sorting.unread_first=!i.sort_unread,o().ajax({url:"/ajax/v1/leads/pipeline/".concat(this.pipeline_id,"/settings"),type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",context:this,data:JSON.stringify({request:{settings:n}})}).done((function(e){var t=e&&e.response&&e.response.settings&&e.response.settings.sorting;if(e.error||s().isUndefined(t))return this.showErrorModal();r&&l.find(".js-sort__item").each((function(e,i){o()(i).attr("data-sort-by")===t.by?o()(i).attr("data-sort-type",t.type).addClass("context-menu__item_active"):o()(i).attr("data-sort-type","desc").removeClass("context-menu__item_active")})),this._$document.trigger("page:reload")})).fail((function(){this.showErrorModal()}))},sortStopPropagation:function(e){e.stopPropagation()}};var u="../build/transpiled/interface/leads/mixins/leads_sorting";window.define(u,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([u])},269413:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var n=i(661533),s=i.n(n),r=i(629133),o=i.n(r),a=i(460159),l=i.n(a),u=i(161320),d=i.n(u),c=i(313981),_=i(323344);const h=c.default.extend({_stats_order:["due","without_task","overdue","new_today","new_yesterday"],filter_presets:{without_task:{"filter[tasks][]":"no_tasks"},overdue:{"filter[tasks][]":"failed_tasks"},due:{"filter[tasks][]":"today"},new_today:function(){var e=APP.system.format.date.date;return{filter_date_switch:"created",filter_date_from:d()().tz(APP.system.timezone).format(e),filter_date_to:d()().tz(APP.system.timezone).format(e)}},new_yesterday:function(){var e=APP.system.format.date.date;return{filter_date_switch:"created",filter_date_from:d()().tz(APP.system.timezone).subtract(1,"days").format(e),filter_date_to:d()().tz(APP.system.timezone).subtract(1,"days").format(e)}}},events:{"click .pipeline-leads__stats-inner .pipeline-leads__stats-count":"onStatsFilterClick"},initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,this.$filter_form=s()("#filter_form"),this.setElement(s()("#pipeline__stats")),c.default.prototype.initialize.call(this)},destroy:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this._render_xhr&&"undefined"!==this._render_xhr.status&&this._render_xhr.abort(),c.default.prototype.initialize.apply(this,t)},render:function(e,t){var i=t||(0,_.getQueryString)();this._render_xhr=s().ajax({url:"/ajax/leads/sum/".concat(e,"/"),type:"POST",data:"pipeline_stats=Y".concat(i.length?"&":"").concat(i),dataType:"json"}).always(o().bind((function(){this._render_xhr=null}),this)).done(o().bind((function(t){var i,n,s,r={due:0,without_task:0,overdue:0,new_today:0,new_yesterday:0};t&&(i=t.prospective,s=t.leads_by_status,o().each(s,(function(e){r.due+=e.task_today,r.without_task+=e.without_task,r.overdue+=e.failed_task,r.new_yesterday+=e.created_yesterday,r.new_today+=e.created_today})),t.prospective&&t.leads_by_status&&(n={pipeline_id:e,prospects:{leads:i.show_forecast?i.prospective_all:0,sum:i.show_forecast?i.prospective_all_sum:0},stats:o().chain(r).map((function(e,t){return{type:t,value:e}})).filter((function(e){return o().contains(this._stats_order,e.type)}),this).sortBy((function(e){return o().indexOf(this._stats_order,e.type)}),this).value()},this.$el.html(l()({ref:"/tmpl/leads_pipeline/stats.twig"}).render(n)),this.toggle_stats_active||(this.toggle_stats_active=!0,o().isFunction(this.options.onInit)&&this.options.onInit())))}),this))},onStatsFilterClick:function(e){var t=s()(e.target),i=t.data("type");"0"!==t.text()&&(this.setCustomFilter(i),this._$document.trigger("filter:apply"))},setCustomFilter:function(e){var t=o().result(this.filter_presets,e,{}),i=APP.data.current_view.search.filter;t&&(o().each(t,(function(e,t){i.form.model.set(t,e)}),this),i.apply())}});var p="../build/transpiled/interface/leads/pipeline/headline_filter";window.define(p,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([p])},197916:(e,t,i)=>{"use strict";i.r(t),i.d(t,{STATUS_DESCRIPTION_WRAP_DURATION:()=>n});var n=100,s="../build/transpiled/interface/leads/pipeline/status_descriptions/constants";window.define(s,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([s])},225418:(e,t,i)=>{"use strict";i.r(t),i.d(t,{StatusDescriptions:()=>f});var n=i(629133),s=i.n(n),r=i(313981),o=i(197916),a=i(734386),l=i(661533);function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,i){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i||e):s.value}},d(e,t,i||e)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function _(e,t){return _=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=c(e);if(t){var s=c(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return function(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}(this,i)}}var p=o.STATUS_DESCRIPTION_WRAP_DURATION,f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(r,e);var t,i,n=h(r);function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),n.apply(this,arguments)}return t=r,i=[{key:"_classes",value:function(){return{statusDescriptions:"pipeline_status__description",statusDescriptionsOverlay:"pipeline_status__description_overlay",overlay:"pipeline_status__description_overlay",scroller:"pipeline-scroller"}}},{key:"_selectors",value:function(){return{overlay:".".concat(this._class("overlay")),scroller:".".concat(this._class("scroller"))}}},{key:"initialize",value:function(e){this.options=e,d(c(r.prototype),"initialize",this).call(this,e),this.setElement(e.$el),this._bindMethods(),this._addItems(),this._initListeners()}},{key:"_$overlay",get:function(){return l(this._selector("overlay"))}},{key:"_addOverlays",value:function(){this._overlayAdded||(this._$currentPipelineCellHead.after(l("<div/>",{class:"default-overlay ".concat(this._class("statusDescriptionsOverlay"))})),this._overlayAdded=!0)}},{key:"_destroyOverlays",value:function(){this._$overlay.remove(),this._overlayAdded=!1}},{key:"_addItems",value:function(){var e=this;this._itemsList=[],this._elem("statusDescriptions").each((function(t,i){e._itemsList.push(e._addComponent(a.StatusDescriptionsItem,{$el:i,showOverlay:e.showOverlay,hideOverlay:e.hideOverlay,onDescriptionUnwrap:e.onDescriptionUnwrap,onDescriptionWrap:e.onDescriptionWrap}))}))}},{key:"_wrapCurrentItem",value:function(){this._currentDescriptionComponent&&this._currentDescriptionComponent.wrap()}},{key:"_onDescriptionUnwrap",value:function(e){var t=e.$pipelineCellHead,i=e.componentId;this._currentDescriptionComponentId=i,this._$currentPipelineCellHead=t,this._currentDescriptionComponent=s().findWhere(this._itemsList,{cid:i})}},{key:"_onDescriptionWrap",value:function(e){this._currentDescriptionComponentId===e&&(this._currentDescriptionComponentId=null,this._$currentPipelineCellHead=null,this._currentDescriptionComponent=null)}},{key:"_showOverlay",value:function(){this._clearOverlayTimeouts(),this._overlayAdded&&(this._$overlay.removeClass("default-overlay-visible default-overlay-fading"),this._destroyOverlays()),this._addOverlays(),this._$overlay.show(),this._$overlay.addClass("default-overlay-visible")}},{key:"_hideOverlay",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e===this._currentDescriptionComponentId){this._clearOverlayTimeouts();var n=function(){t._$overlay.addClass("default-overlay-fading"),t.cleanClassesTimeoutId=setTimeout((function(){t._$overlay.removeClass("default-overlay-visible"),t._$overlay.removeClass("default-overlay-fading"),t._destroyOverlays()}),p)};if(i)return n();this.hideTimeoutId=setTimeout((function(){n()}),o.STATUS_DESCRIPTION_WRAP_DURATION)}}},{key:"_hideOverlayForce",value:function(){this._hideOverlay(this._currentDescriptionComponentId,!0)}},{key:"_clearOverlayTimeouts",value:function(){clearTimeout(this.hideTimeoutId),clearTimeout(this.cleanClassesTimeoutId),this.hideTimeoutId=null,this.cleanClassesTimeoutId=null}},{key:"_initListeners",value:function(){this._$document.on("aside_menu:open",this._hideOverlayForce)}},{key:"_destroyListeners",value:function(){this._$document.off("aside_menu:open",this._hideOverlayForce)}},{key:"_bindMethods",value:function(){this.showOverlay=s().bind(this._showOverlay,this),this.hideOverlay=s().bind(this._hideOverlay,this),this.onDescriptionUnwrap=s().bind(this._onDescriptionUnwrap,this),this.onDescriptionWrap=s().bind(this._onDescriptionWrap,this),this._hideOverlayForce=s().bind(this._hideOverlayForce,this)}},{key:"destroy",value:function(){this._hideOverlayForce(),this._destroyListeners(),d(c(r.prototype),"destroy",this).apply(this,arguments)}}],i&&u(t.prototype,i),r}(r.default),m="../build/transpiled/interface/leads/pipeline/status_descriptions/status_descriptions";window.define(m,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([m])},734386:(e,t,i)=>{"use strict";i.r(t),i.d(t,{StatusDescriptionsItem:()=>_});var n=i(629133),s=i(313981),r=i(197916),o=i(661533);function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,i){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i||e):s.value}},l(e,t,i||e)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=u(e);if(t){var s=u(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return function(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}(this,i)}}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(_,e);var t,i,s=c(_);function _(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_),s.apply(this,arguments)}return t=_,(i=[{key:"_classes",value:function(){return{statusDescriptions:"pipeline_status__description",text:"pipeline_status__description_text",textFull:"pipeline_status__description_text--full",pipelineCell:"pipeline_cell",pipelineCellActive:"pipeline_cell--active",pipelineCellHead:"pipeline_cell-head",pipelineCellHeadActive:"pipeline_cell-head--active",pipelineCellWrapping:"pipeline_cell-head--wrapping",overlay:"pipeline_status__description_overlay",fallback:"pipeline_status__description_fallback"}}},{key:"_selectors",value:function(){return{pipelineCell:".".concat(this._class("pipelineCell")),pipelineCellHead:".".concat(this._class("pipelineCellHead")),statusDescriptions:".".concat(this._class("statusDescriptions")),overlay:".".concat(this._class("overlay"))}}},{key:"events",value:function(){return{mouseenter:"_onMouseenter",mouseleave:"_onMouseleave"}}},{key:"initialize",value:function(e){this.options=e,l(u(_.prototype),"initialize",this).call(this,e),this.setElement(e.$el),this._setTextMaxSize(),this._setCellCursor(),this.wrap=(0,n.bind)(this._wrap,this),this.unwrap=(0,n.bind)(this._unwrap,this)}},{key:"_$pipelineCell",get:function(){return this.$el.closest(this._selector("pipelineCell"))}},{key:"_$pipelineCellHead",get:function(){return this.$el.parent(this._selector("pipelineCellHead"))}},{key:"_needUnwrapText",get:function(){return this._unwrapTextHeight>this._wrapTextHeight}},{key:"_setTextMaxSize",value:function(){var e=this._elem("text")[0].offsetHeight,t=this._calculateDescriptionMaxSize();this._elem("text").css({maxHeight:e}),this._wrapTextHeight=e,this._unwrapTextHeight=t}},{key:"_setCellCursor",value:function(){this.$el.css({cursor:this._needUnwrapText?"pointer":"default"})}},{key:"_unwrap",value:function(){!this._needUnwrapText||this._isUnwrap&&!this._isWrapping||(clearTimeout(this._wrapClassesTimerId),this._$window.scrollTop()>0&&this._$window.scrollTop(0),this._setCellFallback(),this._elem("text").css({maxHeight:this._unwrapTextHeight}),this._$pipelineCell.addClass(this._class("pipelineCellActive")),this._$pipelineCellHead.addClass(this._class("pipelineCellHeadActive")),this._elem("text").addClass(this._class("textFull")),this._isUnwrap=!0,this.options.onDescriptionUnwrap({$pipelineCellHead:this._$pipelineCellHead,componentId:this.cid}),this.options.showOverlay())}},{key:"_wrap",value:function(){var e=this;this._isUnwrap&&(this.options.hideOverlay(this.cid),this._elem("text").css({maxHeight:this._wrapTextHeight}),this._isUnwrap=!1,this._isWrapping=!0,this._$pipelineCellHead.addClass(this._class("pipelineCellWrapping")),this._wrapClassesTimerId=setTimeout((function(){e._removeCellFallback(),e._$pipelineCell.removeClass(e._class("pipelineCellActive")),e._$pipelineCellHead.removeClass(e._class("pipelineCellHeadActive")),e._elem("text").removeClass(e._class("textFull")),e.options.onDescriptionWrap(e.cid),e._isWrapping=!1,e._$pipelineCellHead.removeClass(e._class("pipelineCellWrapping"))}),r.STATUS_DESCRIPTION_WRAP_DURATION))}},{key:"_calculateDescriptionMaxSize",value:function(){var e=this._elem("text"),t=e.html(),i=e.width(),n=o("<div/>").css({position:"fixed",display:"none",width:i,height:"auto",fontSize:e.css("font-size"),lineHeight:e.css("line-height"),color:"transparent"}).html(t);n.appendTo("body");var s=n.height();return n.remove(),s}},{key:"_setCellFallback",value:function(){if(!this._withFallback){var e=this._$pipelineCellHead.clone(!0,!0);this._$pipelineCellHead.parent().prepend(e),this._$cellFallback=e,this._withFallback=!0}}},{key:"_removeCellFallback",value:function(){this._$cellFallback&&this._withFallback&&this._$cellFallback.remove(),this._withFallback=!1,this._$cellFallback=null}},{key:"_onMouseenter",value:function(){this._unwrap()}},{key:"_onMouseleave",value:function(){this._wrap()}}])&&a(t.prototype,i),_}(s.default)},334829:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m});var n=i(661533),s=i.n(n),r=i(629133),o=i.n(r),a=i(460159),l=i.n(a),u=i(162262),d=i.n(u),c=i(313981),_=i(214558),h=i(224043),p=i(845043),f=[];const m=c.default.extend({template:"/tmpl/leads_pipeline/unsorted/item.twig",className:"pipeline_leads__item pipeline-unsorted__item js-unsorted-item js-pipeline-sortable",$detail:null,details:{forms:{template:"/tmpl/list/cells/form_detail.twig",prepare:function(){var e=this.model.get("source_data");return{date_create:this.model.get("date_create"),detail:{from:e.from,data:e.data}}}},chats:{template:"/tmpl/list/cells/chat_detail.twig",prepare:function(){var e=this.model.get("source_data");return{date_create:this.model.get("date_create"),detail:{from:e.service,data:e.data,user_name:e.name,manager_name:this.model.get("manager_name")}}}},mail:{template:"/tmpl/list/cells/email_detail.twig",prepare:function(){return this.model.toJSON()}}},_classes:function(){return{sortable:"js-pipeline-sortable",player_wrapper:"js-audio_wrapper"}},events:{"click .pipeline-unsorted__item-action_decline":"declineClick","click .pipeline-unsorted__item-action_link":"_linkClick","click .pipeline-unsorted__item-action_accept":"acceptClick","swipe .pipeline-unsorted__item-data":"unsortedSwipe","touchmove .pipeline-unsorted__item-data":"unsortedTouchMove","touchstart .pipeline-unsorted__item-data":"unsortedTouchStart","click .js-unsorted--merge":"mergeUnsorted",click:"onTileClick","unsorted:highlight":"highlight","unsorted:accept":"acceptFromEvent","unsorted:decline":"declineFromPipelineManage"},document_events:{"controls:hide:private":"hideDetailOnClickOutside","unsorted:details:clear":"hideDetail","unsorted:drop":"hideDetail"},initialize:function(e){this.options=e||{},c.default.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"decline:start",this.loadStart),this.listenTo(this.model,"declined:failed",this.declineFailed),this.listenTo(this.model,"decline:finished",this.loadStop),this.listenTo(this.model,"declined:success",o().bind(this.destroy,this,!0)),this.listenTo(this.model,"accept:start",this.loadStart),this.listenTo(this.model,"accepted:failed",this.acceptFailed),this.listenTo(this.model,"accept:finished",this.loadStop),this.listenTo(this.model,"accepted:success",this.replaceWithLead),this.listenTo(this.model,"link:start",this.loadStart),this.listenTo(this.model,"linked:failed",this.linkFailed),this.listenTo(this.model,"linked:finished",this.loadStop),this.listenTo(this.model,"linked:success",o().bind(this.destroy,this,!0)),this.listenTo(this.model,"remove",o().bind(this.destroy,this,!0)),d().mixin(this,h.default)},destroy:function(e){this.hideDetail(),c.default.prototype.destroy.call(this,e)},render:function(){var e=s().Deferred();return l()._preload([this.template],o().bind((function(){this.el.id="pipeline_item_".concat(this.model.id),this.el.innerHTML=l()({ref:this.template}).render(o().extend({managers:(0,_.get)()},this.model.toJSON())),e.resolve(this.el)}),this))(),e.promise()},loadStart:function(){this.$el.removeClass(this._class("sortable")).addClass("pending").append('<div class="default-overlay default-overlay-visible unsorted-pipeline-overlay"><span class="spinner-icon spinner-icon-abs-center"></span></div>')},loadStop:function(){this.$el.addClass(this._class("sortable")).removeClass("pending"),this.$(".default-overlay").remove()},failedModal:function(e){404==+e[0].status&&(new p.default({class_name:"modal-unsorted-fail modal-list",text:APP.lang.unsorted_accept_request_error,accept_text:"ОК"}),s()(document).trigger("unsorted:reload"))},acceptFailed:function(e){this.failedModal(e),this.loadStop(),this.$el.trigger("unsorted:accept:failed")},declineFailed:function(e){this.failedModal(e),this.$el.show(),this.loadStop()},_linkClick:function(e){e.stopPropagation(),this.linkClick(this.model)},declineClick:function(e){e.stopPropagation(),e.preventDefault(),this.$el.trigger("unsorted:decline:click"),this.model.decline()},acceptClick:function(e){e.stopPropagation(),e.preventDefault(),this.$el.trigger("unsorted:accept:click"),this.model.accept({status_id:this.options.statuses[0]})},unsortedSwipe:function(e,t,i){1===t&&0===i&&this.acceptClick.apply(this,arguments),-1===t&&0===i&&this.declineClick.apply(this,arguments)},unsortedTouchStart:function(e){this.x_start=e.originalEvent.touches[0].screenX,this.y_start=e.originalEvent.touches[0].screenY},unsortedTouchMove:function(e){Math.abs(e.originalEvent.touches[0].screenX-this.x_start)>Math.abs(e.originalEvent.touches[0].screenY-this.y_start)&&e.preventDefault()},acceptFromEvent:function(e,t){this.model.accept({status_id:t})},declineFromPipelineManage:function(){this.$el.hide(),this.model.decline()},mergeUnsorted:function(e){e.stopPropagation()},onTileClick:function(e){this.$el.find(".js-call-play").length&&(s().contains(this.$el.find(".js-call-play")[0],e.target)||this.$el.find(".js-call-play")[0]===e.target)||this.openCardClick(e)},openCardClick:function(e){e.stopPropagation(),e.preventDefault(),APP.router.navigate("/leads/detail/".concat(this.model.id),{trigger:!0})},highlight:function(e){(e=!!o().isUndefined(e)||e)?f.push(this):f.splice(f.indexOf(this),1),this.$el.toggleClass("selected",e)},hideDetailOnClickOutside:function(e){s().contains(this.el,e.target)||this.el===e.target||this.hideDetail()},hideDetail:function(){this.highlight(!1)},replaceWithLead:function(e){this._$document.trigger("unsorted:item:accepted",[this.model]),this.getLeadData(e.leads,{success:o().bind((function(e,t){this.$el.trigger("unsorted:lead:render",[e,t]),this.destroy(!0)}),this),error:o().bind(o().bind((function(){this.$el.trigger("unsorted:accept:failed")}),this))})},getLeadData:function(e,t){if(e){var i=APP.data.current_view.pipeline_id;s().get("/ajax/leads/pipeline/".concat(i,"/?filter[ID][]=").concat(e)).always((function(e){if(e.response&&e.response.items){var i=o().keys(e.response.items)[0];t.success(o().first(o().values(e.response.items[i])),i)}else t.error()}))}else t.error()}});var g="../build/transpiled/interface/leads/pipeline/unsorted/item";window.define(g,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([g])},109119:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>f});var n=i(501922),s=i(500034),r=i(859200);function o(e,t,i,n,s,r,o){try{var a=e[r](o),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,s)}function a(e){return function(){var t=this,i=arguments;return new Promise((function(n,s){var r=e.apply(t,i);function a(e){o(r,n,s,a,l,"next",e)}function l(e){o(r,n,s,a,l,"throw",e)}a(void 0)}))}}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function d(e,t,i){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i||e):s.value}},d(e,t,i||e)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function _(e,t){return _=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=c(e);if(t){var s=c(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return function(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}(this,i)}}function p(e,t){var i,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}const f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(m,e);var t,o,f=h(m);function m(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),f.apply(this,arguments)}return t=m,o=[{key:"initialize",value:function(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=[{mountFn:this.mountPipelineOnboarding.bind(this),conditionFn:this.shouldShowOnboarding.bind(this)},{mountFn:this.mountSurvey.bind(this),conditionFn:s.isFeatureAvailable.bind(null,"is_customization_for_global")}];d(c(m.prototype),"initialize",this).call(this,(e=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),n.forEach((function(t){u(e,t,i[t])}))}return e}({},i),t=null!=(t={modalFlow:n})?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i.push.apply(i,n)}return i}(Object(t)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})),e));var r=i.pipelineId,o=i.isArchive,a=i.isPipelineTemplatesAvailable;this.pipelineId=r,this.isArchive=o,this.isPipelineTemplatesAvailable=a}},{key:"shouldShowOnboarding",value:function(){var e=(0,s.isFeatureAvailable)(n.USERFLOW_CONSTANTS.FEATURE_FLAG);return!(!((0,r.isAdmin)()&&APP.constant("account").is_chats_inbox_enabled&&(0,s.isFeatureAvailable)("pipeline_sources_tour"))||e||"Y"===sessionStorage.getItem("pipeline-onboarding-closed"))}},{key:"mountPipelineOnboarding",value:function(e){var t=e.onDestroy,n=this;return a((function(){var e,s,r;return p(this,(function(o){switch(o.label){case 0:return[4,i.e(99656).then(i.bind(i,99656))];case 1:return e=o.sent(),s=e.default,r=n._addComponent(s,{pipeline_id:n.pipelineId,is_archive:n.isArchive,is_pipeline_templates_available:n.isPipelineTemplatesAvailable,onDestroy:t}).el,n.$el.append(r),[2]}}))}))()}},{key:"mountSurvey",value:function(e){var t=e.onDestroy,n=this;return a((function(){var e,s;return p(this,(function(r){switch(r.label){case 0:return[4,Promise.all([i.e(76012),i.e(20983),i.e(56740),i.e(37084),i.e(40446),i.e(95882),i.e(18194),i.e(93671),i.e(70013),i.e(38994),i.e(16228),i.e(26263),i.e(21932),i.e(88012),i.e(11958),i.e(39042),i.e(14095),i.e(20064),i.e(15656),i.e(10642),i.e(68924),i.e(56973),i.e(52758),i.e(41136),i.e(39970),i.e(28419),i.e(58551),i.e(21896),i.e(34040),i.e(79328),i.e(47419),i.e(21921),i.e(27992),i.e(74647),i.e(16025),i.e(15081),i.e(16427),i.e(10417),i.e(42162),i.e(69314),i.e(21483),i.e(95848),i.e(60634),i.e(10657)]).then(i.bind(i,614042))];case 1:return e=r.sent(),s=e.default,n._addComponent(s,{onDestroy:t}),[2]}}))}))()}}],o&&l(t.prototype,o),m}(i(77368).default);var m="../build/transpiled/interface/pipeline_popups_flow/pipeline_popups_flow";window.define(m,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([m])},77368:(e,t,i)=>{"use strict";function n(e,t,i,n,s,r,o){try{var a=e[r](o),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,s)}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i){return r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i||e):s.value}},r(e,t,i||e)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=o(e);if(t){var s=o(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return function(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}(this,i)}}i.r(t),i.d(t,{default:()=>u});const u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(d,e);var t,i,u=l(d);function d(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),u.apply(this,arguments)}return t=d,i=[{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(o(d.prototype),"initialize",this).apply(this,arguments);var t=e.modalFlow;this.modalFlow=t,this.hasPageChanged=!1,this.mount()}},{key:"document_events",value:function(){return{"page:change:start":"handlePageChange"}}},{key:"handlePageChange",value:function(){this.hasPageChanged=!0,this.destroy()}},{key:"showNextModal",value:function(){var e,t=this;return(e=function(){var e;return function(e,t){var i,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(i){switch(i.label){case 0:return!(e=t.modalFlow.shift())||t.hasPageChanged?[2]:[4,e.conditionFn()];case 1:return i.sent()?(e.mountFn({onDestroy:t.showNextModal.bind(t)}),[2]):(t.showNextModal(),[2])}}))},function(){var t=this,i=arguments;return new Promise((function(s,r){var o=e.apply(t,i);function a(e){n(o,s,r,a,l,"next",e)}function l(e){n(o,s,r,a,l,"throw",e)}a(void 0)}))})()}},{key:"mount",value:function(){this.showNextModal()}}],i&&s(t.prototype,i),d}(i(313981).default);var d="../build/transpiled/interface/popups_flow/popups_flow";window.define(d,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([d])},194023:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var n=i(629133),s=i.n(n),r=i(460159),o=i.n(r),a=i(445368),l=i(661533);const u={template_filter:"/tmpl/leads_pipeline/unsorted/filter.twig",initBubbleFilterMixin:function(e){e&&(this.summary=e.summary,this.renderBFM())},renderBFM:function(){o()._preload([this.template_filter])().then(s().bind((function(){this._findElem("unsorted_all").append(o()({ref:this.template_filter}).render({summary:this.summary,hide:{}})),this.bubble=this._findElem("unsorted_bubble_filter"),this.bubble.on("click",".pipeline-unsorted__filter-item:not(.pipeline-unsorted__filter-item_empty)",s().bind(this.selectedBFM,this))}),this))},selectedBFM:function(e){var t=l(e.currentTarget),i=(0,a.getNumberTypeUnsorted)(t.data("type")),n=l('[name="filter[unsorted_category][]"]'),s=l('[name="filter[unsorted_category][]"][value="'.concat(i,'"]'));n.prop("checked",!1),s.prop("checked",!0),n.trigger("controls:change"),this.search.filter.apply()}};var d="../build/transpiled/interface/unsorted/mixins/bubble_filter";window.define(d,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([d])},899762:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});var n=i(629133),s=i.n(n);const r={getUnsortedSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=APP.constant("unsorted"),i=!s().isEmpty(e)&&e||t||{};return i.denied=!0,s().extend({},this.unsorted_settings||{},i)}};var o="../build/transpiled/interface/unsorted/mixins/settings";window.define(o,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([o])},913767:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ne});var n=i(661533),s=i.n(n),r=i(629133),o=i.n(r),a=i(460159),l=i.n(a),u=i(162262),d=i.n(u),c=i(55857),_=i(292057),h=i(156040),p=i(656580),f=i(323344),m=i(955026),g=i(445368),y=i(859200),v=i(926168),b=i(500034),w=i(23456),C=i(146521),P=i(258471),S=i(975222),k=i(537107),E=i(334829),T=i(843752),x=i(258139),A=i(885041),I=i(269413),O=i(530463),D=i(194023),M=i(899762),j=i(322403),L=i(281049),$=i(496406),F=i(109119),R=i(225418),H=i(304483),N=i(845043),U=i(197896),q=i(466072),z=i(851199),W=i(956332),B=i(811385),Q=i(977041),K=i(244294),Y=i(883807),X=i(862227),G=i(481612);function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function V(e,t,i,n,s,r,o){try{var a=e[r](o),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,s)}function Z(e){return function(){var t=this,i=arguments;return new Promise((function(n,s){var r=e.apply(t,i);function o(e){V(r,n,s,o,a,"next",e)}function a(e){V(r,n,s,o,a,"throw",e)}o(void 0)}))}}function ee(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function te(e,t){var i,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}var ie=_.default.extend({preload:["/tmpl/search_summary/leads/index.twig","/tmpl/leads_pipeline/item_controller.twig","/tmpl/leads_pipeline/index.twig","/tmpl/leads_pipeline/inner.twig","/tmpl/leads_pipeline/stats.twig","/tmpl/leads_pipeline/header_info.twig","stylesheets/_chunks/pipeline.css"],template:function(){return this._getTemplateAndHolder().template},_Filter:z.default,endpoint:"/ajax/leads/pipeline/",page:2,status_change_ajax:{},unsorted_settings:{},_selectors:function(){return{first_status_row:".pipeline_cell.pipeline_status:not(.pipeline_cell-unsorted):first .js-pipeline-row",list_top_search_summary:"#list-top-search__summary",item_by_id:'.pipeline_leads__item[data-id="%s"]',manage:"#pipeline_manage",more:"#leads_pipeline_load_more",list_holder:"#list_holder",pipeline:"#pipeline_holder",pipeline_cells:".pipeline_cell",pipeline_list_by_id:'.pipeline_items__list[data-id="%s"]',status_head_by_id:"#status_id_%s",status_info_by_id:"#status_id_%s .pipeline_status__head_info",status_checkbox_by_id:"#status_chckbx_%s",status_items_list:"#pipeline_items__list_%s",sort_by:".js-sort__item.context-menu__item_active",unsorted_all:".pipeline-unsorted__all",unsorted_bubble_filter:"#pipeline_unsorted_filter",filter_unsorted_category:"#filter_unsorted_category"}},_classes:function(){return{cell:"pipeline_cell",cell_head:"pipeline_cell-head",unsorted_head:"pipeline_cell-head-unsorted",unsorted_wrapper:"pipeline_cell-unsorted",row:"js-pipeline-row",item:"pipeline_leads__item",quick_lead_wrapper:"pipeline_leads__quick_add__wrapper",quick_lead_add_button:"pipeline_leads__quick_add_button",pipeline_lists:"pipeline_items__list",scroller:"pipeline-scroller",topbar:"list__body-right__top",stats:"pipeline-leads__stats",pipeline_wrapper:"pipeline_wrapper",multiactions_on:"pipeline_wrapper_multiactions-on",pipeline_items__list_plug:"pipeline_items__list_plug",statusDescription:"pipeline_status__description"}},events:{"click #leads_pipeline_load_more":"onLoadMore","click .js-load-more-in-status-error":"onLoadMoreInStatusAfterError","click .pipeline_leads__tags-inner":"editTags","click .context-menu-pipeline .js-multiactions":"toggleMultiActionsMode","click .js-loss-reason-open-modal":"changeLossReason","click .context-menu-pipeline .js-lead_tile":"showTileModal","change .pipeline_status__head-checkbox input":"onStatusHeadCheckboxChange","unsorted:accept:click .js-unsorted-item":"unsortedAccept","unsorted:accept:failed .js-unsorted-item":"unsortedAcceptFailed","unsorted:lead:render .js-unsorted-item":"unsortedReplaceWithLead"},components:function(){return o().chain(this._components).reject((function(e){return e.defer_init})).map((function(e){if(!o().isFunction(e.params))throw new Error("Component params not defined!");return[e.class,e.params.call(this)]}),this).value()},construct:function(e){var t=this;this.params=e||{},this.response=o().isEmpty(e.response)?APP.constant("leads_pipeline_template_params")||{}:e.response,this.tile_config=this.response.tile_config,this.pipeline_id=this.response.pipeline_id,this.hasUnsorted=this.response.has_unsorted,this.current_pipeline=o().chain(this.response.pipelines).values().findWhere({id:this.pipeline_id}).value()||{},this.statuses=new A.default.Collection(o().values(this.response.leads_info_by_status),{parse:!0}),this.registerPerformance(),d().mixin(this,M.default),d().mixin(this,$.default),this.unsorted_settings=this.getUnsortedSettings(this.response&&this.response.unsorted||{}),o().isEmpty(APP.constant("unsorted"))&&APP.constant("unsorted",this.unsorted_settings),o().each(o().propertyOf(e)(["response","js_params","constants"]),(function(e,t){APP.constant(t,e)})),this.pipeline_card_hidden_fields=this._prepareCardHiddenFields(APP.constant("pipeline_card_hidden_fields")),(0,m.hasKeys)(e,["response","js_params","constants","find_partner_form_path"])&&APP.constant("find_partner_form_path",e.response.js_params.constants.find_partner_form_path),this.cant_load_more=[],this._prepareFilter(this.response),this._queue_head_sum=new c.default({concurrency:3}),this._queue_leads_by_statuses=new c.default({concurrency:3}),this._queue_leads_load_more=new c.default({concurrency:3}),this.pipeline=this._startComponent("pipeline"),this.checkImportHash(),this.bindExistingItems(this.response.items),this.initPlayer(),(0,b.isFeatureAvailable)("pipeline_template_settings")&&this.checkQueryParam("show_pipeline_settings",this.showPipelineSettingsModal),(0,b.isFeatureAvailable)("is_customization_for_global")&&this.checkQueryParam("show_instagram_promo",this.showInstagramPromotionModal),this.search=this._startComponent("search");var i=(0,y.getRights)("status_rights",this.pipeline_id),n=o().keys(i),s=this.statuses.filter((function(e){var s,r=String(e.id);return!(!t.hasUnsorted&&(0,v.isUnsortedStatus)(r)||o().contains(n,r)&&!(0,y.isAdmin)()&&(null==i||null===(s=i[r])||void 0===s?void 0:s.view)===y.RIGHTS_DENIED)}));this.status_packages=this.makePackages(s),this.renderHeadStatuses(),this.initStatusDescriptions(),this.initQuickLeadListener(),(0,h.onPageFullyLoaded)((function(){t.initPipelineModalFlow(),APP.first_load&&t.trackTtiMetric()}))},trackTtiMetric:function(){(0,P.trackPerformanceMetric)({group:P.TrackedMetricGroupName.TTI,name:P.TrackedMetricName.PIPELINE_TTI})},initPipelineModalFlow:function(){var e=parseInt(this.pipeline_id),t=this.current_pipeline.is_archive;this._addComponent(F.default,{pipelineId:e,isArchive:t,isPipelineTemplatesAvailable:!0,el:this.$el})},initStatusDescriptions:function(){this._addComponent(R.StatusDescriptions,{$el:this.$el})},destruct:function(){var e=this;this._elem("more").off(),o().each(["_queue_head_sum","_queue_leads_by_statuses","_queue_leads_load_more"],(function(t){e[t]&&e[t].clear()})),this.player&&(this.player.destroy(),this.player=null),APP.constant("max_page",!1)},checkQueryParam:function(e,t){var i=(0,f.QStoJSON)(window.location.search);if(i[e]){t.call(this),delete i[e];var n=o().isEmpty(i)?"":"?".concat(s().param(i)),r=window.location.pathname+window.location.hash+n;APP.router.navigate(r,{trigger:!1,replace:!0})}},setPlayerPosition:function(e,t){var i=e.closest(this._selector("item")),n=i.position();i.trigger("unsorted:highlight"),t.css({top:n.top+33,left:n.left+i[0].offsetWidth+10})},initPlayer:function(){this.player=this._addComponent(W.default,{$container:this._elem("unsorted_wrapper"),append_to:this._elem("unsorted_wrapper"),afterSetPositions:o().bind(this.setPlayerPosition,this),stop:o().bind((function(){this._$document.trigger("unsorted:details:clear")}),this)})},_prepareCardHiddenFields:function(e){return o().reduce(e,(function(e,t,i){return e[i]=o().map(t,(function(e){return e.toString()})),e}),{})},_updateResponseData:function(e){var t={pipeline_id:e.pipeline_id,use_filter:"y"===(0,f.getQueryParam)("useFilter")||(0,f.getQueryParam)("term")};return e.pipeline_card_hidden_fields=this._prepareCardHiddenFields(e.pipeline_card_hidden_fields),o().extend({},e,t)},_getEndpoint:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e[0]&&+e[0];return this.endpoint+(t?t+"/":"")},_getEndpointData:function(){return(0,f.getQueryString)()},_renderPage:function(e){e=o().extend(e,this._getTemplateAndHolder()),_.default.prototype._renderPage.call(this,e),this.trackTtiMetric()},getFilterState:function(){return(0,f.QStoJSON)(this.cleared_query_string||(0,f.getQueryString)(),!0)},changeUrl:function(){if(!o().propertyOf(this.response)(["filter","preset_filter"])&&(new TextEncoder).encode(encodeURIComponent((0,f.getQueryString)())).length>=6e4){this.cleared_query_string=(0,f.getQueryString)();var e=o().find(o().propertyOf(this.response)(["filter","items"]),(function(e){return 1===e.sort||1e3===e.sort}));APP.router.navigate(e.link||"",{trigger:!1})}},_components:[{name:"autoload",class:q.default,params:function(){return{onLoadMore:o().bind(this.onLoadMore,this)}}},{name:"search",class:S.default,defer_init:!0,params:function(){var e=this;return{filter:{el:s()("#sidebar"),is_list:!0,pipeline_id:this.pipeline_id,has_pipelines:this.response.has_pipelines,pipelines:{items:o().isUndefined(this.response.pipelines)?this.response.filter.statuses.items:this.response.pipelines},custom_fields:this.response.filter.custom_fields,groups_cf:this.response.filter.groups_cf,loss_reason:APP.constant("loss_reason_enabled")&&!o().isUndefined(this.response.filter.loss_reasons)?this.response.filter.loss_reasons.items:{},url:o().propertyOf(this)(["response","filter","url"])?this.response.filter.url:"",preset_filter:o().propertyOf(this)(["response","filter","preset_filter"])?this.response.filter.preset_filter:"",getFilterState:o().bind(this.getFilterState,this),onFilterInit:function(){e.changeUrl()}}}}},{name:"topbar",class:B.default,defer_init:!0,params:function(){var e=this;return{HeadlineView:I.default,reset_on_init:!(APP.first_load||APP.data.entity_changed||!this.response),onStatsShow:function(){e._head_statuses_info&&e._head_statuses_info.is_updated&&e.renderHeadStatuses()}}}},{name:"pipeline",class:U.default,defer_init:!0,params:function(){var e=this,t=o().bind((function(){var e;null===(e=this.headline_stats)||void 0===e||e.onLayoutChange()}),this);return{el:this.$el,is_dnd_disabled:this.current_pipeline.is_archive,hs_options:{static_width:!0,hide_scrollbar:!0,no_boundary:!0,fixed_header_options:{head_cell_info_selector:".js-fixed-header-stats",scroll_offset:65,entity:"leads"}},manage:{el:this._elem("manage"),drop:function(t){var i=t.draggable.closest(e._selector("row")).data("id"),n=s()(this).data("status-id"),r=e.statuses.get(i),o=e._getLeadId(t.draggable),a=r&&(0,v.isUnsortedStatus)(r.get("id"));e.leadsManage({status_old:a?"unsorted":i,status_new:n,lead_id:o,uiItem:t.draggable})}},appendTo:this.$el,change:o().bind((function(e,t){var i=this._getLeadId(e.item),n=this.statuses.get(t.item_old.data("id")),s=n&&(0,v.isUnsortedStatus)(n.get("id"));this.leadsManage({status_old:s?"unsorted":t.item_old.data("id"),status_new:t.item_new.data("id"),lead_id:i,uiItem:e.item})}),this),immutable:function(e){e.item.removeAttr("style")},start:function(){k.default.stopHoverMenu(),e.headline_stats&&e.headline_stats.stopHeadlineStats(),e.$el.addClass("pipeline-manage-".concat(this.getAttribute("data-id"))),e.$el.trigger("unsorted:drop")},stop:function(){k.default.startHoverMenu(),e.headline_stats&&e.headline_stats.startHeadlineStats(),t()},manageHide:function(){e.$el.removeClass("pipeline-manage-".concat(this.getAttribute("data-id")))}}}},{name:"item_unsorted",class:E.default,defer_init:!0,params:function(e,t,i){return o().extend({$scroller:this._elem("scroller"),$page_holder:this.$el,$topbar:this._elem("topbar"),$stats:this._elem("stats"),model:this.itemsPush(o().extend(t,{is_checked:this.statuses.get(t.status).get("all_checked")}),i||{}),statuses:this.statuses.chain().filter((function(e){return!(0,v.isUnsortedStatus)(e.get("id"))})).pluck("id").value()},e||{})}},{name:"item",class:T.default,defer_init:!0,params:function(e,t,i){var n=this.statuses.get(t.status);return o().extend({$scroller:this._elem("scroller"),$page_holder:this.$el,$topbar:this._elem("topbar"),$stats:this._elem("stats"),pipeline_card_hidden_fields:this.pipeline_card_hidden_fields,model:this.itemsPush(o().extend(t,{is_checked:n&&n.get("all_checked")}),i||{}),onTagsInit:o().bind((function(){this.pipeline.disable(),this.pipeline.hs.scrollPause(),this._elem("scroller").addClass("h-scroll-x-blocked")}),this),onTagsDestroy:o().bind((function(){this.pipeline.enable(),this.pipeline.hs.scrollResume(),this._elem("scroller").removeClass("h-scroll-x-blocked")}),this),onTagsUpdate:o().bind((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,s,r=this.search.filter.tags_lib;r&&(n=r).updateTags.apply(n,function(e){if(Array.isArray(e))return J(e)}(s=t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(s)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?J(e,t):void 0}}(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}),this)},e||{})}}],bindExistingItems:function(e){var t=o().reduce(e,(function(e,t,i){return e.concat(o().map(t,(function(e){return o().extend(e,{status:parseInt(i)})})))}),[]);this._items=new x.default,this._items.order_by=[this._elem("sort_by").attr("data-sort-by"),this._elem("sort_by").attr("data-sort-type")],o().each(t,(function(e){var t=this.statuses.get(e.status);if(t){var i=(0,v.isUnsortedStatus)(t.get("id"))?"item_unsorted":"item";this._startComponent(i,{el:document.getElementById("pipeline_item_".concat(e.id))},o().extend(e,{tile_config:this.tile_config}))}}),this),this.listenTo(this._items,"change:is_checked",this.onItemsChecked)},updateHeadStatus:function(e){this._head_statuses_info&&o().some(this._head_statuses_info.leads_by_status,o().bind((function(t){if(parseInt(e.status_id)===parseInt(t.status))return t.total_price+=parseInt(e.new_budget-e.old_budget),this._head_statuses_info.is_updated=!0,this._renderHeadStatuses(this._head_statuses_info),!0}),this))},renderHeadStatuses:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=this,n=o().rest(this.status_packages);if(this._head_statuses_info&&t){if(this.response.pipeline_auto_update&&!0!==t.from_auto_update)return;t.budget=o().isNaN(parseInt(t.budget))?0:parseInt(t.budget),o().each(this._head_statuses_info.leads_by_status,(function(e){t.in_status&&parseInt(t.in_status)===parseInt(e.status)&&(e.count+=1,e.total_price+=t.budget||0),t.out_status&&parseInt(t.out_status)===parseInt(e.status)&&e.count>0&&(e.count-=1,e.total_price-=t.budget||0)})),this._head_statuses_info.is_updated=!0,this._renderHeadStatuses(this._head_statuses_info)}else o().each(this.status_packages,(function(t){e._queue_head_sum.add((function(){return p.default.getLeadsByStatus(i.pipeline_id,s().param(t)).done((function(e){i.updateLeadsByStatusContext(e),i._countSummary(i._head_statuses_info_loading.leads_by_status),i._head_statuses_info=o().clone(i._head_statuses_info_loading)}))}))}),this),this.renderPlugInStatus(n),o().each(n,(function(t){e._queue_leads_by_statuses.add((function(){var e=s().Deferred();return i.loadMore(t[i.filter_statuses_data_key],{page:1,limit:20}).always((function(){i.removePlugInStatus(t)})).done((function(n){n.items&&n.items.length?(i.renderLoaded(n),i.pipeline.refresh()):i.onLoadMoreError(t[i.filter_statuses_data_key],{is_loading_finished:!0}),e.resolve(n)})).fail((function(n){i.onLoadMoreError(t[i.filter_statuses_data_key]),e.reject(n)})),e.promise()}))}),this)},_renderHeadStatuses:function(e){var t=!1;APP.constant("max_page",e.all_count),o().each(e.leads_by_status,(function(e){var i=this.statuses.get(e.status);i&&i.set(e),this._elem("status_info_by_id",e.status).html(l()({ref:"/tmpl/leads_pipeline/header_info.twig"}).render({count:"".concat((0,g.numeralWord)(e.count,(0,g.i18n)("pipeline_total_leads"),!0),": "),sum:(0,g.currency)(e.total_price),status_type:e.type,count_num:e.count})),e.loaded?this._elem("status_info_by_id",e.status).html(l()({ref:"/tmpl/leads_pipeline/header_info.twig"}).render({count:(0,g.numeralWord)(e.count,(0,g.i18n)("pipeline_total_leads"),!0)+": ",sum:(0,g.currency)(e.total_price),status_type:e.type,count_num:e.count})):this._elem("status_info_by_id",e.status).html(l()({ref:"/tmpl/leads_pipeline/plug/fake_pipeline_info.twig"}).render({width_for_sum:"RUB"===APP.system.locale.currency?"55px":"39px",is_currency_symbol_in_the_end:"%v %s"===APP.system.locale.currency_pattern,word_leads:(0,g.numeralWord)(5,(0,g.i18n)("pipeline_total_leads"),!0).split(" ").pop()+":",currency_symbol:APP.system.locale.currency_symbol})),e.count>10&&(t=!0)}),this),this._countSummary(e.leads_by_status),this._findElem("pipeline_cells").find(".pipeline_status__head_info").css({opacity:1,maxHeight:20}),t&&this._elem("more").addClass("leads-pipeline__autoload-load-more-shown")},_countSummary:function(e){var t=o().pluck(this.response.leads_info_by_status,"ID"),i={count:0,budget:0,due:0,without_task:0,overdue:0,new_today:0,new_yesterday:0};if(e){o().each(e,(function(e){o().contains(t,Number(e.status))&&(i.count+=e.count,i.budget+=e.total_price,i.due+=e.task_today,i.without_task+=e.without_task,i.overdue+=e.failed_task,i.new_yesterday+=e.created_yesterday,i.new_today+=e.created_today)})),this.renderHeadlineStats(this.pipeline_id,this.cleared_query_string),this._elem("list_top_search_summary").html(l()({ref:"/tmpl/search_summary/leads/index.twig"}).render({summary:i}));var n=this.$el.find(".pipeline__no-items");this._head_statuses_info_loading.all_count&&n.length&&n.remove(),("y"===(0,f.getQueryParam)("useFilter")||(0,f.getQueryParam)("term"))&&!this._head_statuses_info_loading.all_count&&!n.length&&(this._elem("pipeline").find(this._selector("statusDescription")).hide(),this._elem("pipeline").find("".concat(this._selector("cell"),":not(.h-hidden)")).first().prepend(l()({ref:"/tmpl/leads_pipeline/no_items_filter_tmpl.twig"}).render({pipeline_no_results:(0,g.i18n)("pipeline_no_results"),filter_url:"/leads/pipeline/",pipeline_reset_filter:(0,g.i18n)("pipeline_reset_filter")}))),this._$document.trigger("search:count_width"),this._$document.trigger("search:summary_text:load"),this.initBubbleFilterMixin(o().find(this.response.leads_info_by_status,(function(e){return 1===e.type})))}},_renderSummary:o().noop,renderHeadlineStats:function(){var e=[].slice.apply(arguments),t=o().bind((function(){this._head_statuses_info||this.headline_stats.subview.render(e[0],e[1])}),this);(0,y.getRights)("leads","view")&&(this.headline_stats&&this.headline_stats.subview||(this.headline_stats=this._startComponent("topbar")),t())},toggleMultiActionsMode:function(){var e=this._multiactions_on=!this._multiactions_on,t=o().bind(this._toggleMultiActionsMode,this,e);this.pipeline[e?"disable":"enable"](),this.headline_stats?(this.headline_stats[e?"stopHeadlineStats":"startHeadlineStats"](),this.headline_stats.isOpen()?this.headline_stats.forceClose().then(t):t()):t()},showTileModal:function(){return Z((function(){var e,t;return te(this,(function(n){switch(n.label){case 0:return[4,i.e(49916).then(i.bind(i,449916))];case 1:return e=n.sent(),t=e.default,this.tileModal=this._addComponent(t,{pipeline_id:this.pipeline_id}),[2]}}))})).apply(this)},initQuickLeadListener:function(){var e=this;this.$el.one("click.".concat(this.ns),this._selector("quick_lead_add_button"),(function(t){return e.showQuickLeadForm(t)}))},showQuickLeadForm:function(e){return Z((function(){var t,n,s;return te(this,(function(r){switch(r.label){case 0:return[4,i.e(34852).then(i.bind(i,734852))];case 1:return t=r.sent(),n=t.default,s=this,this._quick_lead_form||(this._quick_lead_form=this._addComponent(n,{$el:this._findElem("quick_lead_wrapper"),template_params:this.response,data:{pipeline:"Y"},onToggle:o().bind((function(){var e;null===(e=this.headline_stats)||void 0===e||e.onLayoutChange()}),this),onSuccess:function(e){var t,i,n=e&&e.viewable;s._items.get(e.id)||(((0,y.isAdmin)()||n)&&(i=s._startComponent("item",{},o().extend(e,{tile_config:s.tile_config})).render().$el,this.$el.after(i).trigger("lead:inserted",[i])),s.renderHeadStatuses({in_status:e.status,budget:e.budget})),null===(t=s.pipeline)||void 0===t||t.refresh()}})),this._quick_lead_form.onQuickAddButtonClick(e),[2]}}))})).apply(this)},_toggleStatusHeadCheckbox:function(e,t,i){var n=this._elem("status_checkbox_by_id",e),s=this.statuses.get(e),r=this._items.checkedInStatus(e),o=r.length===s.get("count")&&s.get("count")>0,a=this._items.byStatus(e).length===s.get("count");t&&o&&(n.prop("checked",!0),s.set("all_checked",!0)),o?n.trigger("controls:checkbox:minus",!1):(!s.get("all_checked")||s.get("all_checked")&&s.ignored_ids.size)&&(n.trigger("controls:checkbox:minus",!!r.length,!0),r.length<20&&a&&s.set("all_checked",!1)),(!r.length&&a||!r.length&&!s.ignored_ids.size||i)&&(s.ignored_ids.clear(),n.prop("checked",!1),s.set("all_checked",!1)),s.set("checked_matches_visible",o&&n.prop("checked"))},showMultiactions:function(e){return Z((function(){var t,i,n,r,a;return te(this,(function(l){switch(l.label){case 0:return[4,(0,Q.getMultiactionsHandlerAsync)()];case 1:return t=l.sent(),i=this._items.getChecked(),n=this.statuses.getToExclude(),r=[],e=e||{},a=o().reject(i,(function(e){return o().contains(o().pluck(n,"id"),e.get("status"))})),o().each(n,(function(e){e.ignored_ids.forEach((function(e){r.push(e)}))})),this.m_actions=this._addComponent(t,{only_remove:!this._multiactions_on,need_anim:!1,show_fake:!i.length,collection:this._items,tip_params:{},checked_items:i,current_entity:"leads",$container:s()("#pipeline__stats"),append_method:"after",render_hidden:e.render_hidden,all_checked:!!n.length,headline_stats:this.headline_stats,handle_through:!!n.length,handle_through_params:{pipeline_filter:o().pluck(n,"id"),pipeline_id:this.pipeline_id,exclude_ids:r},template_params:o().extend({show_close_btn:!0,is_top:!0},this._getMultiactionsSummary(a,n,r)),closeCallback:o().bind(this.toggleMultiActionsMode,this),onRender:e.render_hidden?o().bind((function(e){e.removeClass("h-hidden"),this._elem("list_holder").addClass("list__body__holder_m-actions_opening").one(APP.animation_event,o().bind((function(t){s()(t.currentTarget).removeClass("list__body__holder_m-actions_opening"),e.trigger("multiactions:update_params"),this._$window.scrollTop()&&this._$window.triggerHandler("scroll")}),this))}),this):o().noop,onRemove:e.exit_actions?o().bind((function(e){e=o().isFunction(e)?e:o().noop,this._elem("list_holder").addClass("list__body__holder_m-actions_closing").one(APP.animation_event,(function(t){s()(t.currentTarget).removeClass("list__body__holder_m-actions_closing"),e()}))}),this):void 0,onDestroy:o().bind((function(){this.m_actions=null}),this)}),[2]}}))})).apply(this)},_getMultiactionsSummary:function(e,t,i){return{checked_sum:o().reduce(e,(function(e,t){return e+(t.get("budget")||0)}),0)+o().reduce(t,(function(e,t){return e+this.statuses.get(t).get("total_price")}),0,this)-o().reduce(i,(function(e,t){return e+this._items.get(t).get("budget")}),0,this),selected_count:o().reduce(t,(function(e,t){return e+this.statuses.get(t).get("count")}),0,this)+e.length-i.length}},unsortedAccept:function(e){var t=s()(e.currentTarget),i=this._elem("pipeline").find(this._selector("quick_lead_wrapper"));i.length?i.after(t):this._elem("pipeline").find(this._selector("first_status_row")).prepend(t)},unsortedAcceptFailed:function(e){var t=this.statuses.findWhere({type:1}).id;return this._findElem("pipeline_list_by_id",t).prepend(e.currentTarget),new N.default({class_name:"modal-list change-status-error-modal",accept_text:"OK",text:(0,g.i18n)("multiple_change_status_error3")})},unsortedReplaceWithLead:function(e,t,i){var n,r=s()(e.currentTarget);s()("#pipeline_item_".concat(t.id)).is(":not(.js-unsorted-item)").length||((n=this._startComponent("item",{},o().extend(t,{can_edit:!0,status:i,tile_config:this.tile_config})).render().$el).addClass("animated zoomIn").one(APP.animation_event,(function(){n.removeClass("animated zoomIn")})),r.before(n),this.renderHeadStatuses({in_status:t.status,out_status:this.statuses.findWhere({type:1}).id,budget:t.budget}))},onLoadMore:function(e,t){var i,n=this,s=this;return!(APP.data.is_card||APP.is_touch_device&&k.default.isHoverMenuVisible()||this._queue_leads_load_more.size||(i=e?[[e]]:o().map(this.status_packages,(function(e){return o().difference(e[n.filter_statuses_data_key],n.cant_load_more)})),this.more_loading||!o().flatten(i).length||(this.more_loading=!0,this._elem("more").show().addClass("pipeline_leads__load_more-loading"),this._queue_leads_by_statuses.size&&(this._queue_leads_load_more.pause(),this._queue_leads_by_statuses.onIdle().then((function(){return s._queue_leads_load_more.start()}))),o().each(i,(function(e){if(e.length){var i=o().map(e,(function(e){var t=s.statuses.indexOf(s.statuses.get(e));return s.pipeline.hs.scrollMapSetLoading(t,!0),function(){s.pipeline.hs.scrollMapSetLoading(t,!1)}}));s._queue_leads_load_more.add(o().bind((function(e,t,i){return s.onLoadMoreByStatuses(e,i).always((function(){o().each(t,(function(e){return e()}))}))}),null,e,i,t))}})),this._queue_leads_load_more.onIdle().then((function(){s._elem("more").hide().removeClass("pipeline_leads__load_more-loading"),s.more_loading=!1})),0)))},onLoadMoreByStatuses:function(e,t){var i=s().Deferred(),n=this,r=o().result(t,"is_retry_after_error",!1),a=r?e:o().difference(e,this.cant_load_more);return a.length?n.loadMore(a).done((function(e){e.items&&e.items.length?(r&&(n.cant_load_more=o().difference(n.cant_load_more,o().invoke(a,"toString"))),n.renderLoaded(e),n.pipeline.refresh()):n.onLoadMoreError(a,{is_loading_finished:!0}),i.resolve(e)})).fail((function(e){n.onLoadMoreError(a),i.reject(e)})):i.reject(),i.promise()},onLoadMoreError:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o().each(e,(function(e){var n=e.toString();i.is_loading_finished||t._findElem("status_items_list",n).append(l()({ref:"/tmpl/leads_pipeline/load_more_error.twig"}).render({status_id:n,with_retry:!o().contains(t.cant_load_more,n)})),t.cant_load_more.push(n)}))},onLoadMoreInStatusAfterError:function(e){var t=s()(e.currentTarget).parent(),i=parseInt(t.attr("data-id")),n=this.statuses.indexOf(this.statuses.get(i));this.pipeline.hs.scrollMapSetLoading(n,!0),this.onLoadMore(i.toString(),{is_retry_after_error:!0})?t.remove():t.one("animationend",(function(){t.removeClass("animation tada")})).addClass("animated shake")},loadMore:function(e,t){var i={},n=this.cleared_query_string||(0,f.getQueryString)(),r=(this.page-1)*o().result(t,"limit",10),a=(0,f.QStoJSON)(n),l=(0,G.serializeFilterParams)((0,G.deserializeFilterParams)(a),!1),u={};e&&(u["filter[pipe]["+this.pipeline_id+"][]"]=e,l=(0,f.setQueryParam)(u,{only_query_string:!0,query_string:l})),this._findElem("pipeline_lists").each((function(t,n){var a=s()(n),l=a.data("id"),u=a.children(":not(.pipeline_items__list_plug):not(.pipeline_leads__quick_add__wrapper)");e&&!o().contains(e,l.toString())||(i[l]=r-u.length)}));var d=(0,f.QStoJSON)(l,!0);return s().ajax({url:"/ajax/leads/multiple/loadmore/",data:o().extend({json:!0,page:o().result(t,"page",this.page),ELEMENT_COUNT:o().result(t,"limit",10),pipeline:"Y",pipeline_id:this.pipeline_id,LOST_ELEMENTS:i},d),type:"POST",dataType:"json"})},renderLoaded:function(e){var t={},i=(0,y.getRights)("leads","change_status");o().each(e.items,(function(e){var n=this.statuses.get(e.status),s=n&&(0,v.isUnsortedStatus)(n.get("id"));if(t[e.status]||(t[e.status]=document.createDocumentFragment()),e.company_name.name&&(e.contact_company_name={name:e.company_name.name}),!this._items.get(e.id)){var r=this._startComponent(s&&e.unsorted_category?"item_unsorted":"item",{},o().extend(e,{can_edit:i,tile_config:this.tile_config}));t[e.status].appendChild(r.el),r.render()}}),this),o().each(t,(function(e,t){var i=document.getElementById("pipeline_items__list_".concat(t));i&&i.appendChild(e)}),this);var n=this._$document.outerHeight()-this._$body.height()-this._$document.scrollTop();APP.constant("unsorted").all_loaded&&0===n&&this.onLoadMore()},removeConfirm:function(e){return Z((function(){var t,n,r,a;return te(this,(function(l){switch(l.label){case 0:return[4,i.e(61811).then(i.bind(i,761811))];case 1:return t=l.sent(),n=t.default,r=this,a=s()("#lead_".concat(e.lead_id)).find(".pipeline_leads__title-text").attr("title")||"",[2,new n({entity_name:o().escape(a),lead_id:e.lead_id,accept:function(){var t=this,i=r._items.get(e.lead_id);this.requestStart().xhr=s().ajax({url:"/ajax/delete/deals/",type:"POST",dataType:"json",data:{ID:e.lead_id,ACTION:"DELETE",pipeline:"Y"}}).done((function(n){if("success"===n.status)t.requestSuccess((0,g.i18n)("Deleted!")),e.uiItem.trigger("lead:delete"),e.uiItem.remove(),r.reloadBody();else{var s=o().first(n.errors);t.requestFail(o().isString(s)?s:null,!1),r.pipelineSort.sortable("cancel")}r.renderHeadStatuses({out_status:i.get("status"),budget:i.get("budget")}),r.$el.removeClass("pipeline-show-manage")}))},destroy:function(){e.uiItem.length&&e.uiItem.removeClass("h-hidden").removeAttr("style")}})]}}))})).apply(this)},reloadBody:function(){this._findElem("item").length||this._$document.trigger("page:reload")},statusChange:function(e){APP.constant("loss_reason_enabled")&&(0,v.isLostStatus)(e.status_new)?this.modalLossReason(e):(this._items.get(e.lead_id).unset("loss_reason"),this.statusConfirmModal(e))},statusConfirmModal:function(e){var t=this;return(0,v.isWonLostStatus)(e.status_new)&&e.uiItem.find(".pipeline_leads__task-icon_yellow").length<1?new N.default({class_name:"modal-list modal-leave-confirm",decline_text:(0,g.i18n)("card_page_save_complete_tasks_button_decline"),accept_text:(0,g.i18n)("card_page_save_complete_tasks_button_accept"),button_class:"button-input_blue",text:(0,g.i18n)("card_page_save_complete_tasks"),destroy:function(){t.statusChangeSave(e,this.accepted)}}):this.statusChangeSave(e)},changeLossReason:function(e){var t=s()(e.currentTarget).closest(".pipeline_leads__item");(0,y.getRights)("leads","edit")&&this.modalLossReason({lead_id:t.attr("data-id"),status_new:143,status_old:143,uiItem:t,loss_reason_id:s()(e.currentTarget).attr("data-id")},!0)},modalLossReason:function(e,t){return Z((function(){var n,s;return te(this,(function(r){switch(r.label){case 0:return[4,i.e(98857).then(i.bind(i,698857))];case 1:return n=r.sent(),s=n.default,this.modal_loss_reason=this._addComponent(s,{el:this.$el,selected_id:e.loss_reason_id,onAccept:o().bind(this._onAcceptLossReason,this,o().extend({change_loss_reason:t},e)),onCancel:o().bind(this._onCancelLossReason,this,e)}),[2]}}))})).apply(this)},_onCancelLossReason:function(e){e.status_new!==e.status_old&&e.uiItem.removeClass("h-hidden"),this.modal_loss_reason=null},_onAcceptLossReason:function(e,t){var i=this._items.get(e.lead_id);APP.constant("loss_reason_enabled")&&i.set("loss_reason",{id:t.id,name:o().escape(t.name)}),e.change_loss_reason?this.statusChangeSave({lead_id:e.lead_id,accept:0,uiItem:this._findElem("item_by_id",e.lead_id),status_new:i.get("status"),status_old:i.get("status")}):this.statusConfirmModal(e),this.modal_loss_reason=null},statusChangeSave:function(e,t){var i=this._items.get(e.lead_id),n=i.get("loss_reason");this.status_change_ajax[e.lead_id]&&4!==this.status_change_ajax[e.lead_id].readyState&&this.status_change_ajax[e.lead_id].abort(),i&&i.set("status",parseInt(e.status_new)),this.status_change_ajax[e.lead_id]=s().ajax({url:"/ajax/leads/multiple/change_status/",DASHBOARD:"true",type:"POST",dataType:"json",data:{parties:{id:[e.lead_id]},close_tasks:t?1:0,STATUS_ID:e.status_new,PIPELINE_ID:this.pipeline_id,LOSS_REASON_ID:(n||{}).id||0}}).always(o().bind((function(){this.status_change_ajax[e.lead_id]=void 0,this.renderHeadStatuses({in_status:e.status_new,out_status:e.status_old,budget:i.get("budget")})}),this)).done(o().bind((function(t){"success"===t.status?(e.uiItem.trigger("lead:status-change",[e.status_new,e.status_old,this.statuses]),this.statusSuccess(e.uiItem,e.status_new,e.status_old)):"error"===t.status&&this.statusChangeRevert(e)}),this)).fail(o().bind((function(e){"abort"!==e.statusText&&this.showErrorModal()}),this))},showErrorModal:function(){this._error_modal||(this._error_modal=this._addComponent(H.default,{destroy:o().bind((function(){delete this._error_modal}),this)}).showError(null,!1))},showPipelineSettingsModal:function(){var e=this;e._$document.trigger("page:overlay:show"),Promise.all([i.e(3473),i.e(82356)]).then(i.bind(i,382356)).then((function(t){var i=t.default;e._addComponent(i,{pipeline_id:e.pipeline_id,shouldCheckTriggers:!0})}))},showInstagramPromotionModal:function(){var e=this;(0,w.kommoLogAmplitude)("instagramPromoModalViewed"),i.e(82078).then(i.bind(i,182078)).then((function(t){var i=t.default;e._addComponent(i,{pipelineId:e.pipeline_id})}))},statusChangeRevert:function(e){var t=this._elem("pipeline_list_by_id",e.status_old),i=this._findElem("item_by_id",e.lead_id),n=this._findElem("quick_lead_wrapper");return t.find(".pipeline_leads__quick_add__wrapper").length?i.detach().insertAfter(n):i.detach().prependTo(t),i.removeClass("h-hidden"),this.renderHeadStatuses({in_status:e.status_old,out_status:e.status_new,budget:this._items.get(e.lead_id).get("budget")}),new N.default({class_name:"modal-list change-status-error-modal",accept_text:"OK",text:(0,g.i18n)("multiple_change_status_error3")})},leadsManage:function(e){"delete"===e.status_new?"unsorted"===e.status_old?e.uiItem.trigger("unsorted:decline"):this.removeConfirm(e):("unsorted"===e.status_old?e.uiItem.trigger("unsorted:accept",[e.status_new]):e.status_old!==e.status_new&&this.statusChange(e),e.uiItem.removeAttr("style"))},_getLeadId:function(e){return e.attr("data-id")||0},statusSuccess:function(e,t){var i=this.statuses.get(t),n=this._items.get(e.attr("data-id"));e.show(),n&&n.set("status",parseInt(t)),!i&&(0,f.getQueryString)().length>0?this._$document.trigger("page:reload",["pipeline"]):(0,v.isWonLostStatus)(t)&&((new H.default).showSuccess(),i||e.remove())},registerPerformance:function(){var e;APP.first_load?(0,P.registerPerformanceMetrics)({metrics:(e={},ee(e,P.TrackedMetricGroupName.FCP,[P.TrackedMetricName.PIPELINE_FCP]),ee(e,P.TrackedMetricGroupName.TTI,[P.TrackedMetricName.PIPELINE_TTI]),e)}):(0,P.registerPerformanceMetrics)({metrics:ee({},P.TrackedMetricGroupName.TTI,[P.TrackedMetricName.PIPELINE_TTI])})}});d().mixin(ie,K.default,D.default,O.default,Y.default,X.default,j.default,L.default,C.PageLoadErrorHandlerMixin);const ne=ie},389069:e=>{var t=function(e,t){var i="onwheel"in t?"wheel":"mousewheel",n={callback:function(){},elem:t,preventMouse:!0};function s(t){this._options=u(n,t),this._deltaArray=[0,0,0],this._isAcceleration=!1,this._isStopped=!0,this._direction="",this._timer="",this._isWorking=!0;var s,r,o,l=this;this._wheelHandler=function(t){l._isWorking&&(a.call(l,t),l._options.preventMouse&&function(t){(t=t||e.event).preventDefault?t.preventDefault():t.returnValue=!1}(t))},s=this._options.elem,r=i,o=this._wheelHandler,s.addEventListener?s.addEventListener(r,o,!1):s.attachEvent&&s.attachEvent("on"+r,o)}function r(e){e.direction=this._direction,this._options.callback.call(this,e)}s.prototype={constructor:s,turnOn:function(){return this._isWorking=!0,this},turnOff:function(){return this._isWorking=!1,this},setOptions:function(e){return this._options=u(this._options,e),this},getOption:function(e){var t=this._options[e];if(void 0!==t)return t;throw new Error("Unknown option")},destroy:function(){var e,t,n;return e=this._options.elem,t=i,n=this._wheelHandler,e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n),this}};var o=function(e){return o=e.wheelDelta&&!e.deltaY?function(e){return-1*e.wheelDelta}:function(e){return e.deltaY},o(e)};function a(e){var t=this,i=o(e);if(0!==i){var n,s=i>0?"down":"up",a=t._deltaArray.length,u=!1,d=0;for(clearTimeout(t._timer),t._timer=setTimeout((function(){t._deltaArray=[0,0,0],t._isStopped=!0,t._direction=s}),150),n=0;n<a;n++)0!==t._deltaArray[n]&&(t._deltaArray[n]>0?++d:--d);Math.abs(d)===a&&(d>0?"down":"up")!==t._direction&&(u=!0,t._direction=s),t._isStopped||(u?(t._isAcceleration=!0,r.call(this,e)):Math.abs(d)===a&&l.call(this,e)),t._isStopped&&(t._isStopped=!1,t._isAcceleration=!0,t._direction=s,r.call(this,e)),t._deltaArray.shift(),t._deltaArray.push(i)}}function l(e){var t=Math.abs(this._deltaArray[0]),i=Math.abs(this._deltaArray[1]),n=Math.abs(this._deltaArray[2]),s=Math.abs(o(e));s>n&&n>i&&i>t&&(this._isAcceleration||(r.call(this,e),this._isAcceleration=!0)),s<n&&n<=i&&(this._isAcceleration=!1)}function u(e,t){var i,n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}return s}(window,document);e.exports=t}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_18_50_52"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="353f7b75-593d-4926-9f65-e1820e655a26",e._sentryDebugIdIdentifier="sentry-dbid-353f7b75-593d-4926-9f65-e1820e655a26")}catch(e){}}();
//# sourceMappingURL=1454.68f57c63f0e0d272aea7.js.map