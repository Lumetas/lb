"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[76987],{285266:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var n=a(629133),i=a.n(n),_=300;function o(e,t,a,n){return a||(e=n),t.type===APP.note_types.mail_message&&i().where(e,{id:t.id}).length&&(e=i().filter(e,(function(e){return e.type!==APP.note_types.mail_message||t.id===e.id||!i().isEqual(i().pick(t.data.params,"subject","content_summary","from","to"),i().pick(e.data.params,"subject","content_summary","from","to"))||Math.abs(t.date_create-e.date_create)>_}))),e}},159424:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var n=a(629133),i=a.n(n),_=a(859200);function o(e,t){return(0,_.getRights)("is_free_user")&&i().isFunction(t.get)&&!i().isUndefined(t.get("object_type"))&&"tasks"===t.get("object_type").code&&(e=i().without(e,t)),e}},993099:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var n=a(629133),i=a.n(n),_=a(580326),o=a(393455),r=a(418860),d=i().invert(i().extend({sms_in:102,sms_out:103},APP.note_types)),s=["mail_message_chain_in","mail_message_chain_out","call_chain_in","call_chain_out","sms_in","sms_out"],l={type:"none",id:"none"},c={amojo:"amojo",amojo_ex:"amojo_ex",chat:"chat",main_user_changed:"main_user_changed",call:"call",digital_pipeline_event:"digital_pipeline_event",targeting_in:"digital_pipeline_event",targeting_out:"digital_pipeline_event",site_visit:"digital_pipeline_event",lead_auto_created:"digital_pipeline_event",dp_tags_added:"digital_pipeline_event",dp_tags_removed:"digital_pipeline_event",service_message:"digital_pipeline_event",followed_link:"digital_pipeline_event",field_changed:"field_changed",mail_message_chain_in:"mail_message_chain_in",mail_message_chain_out:"mail_message_chain_out",call_chain_in:"call_chain_in",call_chain_out:"call_chain_out",sms_in:"sms_in",sms_out:"sms_out"},u=[c.amojo_ex],p={_groupingChecker:function(e){return!(!c[p._getGroupedNoteType(e).type]||e._skip_id)},_groupingCheckerLastViewModel:function(e,t){var a=p._getGroupedNoteType(e).type;return!(!(t>1||i().contains(u,a))||!c[a])},_getGroupedNoteType:function(e){var t=e.object_type&&e.object_type.code,a=o.default._get(e.type,t,""),n=_.AmoJoMediator.get();switch(!0){case!i().isUndefined(e.chat_id)&&"opened_talks"!==t&&n[e.chat_id]&&n[e.chat_id].entity_type===APP.element_types.contacts:return{type:c.amojo_ex,id:"amojo_ex:".concat(e.chat_id)};case!i().isUndefined(e.chat_id)&&"opened_talks"!==t:return{type:c.amojo,id:"amojo"};case"mail_message"===a:return e.data.paramssent||e.data.params.manager?{type:c.mail_message_chain_out,id:c.mail_message_chain_out}:{type:c.mail_message_chain_in,id:c.mail_message_chain_in};case"call_in_out"===a:return e.type===APP.note_types.call_out?{type:c.call_chain_out,id:c.call_chain_out}:{type:c.call_chain_in,id:c.call_chain_in};case"event"===t&&i().contains([r.default.FIELD_CHANGED_EVENT,r.default.PRICE_CHANGED_EVENT,r.default.LTV_CHANGED_EVENT],e.type):return{type:c.field_changed,id:c.field_changed};case"tasks"!==t&&"event"!==t:return{type:c[d[e.type]],id:c[d[e.type]]};default:return l}},_getGroupedViewType:function(e){switch(!0){case"amojo_ex"===p._getGroupedNoteType(e[0]).type:return"grouped_amojo_ex";case i().indexOf(s,p._getGroupedNoteType(e[0]).type)>-1:return"grouped_complex";default:return"grouped"}},_addGroupped:function(e){var t,a,n,_,o=!1;return i().each(p._all_grouped,(function(r,d){var s=i().without(r,this.last_view_model);if(a=d===p._all_grouped.length-1,_=0,r.length>1){switch(t=p._getGroupedNoteType(r[0]),!0){case"amojo"===c[t.type]:o=!0,n=20,_=a?20:0;break;case"digital_pipeline_event"===c[t.type]:o=!0,n=2,_=a?5:0;break;default:o=!1,n=2}r.length>=n+_&&(o&&a&&(r=r.splice(0,r.length-n)),i().intersection(e,s).length===s.length&&(e=i().difference(e,r),this.renderView(r,p._getGroupedViewType(r))))}}),this),e},_haveToCheckWithLast:function(e,t){var a=this._getCreatedAtDate(e),n=this._getCreatedAtDate(t);return a&&n&&a>=n},_isTheSameDay:function(e,t){var a=this._getCreatedAtDate(e),n=this._getCreatedAtDate(t);return Math.floor(n/86400)===Math.floor(a/86400)},_getCreatedAtDate:function(e){return e.date_create||e.created_at||0},_hasCustomConflict:function(e){var t=i().last(p._last_grouped);return 1==("amojo_ex"===p._getGroupedNoteType(e).type&&"amojo_ex"===p._getGroupedNoteType(t).type&&i().propertyOf(e)(["dialog","id"])!==i().propertyOf(t)(["dialog","id"]))}};function m(e,t,a,n){var _=p._groupingChecker(t),o=!n[a+1];return a||(p._all_grouped=[],p._last_grouped=[],this.last_view_model&&1===n.length&&p._haveToCheckWithLast(n[0],this.last_view_model)&&p._groupingCheckerLastViewModel(this.last_view_model,this.last_view_models&&this.last_view_models.length)&&(p._last_grouped=[this.last_view_model])),_?p._last_grouped.length&&!i().isEqual(p._getGroupedNoteType(p._last_grouped[0]).id,p._getGroupedNoteType(t).id)||p._last_grouped.length&&p._hasCustomConflict(t)||p._last_grouped.length&&!p._isTheSameDay(p._last_grouped[p._last_grouped.length-1],t)?(p._all_grouped.push(p._last_grouped),p._last_grouped=[t]):p._last_grouped.push(t):p._last_grouped.length&&(p._all_grouped.push(p._last_grouped),p._last_grouped=[]),o&&(p._last_grouped.length&&p._all_grouped.push(p._last_grouped),e=p._addGroupped.call(this,e),p._last_grouped=[]),e}},70156:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var n=a(629133),i=a.n(n),_=a(859200),o=a(159424),r=a(285266),d=a(105527),s=a(993099),l=[{reducer_name:"equal_mails",reducer:r.default},{reducer_name:"joinable",reducer:d.default},{reducer_name:"groupable",reducer:s.default}];const c={process:function(e,t){var a=this,n=i().extend({_skipId:i().bind(this._skipId,this)},i().pick(t,"element_id","element_type","last_view_model","last_view_models","renderView")),r=e;(0,_.getRights)("is_free_user")&&(r=i().reduce(e,o.default,e,n));var d=i().reduce(r,(function(e,_,o,r){return i().each(l,(function(a){var d=a.reducer_name,s=a.reducer;i().contains(t.exclude_reducers,d)||(e=s.apply(n,[e,_,o,r]))}),a),e}),r,this);d.length&&i().each(d,(function(e){i().isEmpty(e)||e._skip_id||n.renderView(e)}))},_skipId:function(){return i().uniqueId("skip_id")}};var u="../build/transpiled/interface/notes/reducers/index";window.define(u,(function(){var e="undefined",a=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return a&&a.default||a})),window.require([u])},105527:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var n=a(629133),i=a.n(n),_=a(393455),o=a(47919),r=[APP.note_types.transaction];function d(e,t,a,n){var d,s,l={items:{},types:{},main_type:""},c=a,u=-1,p=this._skipId(),m=_.default._get(t.type,(t.object_type||{}).code),f=i().find(o.default.JOIN_TYPES,(function(e){return-1!==i().indexOf(e.element_types,this.element_type)&&e.types[m]&&e.main_type===m}),this);return f&&i().extend(l,i().pick(f,"template","types","main_type","comparator","min_count")),i().keys(l.types).length&&i().contains(e,t)&&(l=o.default._join(l,t),d=t.type,e=i().reduce(e,(function(e,a,_){var m=!0;return a===t?(e.push(o.default._replaceJoinedMainNote(a,p)),e):(s=o.default._canJoin(l,t,a),d!==a.type&&c<=i().indexOf(n,a)&&(u=_),u>-1&&_>u&&i().contains(r,d)&&(m=!1),s&&m?(l=o.default._join(l,a),e.push({})):e.push(a),e)}),[],this),l&&(!l.min_count||i().flatten(i().values(l.items)).length>=l.min_count)&&(!l.main_type||l.main_type&&1!==l.types[l.main_type]||l.main_type&&l.items[l.main_type])?this.renderView(o.default._sortJoined(l),l.template||"joined"):(l.items=i().flatten(i().values(l.items)),e=i().reduce(e,(function(e,t){return t._skip_id===p&&(t=i().find(l.items,(function(e){return e.id===t.id}))),e.push(t),e}),[])),e=i().filter(e,(function(e){return!i().isEmpty(e)}))),e}i().extend(o.default,{JOIN_TYPES:[{element_types:i().values(APP.element_types),types:{task:1,mail_message:1/0,call_in_out:1/0},min_count:2,main_type:"task",comparator:function(e,t){var a=e,n=t;return"tasks"!==(a.object_type||{}).code&&(n=e,a=t),a.status&&o.default.defaultTimeComparator(n.date_create,a.date_modify)&&o.default.isCallMailOutgoing(n)}},{element_types:i().values(APP.element_types),types:{geolocation:1,attachment:1/0},main_type:"geolocation",template:"geolocation",comparator:function(e,t){return Math.abs(parseInt(e.date_create)-parseInt(t.date_create))<31}},{element_types:i().values(APP.element_types),types:{note:1,attachment:1/0},main_type:"attachment",comparator:function(e,t){return parseInt(e._date_create)===parseInt(t._date_create)||parseInt(e.date_create)===parseInt(t.date_create)}},{element_types:i().values(APP.element_types),types:{transaction:1/0},main_type:"transaction"},{element_types:[APP.element_types.leads],main_type:"lead_created",template:"joined_creation",types:{lead_created:1,contact_created:1/0,company_created:1/0},comparator:o.default.fieldChangedComparator,min_count:2},{element_types:[APP.element_types.contacts],main_type:"contact_created",template:"joined_creation",types:{lead_created:1/0,contact_created:1,company_created:1/0,customer_created:1/0},comparator:o.default.fieldChangedComparator,min_count:2},{element_types:[APP.element_types.companies],main_type:"company_created",template:"joined_creation",types:{lead_created:1/0,contact_created:1/0,company_created:1,customer_created:1/0},comparator:o.default.fieldChangedComparator,min_count:2},{element_types:[APP.element_types.customers],main_type:"customer_created",template:"joined_creation",types:{lead_created:1/0,contact_created:1/0,company_created:1/0,customer_created:1},comparator:o.default.fieldChangedComparator,min_count:2}],_join:function(e,t){var a=_.default._get(t.type,(t.object_type||{}).code);return e.items[a]||(e.items[a]=[]),e.items[a].push(t),e},_canJoin:function(e,t,a){var n=!1,i=_.default._get(a.type,(a.object_type||{}).code);return!a._skip_id&&(e.types[i]&&(!e.items[i]||e.items[i].length<e.types[i])&&(n=!0),n&&(n=e.comparator?e.comparator.call(this,t,a):o.default.defaultTimeComparator(t.date_create,a.date_create)),n)},_sortJoined:function(e){var t;return t=e.main_type?(e.items[e.main_type]||[]).concat(i().values(i().omit(e.items,e.main_type))):i().values(e.items),i().flatten(t)},_replaceJoinedMainNote:function(e,t){return i().extend({id:e.id,type:e.type,_skip_id:t},e)}})},757738:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var n,i=a(334254),_=a.n(i),o=a(792467),r=a.n(o),d=a(445368),s=new(r())({animation:"none",bgColor:"#ff7779",fontFamily:"PT Sans",fontStyle:"normal",position:"up"}),l=0,c="",u=function(){var e=c||(0,d.numeralWord)(l,(0,d.i18n)("New messages (numeral, title)").toLowerCase(),!0);c=c?"":document.title,document.title=e},p=function(){clearInterval(n),c&&u(),s.badge(0)};function m(){_().hidden()&&(l++,p(),s.badge(l),n=setInterval(u,1e3),u())}_().change((function(){l=0,_().hidden()||p()}));var f="../build/transpiled/interface/notes/title_flasher";window.define(f,(function(){var e="undefined",a=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return a&&a.default||a})),window.require([f])},47919:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var n=a(393455);const i={isCallMailOutgoing:function(e){switch(e.type){case APP.note_types.mail_message:return e.data.params.manager;case APP.note_types.call_out:return!0}return!1},defaultTimeComparator:function(e,t){var a=(e-t)/60;return Math.abs(a)<=20},fieldChangedComparator:function(e,t){var a=n.default._get(e.type,(e.object_type||{}).code,""),i=n.default._get(t.type,(t.object_type||{}).code,"");switch(!0){case"field_changed"===a&&!!e.data.params.new_value&&!!e.data.params.old_value:case"field_changed"===i&&!!t.data.params.new_value&&!!t.data.params.old_value:case"field_changed"===a&&!e.data.params.new_value:case"field_changed"===i&&!t.data.params.new_value:return!1;default:return this.defaultTimeComparator(e.date_create,t.date_create)}}};var _="../build/transpiled/interface/notes/utils/joinable";window.define(_,(function(){var e="undefined",a=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return a&&a.default||a})),window.require([_])}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_17_08_33"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c98b5aa5-c55b-482c-a0a3-3cde2db4407c",e._sentryDebugIdIdentifier="sentry-dbid-c98b5aa5-c55b-482c-a0a3-3cde2db4407c")}catch(e){}}();
//# sourceMappingURL=76987.073022fec823c8a64d16.js.map