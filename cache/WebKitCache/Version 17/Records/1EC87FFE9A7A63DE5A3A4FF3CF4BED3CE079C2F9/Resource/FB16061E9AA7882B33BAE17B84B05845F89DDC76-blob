"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[78636],{574253:(t,e,n)=>{n.r(e),n.d(e,{default:()=>i});const i={titleMessageB2C:"ea55bfa2",notificationInnerTitleMessageB2C:"a255d0464"}},466072:(t,e,n)=>{n.r(e),n.d(e,{default:()=>l});var i=n(629133),o=n.n(i),a=n(398457),r=n.n(a),s=[],c=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return r().apply(this,e)};(c.prototype=Object.create(r().prototype)).throttle=o().throttle;var d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.steady_loader=new c({scrollElement:t.element||window,conditions:t.conditions||{"max-bottom":100},throttle:t.throttle||100,handler:function(e,n){var i=t.onLoadMore();i&&i.then?i.then(n):n()}}),s.push(this.steady_loader)};d.prototype.destroy=function(){var t=o().indexOf(s,this.steady_loader);this.steady_loader&&this.steady_loader.stop(),s.splice(t,1)};const l=d;var u="../build/transpiled/components/base/autoload";window.define(u,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([u])},621448:(t,e,n)=>{n.r(e),n.d(e,{InboxBadgeId:()=>i,get:()=>I,listen:()=>S,set:()=>D,update:()=>P});var i,o,a=n(629133),r=n.n(a),s=n(987081),c=n(128508),d=n(12615),l=n(797078),u=n(156040),f=n(214558),_=n(859200),h=n(126608),p=n(661533);function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function m(t,e,n,i,o,a,r){try{var s=t[a](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,o)}function v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,a=[],r=!0,s=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(a.push(i.value),!e||a.length!==e);r=!0);}catch(t){s=!0,o=t}finally{try{r||null==n.return||n.return()}finally{if(s)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}!function(t){t.BADGE="badge",t.BADGE_BRIEF="badge_brief",t.BADGE_NO_CHATS="badge_no_chats",t.BADGE_NO_CHAT_BRIEF="badge_no_chat_brief",t.BADGE_NO_EXTERNAL_CHAT="badge_no_external_chat",t.BADGE_NO_EXTERNAL_CHAT_BRIEF="badge_no_external_chat_brief",t.BADGE_INBOX="badge_inbox",t.BADGE_TEAM_UNION="badge_team_union",t.BADGE_TEAM_UNION_BRIEF="badge_team_union_brief",t.BADGE_SUPPORT_CHAT_BRIEF="badge_support_chat_brief"}(i||(i={}));var y,E=(v(o={},"badge",0),v(o,"badge_brief","0"),v(o,"badge_no_chats",0),v(o,"badge_no_chat_brief","0"),v(o,"badge_no_external_chat",0),v(o,"badge_no_external_chat_brief","0"),v(o,"badge_inbox",0),v(o,"badge_team_union",0),v(o,"badge_team_union_brief","0"),v(o,"badge_support_chat_brief","0"),o),w=[119,126],k=[125],C=APP.constant("account").id,x=(0,f.current)("id"),A="inbox:talks:".concat(C),O="notifications:".concat(C,":").concat(x),N=APP.constant("account").is_chats_inbox_enabled,T=new h.default;function P(){if(!y){var t=(e=function(){var t,e,n;return function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,3,4]),[4,d.default.checkAuth((function(){return Promise.all(r().compact([p.ajax({url:"/v3/inbox/badge",dataType:"json"}),N&&!(0,_.getRights)("is_free_user")&&p.ajax({url:"/ajax/v4/inbox/badge",dataType:"json"})]))}))];case 1:return t=g.apply(void 0,[i.sent(),2]),e=t[0],n=t[1],T.next(e),n&&T.next({badge_inbox:n.count}),[3,4];case 2:return i.sent(),[3,4];case 3:return y=null,[7];case 4:return[2]}}))},n=function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function r(t){m(a,i,o,r,s,"next",t)}function s(t){m(a,i,o,r,s,"throw",t)}r(void 0)}))},function(){return n.apply(this,arguments)});y=t()}var e,n;return y}function S(t){return new s.Observable((function(e){var n=r().isArray(t)?t:[t],i=T.pipe(c.map((function(t){return r().extend(E,r().pick(t,n)),r().pick(E,n)})),c.tap({next:r().bind(e.next,e)})).subscribe(r().noop);return T.next(E),function(){return i.unsubscribe()}}))}function I(t){var e=r().clone(E);return t?e[t]||0:e}function D(t){r().extend(E,r().pick(t,r().keys(E)));var e=r().pick(E,r().keys(t));return r().isEmpty(e)||T.next(e),!r().isEmpty(e)}l.default.subscribe([O]).pipe(c.filter((function(t){return r().propertyOf(t)(["body","channel"])===O})),c.map((function(t){return r().propertyOf(t)(["body","payload"])||{}}))).subscribe(T),N&&(l.default.status.subscribe((function(t){t.state===WebSocket.OPEN&&l.default.send([{method:"subscribe",params:{channel:A}}])})),l.default.subscribe([A]).pipe(c.filter((function(t){return r().propertyOf(t)(["body","channel"])===A&&r().contains(r().union(w,k),r().propertyOf(t)(["body","payload","type"]))})),c.map((function(t){var e=119!==r().propertyOf(t)(["body","payload","type"])||119===r().propertyOf(t)(["body","payload","type"])&&!1===r().propertyOf(t)(["body","payload","model","is_read"]),n=r().contains(w,r().propertyOf(t)(["body","payload","type"]))?1:-1,i="badge_inbox";return D(v({},i,I(i)+(e?n:0))),!0}))).subscribe(T)),(0,u.onPageFullyLoaded)(P)},778636:(t,e,n)=>{n.r(e),n.d(e,{default:()=>ct});var i=n(162262),o=n.n(i),a=n(661533),r=n.n(a),s=n(161320),c=n.n(s),d=n(267651),l=n.n(d),u=n(987081),f=n(128508),_=n(460159),h=n.n(_),p=n(629133),b=n.n(p),m=n(334254),v=n.n(m),g=n(156040),y=n(12615),E=n(313981),w=n(335745),k=n(811149),C=n(49091),x=n(797078),A=n(180137),O=n(833496),N=n(500034),T=n(214558),P=n(445368),S=n(955026),I=n(926168),D=n(258471),M=n(474564),L=n(761634),R=n(537107),B=n(466072),j=n(845043),F=n(567042),U=n(641228),W=n(472450),H=n(963154),q=n(46018),V=n(341302),K=n(382646),G=n(621448),z=n(371596);function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Y(t,e,n,i,o,a,r){try{var s=t[a](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,o)}function $(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function r(t){Y(a,i,o,r,s,"next",t)}function s(t){Y(a,i,o,r,s,"throw",t)}r(void 0)}))}}function J(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Q(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,a=[],r=!0,s=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(a.push(i.value),!e||a.length!==e);r=!0);}catch(t){s=!0,o=t}finally{try{r||null==n.return||n.return()}finally{if(s)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}n.e(22589).then(n.bind(n,579594)),n.e(92504).then(n.bind(n,392504));var tt,et=APP.constant("account").is_chats_inbox_enabled,nt=!1,it=null,ot=et?"?filter[exclude][external_chats]=true":"",at=(0,N.isFeatureAvailable)("global_inbox")?G.InboxBadgeId.BADGE_NO_CHAT_BRIEF:G.InboxBadgeId.BADGE_NO_EXTERNAL_CHAT_BRIEF,rt="/v3/inbox/list".concat(et&&(0,N.isFeatureAvailable)("global_inbox")?"?filter[exclude][chats]=true":ot),st=E.default.extend({el:"#notification-wrapper",data:[],error:null,badge_id:et?at:G.InboxBadgeId.BADGE_BRIEF,sound_id:"amo_inbox_sound",api:{list:rt,read:"/v3/inbox/read",task:"/ajax/todo/multiple/close/"},collection:U.Collection,current_state:F.default.STATE_UNINITIALIZED,current_mode:F.default.MODE_NORMAL,no_content:!1,no_content_text:(0,P.i18n)("No notifications found"),filters:[],opened_direct_chat:null,push_hide_timers:{},directChatOpening:!1,inbox_fully_opened:!1,readable_ids:[],readers:{},presets:null,_selectors:function(){return{inbox:"#notification-aside",inbox_container:"#inbox-container",search_container:".search-container",inbox__spiner:".inbox__spiner",aside_inner:".aside__inner",direct_chat_container:".inbox-direct-chat-container",inbox_toggle_button:".nav__notifications",toast_container:"#popups_inbox",navigation:".js-navigate-link",unread_item:".notification__item__unread",cancel_search:".aside-clear-button",search_input:"input.js-input-search",chat_create_cross:".add_icon-userpic_is-add",button_scroll:".button-scroll",sound_toggler:".js-inbox-mute",notification_emotion:'.js-notification_emotion[data-id="%s"]'}},_classes:function(){return{item:"notification__item",active:"inbox-expanded",enable_animation:"animated",hide_animation:"slide-out",show_animation:"slide-in",loading:"loading-full",direct_chat_enabled:"direct-chat__opened",chat_create_active:"active"}},events:{"click .js-inbox-multiactions":"openMultiaction","click .js-create_group_chat:not(.chat_create-button--disabled)":"createGroupChat","click .notification__item:not(.notification__item-plug)":"onSelectItemClick","click .notification-inner__button_show-more":"onShowMoreClick","click .js-notification-favorites":"chooseFavorite","mouseenter .notification__item:not(.notification__item-plug)":"onNotificationMouseEnter","mouseleave .notification__item:not(.notification__item-plug)":"onNotificationMouseLeave"},document_events:{"amo:task:complete":"completeTask"},addReader:function(t,e){return this.readers[e]=t,e},chooseFavorite:function(t){var e=r()(t.currentTarget).closest(".notification-inner").data("id"),n=this.notifications.get(e),i=!n.get(this.getLabelParamName());t.stopPropagation(),t.preventDefault(),n&&(n.set(this.getLabelParamName(),i),r().ajax({url:"/v3/inbox/notifications/".concat(n.get("notification_id"),"/label"),type:i?"POST":"DELETE"}))},onNotificationMouseEnter:function(t){var e=this.notifications.get(t.currentTarget.dataset.id);this.destroyQuickActionMenu(),e&&this.initQuickActionMenu({el:r()(t.currentTarget).find(".js-notification-quick-action"),model:e})},onNotificationMouseLeave:function(){this.notification_quick_action&&!this.notification_quick_action.is_active&&this.destroyQuickActionMenu()},removeReader:function(t){delete this.readers[t]},initialize:function(t){var e=this.source||H.default;this.options=t||{},this.apply_deferred=r().Deferred(),this.filter_deferred=r().Deferred(),E.default.prototype.initialize.apply(this,arguments),this.$el.length&&(this._managers=(0,T.get)(),this.source_loader=new e(F.default.PAGE_COUNT,this.api.list),this.notifications=this._addComponent(this.collection,{order_by:this.getInitialSortOrder().unread_first?"read_state":""}),this.listenTo(this.notifications,"change:selected",this.onItemSelected),this.unmountNotFoundNotificationHandler=this.initNotFoundNotificationHandler(),this.socket=new u.Subscription,this.initSound(),this.initAllPromises())},destroy:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.badge&&this.badge.unsubscribe(),this.socket&&this.socket.unsubscribe(),this.unmountNotFoundNotificationHandler&&this.unmountNotFoundNotificationHandler(),E.default.prototype.destroy.apply(this,e)},initAllPromises:function(){return this.promise_all_init=Promise.all([this.requestBadge().then(b().bind(this.requestPresets,this)),this.requestPushPermission(),this.connect(),this.initSource()]),this.promise_all_init},initMultiaction:function(){return $((function(){var t,e;return Z(this,(function(i){switch(i.label){case 0:return this.multiaction?[2]:[4,n.e(59068).then(n.bind(n,59068))];case 1:return t=i.sent(),e=t.default,this.multiaction=this._addComponent(e,{el:this._elem("aside_inner").get(0),notifications:this.notifications,closeChat:b().bind(this.closeDirectChat,this),onButtonClick:b().bind(this.processMultiaction,this)}),[2]}}))})).apply(this)},addUsersInBuffer:function(t){this.source_loader.addUsersBuffer(t)&&this.getAddModelDirect(t)},multiactionClose:function(){this.multiaction&&this.multiaction.close()},canMultiactionsBeShown:function(){return!(1===this.notifications.length&&"fake"===this.notifications.first().get("id"))},openMultiaction:function(){this.multiaction&&this.canMultiactionsBeShown()&&this.multiaction.show((0,S.hasKeys)(this.search,["filter"])&&this.search.filter.super_change)},addNotification:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.filterEntryCheck(t)?this.notifications.add(t,e):this.rejectExistingModelOnAdd(t)},getInitialSortOrder:function(){return(0,W.getInitialSortOrder)()},initNotFoundNotificationHandler:function(){var t=this,e=function(){t.canNotFoundNotificationBeShown()?t.addNotFoundNotification():t.canNotFoundNotificationBeRemoved()&&t.removeNotFoundNotification()};return this.notifications.on("add remove",e),function(){t.notifications.off("add remove",e)}},rejectExistingModelOnAdd:function(t){var e=t.id,n=[];return this.notifications.get(e)?(this.notifications.remove(e),n=[e]):n},excludeTypeEntryCheck:function(t){return b().contains(this.options.exclude_click_types,b().propertyOf(t.get("click"))(["type"]))},filterEntryCheck:function(t){var e=this.getFilterSource(),n=b().reduce(this.getFilterOptions(),(function(t,n,i){if(b().isEmpty(n))return t;switch(i){case"provider[]":t.sources={},!b().isEmpty(n)&&b().isString(n)&&(n=[n]),n=b().filter(b().toArray(n),(function(n){return!b().contains(b().pluck(e,"id"),n)||(t.sources.chat_source=[n].concat(t.sources.chat_source||[]),!1)}),this),b().isArray(t.sources.provider)?t.sources.provider=t.sources.provider.concat(b().isArray(n)?n:[n]):t.sources.provider=b().isArray(n)?n:[n];break;case"updated_at_to":t.updated_at||(t.updated_at={}),t.updated_at.to=n;break;case"updated_at_from":t.updated_at||(t.updated_at={}),t.updated_at.from=n;break;case"label[]":case"is_read[]":t.statuses=t.statuses||{},t.statuses[i.replace("[]","")]=b().isArray(n)?n:[n];break;default:t[i]=b().isArray(n)?n:[n]}return t}),{},this),i=!0;return i=b().every(n,(function(e,n){var i=n.replace("[]","");switch(n){case"filter[date_preset]":return this.checkPresetNotification(t.get("updated_at"),e[0]);case"updated_at":return this.checkTimeNotification(t.get(i),e);case"sources":case"statuses":return b().some(e,(function(e,n){return!b().isUndefined(t.get(n))&&t.get(n).toString()&&-1!==e.indexOf(t.get(n).toString())}));default:return!b().isUndefined(t.get(i))&&t.get(i).toString()&&-1!==e.indexOf(t.get(i).toString())}}),this),this.excludeTypeEntryCheck(t)&&(i=!1),i},checkPresetNotification:function(t,e){var n=(0,K.default)(e);return t>=parseInt(n.from)&&t<=parseInt(n.to)},checkTimeNotification:function(t,e){var n=c()(e.from,APP.system.format.date.date).format("X"),i=c()(e.to,APP.system.format.date.date).set({hours:23,minutes:59,second:59}).format("X");return t>=n&&t<=i},canNotFoundNotificationBeShown:function(){return 0===this.notifications.length},canNotFoundNotificationBeRemoved:function(){return!(1===this.notifications.length&&"fake"===this.notifications.at(0).get("id"))},initSource:function(){this.source_loader.init(b().bind((function(t,e){var n=this.notifications.model;t.error&&(this.current_state=F.default.STATE_SHOW_ERROR,this.showError(),this.hideLoading(),e.resolve()),t.items&&b().each(t.items,b().bind((function(t){var e=new n(t);this.excludeTypeEntryCheck(e)||this.createNotificationModel(t)}),this)),this.canNotFoundNotificationBeShown()&&this.addNotFoundNotification(),this.readable_ids.length>0&&this.read({id:this.readable_ids}),this.notifications.sort(),this.current_state=F.default.STATE_SHOW_CONTENT,this.hideLoading(),e.resolve()}),this))},addNotFoundNotification:function(){this.notifications.add({id:"fake",type:"user_not_found"})},removeNotFoundNotification:function(){this.notifications.remove("fake")},scrollToTop:b().noop,onVirtualizedListScroll:function(){},onSelectItemClick:function(t){var e,n=r()(t.currentTarget),i=n.attr("data-custom-action-hash"),o=Boolean(null===(e=this.multiaction)||void 0===e?void 0:e.is_show);if(i)this.fulfillItemCustomAction(i);else if(o&&(t.stopPropagation(),t.preventDefault()),!(t.metaKey||t.ctrlKey||o)){var a=this.notifications.get(n.attr("data-id"));(null==a?void 0:a.get("click"))&&a.set("selected",!0)}},onShowMoreClick:function(t){var e=this.notifications.get(r()(t.currentTarget).closest(this._selector("item")).attr("data-id"));t.stopPropagation(),t.preventDefault(),e&&e.set("opened",!e.get("opened"))},onItemSelected:function(t){if(t.get("selected")){var e=b().propertyOf(APP.constant("account"))(["amo_messenger","direct_migrated"]),n=t.get("click").type;if(t.get("is_native_link"))t.set("selected",!1);else{if(e){if(t.get("amo_link"))return this._redirectToAmo({id:t.get("id"),amo_link:t.get("amo_link")}),void t.set("selected",!1);if(b().contains(["chat_group_create"],n))return void t.set("selected",!1)}switch(!0){case"chat_group"===n:case"chat_group_create"===n:case"chat_direct"===n:this.openChat(t.toJSON());break;case!b().isUndefined(t.get("web_link")):t.set("selected",!1)}}}},_redirectToAmo:function(t){var e=t.amo_link;V.amo_window.open(e)},onWindowKeyDown:function(t){this.directChatOpening||(t===F.default.ENTER&&this.notifications.select(),t===F.default.ARROW_DOWN&&this.notifications.preselect(1),t===F.default.ARROW_UP&&this.notifications.preselect(-1),b().contains([F.default.ENTER,F.default.ARROW_DOWN,F.default.ARROW_UP],t)&&this.hide())},hide:function(){var t=b().propertyOf(this)(["search","filter"]);t&&b().isFunction(t.hide)&&t.hide(),this.current_mode===F.default.MODE_ONLY_SUPPORT&&(this.current_mode=F.default.MODE_NORMAL,R.default.toggleLeftMenu(),this.search&&this.search.enableSearch(),this.resetFilter()),this.multiactionClose()},initSearch:function(t){return $((function(){var e,i;return Z(this,(function(o){switch(o.label){case 0:return this.search?[2]:[4,Promise.all([n.e(93103),n.e(7390),n.e(69148),n.e(15921)]).then(n.bind(n,115921))];case 1:return e=o.sent(),i=e.default,this.search=this._addComponent(i,b().extend({el:this.el.querySelector(".search-container-wrapper"),getPresets:b().bind(this.requestPresets,this),onCloseChat:b().bind((function(){this.opened_direct_chat&&"create_group"===this.opened_direct_chat.id&&this.opened_direct_chat.trigger("onClosed")}),this),onFilterItems:b().bind((function(t){this.data=[],this.showLoading(),this.multiactionClose(),this.loadData(t)}),this),onTermIsValid:b().bind((function(){this.loader&&this._destroyComponent(this.loader)}),this),onTermIsInvalid:b().bind((function(){this.autoloadContent()}),this),startClickDown:b().bind(this.onWindowKeyDown,this),onFilterToggle:b().bind((function(t){this.$el.toggleClass("inbox-filter_open",t)}),this)},t||{})),[2]}}))})).apply(this)},getFilterOptions:function(){if(this.search)return this.search.getFilterOptions()},getFilterSource:function(){if(this.search)return this.search.getFilterSource()},fulfillItemCustomAction:function(t){return $((function(){var e,i,o,a,r,s,c,d,u,f,_,h,p,b;return Z(this,(function(m){switch(m.label){case 0:return[4,Promise.all([n.e(93204).then(n.bind(n,893204)),n.e(82994).then(n.bind(n,382994)),n.e(69494).then(n.bind(n,369494)),n.e(71629).then(n.bind(n,671629)),n.e(61954).then(n.bind(n,361954)),n.e(78939).then(n.bind(n,178939))])];case 1:switch(e=Q.apply(void 0,[m.sent(),6]),i=e[0],o=i.default,a=e[1],r=a.default,s=e[2],c=s.default,d=e[3],u=d.default,f=e[4],_=f.default,h=e[5],p=h.default,b=(0,I.isExpired)(),t){case r:l().publish(o,!0),this.hide();break;case u:l().publish(c,!0),this.hide();break;case _:if(b){APP.router.navigate("/settings/pay/",{trigger:!0});break}l().publish(p,!0),this.hide()}return[2]}}))})).apply(this)},firstApply:function(){var t=b().min(this.presets,"sort").payload,e={};this.current_mode===F.default.MODE_ONLY_SUPPORT?e.provider=[(0,L.getSupportBotId)()]:b().each(t,b().bind(this.firstApplyMutator,this,e)),this.apply({is_first:!0,first_preset_data:e})},firstApplyMutator:function(t,e,n){switch(n){case"is_read[]":if(b().isArray(e))return;break;case"filter[date_preset]":return void(b().isEmpty(e)||(t.updated_at||(t.updated_at={}),t.updated_at=(0,K.default)(e)));case"updated_at_from":case"updated_at_to":return void(b().isEmpty(e)||(t.updated_at||(t.updated_at={}),"updated_at_from"===n?t.updated_at.from=c()(e,APP.system.format.date.date).format("X"):t.updated_at.to=c()(e,APP.system.format.date.date).set({hours:23,minutes:59,second:59}).format("X")))}b().isEmpty(e)||(t[n.replace("[]","")]=e)},show:function(){return $((function(){return Z(this,(function(t){switch(t.label){case 0:return[4,Promise.all([this.initSearch(),this.initMultiaction()])];case 1:return t.sent(),this.firstApply(),this.search?[4,this.search.initFilter()]:[3,3];case 2:t.sent(),t.label=3;case 3:return this.filter_deferred.resolve(),[2]}}))})).apply(this)},initSound:function(){return $((function(){var t,e;return Z(this,(function(i){switch(i.label){case 0:return this.sound?[2]:[4,n.e(20155).then(n.bind(n,320155))];case 1:return t=i.sent(),e=t.default,this.sound=this._addComponent(e,{el:this._elem("sound_toggler").get(0),storage_id:this.sound_id}),[2]}}))})).apply(this)},onSocketReconnectSynchronize:function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).status===C.SOCKET_STATE.CONNECTED){var t=this._elem("search_input").val(),e=this.notifications.findWhere({selected:!0});e&&this.reconnectOpenedChat(e),t?this.search.filter.filterItems(t):this.resetFilter(),G.update()}},resetFilter:function(){var t;this.data=[],this.showLoading(),(null===(t=this.search)||void 0===t?void 0:t.filter)&&this.loadData({reset:!0})},reconnectOpenedChat:function(t){return $((function(){var e;return Z(this,(function(n){switch(n.label){case 0:return[4,this._getChatView(t.attributes)];case 1:return e=n.sent(),this.opened_direct_chat=this._addComponent(e,this._getChatViewParams(t.attributes)),this.opened_direct_chat.render(),[2]}}))})).apply(this)},completeTask:function(t,e){return $((function(){return Z(this,(function(i){switch(i.label){case 0:t.preventDefault(),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,(0,A.completeTask)(e)];case 2:return"success"!==i.sent().status?[3,4]:[4,n.e(28313).then(n.bind(n,728313))];case 3:new(0,i.sent().default)({id:e.id,noreload:!0}),i.label=4;case 4:return[3,6];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))()},processNotificationFetch:function(t,e){return k.default.fetchAction(t,e).then(b().bind((function(t){t._embedded&&t._embedded.clear&&this.resetFilter()}),this))},processNotificationDelete:function(t){var e=b().reduce(t.ids,(function(t,e){var n=this.getModelByNotificationId(e);return"chat_direct"===(n.get("entity")&&n.get("entity").type)?t.concat(n.get("id")):t}),[],this);this.processNotificationFetch("delete",t).then(b().bind((function(){b().each(e,(function(t){this.addUsersInBuffer(t)}),this)}),this))},processMultiaction:function(t,e){"read"===t?this.readNotification(e):"delete"===t&&this.deleteNotification(e)},readNotification:function(t){(this.notifications.findWhere({notification_id:b().propertyOf(t)(["ids",0])})||t.choose_all)&&this.processNotificationFetch("read",t)},deleteNotification:function(t){(this.notifications.findWhere({notification_id:b().propertyOf(t)(["ids",0])})||t.choose_all)&&(this.confirm_modal=this._addComponent(j.default,{class_name:"modal-list",decline_text:(0,P.i18n)("No"),accept_text:(0,P.i18n)("Yes"),button_class:"button-input_blue",text:(0,P.i18n)("Are you sure you want to delete?").replace(" #PLACEHOLDER#",""),accept:b().bind((function(){this.processNotificationDelete(t),this.confirm_modal.destroy()}),this)}))},connect:function(){var t=x.default.subscribe(["notifications:".concat(APP.constant("account").id,":").concat(APP.constant("user").id)]).pipe(f.filter((function(t){return(0,S.hasKeys)(t,["body","payload"])})),f.map((function(t){return t.body.payload})),f.tap({next:b().bind((function(t){this.refreshCounter(t)}),this)}),f.share()),e=t.pipe(f.filter((function(t){return"update"===t.action})),f.map((function(t){return t.notifications}))),n=t.pipe(f.filter((function(t){return"read"===t.action})),f.map((function(t){return t.ids}))),i=t.pipe(f.filter(b().bind((function(t){return t.action===this.getLabelParamName()}),this)),f.map((function(t){return{ids:t.ids,label:t.label}}))),o=t.pipe(f.filter((function(t){return"delete"===t.action})),f.map((function(t){return t.ids})));this.socket.add(e.subscribe(b().bind(this.onMessageReceived,this))),this.socket.add(n.subscribe(b().bind(this.onMessageRead,this))),this.socket.add(i.subscribe(b().bind(this.onMessageLabel,this))),this.socket.add(o.subscribe(b().bind(this.onMessageRemove,this))),x.default.onConnectionChange(b().bind(this.onSocketReconnectSynchronize,this))},read:function(t){var e=this,n=(0,T.current)("id"),i=b().propertyOf((0,T.get)(n))("group"),o=i?Number(i.split("_")[1]):null;return!b().isNull(this.readable_ids)&&this.readable_ids.length>0&&(this.readable_ids=[]),u.from(y.default.checkAuth((function(){var n=r().Deferred(),i=[r().ajax({type:"POST",url:e.api.read,contentType:"application/json",data:JSON.stringify(b().omit(t,"chat_ids"))})];return t.chat_ids&&t.chat_ids.length&&i.push((0,M.readChat)(t.chat_ids,o).toPromise()),Promise.all(i).then((function(t){n.resolve(t[0])})),n}))).pipe(f.filter((function(t){return(0,S.hasKeys)(t,["_embedded","ids"])})),f.map(b().bind((function(t){return this.reAskNotification(t._embedded.ids),t._embedded.ids}),this)))},getModelByNotificationId:function(t){return this.notifications.find((function(e){return e.get("notification_id")===t}))},onMessageRead:function(t){var e=[],n=[];return b().each(t,(function(t){var i=this.getModelByNotificationId(t);i?(i.set("is_read",!0,{sort:!1}),i.set("first_unanswered_message_at",null,{sort:!1}),this.filterEntryCheck(i)||(this.notifications.remove(i.id),n.push(t))):e.push(t)}),this),e.length&&this.reAskNotification(e),this.notifications.sort(),n},onMessageLabel:function(t){var e=t.ids,n=t.label,i=[];b().each(e,(function(t){var e=this.getModelByNotificationId(t);e?(e.set(this.getLabelParamName(),n,{sort:!1}),this.filterEntryCheck(e)||this.notifications.remove(e.id)):i.push(t)}),this),i.length&&this.reAskNotification(i),this.notifications.sort()},reAskNotification:function(t){return r().ajax({url:this.api.list,data:{filter:{id:t}}}).then(b().bind((function(t){b().propertyOf(t)(["_embedded","items"])&&b().each(t._embedded.items,b().bind((function(t){var e;"chat_direct"===b().propertyOf(t)(["entity","type"])?(e=this.notifications.get(t.id),this.notifications.remove(e?t.id:t.entity.id)):this.notifications.remove(t.id),this.createNotificationModel(t),this.notifications.sort()}),this))}),this))},onMessageRemove:function(t){var e=this;return b().reduce(t,(function(t,n){var i=e.getModelByNotificationId(n);return i?(e.notifications.remove(i.get("id")),t.concat(n)):t}),[])},onMessageReceived:function(t){var e;b().each(t,b().bind((function(t){var n=new(0,this.notifications.model)(t);!1===(t=n.toJSON()).is_read&&(this.readTypes(t),this.readable_ids.length>0&&this.inbox_fully_opened&&this.read({id:this.readable_ids}),e=b().reduce(this.readers,(function(e,n){return b().extend(e,n(t))}),{}),b().isEmpty(e)||this.read(e)),this.current_state!==F.default.STATE_SHOW_CONTENT||this.search.filter_is_active||this.addNotification(n,{merge:!0}),t.silent||this.disableNotificationEntryCheck(n)||this.showNotification(t),this._checkChatCreated(t)}),this))},disableNotificationEntryCheck:function(t){return this.excludeTypeEntryCheck(t)},showNotification:function(t){return $((function(){return Z(this,(function(e){switch(e.label){case 0:return[4,this.initSound()];case 1:return e.sent(),this.sound.playSoundMessage(),v().hidden()?this.showPushNotification(t):this.didNotifyAllowed(t)&&this.showInternalNotification(t),[2]}}))})).apply(this)},showInternalNotification:b().debounce((tt=$((function(t){var e,i,o,a,s,c;return Z(this,(function(d){switch(d.label){case 0:e=this.notifications.model,i=new e(t),(t=i.toJSON()).notification=!0,d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.all([n.e(14570).then(n.bind(n,14570)),h()._preload(["/tmpl/inbox/message.twig"])()])];case 2:return o=Q.apply(void 0,[d.sent(),1]),a=o[0],(s=a.default).subscribe((function(){O.default.execCallbacks(t)})),s.create(h()({ref:"/tmpl/inbox/message.twig"}).render(t),function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){J(t,e,n[e])}))}return t}({containerId:this._selector("toast_container"),toastClass:"popup-inbox",closeHtml:'<img class="popup-inbox__close" src="/frontend/images/interface/inbox/close_notification.svg">',closeButton:!0,onclick:b().bind((function(t){this.addNotification(i,{merge:!0}),t.currentTarget=r()(t.currentTarget).children(this._selector("item")).get(0),this.onSelectItemClick(t,{trigger:!0})}),this)},t.toast_options)),[3,4];case 3:throw c=d.sent(),new Error(c);case 4:return[2]}}))})),function(t){return tt.apply(this,arguments)}),100),_isPushSupported:function(){return"Notification"in window},_isPushAllowed:function(){return"granted"===it},requestPushPermission:function(){!nt&&this._isPushSupported()&&Notification&&Notification.requestPermission&&(Notification.requestPermission(b().bind((function(t){it=t,this._$document.trigger("notification:request:permission",t)}),this)),nt=!0)},showPushNotification:function(t){var e,n="";if(this._isPushSupported()&&this._isPushAllowed()){var i;t.body&&(t.body.preview?n=t.body.preview:b().each(t.body.rows,(function(t){n+=t.text})));var o=null!==(i=null===(e=t.click)||void 0===e?void 0:e.value)&&void 0!==i?i:"".concat(t.notification_id,": ").concat(t.created_at),a=new Notification((0,P.stripTags)(t.body.title),{lang:APP.lang_id,body:(0,P.stripTags)(n),icon:(0,S.hasKeys)(t,["body","icon","value"])?t.body.icon.value:"",tag:o});a.onclick=b().bind((function(){this.focusWindow(),this.onPushNotificationClick(t),a.close()}),this),a.onshow=b().bind((function(){this.push_hide_timers[o]&&clearTimeout(this.push_hide_timers[o]),this.push_hide_timers[o]=b().delay((function(){a.close()}),1e4)}),this),a.onerror=b().noop,a.onclose=b().bind((function(){this.push_hide_timers[o]&&clearTimeout(this.push_hide_timers[o])}),this)}},onPushNotificationClick:function(t){var e,n=(t.click||{}).type;if(!t.is_native_link)if(t.amo_link)this._redirectToAmo({id:t.id,amo_link:t.amo_link});else switch(n){case"chat_direct":case"chat_group":this.openChat(t),this.scrollToTop();break;default:t.web_link&&(this.focusWindow(),"/"===t.web_link[0]||/^(https?:\/\/)?([0-9a-z\-.]{1,})(\.amocrm\.(ru|com)|\.amocrm2\.saas).*/i.test(t.web_link)?APP.router.navigate(t.web_link,{trigger:!0}):((e=window.open()).opener=null,e.location=t.web_link))}},focusWindow:function(){window.focus()},afterFirstLoad:function(){return this.apply_deferred},afterFilterInit:function(){return this.filter_deferred},apply:function(t){var e=r().Deferred(),n=this;switch(this.no_content&&this.loadData({reset:!0}).then((function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];e.resolve.apply(null,i),n.apply_deferred.resolve.apply(null,i)})),this.current_state){case F.default.STATE_ONLY_SUPPORT:case F.default.STATE_UNINITIALIZED:case F.default.STATE_SHOW_ERROR:this.loadData({reset:!0,is_init:t.is_first,init_data:t.first_preset_data}).then((function(){e.resolve(),n.apply_deferred.resolve()}));break;default:e.resolve(),this.apply_deferred.resolve()}return e},showError:b().noop,showContent:function(t){this.current_state=F.default.STATE_SHOW_CONTENT,t.length>0&&b().each(t,(function(t){this.addNotification(t)}),this)},loadData:function(t){var e=this;return new Promise((function(n,i){h()._preload(["/tmpl/inbox/direct_chat/item.twig","stylesheets/_chunks/cards.css"])().then((function(){e._loadData(t).then(n,i)}))}))},_loadData:function(t){var e=this,n=r().Deferred();return t=t||{},this.search&&(t=b().extend(t,this.search.fetch_options),this.notifications.setOrder(this.search.order),t.is_init?t.filter=t.init_data:t.filter=this.search.filter.getFilterState(),t.order=this.search.order),!t.reset&&(this.current_state===F.default.STATE_SHOW_LOADING||this.source_loader.isFinished()&&b().isEmpty(t.filter)&&!t.from_create)?n.resolve():(t.onFetchResponse||(t.onFetchResponse=function(t){e.refreshCounter(t)}),this.current_state=F.default.STATE_SHOW_LOADING,t.reset&&(this.showLoading(),this.notifications.reset()),this.source_loader.onNewOption(t,b().bind((function(t){this.no_content=t}),this),n),this.opened_direct_chat&&t.from_create&&this.opened_direct_chat.trigger("chatsFetched"),n.promise())},readTypes:function(t){!1!==t.is_read||t.body.actions&&t.body.actions.click&&!t.body.actions.read_on_show||this.readable_ids.push(t.notification_id)},createNotificationModel:function(t){var e=new(0,this.notifications.model)(t);this.readTypes(e.attributes),this.opened_direct_chat&&this.opened_direct_chat.model&&e.id.toString()===this.opened_direct_chat.model.id.toString()&&(e.set({selected:!0},{silent:!0}),this.opened_direct_chat.model=e),e.get("entity")&&parseInt(b().propertyOf(e.get("entity"))("id"))===(0,T.current)("id")||this.addNotification(e,{sort:!1})},autoloadContent:function(){this.loader=this._addComponent(B.default,{element:this._findElem("inbox_container").get(0),throttle:300,conditions:{"max-bottom":1168},onLoadMore:b().bind(this.loadData,this)})},requestBadge:function(){var t=this;return this.badge=G.listen(this.badge_id).subscribe((function(e){t.refreshCounter(e)})),r().Deferred().resolve()},getCounterEl:function(){return r()(".inbox-counter")},refreshCounter:function(t){var e=t[this.badge_id],n=this.getCounterEl();b().isUndefined(e)||(parseInt(e)>0?n.text(e).removeClass("hidden"):n.text(0).addClass("hidden"))},requestPresets:function(){var t=r().Deferred();return null===this.presets?(0,g.onPageFullyLoaded)(b().bind((function(){r().ajax("/v3/inbox/filter/presets").done(b().bind((function(e){var n=e||{};return this.presets=n.presets||[],t.resolve(this.presets),this.presets}),this)).fail(t.reject)}),this)):t.resolve(this.presets),t.promise()},showLoading:function(){this._toggleClass("loading","search_container",!0),this._toggleClass("loading","inbox__spiner",!0),APP.first_load&&((0,w.logPerformanceMetric)({type:(0,w.getRealCardPageType)(),name:"chatFcp"}),(0,D.trackPerformanceMetric)({group:D.TrackedMetricGroupName.FCP,name:D.TrackedMetricName.CHAT_FCP}))},hideLoading:function(){this._toggleClass("loading","search_container",!1),this._toggleClass("loading","inbox__spiner",!1),this.trigger("inbox:loaded:fully"),(0,D.trackPerformanceMetric)({group:D.TrackedMetricGroupName.TTI,name:D.TrackedMetricName.CHAT_TTI}),APP.first_load&&(0,w.logPerformanceMetric)({type:(0,w.getRealCardPageType)(),name:"chatTti"})},addNotifyFilter:function(t){var e=this;return this.filters.push(t),{remove:function(){var n=b().indexOf(e.filters,t);n>-1&&e.filters.splice(n,1)}}},didNotifyAllowed:function(t){var e=!0;return this.filters.forEach((function(n){n(t)||(e=!1)})),e},_isChatAlreadyOpened:function(t){return null!==this.opened_direct_chat&&this.opened_direct_chat.getId()===t.toString()},_getChatView:function(t){return $((function(){return Z(this,(function(e){switch(e.label){case 0:switch(b().propertyOf(t)(["click","type"])){case"chat_group":return[3,1];case"chat_group_create":return[3,3];case"chat_direct":return[3,5]}return[3,5];case 1:return[4,Promise.all([n.e(95882),n.e(93671),n.e(5179),n.e(93103),n.e(14095),n.e(15656),n.e(8232),n.e(44897),n.e(17815),n.e(40433),n.e(35969),n.e(40272),n.e(69500),n.e(45701)]).then(n.bind(n,775416))];case 2:return[2,e.sent().default];case 3:return[4,Promise.all([n.e(95882),n.e(93671),n.e(5179),n.e(93103),n.e(14095),n.e(15656),n.e(8232),n.e(44897),n.e(17815),n.e(40433),n.e(35969),n.e(40272),n.e(69500),n.e(58835)]).then(n.bind(n,586271))];case 4:return[2,e.sent().default];case 5:return[4,Promise.all([n.e(95882),n.e(93671),n.e(5179),n.e(93103),n.e(11958),n.e(14095),n.e(15656),n.e(42693),n.e(8232),n.e(52434),n.e(44897),n.e(17815),n.e(40433),n.e(35969),n.e(40272),n.e(69500),n.e(54581),n.e(59306),n.e(36020)]).then(n.bind(n,472033))];case 6:return[2,e.sent().default];case 7:return[2]}}))}))()},_getChatViewParams:function(t){return{id:t.id,model:t.notification_id?this.getModelByNotificationId(t.notification_id):this.notifications.get(t.id),$container:this._getDirectChatContainer()}},_getDirectChatContainer:function(){return this._elem("direct_chat_container")},_toggleDirectChatOpenedState:function(t){this._toggleClass("direct_chat_enabled",this.$el,t)},_checkChatCreated:function(t){(0,S.hasKeys)(t,["click","type"])&&t.click.type===F.default.TYPE_GROUP&&null!==this.opened_direct_chat&&this.opened_direct_chat.trigger("chatCreated",t)},openChat:function(t){return $((function(){var e,n,i,o,a;return Z(this,(function(r){switch(r.label){case 0:return this.multiactionClose(),this._isChatAlreadyOpened(t.id)?[2,Promise.reject()]:(this.directChatOpening=!0,[4,this._getChatView(t)]);case 1:return n=r.sent(),i=this._addComponent(n,this._getChatViewParams(t)),o=this.closeDirectChat({is_before_opening:!0}).then(b().bind((function(){return this.opened_direct_chat=i,this.opened_direct_chat.on("onClosed",b().bind(this.closeDirectChat,this)),t.click&&"chat_group_create"===t.click.type&&(this.opened_direct_chat.on("openChat",b().bind(this.openChat,this)),this.opened_direct_chat.on("fetchData",b().bind(this.loadData,this))),this.directChatOpening=!1,Promise.resolve()}),this)),this._toggleDirectChatOpenedState(!0),e=t.notification_id?this.getModelByNotificationId(t.notification_id):this.notifications.get(t.id),a=i.render().then(b().bind((function(){return i.showAnimation(),i.$el.show(),e&&e.set({selected:!0}),Promise.resolve()}),this)),[2,Promise.all([a,o])]}}))})).apply(this)},closeDirectChat:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r().Deferred();return b().isNull(this.opened_direct_chat)||b().isUndefined(this.opened_direct_chat)||(this.opened_direct_chat.trigger("closeDirectChat"),this._toggleDirectChatOpenedState(!1,t),this._toggleClass("chat_create_active",this._elem("chat_create_cross"),!1),this.opened_direct_chat.model&&this.opened_direct_chat.model.set({selected:!1}),this._destroyComponent(this.opened_direct_chat),this._getDirectChatContainer().empty(),this.opened_direct_chat=null),e.resolve(),e.promise()},destroyQuickActionMenu:function(){this.notification_quick_action&&(this._destroyComponent(this.notification_quick_action),this.notification_quick_action=null)},initQuickActionMenu:function(t){return $((function(){var e,i;return Z(this,(function(o){switch(o.label){case 0:return[4,n.e(45611).then(n.bind(n,245611))];case 1:return e=o.sent(),i=e.default,this.notification_quick_action=this._addComponent(i,b().extend({onButtonClick:b().bind(this.processMultiaction,this)},t)),[2]}}))})).apply(this)},createGroupChat:function(){this.openChat({click:{type:"chat_group_create"},id:"create_group",entity:{id:"create_group"}})},getAddModelDirect:function(t){var e,n,i,o=this.notifications.model,a=q.default.getRecipient(t);return!!a&&(a.is_bot?(n={bot:a.id,sub:"chat_direct"},i={chat_bot:a.id}):(n={profile:a.id,sub:"chat_direct"},i={chat_direct:a.id}),e=new o({id:a.id,body:{title:a.title,icon:n,actions:{click:i}},last_message:{id:0},is_read:!0,is_bot:!0===a.is_bot,entity:{type:"chat_direct",id:a.id},created_at:0,updated_at:0}),this.addNotification(e,{merge:!0}),e)},openDirectChat:function(t){var e=this.notifications.get(t);this.current_state!==F.default.STATE_UNINITIALIZED&&this.current_state!==F.default.STATE_ONLY_SUPPORT?(e||(e=this.getAddModelDirect(t)),this.openChat(e.attributes)):this.show().then(b().bind((function(){this.openDirectChat(t)}),this))},showOnlySupport:function(t){this.inbox_fully_opened&&this.hide(),this.current_mode=F.default.MODE_ONLY_SUPPORT,this.current_state=F.default.STATE_ONLY_SUPPORT,this.search&&this.search.disableSearch(),this.openDirectChat(t)},getLabelParamName:function(){return"label"}});o().mixin(st,z.default);const ct=st;var dt="../build/transpiled/components/base/inbox/base";window.define(dt,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([dt])},567042:(t,e,n)=>{n.r(e),n.d(e,{default:()=>o});var i=["845275ac-22e4-4778-9e9a-3b5d06e9e914","45e0ff46-eef9-463f-a725-8b97dfd1cca0","27850382-d297-47ab-a74c-544ee8cc895d","7da05ed4-4a9d-48a9-a92f-efc81aff9e31","eed2daac-a9fe-4b47-ab9f-d0ca5c0f17a6","7691f5d1-d4f7-4466-9ac3-8a316b1557ae","66396ad3-95f7-477d-bd4e-a596a94087c5","966d8f59-55bc-4961-be32-f319c176a295","49ae13e7-b75a-4fc0-9f39-c5c2812dcb34","da877054-c483-4da2-91f7-2e5aeacbaedf","b83b697f-1f6c-4726-b36b-a57b6593173b","be2d1c42-351b-40d0-97b7-5d2e1314b079","f6cb24c9-8d27-4a96-9720-9efd6af539c1","de4475bb-73ad-4fe6-a2df-3d2b7cb7cb84"];(0,n(500034).isFeatureAvailable)("global_inbox")&&i.push("3c9022fd-ac7d-48f4-ad24-7b5121417aa3");const o={STATE_UNINITIALIZED:-1,STATE_SHOW_CONTENT:1,STATE_SHOW_LOADING:2,STATE_SHOW_ERROR:3,STATE_ONLY_SUPPORT:4,MODE_NORMAL:1,MODE_ONLY_SUPPORT:2,EVENT_READ:"read",EVENT_DELETE:"delete",EVENT_NEW:"new",LOCAL_STORAGE_KEY:"_amojo_direct",PAGE_COUNT:50,ENTER:13,ESC_KEY:27,ENTER_KEY:13,ARROW_DOWN:40,ARROW_UP:38,LEFT_MENU_WIDTH:65,TYPE_DIRECT:"chat_direct",TYPE_GROUP:"chat_group",SYSTEM_CREATE_GROUP:"group_chat_create",AMO_CHATS_GROUP_TYPE:18,FIXED_CORE_PROVIDERS:i,EMOTION_FILTER_NAME:"emotion",EMOTIONS:{NEUTRAL:"NEUTRAL",NEGATIVE:"NEGATIVE",POSITIVE:"POSITIVE"}};var a="../build/transpiled/components/base/inbox/constants";window.define(a,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([a])},628193:(t,e,n)=>{n.r(e),n.d(e,{getMessagePreviewFromInboxData:()=>o});var i=n(445368),o=function(t){var e,n=t.data,o=t.currentUser;if(!n||!o||!n.last_message)return"";var a=n.last_message,r=a.id,s=a.author,c=a.text,d=o.id===r,l=(0,i.i18n)("You"),u=s===(null===(e=n.contact)||void 0===e?void 0:e.name);return d?"".concat(l||"",": ").concat(c):u?c:s?"".concat(s,": ").concat(c):"...:".concat(c)}},216105:(t,e,n)=>{n.r(e),n.d(e,{getMessagePreviewFromInboxData:()=>i.getMessagePreviewFromInboxData});var i=n(628193)},371596:(t,e,n)=>{n.r(e),n.d(e,{default:()=>U});var i=n(629133),o=n.n(i),a=n(949137),r=n.n(a),s=n(460159),c=n.n(s),d=n(331542),l=n.n(d),u=n(827378),f=n.n(u),_=n(567952),h=n.n(_),p=n(564638),b=n(445368),m=n(214558),v=n(500034),g=n(204141),y=n(230774),E=n(231102),w=n(504783),k=n(981837),C=n(590717),x=n(567042),A=n(937585),O=n(141963),N=n(216105),T=n(661533),P={},S=[],I={},D=[],M={},L=[],R=function(){return r().apply(this,arguments)};(R.prototype=Object.create(r().prototype)).getRowOffset=function(){var t;try{t=r().prototype.getRowOffset.apply(this,arguments)}catch(e){t=0}return t},R.prototype.destroy=function(t){this.container.removeEventListener("scroll",this.handleScroll),t&&(this.container.innerHTML=""),M={},L=[]};var B=(0,v.isFeatureAvailable)(v.Features.B2C_INBOX_CARD)&&(0,v.isFeatureAvailable)(v.Features.GLOBAL_INBOX),j=function(t){var e=this.notifications.at(t);return e&&this._items_heights_cached[e.id]?this._items_heights_cached[e.id]:64},F=function(t){var e,n=this.notifications.at(t),i=document.createElement("DIV");if(!n||!n.id)return i;var a,r,s=n.toJSON();s.label=n.get(this.getLabelParamName()),(0,v.isFeatureAvailable)(v.Features.EMOTION_DETECTOR_AVAILABLE)&&(0,v.isFeatureAvailable)(v.Features.IS_EMOTION_DETECTOR_ENABLED)&&(s.is_emotion_detector_enabled=!0,s.emotionDisplay=s.emotion===x.default.EMOTIONS.NEUTRAL?(null===(a=M[n.id])||void 0===a?void 0:a.toLowerCase())||x.default.EMOTIONS.NEGATIVE:null===(r=s.emotion)||void 0===r?void 0:r.toLowerCase());var d,u,_,p,L,R=0,j="",F={data:s,twig:c(),isUserOnline:(0,m.isUserOnline)(n.id)},U=o().isUndefined(null===(e=n.attributes)||void 0===e?void 0:e.type),W=B&&!U;switch(!0){case!n:case!n.id:return i;case"amochats_connect_sources"===n.id:i.innerHTML=(0,C.default)();break;case"fake"===n.id&&"user_not_found"===n.get("type"):i.innerHTML=(0,E.default)(this.no_content_text);break;case"go-to-add-channel"===n.id:i.innerHTML=(0,w.default)({id:n.id,title:(0,b.i18n)("Add channels"),text:(0,b.i18n)("Capture leads from WhatsApp & more!")});break;case"go-to-invite-a-user"===n.id:i.innerHTML=(0,w.default)({id:n.id,title:(0,b.i18n)("Invite team members (Conversation)"),text:(0,b.i18n)("Collaborate & sell together")});break;case"files-notification"===n.get("type"):i.innerHTML=(0,k.default)(n.attributes);break;case W:var H,q,V,K,G=APP.constant("user"),z=h()({data:s,message:(0,N.getMessagePreviewFromInboxData)({data:s,currentUser:G})}),X=f().createElement(A.B2CNotificationInboxCard,{displayMode:O.CardDisplayMode.CHAT,isNativeLink:Boolean(null===(H=z.data)||void 0===H?void 0:H.isNativeLink),id:z.data.id,isProvider:Boolean(z.data.provider),isTalk:null===(q=z.data.body)||void 0===q?void 0:q.isTalk,isPreselected:Boolean(z.data.preselected),isSelected:Boolean(z.data.selected),isChecked:Boolean(z.data.checked),isRead:Boolean(z.data.isRead),isFavorite:Boolean(z.data.label),amoLink:z.data.amoLink,customActionHash:z.data.customActionHash,webLink:z.data.webLink,absoluteLink:z.data.absoluteLink,typeContact:null===(V=z.data.entity)||void 0===V?void 0:V.type,message:z.message||"",body:z.data.body,contact:z.data.contact,status:z.data.status,updatedAt:z.data.updatedAt,emotion:z.data.emotion,avatar:null===(K=z.data.contact)||void 0===K?void 0:K.profileAvatar});l().render(X,i);break;default:R=s.id;try{d=P[R].data===JSON.stringify(s)}catch(t){d=!1}if(o().isUndefined(P[R])||!d){u=this.is_chats_notification_item_enabled?(0,y.createChatsNotificationItemTemplate)(F):(0,g.createNotificationItemTemplate)(F),p=(_=T(u)).find(".notification-inner__avatar");var Y=c()._twig.filter("avatar",s.body.icon.avatar_id);j=s.body.icon.value||Y,o().isUndefined(I[j])&&((L=new Image).onerror=function(){this.onerror=null,this.src=Y,P[R].html=_[0].outerHTML},L.src=j,I[j]=L,D.push(j)),p.append(I[j]),o().isUndefined(P[R])&&S.push(R),P[R]={html:_[0].outerHTML,data:JSON.stringify(s)}}(0,v.isFeatureAvailable)(v.Features.IS_EMOTION_DETECTOR_ENABLED)&&(P[R].html=this._addEmotionStateClass(P[R].html,n)),i.innerHTML=P[R].html}return S.length>=200&&(delete P[S[0]],S.shift()),D.length>=200&&(delete I[D[0]],D.shift()),i.children[0]};const U={initialize:function(){if(this.$el.length){this.$el.on("click"+this.ns,".button-scroll",o().bind(this.clickButtonScroll,this));var t=this._elem("inbox_container").get(0);this._items_heights_cached={},this.checkVisibilityOpenChat=o().throttle(o().bind(this._checkVisibilityOpenChat,this),1e3),this.updateListView=o().throttle(o().bind(this._updateListView,this),100,{leading:!1}),this.listView=this._addComponent(R,t,{height:t.offsetHeight,rowCount:this.notifications.length,overscanCount:3,rowHeight:o().bind(j,this),renderRow:o().bind(F,this),onScroll:o().bind(this.onVirtualizedScroll,this),onRowsRendered:o().bind(this.onRowsRendered,this)}),this.listenTo(this.notifications,"add",this.onInboxListModify),this.listenTo(this.notifications,"remove",this.onInboxListModify),this.listenTo(this.notifications,"sort",this.onInboxListModify),this.listenTo(this.notifications,"change",this.onInboxListModify),this.listenTo(this.notifications,"reset",this.updateListView),this.listenTo(this.notifications,"change",this.onChangeUpdateItemHeight),this.listenTo(this.notifications,"change:selected",this.checkVisibilityOpenChat),this.listenTo(this.notifications,"change:preselected",o().bind(this.scrollToActiveItem,this,{preselected:!0})),this._$window.on("resize"+this.ns,o().throttle(o().bind(this.onVirtualizedResize,this),p.WINDOW_RESIZE_THROTTLE_DELAY))}},onVirtualizedResize:function(){this.listView&&this._elem("inbox_container").is(":visible")&&this.listView.resize(this._elem("inbox_container").get(0).offsetHeight)},onVirtualizedScroll:function(){this.onVirtualizedListScroll.apply(this,arguments),this.checkVisibilityOpenChat()},clickButtonScroll:function(){this.scrollToActiveItem({selected:!0}),this.checkVisibilityOpenChat()},_checkVisibilityOpenChat:function(){var t=this.notifications.indexOf(this.notifications.findWhere({selected:!0})),e=!1,n=this.listView._sizeAndPositionManager.getVisibleRange({containerSize:this.listView.state.height,offset:this.listView.state.offset,overscanCount:0}),i=t>n.stop;t>-1&&(e=!0,n.start<=t&&n.stop>=t&&(e=!1)),this._findElem("button_scroll").toggleClass("button-scroll_to-bottom",i).toggle(e)},_updateListView:function(){this.listView.setRowCount(this.notifications.length)},_addEmotionStateClass:function(t,e){var n=T(t),i=n.find(".js-notification_emotion");if(i){var o=e.get("id"),a=e.get("emotion"),r=a===x.default.EMOTIONS.NEUTRAL;switch(!0){case!r&&Boolean(M[o]):i.addClass("shown"),i.removeClass("emotion-appear");break;case!r&&Boolean(!M[o]):if(i.addClass("emotion-appear"),M[o]=a,L.push(o),L.length>200){var s=L.shift();s&&delete M[s]}break;case r&&Boolean(M[o]):i.addClass("emotion-disappear"),delete M[o]}return n[0].outerHTML}},onInboxListModify:function(t){var e=this.notifications.indexOf(t);(!this._visible_start||!this._visible_stop||-1===e||e>=this._visible_start&&e<=this._visible_stop)&&this.updateListView()},onChangeUpdateItemHeight:function(t){o().isEmpty(o().omit(t.changed,"selected","preselected"))||this.updateItemMeasuredHeight(t)},updateItemMeasuredHeight:function(t){var e=!1,n=document.getElementById("inbox-notification-"+t.id);return n&&n.offsetHeight&&(this._items_heights_cached[t.id]=n.offsetHeight,e=!0),e},onRowsRendered:function(t){this._visible_stop=t.stopIndex,this._visible_start=t.startIndex,this.setItemsHeights(t)},setItemsHeights:o().debounce((function(t){for(var e,n=!1,i=t.startIndex;i<=t.stopIndex;i++){var o=this.notifications.at(i);o&&!this._items_heights_cached[o.id]&&(e=this.updateItemMeasuredHeight(o),n||(n=e))}n&&this.updateListView()}),300),scrollToActiveItem:function(t){var e=this.notifications.findWhere(t||{preselected:!0});e&&this.listView.scrollToIndex(this.notifications.indexOf(e),"center")},scrollToTop:function(){this.listView.scrollToIndex(0)}}},590717:(t,e,n)=>{n.r(e),n.d(e,{default:()=>o});var i=n(445368);const o=function(){return'\n    <div class="amochats-connect-sources connect-sources" id="inbox-notification-amochats_connect_sources">\n      <div class="connect-sources__inner">\n        <div class="connect-sources__image"></div>\n\n        <div class="connect-sources__text">\n          '.concat((0,i.i18n)("Connect your channels and pages in social networks as sources and chats from customers will get into imBox in the form of talks"),'\n        </div>\n\n        <div class="connect-sources__list-wrapper">\n          <ul class="connect-sources__list">\n            <li class="connect-sources__item">\n              <button class="connect-sources__btn js-connect-sources-add-base" data-name="telegram" type="button">\n                <svg class="svg-icon svg-inbox--social--telegram-dims">\n                  <use xlink:href="#inbox--social--telegram"></use>\n                </svg>\n                <span>').concat((0,i.i18n)("Connect"),' Telegram</span>\n              </button>\n            </li>\n            <li class="connect-sources__item">\n              <button class="connect-sources__btn js-connect-sources-add-base" data-name="vk" type="button">\n                <svg class="svg-icon svg-inbox--social--vk-dims">\n                  <use xlink:href="#inbox--social--vk"></use>\n                </svg>\n                <span>').concat((0,i.i18n)("Connect"),' Vkontakte</span>\n              </button>\n            </li>\n            <li class="connect-sources__item">\n              <button class="connect-sources__btn js-connect-sources-add-widget" data-code="amochats_whatsapp" type="button">\n                <svg class="svg-icon svg-inbox--social--whatsapp-dims">\n                  <use xlink:href="#inbox--social--whatsapp"></use>\n                </svg>\n                <span>').concat((0,i.i18n)("Connect"),' WhatsApp</span>\n              </button>\n            </li>\n            <li class="connect-sources__item">\n              <button class="connect-sources__btn connect-sources__btn--viber js-connect-sources-add-base" data-name="viber" type="button">\n                <svg class="svg-icon svg-inbox--social--viber-dims">\n                  <use xlink:href="#inbox--social--viber"></use>\n                </svg>\n                <span>').concat((0,i.i18n)("Connect")," Viber</span>\n              </button>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  ")};var a="../build/transpiled/components/base/inbox/notification_templates/amochats_connect_sources";window.define(a,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([a])},230774:(t,e,n)=>{n.r(e),n.d(e,{createChatsNotificationItemTemplate:()=>a});var i=n(629133),o=n.n(i);function a(t){var e=o().template('data-id="<%= data.id %>" id="inbox-notification-<%= data.id %>" class="notification notification--talk notification__item <%= data.label ? "notification__item_favirites" : "" %> <%= !data.provider && !data.body.is_talk ? "notification__item_not-multiaction" : "" %> <%= data.checked ? "notification_checked" : "" %> <% if (!data.preselected && !data.is_read) { print("notification__item__unread"); } %> notification-inner <% if (data.preselected) { print("notification-inner_preselected"); } else if (data.selected) { print("notification-inner_selected"); } %>"')(t),n=o().template('\n    <% if (data.web_link) { %><a href="<%= data.web_link %>" class="<% if (data.absolute_link) { %>notification-inner__link<% } else { %>notification-inner__navigate-link js-navigate-link<% } %>" <% if (data.absolute_link) { %>target="_blank"<% } %>><% } %>\n\n    <div class="notification-chat__non-select">\n      <div class="<% if (data.body.icon.robot) { %>notification-chat__container-img_bot<% } else { %>notification-chat__container-img<% } %>">\n        <div class="n-avatar notification-inner__avatar <%= data.body.icon.border ? "notification-inner__avatar__border__blue" : "" %>" <% if (!_.isEmpty(data.id)) { %>id="<%= data.id %>"<% } %>></div>\n\n        <% if (data.body.icon.sub == "chat_group") { %>\n          <% var icon_class_name = "group_chat" %>\n        <% } else if (data.body.icon.sub == "error" || data.body.icon.sub == "chat_direct") { %>\n          <% var icon_class_name = false %>\n        <% } else if (data.body.icon.sub == "chat") { %>\n          <% var icon_class_name = "chats" %>\n        <% } else { %>\n          <% var icon_class_name = data.body.icon.sub %>\n        <% } %>\n\n        <% if (icon_class_name) { %>\n          <div class="notification-chat__container-icon">\n            <% if (icon_class_name == "mail") { %>\n              <img class="notification-mail__icon" src="/frontend/images/interface/inbox/icon_notification_mail.png">\n            <% } else if (data.body.icon_origin) { %>\n              <img class="notification-<%= data.body.icon_origin %>__icon" src="<%= data.body.icon_origin %>">\n            <% } else { %>\n              <svg class="svg-icon svg-common--chats-dims"><use xlink:href="#common--<%= icon_class_name %>"></use></svg>\n            <% } %>\n          </div>\n        <% } %>\n      </div>\n    </div>\n\n    <div class="notification-inner__container_text <% if (!data.body.last_message_at && !data.updated_at) { %>notification-inner__container_text--center<% } %>">\n\n    <div class="notification-inner__info_message">\n      <div class="notification-inner__info">\n        <span class="notification-inner__title_message_talk-id <% if (data.status === \'closed\') { %>notification-inner__title_message_talk-id_closed<% } %>" title="A<%= data.id %>">A<%= data.id %></span>\n\n\n        <% if (data.provider || data.body.is_talk) { %>\n          <label class="notification-chat__checkbox control-checkbox">\n            <input type="checkbox" class="js-item-checkbox" name="notify_selected" id="cbx_drop_<%= data.id %>" value="<%= data.id %>" <%= data.checked ? "checked" : "" %>>\n            <span class="control-checkbox__helper"></span>\n          </label>\n\n          <div class="notification-inner__controllers">\n            <svg class="svg-icon js-notification-favorites notification-inner__favorites <% if (data.label) { %>notification-inner__favorites_selected <% } %>svg-inbox--outline-star-dims"><use xlink:href="#inbox--outline-star"></use></svg>\n            <svg class="svg-icon js-notification-quick-action notification-inner__quick-action svg-controls--button-more-dims" style="<%= data.is_quick_action_enabled ? \'\' : \'display: none;\' %>"><use xlink:href="#controls--button-more"></use></svg>\n          </div>\n        <% } %>\n\n        <span class="notification-inner__data_message"><%= twig._twig.filter("feed_date", data.body.last_message_at || data.updated_at) %></span>\n      </div>\n    </div>\n\n    <div class="notification-inner__info_message">\n      <h2 class="notification-inner__title_message">\n        <span class="notification-inner__title_message_title"><%= data.body.__old_type ? data.body.title : _.escape(data.body.title) %></span>\n      </h2>\n    </div>\n\n      <% if (data.body.subtitle) { %>\n        <div class="notification-inner__info_message">\n          <h3 class="notification-inner__title_message"><%= data.body.subtitle %></h3>\n        </div>\n      <% } %>\n\n      <div class="notification-inner__info_message">\n        <div class="notification-inner__info">\n          <span class="notification-inner__from__message <% if (data.opened) { %>notification-inner__from__message-fully-opened<% } %>">\n            <% _.each(data.body.rows, function(line, index) {%>\n              <span class="<%= line.style %> notification-inner__from__message_height-<%= line.class_height %>">\n                <%= data.body.__old_type ? line.text : _.escape(line.text) %>\n\n                <% if (!data.notification && index === data.body.rows.length -1 && _.contains(["h2", "h3"], line.class_height) && !data.disable_more_content_button) { %>\n                  <div class="notification-inner__button_show-more-container" <% if (line.text.length > 100) { %>style="display: block"<% } %>>\n                    <div class="notification-inner__button_show-more">\n                      &#8226;&#8226;&#8226;\n                    </div>\n                  </div>\n                <% } %>\n              </span>\n            <% }); %>\n          </span>\n        </div>\n      </div>\n\n    </div>\n\n    <% if (data.web_link) { %></a><% } %>\n  ')(t);return t.data.is_native_link?'\n      <a href="'.concat(t.data.amo_link,'" ').concat(e,">\n        ").concat(n,"\n      </a>\n    "):"\n    <div ".concat(e,">\n      ").concat(n,"\n    </div>\n  ")}var r="../build/transpiled/components/base/inbox/notification_templates/chats_item_template";window.define(r,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([r])},981837:(t,e,n)=>{n.r(e),n.d(e,{default:()=>c});var i=n(460159),o=n.n(i),a=n(629133),r=n.n(a),s=n(445368);const c=function(t){var e,n=t.id,i=t.file,a=t.extension,c=t.updated_at,d=t.entityType,l=t.entityId,u=t.progress,f=t.status;return e=100===u?"100%":"error"===f?'<span style="color: #F37575;">'.concat(u,"</span>"):"".concat((0,s.i18n)("Uploading")," ").concat(u,"%"),'\n  <div data-id="'.concat(n,'" class="notification__item notification-inner " id="files-notification-').concat(n,'" style="background: var(--palette-notification-unread-background);">\n    <a href="/').concat(d,"/detail/").concat(l,'?tab_id=files" class="notification-inner__navigate-link js-navigate-link">\n      <div class="notification-chat__non-select">\n        <div class="notification-chat__container-img ').concat(100===u||"error"===f?"":"tab-file__item-img-loading",'">\n          ').concat(function(t){return'\n    <svg\n      width="36"\n      height="40"\n      viewBox="0 0 36 40"\n      fill="none"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n    <path\n      fill-rule="evenodd"\n      clip-rule="evenodd"\n      d="M26.2097 1H7C5.89543 1 5 1.89543 5 3V37C5 38.1046 5.89543 39 7 39H33C34.1046 39 35 38.1046 35 37L35 9.5H29.7097C27.7767 9.5 26.2097 7.933 26.2097 6L26.2097 1ZM36 9L36 37C36 38.6569 34.6569 40 33 40H7C5.34315 40 4 38.6569 4 37V3C4 1.34315 5.34315 0 7 0H26.7097L36 9ZM34.0467 8.5L27.2097 1.87667L27.2097 6C27.2097 7.38071 28.329 8.5 29.7097 8.5H34.0467Z"\n      fill="#979797"\n    />\n    />\n      <rect y="25" width="26" height="12" rx="3" fill="#979797" />\n      <text\n        fill="white"\n        xml:space="preserve"\n        font-size="9.5"\n        font-weight="bold"\n        letter-spacing="0.01em"\n        font-family="PT Sans"\n      >\n        <tspan x="3.3" y="34.7">'.concat(t,"</tspan>\n      </text>\n    </svg>\n  ")}(a.toUpperCase()),'\n        </div>\n      </div>\n      <div class="notification-inner__container_text ">\n          <div class="notification-inner__info_message">\n            <h2 class="notification-inner__title_message">\n              <span class="notification-inner__title_message_title">').concat(r().escape(i.name),'</span>\n            </h2>\n            <span class="notification-inner__data_message">').concat(o()._twig.filter("feed_date",c),'</span>\n          </div>\n        <span class="notification-inner__from__message ">\n          <span class="default notification-inner__from__message_height-h3">\n            ').concat(e,"\n          </span>\n        </span>\n      </div>\n    </a>\n  </div>\n  ")};var d="../build/transpiled/components/base/inbox/notification_templates/file_template";window.define(d,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([d])},504783:(t,e,n)=>{n.r(e),n.d(e,{default:()=>i});const i=function(t){var e=t.id,n=t.title,i=t.text;return'\n    <div class="'.concat(["notification-item-go-to-button","notification-item--".concat(e),"notification__item"].join(" "),'"\n    >\n      <svg class="svg-icon svg-inbox--plus-in-circle-dashed-dims">\n        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#inbox--plus-in-circle-dashed"></use>\n      </svg>\n\n      <div class="notification-item-go-to-button__content">\n        <span class="notification-item-go-to-button__title">\n          ').concat(n,'\n        </span>\n\n        <span class="notification-item-go-to-button__text">\n          ').concat(i,"\n        </span>\n      </div>\n    </div>\n  ")};var o="../build/transpiled/components/base/inbox/notification_templates/go_to_add_notification";window.define(o,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([o])},204141:(t,e,n)=>{n.r(e),n.d(e,{createNotificationItemTemplate:()=>a});var i=n(629133),o=n.n(i);function a(t){var e=o().template('data-id="<%= data.id %>" id="inbox-notification-<%= data.id %>" <% if (data.custom_action_hash) { %>data-custom-action-hash="<%= data.custom_action_hash %>"<% } %> class="notification__item <%= data.label ? "notification__item_favirites" : "" %> <%= !data.provider && !data.body.is_talk ? "notification__item_not-multiaction" : "" %> <%= data.checked ? "notification_checked" : "" %> <% if (!data.preselected && !data.is_read) { print("notification__item__unread"); } %> notification-inner <% if (data.preselected) { print("notification-inner_preselected"); } else if (data.selected) { print("notification-inner_selected"); } %>"')(t),n=o().template('\n    <% if (data.web_link) { %><a href="<%= data.web_link %>" class="<% if (data.absolute_link) { %>notification-inner__link<% } else { %>notification-inner__navigate-link js-navigate-link<% } %>" <% if (data.absolute_link) { %>target="_blank"<% } %>><% } %>\n\n    <% if (data.provider || data.body.is_talk) { %>\n      <label class="notification-chat__checkbox control-checkbox">\n        <input type="checkbox" class="js-item-checkbox" name="notify_selected" id="cbx_drop_<%= data.id %>" value="<%= data.id %>" <%= data.checked ? "checked" : "" %>>\n        <span class="control-checkbox__helper"></span>\n      </label>\n\n      <div class="notification-inner__controllers">\n        <svg class="svg-icon js-notification-quick-action notification-inner__quick-action svg-controls--button-more-dims" style="<%= data.is_quick_action_enabled ? \'\' : \'display: none;\' %>"><use xlink:href="#controls--button-more"></use></svg>\n        <svg class="svg-icon js-notification-favorites notification-inner__favorites <% if (data.label) { %>notification-inner__favorites_selected <% } %>svg-inbox--outline-star-dims"><use xlink:href="#inbox--outline-star"></use></svg>\n      </div>\n    <% } %>\n\n    <div class="notification-chat__non-select">\n      <div class="<% if (data.body.icon.robot) { %>notification-chat__container-img_bot<% } else { %>notification-chat__container-img<% } %>">\n        <div class="n-avatar notification-inner__avatar" <% if (!_.isEmpty(data.id)) { %>id="<%= data.id %>"<% } %>></div>\n\n        <% if (data.body.icon.sub == "chat_group") { %>\n          <% var icon_class_name = "group_chat" %>\n        <% } else if (data.body.icon.sub == "error" || data.body.icon.sub == "chat_direct") { %>\n          <% var icon_class_name = false %>\n        <% } else if (data.body.icon.sub == "chat") { %>\n          <% var icon_class_name = "chats" %>\n        <% } else { %>\n          <% var icon_class_name = data.body.icon.sub %>\n        <% } %>\n\n        <% if (icon_class_name) { %>\n          <div class="notification-chat__container-icon">\n            <% if (icon_class_name == "mail") { %>\n              <img class="notification-mail__icon" src="/frontend/images/interface/inbox/icon_notification_mail.png">\n            <% } else if (data.body.icon_origin) { %>\n              <img class="notification-<%= data.body.icon_origin %>__icon" src="<%= data.body.icon_origin %>">\n            <% } else { %>\n              <svg class="svg-icon svg-common--chats-dims"><use xlink:href="#common--<%= icon_class_name %>"></use></svg>\n            <% } %>\n          </div>\n        <% } %>\n      </div>\n    </div>\n\n    <div class="notification-inner__container_text <% if (!data.body.last_message_at && !data.updated_at) { %>notification-inner__container_text--center<% } %>">\n      <% if (data.body.title) { %>\n        <div class="notification-inner__info_message">\n          <h2 class="notification-inner__title_message">\n            <span class="notification-inner__title_message_title"><%= data.body.__old_type ? data.body.title : _.escape(data.body.title) %></span>\n            <% if (data.body.is_talk) { %><span class="notification-inner__title_message_talk-id" title="A<%= data.id %>">A<%= data.id %></span><% } %>\n            <span data-id="<%= data.id ? data.id : "" %>" class="control-user_state <%= isUserOnline ? "control-user_state_online" : "" %>" ></span>\n\n            <% if (data.is_emotion_detector_enabled && data.emotion) { %>\n              <div class="notification-inner__emotion js-notification_emotion" data-id="<%= data.id ? data.id : "" %>">\n                <svg class="notification-inner__emotion__svg">\n                  <use xlink:href="#common--<%= data.emotionDisplay %>"></use>\n                </svg>\n              </div>\n            <% } %>\n          </h2>\n          <span class="notification-inner__data_message"><%= twig._twig.filter("feed_date", data.body.last_message_at || data.updated_at) %></span>\n        </div>\n      <% } %>\n\n      <% if (data.body.subtitle) { %>\n        <div class="notification-inner__info_message">\n          <h3 class="notification-inner__title_message"><%= data.body.subtitle %></h3>\n        </div>\n      <% } %>\n\n      <span class="notification-inner__from__message <% if (data.opened) { %>notification-inner__from__message-fully-opened<% } %>">\n        <% _.each(data.body.rows, function(line, index) {%>\n          <span class="<%= line.style %> notification-inner__from__message_height-<%= line.class_height %>">\n            <%= data.body.__old_type ? line.text : _.escape(line.text) %>\n\n            <% if (!data.notification && index === data.body.rows.length -1 && _.contains(["h2", "h3"], line.class_height) && !data.disable_more_content_button) { %>\n              <div class="notification-inner__button_show-more-container" <% if (data.body.showMoreButton) { %>style="display: block"<% } %>>\n                <div class="notification-inner__button_show-more">\n                  &#8226;&#8226;&#8226;\n                </div>\n              </div>\n            <% } %>\n          </span>\n        <% }); %>\n      </span>\n    </div>\n\n    <% if (data.web_link) { %></a><% } %>\n  ')(t);return t.data.is_native_link?'\n      <a href="'.concat(t.data.amo_link,'" ').concat(e,">\n        ").concat(n,"\n      </a>\n    "):"\n    <div ".concat(e,">\n      ").concat(n,"\n    </div>\n  ")}var r="../build/transpiled/components/base/inbox/notification_templates/item_template";window.define(r,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([r])},231102:(t,e,n)=>{n.r(e),n.d(e,{default:()=>i});const i=function(t){return'\n    <div class="notification__item notification__user-not-found">\n      <div class="notification__user-not-found-inner">\n        <div class="notification__user-not-found-text">\n          '.concat(t,"\n        </div>\n      </div>\n    </div>\n  ")};var o="../build/transpiled/components/base/inbox/notification_templates/user_not_found";window.define(o,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([o])},472450:(t,e,n)=>{n.r(e),n.d(e,{default:()=>v,getInitialSortOrder:()=>g});var i=n(661533),o=n.n(i),a=n(629133),r=n.n(a),s=n(313981);function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n||t):o.value}},l(t,e,n||t)}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function f(t,e){return f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},f(t,e)}function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=u(t);if(e){var o=u(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(t,e){return!e||"object"!=((n=e)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e;var n}(this,n)}}var h="amo_inbox_order",p={sort_by:"unread_first",sort_type:"false"},b={sort_by:"unread_first",sort_type:"true"};function m(){return"com"===APP.constant("account").top_level_domain?p:b}var v=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(a,t);var e,n,i=_(a);function a(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return e=a,n=[{key:"_classes",value:function(){return{sort_buttons:"js-read-sort",selected_sort_option:"search-more__item_active"}}},{key:"_selectors",value:function(){return{selected_sort_by:'.js-read-sort[data-sort-by="%s"][data-sort-type="%s"]'}}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(u(a.prototype),"initialize",this).apply(this,arguments);var e=t.onSelect,n=void 0===e?r().noop:e,i=JSON.parse(localStorage.getItem(h));this.onSelect=n,this.order=r().isNull(i)||r().isUndefined(i)?this._getDefaultSort():i,r().isBoolean(this.order)&&(this.order=this.order?b:p),this._prepareSort()}},{key:"events",value:function(){return{"click .js-read-sort":"onOrderChange","click .search-more__item-header":"onSearchMoreItemHeaderClick"}}},{key:"changeStateSort",value:function(t){var e=o()(t.currentTarget);e.hasClass(this._class("selected_sort_option"))||(this._elem("sort_buttons").removeClass(this._class("selected_sort_option")),e.addClass(this._class("selected_sort_option")),this.order={sort_by:e.attr("data-sort-by"),sort_type:e.attr("data-sort-type")},localStorage.setItem(h,JSON.stringify(this.order)))}},{key:"onOrderChange",value:function(t){this.changeStateSort(t),this.onSelect(this.getQueryObject())}},{key:"_prepareSort",value:function(){this._findElem("selected_sort_by",this.order.sort_by,this.order.sort_type).addClass(this._class("selected_sort_option"))}},{key:"_getDefaultSort",value:function(){return m()}},{key:"getQueryObject",value:function(){return d({},this.order.sort_by,this.order.sort_type)}},{key:"onSearchMoreItemHeaderClick",value:function(t){t.stopPropagation()}}],n&&c(e.prototype,n),a}(s.default);function g(){var t;try{if(!(t=JSON.parse(localStorage.getItem(h)))||!r().isObject(t))throw new Error("No sort in LS")}catch(e){t=m()}return d({},t.sort_by,t.sort_type)}var y="../build/transpiled/components/base/inbox/read_sort";window.define(y,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([y])},963154:(t,e,n)=>{n.r(e),n.d(e,{default:()=>v});var i=n(629133),o=n.n(i),a=n(987081),r=n(128508),s=n(214558),c=n(926168),d=n(450422),l=n(474564),u=n(761634),f=n(46018),_=n(661533),h=(0,s.current)(),p=APP.constant("account").amojo_rights,b="",m={list:"/v3/inbox/list",default_list:"/v3/inbox/list"};function v(t,e){var n,i,v=function(t,e){return!e||(E=o().omit(E,t),!1)},g=function(t){var e;if(e=(t=t||{}).fetch_local?(0,s.get)(!0):E,t.is_filter)return a.from([]);var n=a.concat(a.from(p.can_direct?o().values(e):[]),a.from(o().values((0,u.get)())).pipe(r.filter((function(t){return(0,d.isAmoChatsFullEnabled)()?"amo.support"===t.code:t.is_direct&&("amo.support"!==t.code||!(0,c.isCustomers)())})))).pipe(r.filter((function(e){switch(!0){case t.fetch_local:return t.fetch_local;case e.id===h.id:return v(e.id,!0);default:return!0}})),r.map((function(t){var e,n;return t.bot?(e={url:t.avatar},n={chat_bot:t.id}):(e={profile:t.id},n={chat_direct:t.id}),{entity:{type:"chat_direct",id:t.id},preview:"text",id:t.id.toString(),login:t.login,created_at:0,updated_at:0,is_bot:!0===t.bot,is_read:!0,body:{icon:e,title:t.title,actions:{click:n}}}})));return i?a.concat(n,C.pipe(r.filter((function(t){return!o().isNull(t.entity_id)})),r.map((function(t){return{entity:{id:t.entity_id.toString(),type:"chat_group"},is_read:!0,web_link:null,id:parseInt(t.entity_id),created_at:0,updated_at:0,body:{title:t.title,icon:{profile:t.chat_id.toString(),sub:"chat_group"},actions:{click:{chat_group:t.chat_id.toString()}}}}})))).pipe(r.map((function(e){return o().isFunction(t.rate)?t.rate(e):e})),r.filter((function(t){return t._sorting_rate>0})),r.toArray(),r.map((function(t){return o().sortBy(t,(function(t){return-t._sorting_rate}))})),r.flatMap((function(t){return a.from(t)}))):n},y=!0,E=(0,s.get)(!0),w={},k=e?{list:e,default_list:e}:o().clone(m),C=a.defer((function(){return(0,l.getGroupChats)(l.CHAT_GROUP_TYPE)})).pipe(r.map((function(t){return t?t.response.chats.group_list:null})),r.shareReplay(1),r.flatMap((function(t){return a.from(o().values(t))})));return{init:function(e){var c;(n=new a.Subject).pipe(r.switchMap((function(e){return c=e.deferred,function(e,n){var c;i=(e=e||{}).term&&e.term.length>0;var d={is_filter:!o().isEmpty(e.filter)};return i&&o().extend(d,e,{fetch_local:!0}),e.reset&&(y=!0,E=(0,s.get)(!0)),c=i?g(d):a.concat(function(e,n){return a.defer((function(){var i;return y?((k.list===k.default_list||e.reset)&&(w={limit:t,order:e.order,filter:e.filter},p.can_direct||(w.filter||(w.filter={}),w.filter.exclude={entity_type:["chat_direct"]})),i=_.ajaxPromisify({url:e.reset?k.default_list:k.list,data:w}),a.from(i).pipe(r.map((function(t){return o().isUndefined(t)?(y=!1,[]):(o().isFunction(e.onFetchResponse)&&e.onFetchResponse(t),k.list=t._links.next?t._links.next.href:t._links.self.href,b||(b=t._links.next?t._links.next.href:t._links.self.href),t._embedded.items)})),r.flatMap((function(e){return e.length<t&&(y=!1),a.from(e)})),r.tap({next:function(){o().isFunction(n)&&n(!1)},error:function(){return o().isFunction(n)&&n(!0),a.from([])}}))):Promise.reject()}))}(e,n).pipe(r.filter((function(t){return!t.click||!t.click.type||"chat_direct"!==t.click.type||!!f.default.getRecipient(t.click.values)}))),g(d)).pipe(r.take(t),r.tap({next:function(t){v(t.id,t.entity&&"chat_direct"===t.entity.type)}})),a.onErrorResumeNext(c).pipe(r.toArray())}(e.options,e.noContent)})),r.catchError((function(t){e({error:t},c)}))).subscribe((function(t){e({items:t},c)}))},onNewOption:function(t,e,i){n.next({options:t,noContent:e,deferred:i})},isFinished:function(){return!y&&0===o().keys(E).length},addUsersBuffer:function(t){if(0===o().keys(E).length)return!0;var e=(0,s.get)(t);return e&&!o().isEqual(e,(0,s.get)())&&(E[t]=(0,s.get)(t)),!1}}}var g="../build/transpiled/components/base/inbox/sources";window.define(g,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([g])},46018:(t,e,n)=>{n.r(e),n.d(e,{default:()=>a});var i=n(214558),o=APP.constant("amojo_bots");const a={getRecipient:function(t){var e,n=(0,i.get)(!0);return 1==(parseInt(t).toString()===t.toString())?n[t]:{id:(e=o[t]).id,amojo_id:e.id,title:e.name,avatar:e.avatar,is_bot:!0}}};var r="../build/transpiled/components/base/inbox/users";window.define(r,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([r])},341302:(t,e,n)=>{n.r(e),n.d(e,{amo_window:()=>o});var i="persistentOpen",o=function(){var t=null,e=null;function n(e){t=window.open(e.href)}function o(n){if(n.source===t)switch(n.data&&n.data.method){case"".concat(i).concat(".").concat("resolved"):if(!e)break;clearTimeout(e),e=null,t&&t.focus()}}return window.addEventListener("message",o),{open:function(o){if(!e){var a;try{a=new URL(o)}catch(t){return void console.error("Can't parse provided url: ".concat(o))}t&&!t.closed?function(o){t.postMessage({method:i,payload:{linkDetails:"".concat(o.pathname).concat(o.search)}},o.origin);var a=setTimeout((function(){n(o),e=null}),600);e=a}(a):n(a)}},destroy:function(){window.removeEventListener("message",o),t=null,clearTimeout(e),e=null}}}(),a="../build/transpiled/components/base/inbox/utils/persistent_window";window.define(a,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([a])},382646:(t,e,n)=>{n.r(e),n.d(e,{default:()=>a});var i=n(161320),o=n.n(i);function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=o()().tz(APP.system.timezone).set({hours:0,minutes:0,second:0}),n=o()().tz(APP.system.timezone).set({hours:23,minutes:59,second:59}),i=parseInt(o()().tz(APP.system.timezone).quarter()),a=parseInt(t.replace("previous_days_",""));if(a>0)return{from:e.subtract(a,"day").format("X"),to:n.format("X")};switch(t){case"today":case"current_day":return{from:e.format("X"),to:n.format("X")};case"yesterday":return{from:e.subtract(1,"day").format("X"),to:n.subtract(1,"day").format("X")};case"current_week":case"week":return{from:e.weekday(0).format("X"),to:n.weekday(6).format("X")};case"previous_week":return{from:e.subtract(1,"week").weekday(0).format("X"),to:n.subtract(1,"week").weekday(6).format("X")};case"current_month":case"month":return{from:e.startOf("month").format("X"),to:n.endOf("month").format("X")};case"previous_month":return{from:e.subtract(1,"month").startOf("month").format("X"),to:n.subtract(1,"month").endOf("month").format("X")};case"current_quarter":case"quarter":return{from:e.startOf("month").month(3*i-3).format("X"),to:n.month(3*i-1).endOf("month").format("X")};case"current_year":return{from:e.startOf("year").format("X"),to:n.endOf("year").format("X")}}}var r="../build/transpiled/components/base/inbox/utils/preset_to_timestamp";window.define(r,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([r])},811149:(t,e,n)=>{n.r(e),n.d(e,{default:()=>l});var i=n(12615);function o(t,e,n,i,o,a,r){try{var s=t[a](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,o)}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){a(t,e,n[e])}))}return t}var s,c,d=(s=function(t,e){var n,i,o,a=arguments;return function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(this,(function(s){switch(s.label){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:{},i={headers:{"Content-Type":"application/json;charset=utf-8",headers:{"X-Requested-With":"XMLHttpRequest"}},method:"POST",body:JSON.stringify(r({id:e.ids,all:e.choose_all||!1},n))},[4,fetch("/v3/inbox/".concat(t),i)];case 1:return(o=s.sent()).ok&&200===o.status?[2,o.json()]:[2,{status:o.status}]}}))},c=function(){var t=this,e=arguments;return new Promise((function(n,i){var a=s.apply(t,e);function r(t){o(a,n,i,r,c,"next",t)}function c(t){o(a,n,i,r,c,"throw",t)}r(void 0)}))},function(t,e){return c.apply(this,arguments)});const l={fetchAction:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i.default.check().fail((function(){return{status:401}})).done((function(){return d(t,e,n)}))}};var u="../build/transpiled/network/inbox/api";window.define(u,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([u])},833496:(t,e,n)=>{n.r(e),n.d(e,{default:()=>a});var i={},o=function(t,e){if("Y"===APP.widgets.list[t].init_once)return i[t]=e};APP.addNotificationCallback=o;const a={addCallback:o,execCallbacks:function(t){for(var e in i)i[e](t)}};var r="../build/transpiled/widgets/notification_subscriber";window.define(r,(function(){var t="undefined",n=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return n&&n.default||n})),window.require([r])},283070:(t,e,n)=>{n.r(e),n.d(e,{BaseInboxCard:()=>i.BaseInboxCard});var i=n(409220)},409220:(t,e,n)=>{n.r(e),n.d(e,{BaseInboxCard:()=>l});var i=n(60042),o=n.n(i),a=n(701106),r=n(491967),s=n(445368),c=n(574253),d=n(827378),l=function(t){var e=t.id,n=t.contact,i=t.status,l=t.updatedAt,u=t.children,f=t.subtitle,_=t.emotion,h=t.shouldShowEmotion,p=t.foundMessage,b=(null==n?void 0:n.name)||"...",m=(null==p?void 0:p.createdAt)||l;return d.createElement("div",{className:o()("notification-inner__container_text",{"notification-inner__container_text--center":!l})},d.createElement("div",{className:"notification-inner__info_message"},d.createElement(a.default,{type:"h2",size:"l",className:o()("notification-inner__title_message",c.default.titleMessageB2C)},d.createElement("span",{className:"notification-inner__title_message_title"},b),d.createElement("span",{className:o()(c.default.notificationInnerTitleMessageB2C,"notification-inner__title_message_talk-id ".concat("closed"===i?"notification-inner__title_message_talk-id_closed":"")),title:"A".concat(e)},"A".concat(e)),h&&_&&d.createElement("div",{className:"notification-inner__emotion js-notification_emotion shown","data-id":"120"},d.createElement(r.default,{type:"svg",name:"common--".concat(_.toLowerCase()),className:"notification-inner__emotion__svg"}))),(m||0===m)&&d.createElement("span",{className:"notification-inner__data_message"},(0,s.formatDate)(m))),f&&d.createElement(a.default,{type:"h3",size:"l",className:"notification-inner__info_message"},f),u)}},937585:(t,e,n)=>{n.r(e),n.d(e,{B2CNotificationInboxCard:()=>i.B2CNotificationInboxCard});var i=n(967727)},181767:(t,e,n)=>{n.r(e),n.d(e,{getMessageWebLink:()=>a});var i=n(323344);function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var a=function(t,e){if(!e)return t;var n,a,r=(n=t.split("?"),a=2,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,a=[],r=!0,s=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(a.push(i.value),!e||a.length!==e);r=!0);}catch(t){s=!0,o=t}finally{try{r||null==n.return||n.return()}finally{if(s)throw o}}return a}}(n,a)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(n,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=r[0],c=r[1],d=void 0===c?"":c;return"".concat(s).concat((0,i.setQueryParam)({t:e.createdAt,tid:e.id},{query_string:d,only_query_string:!0}))}},938314:(t,e,n)=>{n.r(e),n.d(e,{getMessageWebLink:()=>i.getMessageWebLink});var i=n(181767)},226927:(t,e,n)=>{var i;n.r(e),n.d(e,{CardDisplayMode:()=>i}),function(t){t.CHAT="chat",t.SEARCH="search"}(i||(i={}))},141963:(t,e,n)=>{n.r(e),n.d(e,{BodyInbox:()=>o.BodyInbox,CardDisplayMode:()=>i.CardDisplayMode,ChatInboxCardProps:()=>o.ChatInboxCardProps,Contact:()=>o.Contact,ContentProps:()=>o.ContentProps,SearchInboxCardProps:()=>o.SearchInboxCardProps});var i=n(226927),o=n(828195)},828195:(t,e,n)=>{n.r(e)},982096:(t,e,n)=>{n.r(e),n.d(e,{B2CNotificationInboxCard:()=>l});var i=n(60042),o=n.n(i),a=n(500034),r=n(226927),s=n(584509),c=n(827378);function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=function(t){var e,n,i=t.displayMode,l=t.isNativeLink,u=t.onActionClick,f=t.id,_=t.isProvider,h=t.isTalk,p=t.isPreselected,b=t.isSelected,m=t.isChecked,v=t.isRead,g=t.isFavorite,y=t.amoLink,E=t.customActionHash,w=i===r.CardDisplayMode.CHAT&&l,k=o()("notification__item","notification-inner",{"notification__item_not-multiaction":!_&&!h,"notification-inner_preselected":p,"notification-inner_selected":!p&&b,"notification--talk":!(0,a.isFeatureAvailable)("global_inbox"),notification_checked:m,notification__item__unread:i===r.CardDisplayMode.CHAT&&!p&&!v,notification__item_favirites:g}),C={id:"inbox-notification-".concat(f),"data-id":f,"data-custom-action-hash":E,className:k,onClick:u};return w?c.createElement("a",(e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){d(t,e,n[e])}))}return t}({},C),n=null!=(n={href:y})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n.push.apply(n,i)}return n}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e),c.createElement(s.CardContent,t)):c.createElement("div",C,c.createElement(s.CardContent,t))}},584509:(t,e,n)=>{n.r(e),n.d(e,{CardContent:()=>c});var i=n(352185),o=n(562268),a=n(827378);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){r(t,e,n[e])}))}return t}var c=function(t){var e=t.webLink,n=t.absoluteLink,r=t.foundMessage,c=function(t,e){if(null==t)return{};var n,i,o=function(t,e){if(null==t)return{};var n,i,o={},a=Object.keys(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}(t,["webLink","absoluteLink","foundMessage"]);return e?a.createElement(i.LinkWrapper,{webLink:e,absoluteLink:n,foundMessage:r},a.createElement(o.InnerContent,s({foundMessage:r},c))):a.createElement(o.InnerContent,s({foundMessage:r},c))}},734304:(t,e,n)=>{n.r(e),n.d(e,{InnerContent:()=>s});var i=n(827378),o=n.n(i),a=n(711757),r=n(256795),s=function(t){var e=t.id,n=t.body,i=t.contact,s=t.avatar||null;return o().createElement(o().Fragment,{key:"inner-content-".concat(e)},o().createElement(r.AvatarInbox,{body:n,contact:i,profileAvatar:s}),o().createElement(a.Content,t))}},330010:(t,e,n)=>{n.r(e),n.d(e,{AvatarInbox:()=>u,getIconClassName:()=>l});var i=n(60042),o=n.n(i),a=n(827378),r=n(445368),s=n(17011),c=n(827378);function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var l=function(t){switch(t){case"chat_group":return"group_chat";case"chat":return"chats";case"chat_direct":return!1;default:return t}},u=function(t){var e,n,i,u,f,_,h=t.body,p=t.profileAvatar,b=(0,r.getDefaultAvatar)(null===(e=h.icon)||void 0===e?void 0:e.avatarId),m=(f=(0,a.useState)(p||b),_=2,function(t){if(Array.isArray(t))return t}(f)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,a=[],r=!0,s=!1;try{for(n=n.call(t);!(r=(i=n.next()).done)&&(a.push(i.value),!e||a.length!==e);r=!0);}catch(t){s=!0,o=t}finally{try{r||null==n.return||n.return()}finally{if(s)throw o}}return a}}(f,_)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(f,_)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),v=m[0],g=m[1],y=l(null===(n=h.icon)||void 0===n?void 0:n.sub);return c.createElement("div",{className:"notification-chat__non-select"},c.createElement("div",{className:o()({"notification-chat__container-img_bot":null===(i=h.icon)||void 0===i?void 0:i.robot,"notification-chat__container-img":!(null===(u=h.icon)||void 0===u?void 0:u.robot)})},c.createElement("div",{className:o()("n-avatar","notification-inner__avatar")},c.createElement("img",{src:v,alt:"avatar",onError:function(){v!==b&&g(b)}})),y&&c.createElement("div",{className:"notification-chat__container-icon"},c.createElement(s.IconImage,{iconClassName:y,iconOrigin:h.iconOrigin}))))}},593974:(t,e,n)=>{n.r(e),n.d(e,{IconImage:()=>a});var i=n(491967),o=n(827378),a=function(t){var e=t.iconClassName,n=t.iconOrigin;return"mail"===e?o.createElement("img",{className:"notification-mail__icon",src:"/frontend/images/interface/inbox/icon_notification_mail.png",alt:"mail icon"}):n?o.createElement("img",{className:"notification-".concat(n,"__icon"),src:n,alt:"icon"}):o.createElement(i.default,{type:"svg",name:"common--".concat(e)})}},17011:(t,e,n)=>{n.r(e),n.d(e,{IconImage:()=>i.IconImage});var i=n(593974)},256795:(t,e,n)=>{n.r(e),n.d(e,{AvatarInbox:()=>i.AvatarInbox});var i=n(330010)},909899:(t,e,n)=>{n.r(e),n.d(e,{Content:()=>s});var i=n(141963),o=n(606108),a=n(441925),r=n(827378),s=function(t){return t.displayMode===i.CardDisplayMode.CHAT?r.createElement(o.ChatInboxCard,t):t.displayMode===i.CardDisplayMode.SEARCH?r.createElement(a.SearchInboxCard,t):null}},589819:(t,e,n)=>{n.r(e),n.d(e,{ChatInboxCard:()=>l});var i=n(60042),o=n.n(i),a=n(701106),r=n(491967),s=n(283070),c=n(827378);function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=function(t){var e=t.id,n=t.body,i=t.typeContact,l=t.message,u=t.isFavorite,f=t.emotion,_=t.isTalk,h=t.isChecked;return c.createElement(c.Fragment,null,_&&c.createElement("label",{className:"notification-chat__checkbox control-checkbox"},c.createElement("input",{type:"checkbox",className:"js-item-checkbox",name:"notify_selected",id:"cbx_drop_".concat(e),value:e,checked:h,readOnly:!0}),c.createElement("span",{className:"control-checkbox__helper"})),c.createElement(s.BaseInboxCard,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){d(t,e,n[e])}))}return t}({shouldShowEmotion:Boolean(f),subtitle:n.subtitle},t),n.title&&"contacts"!==i&&c.createElement("div",{className:"notification-inner__info_message"},c.createElement(a.default,{type:"h3",size:"l",className:"notification-inner__title_message notification-inner__container_text_B2C"},c.createElement("span",{className:"notification-inner__title_message_title"},n.title))),c.createElement("div",{className:"notification-inner__info_message"},c.createElement(a.default,{type:"h3",size:"l",className:"notification-inner__title_message notification-inner__from__message notification-inner__container_text_B2C"},c.createElement("span",{className:"notification-inner__title_message_title"},l))),c.createElement("div",{className:"notification-inner__controllers"},c.createElement(r.default,{type:"svg",name:"controls--button-more",className:"js-notification-quick-action notification-inner__quick-action"}),c.createElement(r.default,{type:"svg",name:"inbox--outline-star",className:o()("js-notification-favorites notification-inner__favorites",{"notification-inner__favorites_selected":u})}))))}},606108:(t,e,n)=>{n.r(e),n.d(e,{ChatInboxCard:()=>i.ChatInboxCard});var i=n(589819)},461097:(t,e,n)=>{n.r(e),n.d(e,{SearchInboxCard:()=>l});var i=n(60042),o=n.n(i),a=n(916569),r=n(701106),s=n(283070),c=n(827378);function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=function(t){var e=t.body,n=t.message,i=t.isOpened,l=t.typeContact;return c.createElement(s.BaseInboxCard,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){d(t,e,n[e])}))}return t}({subtitle:e.subtitle},t),(e.title||!e.subtitle)&&"contacts"!==l&&c.createElement("div",{className:"notification-inner__info_message"},c.createElement(r.default,{type:"h3",size:"l",className:"notification-inner__title_message notification-inner__container_text_B2C"},c.createElement("span",{className:"notification-inner__title_message_title"},e.title||"..."))),e.rows&&c.createElement("span",{className:o()("notification-inner__from__message",{"notification-inner__from__message-fully-opened":i})},e.rows.map((function(t,e){return c.createElement(a.Text,{key:e,theme:a.TextSecondaryDarkTheme,size:"l",className:o()(t.style,"notification-inner__from__message_height-".concat(t.classHeight))},n)}))))}},441925:(t,e,n)=>{n.r(e),n.d(e,{SearchInboxCard:()=>i.SearchInboxCard});var i=n(461097)},711757:(t,e,n)=>{n.r(e),n.d(e,{Content:()=>i.Content});var i=n(909899)},562268:(t,e,n)=>{n.r(e),n.d(e,{InnerContent:()=>i.InnerContent});var i=n(734304)},745409:(t,e,n)=>{n.r(e),n.d(e,{LinkWrapper:()=>s});var i=n(60042),o=n.n(i),a=n(938314),r=n(827378),s=function(t){var e=t.children,n=t.webLink,i=t.foundMessage,s=t.absoluteLink,c=(0,a.getMessageWebLink)(n,i);return r.createElement("a",{href:c,className:o()({"notification-inner__link":s,"js-navigate-link notification-inner__navigate-link":!s}),target:s&&"_blank",rel:s?"noreferrer noopener":void 0},e)}},352185:(t,e,n)=>{n.r(e),n.d(e,{LinkWrapper:()=>i.LinkWrapper});var i=n(745409)},967727:(t,e,n)=>{n.r(e),n.d(e,{B2CNotificationInboxCard:()=>i.B2CNotificationInboxCard});var i=n(982096)}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_18_50_52"},function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(new Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="9cc89bfd-c1b6-46ed-ada9-fd1974bbe65a",t._sentryDebugIdIdentifier="sentry-dbid-9cc89bfd-c1b6-46ed-ada9-fd1974bbe65a")}catch(t){}}();
//# sourceMappingURL=78636.8acb736f010bdb6ed30a.js.map