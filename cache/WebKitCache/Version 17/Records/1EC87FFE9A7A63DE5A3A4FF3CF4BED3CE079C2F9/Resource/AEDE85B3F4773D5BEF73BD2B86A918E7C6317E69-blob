{% if (has_pipelines) %}
    <div class="pipeline-select-wrapper pipeline-select-wrapper_plain {% if multiple %}multiple js-control-pipeline-select_multiple-default filter-pipelines-multiselect{% else %}js-control-pipeline-select control--select-white modal-body__inner__managers-select{% endif %} folded {{class_name}}" id="{{id}}">
        {% set class_name = '' %}
        <div class="pipeline-select-wrapper__inner pipeline-select-wrapper__inner_plain {{inner_class_name}} {% if multiple %}pipeline-select-wrapper__inner-multiple filter-pipelines-multiselect__inner{% endif %} custom-scroll">
            <div class="pipeline-select-wrapper__inner__holder">
                <div class="pipeline-select-wrapper__inner__container">
                    {% if not selected_pipeline_id %}
                        {% set selected_pipeline_id = selected_pipe.id %}
                    {% endif %}

                    {% if not selected_pipeline_id and params.form_params %}
                        {% set selected_pipeline_id = params.form_params.settings.lead_pipe %}
                        {% set selected = params.form_params.settings.lead_status %}
                    {% endif %}
                    {% if not selected_pipeline_id %}
                        {% set selected_pipeline_id = (items | first).id %}
                    {% endif %}
                    {% if not multiple %}
                        <input class="pipeline-select__pipeline-selected" type="hidden" name="{{selected_pipe.name}}" value="{{selected_pipeline_id}}">
                    {% endif %}

                    {% for pipeline in items %}
                        {% set pipe_id = 'pipeline_' ~ pipeline.id ~ '_' ~ random() %}
                        <input
                            class="pipeline-select__pipeline-input js-form-changes-skip js-filter-clear-skip"
                            type="radio"
                            name=""
                            id="{{pipe_id}}"
                            value="{{pipeline.id}}"
							{% if multiple %}
							data-is-custom="n"
							{% endif %}
                            {% if not multiple and (selected_pipeline_id == pipeline.id) %}
                            checked="checked"
                            {% elseif multiple and loop.first %}
                            checked="checked"
                            {% endif %}>
                        <div class="pipeline-select{% if multiple %} pipeline-select__button-create-new-field{% endif %}">
                            <label class="pipeline-select__caption" title="{{pipeline.name}}" for="{{pipe_id}}">
                                {% if multiple %}
                                    {% include "templates/checkbox.twig" with { id: pipe_id ~ '_checkbox', name: '', value: pipeline.id } %}
                                {% endif %}
                                <span class="pipeline-select__caption__inner">
                                    <span class="pipeline-select__caption-text" {% if multiple %} data-statuses-numeral="этап,этапа,этапов,этапы" data-pipelines-numeral="воронка,воронки,воронок,воронки" data-folded-title="Активные статусы" {% endif %} title="{{pipeline.name}}"></span>
                                </span>
                            </label>

                            <ul class="pipeline-select__dropdown">
                                {% if not selected and pipeline.id == selected_pipeline_id %}
                                    {% set selected = (pipeline.statuses | first).id %}
                                {% endif %}

                                {% if not selected and pipeline.id == selected_pipeline_id %}
                                    {% for status in pipeline.statuses %}
                                        {% if loop.first %}
                                            {% set selected = status.id %}
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}

                                {% for status in pipeline.statuses %}
                                    {% set item_id = 'pipeline_' ~ pipeline.id ~ '_' ~ status.id ~ '_' ~ random() %}
                                    {% set is_selected_item = (selected_pipeline_id == pipeline.id and selected == ('' ~ status.id)) %}
                                    <li class="pipeline-select__dropdown__item{% if is_selected_item and not multiple %} pipeline-select__dropdown__item_selected{% endif %}" style="background-color: {{status.color}};" for="{{item_id}}">
                                        {% if multiple %}
                                            {% set checked = false %}
                                            {% if sel[pipeline.id] | length > 0 %}
                                                {% for st in sel[pipeline.id] %}
                                                    {% if st == status.id %}
                                                        {% set checked = true %}
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                            {% include "templates/checkbox.twig" with { name: 'filter[pipe][' ~ pipeline.id ~ '][]', additional_data: 'data-pipeline-id="' ~ pipeline.id ~ '"', id: item_id, value: status.id, class_name: 'pipeline-select__dropdown__item__label', text: status.name, checked: checked } %}
                                        {% else %}
                                            <input class="pipeline-select__dropdown__item__input" type="radio" name="{{name}}" id="{{item_id}}" value="{{status.id}}" {% if is_selected_item %} checked="checked" {% endif %}>
                                            <label class="pipeline-select__dropdown__item__label" for="{{item_id}}">
                                                <span class="pipeline-select__item-text-wrapper">
                                                    <span class="pipeline-select__item-text">{{status.name}}</span>
                                                </span>
                                            </label>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% else %}
    {% include "templates/select.twig" %}
{% endif %}