"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[73413],{348924:(t,e,i)=>{i.r(e),i.d(e,{default:()=>o});var s=i(629133),n=i.n(s),r=i(267651),a=i.n(r);const o={_publisher_tokens:[],undelegatePublisherEvents:function(){this._publisher_tokens=n().reject(this._publisher_tokens,(function(t){return a().unsubscribe(t),!0}))},delegatePublisherEvents:function(){this.undelegatePublisherEvents(),n().each(n().result(this,"publisher_events",null),(function(t,e){n().isString(t)&&(t=n().bind(this[t],this)),this._publisher_tokens.push(a().subscribe(e,t))}),this)}};var d="../build/transpiled/common/mixin/publisher_events";window.define(d,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([d])},511535:(t,e,i)=>{i.r(e),i.d(e,{list:()=>m,subscribe:()=>g,unsubscribe:()=>b});var s=i(629133),n=i.n(s),r=i(661533),a=i.n(r),o=i(987081),d=i(128508),_=i(277476),u={base:"/ajax/v1/subscriptions",list:"/ajax/v3/subscriptions"};function l(t,e){var i={request:{subscriptions:{}}};return i.request.subscriptions[e]=t,i}function c(t){var e=new _.default;return n().each(t,(function(t){e.add(t)})),e}function h(t){return u[t]?u[t]:"".concat(u.base,"/").concat(t)}function p(t){return function(e){return e?"list"===t?e._embedded&&e._embedded.subscriptions||{}:e.response.subscriptions[t]:null}}function f(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET";return function(){return 0===t.entity_id?Promise.resolve():a().ajaxPromisify({url:e,type:i,data:t,dataType:"json"})}}function m(t,e){var i={entity_type:t,entity_id:e};return o.from(f(i,h("list"))()).pipe(d.map(p("list")),d.map(c))}function g(t){return o.from(f(l(t,"subscribe"),h("subscribe"),"POST")()).pipe(d.map(p("subscribe")))}function b(t){return o.from(f(l(t,"unsubscribe"),h("unsubscribe"),"POST")()).pipe(d.map(p("unsubscribe")))}var v="../build/transpiled/interface/card/controls/subscribers/network/api";window.define(v,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([v])},277476:(t,e,i)=>{i.r(e),i.d(e,{default:()=>a});var s=i(345839),n=i.n(s),r=i(347736);const a=n().Collection.extend({model:r.default});var o="../build/transpiled/interface/card/controls/subscribers/network/collection";window.define(o,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([o])},347736:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});var s=i(345839);const n=i.n(s)().Model.extend({defaults:{user_id:0,group_id:0},initialize:function(){this.attributes.user_id=parseInt(this.attributes.user_id)||0,this.attributes.group_id=parseInt(this.attributes.group_id)||0,this.id=this._makeId()},_makeId:function(){return this.attributes.user_id>0?this.attributes.user_id:"group_".concat(this.attributes.group_id)}});var r="../build/transpiled/interface/card/controls/subscribers/network/model";window.define(r,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([r])},397240:(t,e,i)=>{i.r(e),i.d(e,{default:()=>p});var s=i(629133),n=i.n(s),r=i(987081),a=i(128508),o=i(214558),d=i(277476),_=i(347736),u=i(511535),l=i(661533),c={};function h(t,e){var i="".concat(t).concat(e);return c[i]?c[i]:(this.hash=i,this.entity_type=parseInt(t),this.entity_id=parseInt(e),this.items=new d.default,this.updates$=new r.Subject,this._changes={},this.reset$=new r.BehaviorSubject(!0),this.list$=new r.ReplaySubject(1),this.loading$=new r.BehaviorSubject(!1),this.sync_state$=new r.BehaviorSubject(!0),c[i]=this,this.init(),this)}n().extend(h.prototype,{init:function(){var t=r.merge(this.reset$,r.fromEvent(l(document),"users:list:changed")).pipe(a.switchMap(n().bind(this.fetch,this)),a.combineLatestWith((0,o.fetch)(),this.onlyActive),a.map(this.resetItems,this)),e=r.fromEvent(this.items,"add remove").pipe(a.switchMap(n().bind((function(){return r.of(this.items)}),this)));r.merge(e,t).pipe(a.map((function(t){return{action:"reset",items:t.toArray()}}))).subscribe(this.list$)},onlyActive:function(t,e){var i=t.clone();return i.models=n().filter(i.models,(function(t){if(t.get("user_id")>0){if(!e.managers[t.get("user_id")])return!1}else if(!e.groups["group_".concat(t.get("group_id"))])return!1;return!0})),i},fetch:function(){return this.startLoading().pipe(a.flatMap(n().bind((function(){return u.list(this.entity_type,this.entity_id)}),this)),a.tap({complete:n().bind(this.stopLoading,this)}))},save:function(){return this.startLoading().pipe(a.switchMap(n().bind(this.makeSaveObserverChain,this)),a.tap({next:n().bind((function(t){t.add&&t.add.success&&(t.add.success.user_id&&t.add.success.user_id.length>0&&n().each(t.add.success.user_id,(function(t){var e=new _.default({user_id:t});this._changes=n().omit(this._changes,e.id),this.items.add(e)}),this),t.add.success.group_id&&t.add.success.group_id.length>0&&n().each(t.add.success.group_id,(function(t){var e=new _.default({group_id:t});this._changes=n().omit(this._changes,e.id),this.items.add(e)}),this)),t.remove&&t.remove.success&&(t.remove.success.user_id&&t.remove.success.user_id.length>0&&n().each(t.remove.success.user_id,(function(t){var e=new _.default({user_id:t});this._changes=n().omit(this._changes,e.id),this.items.remove(e)}),this),t.remove.success.group_id&&t.remove.success.group_id.length>0&&n().each(t.remove.success.group_id,(function(t){var e=new _.default({group_id:t});this._changes=n().omit(this._changes,e.id),this.items.remove(e)}),this)),this.stopLoading(),this._changes={},this._updateState()}),this)}))},count:function(){return this.items.length},makeSaveObserverChain:function(){var t,e={user_id:[],group_id:[]},i={user_id:[],group_id:[]};return n().each(this._changes,(function(t){var s=t.model;-1===t.state?s.get("user_id")>0?i.user_id.push(s.get("user_id")):i.group_id.push(s.get("group_id")):1===t.state&&(s.get("user_id")>0?e.user_id.push(s.get("user_id")):e.group_id.push(s.get("group_id")))}),this),t=r.of({remove:{},add:{}}),(e.user_id.length||e.group_id.length)&&(t=r.zip(t,u.subscribe(n().extend(e,{entity_type:this.entity_type,entity_id:this.entity_id,event:"chat_message"}))).pipe(a.map((function(t){return t[0].add=t[1],t[0]})))),(i.user_id.length||i.group_id.length)&&(t=r.zip(t,u.unsubscribe(n().extend(i,{entity_type:this.entity_type,entity_id:this.entity_id,event:"chat_message"}))).pipe(a.map((function(t){return t[0].remove=t[1],t[0]})))),t},unsubscribe:function(t){var e=this.items.get(t);return e&&this._markRemoved(e),this},subscribe:function(t){var e,i=t.toString().replace("group_","");return e=i===t.toString()?new _.default({user_id:t}):new _.default({group_id:i}),this._markAdded(e),this},subscribeUser:function(t){var e=new _.default({user_id:t});this._markAdded(e)},subscribeGroup:function(t){new _.default({group_id:t})},unsubscribeUser:function(t){var e=new _.default({user_id:t});this._markRemoved(e)},unsubscribeGroup:function(t){var e=new _.default({group_id:t});this._markRemoved(e)},_markRemoved:function(t){this._changes[t.id]||(this._changes[t.id]={state:0,model:t}),this._changes[t.id].state--,this._updateState()},_markAdded:function(t){this._changes[t.id]||(this._changes[t.id]={state:0,model:t}),this._changes[t.id].state++,this._updateState()},_updateState:function(){var t=n().reduce(n().values(this._changes),(function(t,e){return t.state+e.state}));this.sync_state$.next(0===t)},resetItems:function(t){return this._changes={},this.sync_state$.next(!0),this.items.reset(t.toJSON(),{silent:!0}),this.updates$.next({action:"add",items:t.toArray()}),t},startLoading:function(){return this.loading$.next(!0),r.of(!0)},stopLoading:function(){this.loading$.next(!1)},destroy:function(){c=n().omit(c,this.hash)}});const p=h;var f="../build/transpiled/interface/card/controls/subscribers/network/service";window.define(f,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([f])},448596:(t,e,i)=>{i.r(e),i.d(e,{default:()=>_});var s=i(629133),n=i.n(s),r=i(445368),a=i(214558),o=i(397240),d=i(93103);const _=d.default.extend({_show_all:null,_classes:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return n().extend({},d.default.prototype._classes.apply(this,e),{title_text:"users-select__head-title-text"})},initialize:function(t){n().extend(t,{users_template:"/tmpl/users_select/wrapper/amojo.twig",select_one_group:!0}),d.default.prototype.initialize.apply(this,arguments)},_getChatMembers:function(){var t=(0,a.get)(!0),e=[];if(n().isUndefined(this.options.entity))return!1;var i=new o.default(this.options.entity.element_type,this.options.entity.id);return n().each(i.items.models,(function(i){0===i.attributes.user_id?n().each(t,(function(t){t.group==="group_".concat(i.attributes.group_id)&&t.amojo_id&&e.push(t.amojo_id)})):t[i.id]&&t[i.id].amojo_id&&e.push(t[i.id].amojo_id)})),e||{}},getRenderUsersAndGroups:function(t){var e={},i={},s={},o=this.$el.data("values-hash"),_=this.$el.data("groups-hash"),u=n().isFunction(this.options.getChatMembers)?this.options.getChatMembers():this._getChatMembers(),l=n().filter(_,(function(e,i){var s=n().find(o,(function(t){return t.group_id===i&&parseInt(t.id)!==parseInt((0,a.current)("id"))}));return this.options.select_groups&&n().contains(t.groups,e)&&s}),this);return i=n().reduce(t.users,(function(t,e){var i=e.group;return"external"===i?(e.option=n().escape(e.option),e.title=n().escape(e.title)):i="members",-1===n().indexOf(u,e.amojo_id||e.id)&&"external"!==e.group||this.options.exclude_me&&parseInt(e.id)===(0,a.current)("id")||(n().isArray(t[i])||(t[i]=[]),t[i].push(e)),t}),{},this),this._show_all||!n().without(n().keys(i),"external").length||t.value&&l.length&&this.options.select_groups||n().isNull(this._show_all)&&t.selected_item[0].is_group?(e=d.default.prototype.getRenderUsersAndGroups.apply(this,arguments),i.members&&(e.users.members=[{id:"show_members",group:"members",title:(0,r.i18n)("Show participants only")}],e.groups.members.hidden=!1,e.groups.members.hide_title=!0),this.options.select_groups&&n().each(e.groups,(function(t){n().contains(["group_free_users","external","bots","members"],t.id)||(t.selectable=!0,t.hidden=!n().contains(l,t.title))})),e.users=n().reduce(e.users,(function(t,i,s){var r=n().filter(i,(function(t){return!this.options.exclude_me||parseInt(t.id)!==(0,a.current)("id")}),this);return r.length&&e.groups[s]?(t[s]=r,e.groups[s].hidden=!1):this.options.select_groups||(e.groups[s].hidden=!0),t}),{},this),this.showOnlyExternalUsersIfHasLoadMore(e,t.selected_item[0])):(s=n().reduce(["external","members"],(function(t,e){return t[e]={title:_[e],hidden:!i[e]&&-1===n().indexOf(l,_[e]),selectable:this.options.select_groups&&"members"===e,id:e},t}),{},this),i.members&&(s.members.select_title=(0,r.i18n)("Write to all"),i.members.push({id:"show_all",group:"members",title:(0,r.i18n)("Show all users in chat")})),this.options.teammate_mention&&(delete i.external,delete s.external,delete i.bots,delete s.bots),this.showOnlyExternalUsersIfHasLoadMore({users:i,groups:s},t.selected_item[0]))},showOnlyExternalUsersIfHasLoadMore:function(t,e){!e||!e.active&&e.is_group;var i,s,a=t.users.external||[];return e=e||{},a.length&&"more_chats"===a[a.length-1].id?((this._show_internal||e.active||e.is_group)&&!1!==this._show_internal?(i=n().extend(t.users,{external:[{id:"show_external",group:"external",title:(0,r.i18n)("Show contacts")}]}),s=n().extend({},t.groups,{external:n().extend(t.groups.external,{hidden:!1,hide_title:!0})})):(i={internal:[{id:"show_internal",group:"internal",title:(0,r.i18n)("Show users")}],external:t.users.external},(s={internal:t.groups.members,external:t.groups.external}).internal.hidden=!1,s.internal.hide_title=!0),{users:i,groups:s}):t},getHighlightedItem:function(t,e){if(t.is_group)return t;var i=n().chain(e.users).clone().toArray().flatten().filter((function(t){return"show_all"!==t.id})).value();return(t=n().findWhere(i,{id:t.id}))||(t=i[0]),t},itemChoose:function(t,e){var i,s=this;switch(!0){case"more_chats"===e.id:t.stopPropagation(),n().isFunction(this.options.loadChats)&&(i=this.$list.find(this._selector("suggest")).scrollTop(),this.$list.find('.js-multisuggest-item[data-id="'.concat(e.id,'"]')).append('<span class="spinner-icon" style="width: 9px; height: 9px; margin-left: 5px;"></span>'),this.options.loadChats().then((function(){s.$(".js-multisuggest-input").val(""),s.loadHelper(),s.$list.find(s._selector("suggest")).scrollTop(i)})));break;case"show_external"===e.id:case"show_internal"===e.id:t.stopPropagation(),this._show_internal="show_internal"===e.id,this.setUsers(t,!1);break;case"show_members"===e.id:case"show_all"===e.id:t.stopPropagation(),this.$(".js-multisuggest-input").val(""),this._show_all="show_all"===e.id,this._show_internal=!0,this.setUsers(t,!1);break;default:d.default.prototype.itemChoose.apply(this,arguments)}},setExistsUsersGroup:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.users.groups.members=(0,r.i18n)("Participants"),d.default.prototype.setExistsUsersGroup.apply(this,e)},loadItems:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];d.default.prototype.loadItems.apply(this,e),n().isFunction(this.options.loadChats)&&this.items_load_promises.push(this.options.loadChats())},addGroupClick:n().noop});var u="../build/transpiled/interface/card/controls/users_select";window.define(u,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([u])},218043:(t,e,i)=>{i.r(e),i.d(e,{default:()=>h});var s=i(629133),n=i.n(s),r=i(345839),a=i.n(r),o=i(162262),d=i.n(o),_=i(313981),u=i(926168),l=i(816412),c=_.default.extend({$el:null,_el_class:"linked-holder",_raw_element:null,_info:null,_is_active:!1,initialize:function(t){this.$el.addClass(this._el_class),this.parseParams(t),_.default.prototype.initialize.apply(this,arguments)},loadData:function(){throw new Error("Override this function, please")},parseParams:function(t){if(!t)throw new Error("Please, read docs for initialize function");this.setInfo(t.type),this.setCurrentElement(t.current),this.setRawElement(t.raw_element),this.setNotesCollection(t.notes)},setNotesCollection:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._addComponent(a().Collection);this._card_notes=t},setInfo:function(t){this._info=(0,u.parseLinkedType)(t)},getInfo:function(t){var e=this._info||{};return t&&(e=e[t]||null),e},setRawElement:function(t){t&&(this._raw_element=n().extend({},this._raw_element,t))},toggle:function(t){t=n().isUndefined(t)?!this._is_active:!!t,this._is_active=t,this.$el.toggle(this._is_active)}});d().mixin(c,l.default);const h=c;var p="../build/transpiled/interface/card/linked/linked_holder";window.define(p,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([p])},172848:(t,e,i)=>{i.r(e),i.d(e,{default:()=>o});var s=i(926168),n=i(894193),r=i(509446),a=function(t){var e;switch((0,s.convertElementType)(t,"string")){case"leads":e=n.default;break;case"customers":e=r.default}return e};function o(t,e,i){var s;if("statistic"===t&&(s=a(e)),!s)throw new Error('Unknown static type "%s"'.replace("%s",t));return new s(i)}var d="../build/transpiled/interface/card/linked/linked_static_fabric";window.define(d,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([d])},331499:(t,e,i)=>{i.r(e),i.d(e,{default:()=>d});var s=i(629133),n=i.n(s),r=i(460159),a=i.n(r),o=i(218043);const d=o.default.extend({_el_class:"linked-static-holder",_raw_element:null,initialize:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];o.default.prototype.initialize.apply(this,e),this.loadData().then(n().bind(this.onLoad,this))},loadData:function(){return a()._preload(n().result(this,"_preload"))()},onLoad:function(){this.render()},_template:null,_preload:function(){return[this._template]},render:function(){throw new Error("Override this function, please")}});var _="../build/transpiled/interface/card/linked/linked_static_holder";window.define(_,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([_])},816412:(t,e,i)=>{i.r(e),i.d(e,{default:()=>a});var s=i(629133),n=i.n(s),r=i(926168);const a={_element:{type:null,id:0},setCurrentElement:function(t){if(!t)throw new Error("Empty element given");this._element=n().extend({},this._element||{}),n().isUndefined(t.type)||(this._element.type=(0,r.parseLinkedType)(t.type)),t.id>=0&&this.setMainId(t.id)},setMainId:function(t){var e=parseInt(t)||0;if(e<0)throw new Error("Element id must be positive integer, but given ".concat(t));this._element.id=e}};var o="../build/transpiled/interface/card/linked/mixins/current_element";window.define(o,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([o])},449429:(t,e,i)=>{i.r(e),i.d(e,{default:()=>g});var s=i(629133),n=i.n(s),r=i(460159),a=i.n(r),o=i(809228),d=i.n(o),_=i(410432),u=i(214558),l=i(500034),c=i(641762),h=i(331499),p=i(580326),f=i(474564),m=i(661533);const g=h.default.extend({_feed_stats:{},_loading:!0,initialize:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];h.default.prototype.initialize.apply(this,e),this._loadStats()},_loadStats:function(){var t=n().keys(p.AmoJoMediator.get()),e=this._card_notes.findCollection(this._raw_element.id),i=[];this._feed_stats={},this._card_stats={},e&&i.push(e.getStats()),(0,l.isFeatureAvailable)("operday")&&i.push(_.default.getStatsOnCard(this._element.type.type,this._element.id)),t.length&&i.push((0,f.getChatsStat)(t).toPromise()),Promise.all(i).then(n().bind((function(t){var e=n().pick(t[1],["users_groups","spent_time"]),i=n().propertyOf(t)([0,0,"visited_pages"]);n().isEmpty(e)||(e=this.prepareOperdayStatsData(e)),this._loading=!1,n().each(n().flatten(t),this._updateNotesStats,this),this._card_stats=n().extend({letters:0,tasks:{expired:0,completed:0},calls:{inbound:0,outbound:0},visited_at:i.business_card_page?i.business_card_page:i.personal_page},n().pick(t[0][0],["letters","tasks","calls"]),{operday:e}),this.listenTo(this._card_notes,"add",this._updateStatOnNoteAdd,this),this.listenTo(this._card_notes,"remove",this._updateStatOnNoteRemove,this),this.render()}),this)),this.listenTo(this._card_notes,"add:from_socket",this._updateStatOnChatAdd,this)},prepareOperdayStatsData:function(t){var e={};return e.spent_time=Math.floor(t.spent_time/3600),e.users_groups=n().map(t.users_groups,(function(t){return n().extend(t,{spent_time:(0,c.secondsToHHMM)(t.spent_time),users:n().chain(t.users).keys().map((function(e){return t.users[e]})).sortBy((function(t){return-t.spent_time})).map((function(t){return n().extend(t,{spent_time:(0,c.secondsToHHMM)(t.spent_time)})})).value()})})),e},_updateStatOnNoteRemove:function(t){this._updateStatOnNote(t,-1)},_updateStatOnNoteAdd:function(t){this._updateStatOnNote(t,1)},_updateStatOnNote:function(t,e){"notes"===(t.get("object_type")||{}).code&&parseInt(t.get("type"))===APP.note_types.common&&this._updateNotesStats({id:t.get("element_id"),count:e,users:[{id:t.get("created_by"),count:e}]})},_updateStatOnChatAdd:function(t){this._updateNotesStats({id:t.chat_id,count:1,users:[{id:t.author.id,count:1}]})},_updateNotesStats:function(t){var e,i=n().find(p.AmoJoMediator.get(),(function(e){return e.chat_id===t.id})),s=(0,u.get)("all"),r=Boolean(t.users_groups)&&(0,l.isFeatureAvailable)("operday");switch(!0){case!n().isUndefined(i)&&i.entity_type===APP.element_types.contacts:e="external_chats";break;case!n().isUndefined(i):e="internal_chats";break;case r:e="operday_stats";break;default:e="notes"}this._feed_stats[e]||(this._feed_stats[e]=0),this._feed_stats[e]+=t.count,this._feed_stats.users||(this._feed_stats.users=[]),n().each(t.users,(function(t){var e=n().find(s,(function(e){return parseInt(e.id)===parseInt(t.id)||e.amojo_id===t.id})),i=!1;this._feed_stats.users=n().reduce(this._feed_stats.users,(function(e,s){return parseInt(s.id)===parseInt(t.id)&&(s.count+=t.count,i=!0),e.push(s),e}),[]),!i&&e&&this._feed_stats.users.push({id:e.id,name:e.title,count:t.count})}),this),n().sortBy(this._feed_stats.users,"count"),this.render()},prepareElementForRender:function(t){var e=n().clone(t);return e.is_new=n().isUndefined(t.id),e},_onSuccessCopyAction:function(t){m(t.trigger).addClass("js-copied"),n().delay(n().bind((function(){m(t.trigger).removeClass("js-copied")}),this),800)},_onFailedCopyAction:function(t){m(t.trigger).addClass("animated shake"),n().delay(n().bind((function(){m(t.trigger).removeClass("animated shake")}),this),200)},render:function(){var t=a()({ref:this._template}),e=this.prepareElementForRender(this._raw_element),i=t.render({element:e,currency:APP.system.locale.currency_symbol,feed:this._feed_stats,loading:this._loading,element_type:APP.getBaseEntity(),stats:this._card_stats}),s=m(i);this.$el.html(s),this.afterRender()},afterRender:function(){this._addComponent(d(),".js-page-link").on("success",n().bind(this._onSuccessCopyAction,this)).on("error",n().bind(this._onFailedCopyAction,this))}});var b="../build/transpiled/interface/card/linked/statistic/base";window.define(b,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([b])},509446:(t,e,i)=>{i.r(e),i.d(e,{default:()=>c});var s=i(629133),n=i.n(s),r=i(460159),a=i.n(r),o=i(445368),d=i(955026),_=i(449429),u=i(304483),l=i(661533);const c=_.default.extend({prepareElementForRender:function(){var t=_.default.prototype.prepareElementForRender.apply(this,arguments);return t.is_new||(t.days_from_create?t.days_from_create=(0,o.reductNumericValue)({value:t.days_from_create,maxValue:9999}):t.days_from_create=0,(0,d.hasKeys)(t,["transactions","statistic"])||(t.transactions=t.transactions||{},t.transactions.statistic={}),t.transactions.statistic=n().extend({count:0,sum:0},t.transactions.statistic),t.transactions.statistic.count=(0,o.reductNumericValue)({value:t.transactions.statistic.count,maxValue:999999})),t},_changeBonusPoints:function(t,e){var i=this.prepareElementForRender(this._raw_element).id,s="/ajax/v4/customers/".concat(i,"/bonus_points"),r={updated_by:APP.constant("user").id},a=t?{earn:e}:{redeem:e};return r=n().extend(r,a),l.ajax({url:s,type:"POST",contentType:"application/json",data:JSON.stringify(r)}).done(n().bind((function(t){this.$el.find(".js-bonus-points").text(t.bonus_points)}),this))},_openBonusPointsModal:function(t){var e=this;this.bonus_points_modal||(this.bonus_points_modal=new u.default({init:function(i){i.addClass("bonus-points-modal").trigger("modal:loaded").html(a()({ref:e._modal_template}).render({increment:t})).trigger("modal:centrify");var s=i.find('input[name="bonus-points"]'),r=i.find(".js-modal-accept");this.onModalAcceptClick=function(){var i=Number(s.val());i&&i>0&&(r.trigger("button:load:start"),e._changeBonusPoints(t,i).done(n().bind((function(){this.showSuccess((0,o.i18n)("Bonus points successfully changed"))}),this)).fail(n().bind((function(t){this.showError((0,o.i18n)(t.responseJSON.detail))}),this)).always(n().bind((function(){r.trigger("button:load:stop")}),this)))}},destroy:function(){e.bonus_points_modal=null}}))},afterRender:function(){_.default.prototype.afterRender.call(this),a()._preload([this._modal_template])().then(n().bind((function(){this.$el.find(".js-bonus-points-give").on("click",n().bind(this._openBonusPointsModal,this,!0)),this.$el.find(".js-bonus-points-take").on("click",n().bind(this._openBonusPointsModal,this,!1))}),this))},_template:"/tmpl/cards/customers/card/stats.twig",_modal_template:"/tmpl/cards/stats/bonus_points_modal.twig"});var h="../build/transpiled/interface/card/linked/statistic/customers";window.define(h,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([h])},894193:(t,e,i)=>{i.r(e),i.d(e,{default:()=>c});var s=i(629133),n=i.n(s),r=i(162262),a=i.n(r),o=i(348924),d=i(769381),_=i(449429),u=APP.element_types,l=_.default.extend({_statistic_element_types:[],initialize:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];_.default.prototype.initialize.apply(this,e),this.delegatePublisherEvents()},initStatisticElementTypes:function(){var t=(this.getFeedFilterFromStorage(u.leads)||{}).linked;t||(t=n().values(u)),this.setStatisticElementTypes(t)},destroy:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.undelegatePublisherEvents(),_.default.prototype.destroy.apply(this,e)},prepareElementForRender:function(){var t=_.default.prototype.prepareElementForRender.apply(this,arguments);return t.is_new||(t.statistic=n().reduce(t.statistic,(function(t,e,i){var s=n().extend({pages:[]},t);return i=parseInt(i),-1===this._statistic_element_types.indexOf(i)||n().isEmpty(e.pages)||(s.pages=e.pages),s}),{},this)),t},setStatisticElementTypes:function(t){this._statistic_element_types=[u.leads],t=n().values(t),n().each(t,(function(t){(t=parseInt(t)||0)&&-1===this._statistic_element_types.indexOf(t)&&this._statistic_element_types.push(t)}),this)},onLoad:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.initStatisticElementTypes(),_.default.prototype.onLoad.apply(this,e)},undelegateEvents:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.undelegatePublisherEvents(),_.default.prototype.undelegateEvents.apply(this,e)},delegateEvents:function(t){var e=_.default.prototype.delegateEvents.apply(this,arguments);return t||this.delegatePublisherEvents(),e},publisher_events:function(){var t=n().extend({},n().result(_.default.prototype,"publisher_events"));return t["notes:filter:change"]="onLinkedFilterChanged",t},onLinkedFilterChanged:function(t,e){e&&e.element_type===u.leads&&(this.setStatisticElementTypes((e.values||{}).linked),this.render())},_template:"/tmpl/cards/leads/stats.twig"});a().mixin(l,d.default,o.default);const c=l;var h="../build/transpiled/interface/card/linked/statistic/leads";window.define(h,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([h])},769381:(t,e,i)=>{i.r(e),i.d(e,{default:()=>u});var s=i(629133),n=i.n(s),r=i(267651),a=i.n(r),o=i(926168),d=i(214558),_=i(661533);const u={getFeedFilterFromStorage:function(t){var e=(0,d.current)("settings")||{};return e.feed_filter?e.feed_filter[(0,o.convertElementType)(t,"string")]:null},getFeedSystemFromStorage:function(){var t=(0,d.current)("settings")||{};return{need_msec:t.need_msec||!1,need_open_talks_preview:!n().has(t,"need_open_talks_preview")||!!t.need_open_talks_preview}},setFeedFilterToStorage:function(t,e,i){var s=(0,o.convertElementType)(t,"string"),r=(0,d.current)("settings")||{},u={};return n().isEmpty(e)?e=n().propertyOf(r)(["feed_filter",s])||{}:(u[s]=e,r.feed_filter=n().extend(r.feed_filter||{},u)),n().isEmpty(i)?i=n().pick(r,["need_msec","need_open_talks_preview"]):(r.need_msec=n().has(i,"need_msec")?i.need_msec:r.need_msec,r.need_open_talks_preview=n().has(i,"need_open_talks_preview")?i.need_open_talks_preview:r.need_open_talks_preview),(0,d.current)("settings",r),a().publish("notes:filter:change",{element_type:t,values:e,system_props:i}),_.ajax({url:"/ajax/card/feed_filter/set/",type:"POST",data:{entity_type:t,value:JSON.stringify(e),system_props:JSON.stringify(i)}})}};var l="../build/transpiled/interface/card/mixins/notes_linked_element_types";window.define(l,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([l])},73462:(t,e,i)=>{i.r(e),i.d(e,{default:()=>g});var s=i(629133),n=i.n(s),r=i(460159),a=i.n(r),o=i(313981),d=i(335745),_=i(323344),u=i(445368),l=i(450422),c=i(258471),h=i(656724),p=i(172848),f=i(661533);i(368439);var m=f(document);const g=o.default.extend({_TabHandler:h.default,_classes:function(){return{item:"card-tabs__item",js_item:"js-card-tab",js_item_plug:"js-card-tab-plug",item_inner:"card-tabs__item-inner",item_in_context:"card-tabs__item_in-context",item_is_selected:"selected",item_preload:"card-tabs__item_preload",add_linked_type:"js-add_linked_type",dots:"js-linked-toggler",dots_button:"button-input-with-menu",dots_button_pressed:"button-input-pressed",fitter:"js-fitter",slider:"card-tabs-slider"}},_selected_tab:"",_default_selected_tab:"default",_inited_id:"default",_tabs:[{id:"default",_tab_type:"default",name:(0,u.i18n)("Main")},{id:"statistic",_tab_type:"default",name:(0,u.i18n)("Statistics")}],_tabs_views:[],_dots_tt:null,events:{"mouseenter .js-linked-toggler":"_onDotsMouseEnter","mouseleave .js-linked-toggler":"_onDotsMouseLeave","click .js-linked-toggler":"_onDotsClick"},document_events:{"tabs:refresh":"render","tabs:reset":"_setSortOrder"},initialize:function(t){o.default.prototype.initialize.apply(this,arguments),this._settings_exists=!t.no_settings,this._onShow=t.onShow||n().noop,this._onHide=t.onHide||n().noop,this._onSwitch=t.onSwitch||n().noop,this._products_id=APP.constant("account").products.catalog_id,this._card_id=APP.constant("card_id"),this._keep_tab_id=!t.no_query_string,this._render=n().bind(this._render,this),this.notes=t.notes||{},t.items&&t.items.length&&(this._tabs=t.items),this._tabs=n().filter(this._tabs,(function(t){return"statistic"!==t.id||!(!n().contains(["leads","customers"],APP.getBaseEntity())||0===this._card_id||(0,l.isAmoChatsFullEnabled)())}),this),this._setSortOrder(),this.setTti=n().once((function(){(0,c.trackPerformanceMetric)({name:c.TrackedMetricName.CARD_TTI,group:c.TrackedMetricGroupName.TTI}),APP.constant("load_from_server")&&(0,d.logPerformanceMetric)({type:(0,d.getRealCardPageType)(),name:"cardTti"})})),this.render(),this._$window.on("resize".concat(this.ns),n().bind(this.render,this)),this._$document.on("toggleWidgetPanel".concat(this.ns),n().bind(this.render,this))},destroy:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._$document.off("toggleWidgetPanel".concat(this.ns)),this.destroyTabs(),o.default.prototype.destroy.apply(this,e)},_onDotsMouseEnter:function(){var t=this._findElem("dots_button");clearTimeout(this._dots_tt),t.hasClass(this._class("dots_button_pressed"))||(t.trigger("button:menu:toggle",[{visible:!1,no_trigger:!0}]),this.$el.addClass("dots-active"))},_onDotsMouseLeave:function(){this._dots_tt=setTimeout(n().bind((function(){this._findElem("dots_button").trigger("button:menu:toggle",[{visible:!0,no_trigger:!0}]),this.$el.removeClass("dots-active"),this._dots_tt=null}),this),100)},_onDotsClick:function(t){3===t.isTrigger||APP.is_touch_device||f(t.target).closest("li").length||t.stopPropagation()},get:function(){return n().map(this._tabs,(function(t){return n().extend({},t)}))},update:function(t,e,i,s){return this._tabs=n().filter(this._tabs,(function(t){return t._tab_type!==e})),n().isArray(t)?(this._tabs=this._tabs.concat(n().map(t,(function(t){return n().extend(t,{_tab_type:e,onShow:i,onHide:s})}),this)),this._actualizeSort(e),this.render()):Promise.resolve()},_actualizeSort:function(t){var e=this._sort_order;e&&e[0]&&e[0].type===t&&(e=this._setSortOrder(),n().findWhere(this._tabs,{id:e&&e[0].id})||(this._sort_order=n().without(e,e[0])))},_sort:function(){var t=this._sort_order,e=n().find(t,(function(t){return"default"===t.id}));return t&&(this._tabs=n().chain(this._tabs).reduce((function(e,i,s){var r=n().findIndex(t,(function(t){return n().contains([t.id,parseInt(t.id)],i.id)}));return"settings"===i.id?i.sort=1/0:i.sort=r>=0?r:s,e.push(i),e}),[]).sortBy("sort").value(),e&&t[0]&&(this._default_selected_tab=t[0].id)),this._tabs},_setSortOrder:function(){return this._sort_order=(APP.constant("tabs_groups")||{})[APP.getBaseEntity()],this._sort_order},render:a()._preload(["/tmpl/cards/toggler.twig","/tmpl/controls/button.twig"],"_render"),_render:function(){var t=this._measure(),e={inner_class_name:"button-input-more-inner",class_name:"button-input-more",svg_class_name:"controls--button-more",tab_index:"-1",context_menu:n().map(t.hidden,(function(t){return{svg_icon:t.svg_icon,class_name:[this._class("js_item"),this._class("item_in_context")].join(" "),id:"linked_context_".concat(t.id),additional_data:"",href:null,_blank:null,span_class:"h-text-overflow",text:t.name}}),this)};this.destroyTabs(),this.$el.append(t.$visible.map(n().bind((function(t,e){return this.initTab(e,this._tabs[t]),e}),this))),this._elem("dots").removeClass(this._class("item_is_selected")).removeClass(this._class("item_preload")),e.context_menu.length?(this._elem("dots").html(a()({ref:"/tmpl/controls/button.twig"}).render(e)),n().each(t.hidden,(function(t){this.initTab(f("#linked_context_".concat(t.id)).get(0),t)}),this)):this._elem("dots").html(""),this.setTti()},_getTrimmedVisibleTabs:function(t,e){var i=0;return{$items:t.find(this._selector("item_inner")).filter((function(t,e){var s=f(e);return i+=e.parentNode.offsetWidth,s.get(0).scrollWidth>parseInt(s.css("max-width"))})),rest_width:e-i}},_getTabViewById:function(t){return n().find(this._tabs_views,(function(e){return e._settings.id===t}))},_getVisibleWidth:function(){return this.$el.get(0).offsetWidth-this._elem("dots").width()},_getTabHTML:function(t){return['<div class="'.concat(this._class("item")," ").concat(this._class("js_item"),'" data-id="').concat(t.id,'"><span class="').concat(this._class("item_inner"),'" title="').concat((0,u.stripTags)(t.name),'">').concat(t.name,"</span></div>")].join()},_measure:function(){return!this._measure_last_call_time||Date.now()-this._measure_last_call_time>=50?this._measureForce():(clearTimeout(this._measure_call_tmid),this._measure_last_call_time=Date.now(),this._measure_call_tmid=setTimeout(this._render,50)),this._measured},_measureForce:function(){var t,e=f('<div class="'.concat(this._class("fitter"),'"></div>')),i=this._getVisibleWidth();return this.$el.append(e),e.css({zIndex:-1,position:"absolute",top:0,bottom:0,whiteSpace:"nowrap",visibility:"hidden"}),t=n().findIndex(this._sort(this._tabs),(function(t){var s=f(this._getTabHTML(t));e.append(s);var n=i-e.get(0).offsetWidth;return n<0&&s.remove(),n<0}),this),this._adjustVisibleWidths(e,i),e.remove(),this._measured={$visible:e.children(),hidden:t>-1?n().rest(this._tabs,t):[]},this._measured},_initStatistic:function(){var t=APP.constant("card_element"),e=APP.getBaseEntity();this._statistic||n().isEmpty(this.notes)||(this._statistic=new p.default("statistic",e,{current:{id:t.id,type:{name:"name",id:APP.element_types[e]}},element_model:null,id:"statistic",notes:this.notes,raw_element:t,type:{name:"name",id:"statistic",linked:!0,type:"statistic",_tab_type:"linked"}}),f('.linked-forms__group-wrapper[data-id="statistic"]').prepend(this._statistic.$el))},toggleTabs:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m.trigger("revertProducts",""),this._onHide(),n().each(this._tabs_views,(function(t){t.onHide()})),e.no_select||(this._selected_tab=t.id),this._inited_id=t.id,this._onSwitch(t.id),this._updateUrl(t.id),"statistic"!==t.id||t.is_cf_tab||this._initStatistic(),t},_updateUrl:function(t){var e="",i=this._default_selected_tab;t=t===this._products_id?"products":t,i=i===this._products_id?"products":i,this._keep_tab_id&&(e=t===i?(e=(0,_.removeQueryParam)("tab_id"))?"?".concat(e):"":(0,_.setQueryParam)({tab_id:t},{only_query_string:!0}),APP.router.navigate(window.location.pathname+e,{replace:!0,trigger:!1}))},_animateToSelected:function(t){var e=t.is(this._selector("dots"))?t.width():t.get(0).offsetWidth,i={width:e};e&&(i.left=t.position().left),this._findElem("slider").css(i)},initTab:function(t,e){var i=e.onShow||this._onShow,s=n().compose(i,n().bind(this.toggleTabs,this)),r=(0,_.getQueryParam)("tab_id"),a=this._selected_tab;!0===e.no_highlight&&(s=i),n().isNaN(Number(r))||(r=Number(r)),this._keep_tab_id&&r&&(a="products"===r?this._products_id:r,this._selected_tab=a),"statistic"===e.id&&(e.is_disabled="leads"!==APP.getBaseEntity()),this._tabs_views.push(this._addComponent(this._TabHandler,n().extend({el:t,settings:e,selected_class_name:this._class("item_is_selected"),preload_class_name:this._class("item_preload"),dots_class_name:this._class("dots"),is_context_item:t.classList.contains(this._class("item_in_context")),is_selected:e.id===(a||this._default_selected_tab),autoinit:this._inited_id!==(a||this._default_selected_tab),onClick:s,onHide:e.onHide,onAnimateBorder:n().bind(this._animateToSelected,this)},this._getTabAdditionalParams())))},_getTabAdditionalParams:function(){return{}},_adjustVisibleWidths:function(t,e){var i,s=this._getTrimmedVisibleTabs(t,e);s.$items.length&&s.rest_width>0&&(i=s.rest_width/s.$items.length,s.$items.css("max-width","+=".concat(i,"px")),this._adjustVisibleWidths(t,e))},destroyTabs:function(){this._findElem("js_item_plug").remove(),this._findElem("dots").removeAttr("data-notification"),this._tabs_views=n().reduce(this._tabs_views,(function(t,e){return e.destroy(),t}),[])},setNotification:function(t,e,i){var s=this._getTabViewById(t);s&&s.setNotification(e,i),this._measure(),this._selected_tab===t&&this._animateToSelected(s.$el)},switchTab:function(t){var e=this._getTabViewById(t);e&&e.onClick()}});var b="../build/transpiled/interface/card/tabs/index";window.define(b,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([b])},656724:(t,e,i)=>{i.r(e),i.d(e,{default:()=>o});var s=i(629133),n=i.n(s),r=i(313981),a=i(661533);const o=r.default.extend({_classes:function(){return{notification:"card-tabs__notification%s",notification_item:"card-tabs__notification_item"}},events:{click:"onClick"},initialize:function(t){this._settings=t.settings||{},this._onClick=t.onClick||n().noop,this._onHide=t.onHide||n().noop,this._animateBorder=t.onAnimateBorder||n().noop,this._selected_class_name=t.selected_class_name||"",this._preload_class_name=t.preload_class_name||"",this._dots_class_name=t.dots_class_name||"",this._is_context_item=t.is_context_item,r.default.prototype.initialize.apply(this,arguments),t.settings.notification_count&&this.setNotification(t.settings.notification_count,t.settings.notification_type),t.is_selected&&(t.autoinit&&this._onClick(this._settings,{no_select:!0}),this._highlight(!0,!0))},destroy:function(){r.default.prototype.destroy.call(this,!0)},onClick:function(){this.$el.hasClass("js-disabled")||(this._onClick(this._settings,{no_select:this._settings.is_disabled}),this._highlight(!0))},onHide:function(){this._onHide(this._settings),this._highlight(!1)},_highlight:function(t,e){var i=this.$el;!0!==this._settings.no_highlight?(this._is_context_item&&(i=this.$el.closest(".".concat(this._dots_class_name)),t?this.$el.addClass(this._selected_class_name):this.$el.removeClass(this._selected_class_name)),this._animateBorder(i),t?(i.addClass(this._selected_class_name),!0===e&&i.addClass(this._preload_class_name)):i.removeClass(this._selected_class_name).removeClass(this._preload_class_name)):t||i.removeClass(this._selected_class_name).removeClass(this._preload_class_name)},setNotification:function(t,e){var i,s,n=0;e=e||"",this._settings.notification_count=t,this._settings.notification_type=e,t?this._$notification?this._updateNotificationCount(t,this._$notification):this._$notification=this._setNotificationCount(t):this._$notification&&this._clearNotification(),e&&this.$el.toggleClass(this._class("notification","-".concat(e)),t>0),this._is_context_item&&((i=this.$el.closest(".".concat(this._dots_class_name))).find(this._selector("notification_item")).each((function(t,e){(s=a(e)).text()&&(n+=parseInt(s.text()))})),n?i.attr("data-notification",this._formatNotificationCount(n)):i.removeAttr("data-notification"),e&&i.toggleClass(this._class("notification","-".concat(e)),n>0))},_setNotificationCount:function(t,e){var i=this._formatNotificationCount(t);e||(e=this.$el);var s=a('<span class="'.concat(this._class("notification_item"),'">').concat(i,"</span>"));return e.append(s),s},_updateNotificationCount:function(t,e){var i=this._formatNotificationCount(t);e.text(i)},_formatNotificationCount:function(t){return parseInt(t)>99?"99+":t},_clearNotification:function(){this._$notification.remove(),this._$notification=null}});var d="../build/transpiled/interface/card/tabs/tab";window.define(d,(function(){var t="undefined",i=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return i&&i.default||i})),window.require([d])}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_18_50_52"},function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(new Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="f6290668-d0d1-422f-9659-3b5dfa69dd61",t._sentryDebugIdIdentifier="sentry-dbid-f6290668-d0d1-422f-9659-3b5dfa69dd61")}catch(t){}}();
//# sourceMappingURL=73413.8a9172a8ab6b3990575a.js.map