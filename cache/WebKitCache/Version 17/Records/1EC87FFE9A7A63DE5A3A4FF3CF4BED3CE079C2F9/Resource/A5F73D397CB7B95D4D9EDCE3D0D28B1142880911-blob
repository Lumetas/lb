"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[70112],{170112:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var s=a(629133),i=a.n(s),r=a(460159),n=a.n(r),d=a(161320),l=a.n(d),u=a(214558),c=a(445368),o=a(955026),m=a(49987),p=a(729115),_={create:"add",update:"update",patch:"update",delete:"delete",read:"list"};const f=p.default.Model.extend({_editable:!0,_fields:null,_type:null,_editable_attributes:["id","name","first_name","last_name","catalog_id","custom_fields"],isNew:function(){var e=this.get(this.idAttribute);return!e||parseInt(e)<=0},save:function(e){return!!this._editable&&p.default.Model.prototype.save.call(this,null,e)},sync:function(e,t,a){var s=this,r=_[e],n=this.extractAttributesForRequest(t.attributes);a=a||{},"delete"===e?(a.data={request:{}},(a.data.request[this._type]={})[r]=[n.id],a.data=JSON.stringify(a.data)):(a.attrs={request:{}},(a.attrs.request[this._type]={})[r]=[i().pick(n,this._editable_attributes)]),a.emulateHTTP=!0,a.request_for_create_model="add"===r,a.contentType="application/json";var d=a.success;return a.success=function(e){var t=s.holdSaveErrors(e,a);i().isObject(t)&&t.errors.length?(a.error||i().noop)(e):(d||i().noop)(e)},p.default.Model.prototype.sync.call(this,e,t,a)},extractAttributesForRequest:function(e){return e.custom_fields=this.extractCustomFieldsForRequest(e),e.date&&(e.time_appended||(e.date=(0,c.getMoment)(e.date+l()().format("HH:mm")).format("X"),e.time_appended=!0),e.date=(0,c.getMoment)(e.date).format("X")),e},parse:function(e,t){var a;if(!(0,o.hasKeys)(e,["response",this._type]))return e;if("return"===(a=this.holdSaveErrors(e,t)))return i().clone(this.attributes);if(i().isEmpty(a[this._type])||(a=a[this._type]),!a)throw new Error("Invalid response from server: ".concat(JSON.stringify([e])));if(!(a=i().first(i().values(a))))throw new Error("Invalid response from server: ".concat(JSON.stringify([e])));return a},holdSaveErrors:function(e,t){var a=e.response.pagination?e.response:i().first(i().values(e.response[this._type]));a.errors=i().values(a.errors);var s=i().first(a.errors);return(t=t||{}).request_for_create_model&&s&&404===s.code?(this.set("id",s.id),"return"):a},setFromAPI:function(e){var t=this.parseFromAPI(e);return this.set(t,{skip_check_editable:!0}),this.updateDefaults(),this},parseFromAPI:function(e){var t=i().extend({},e,this.parseCustomFieldsFromResponse(e.custom_fields));return t.name&&t.name.text&&(t.name=t.name.text),t},parseCustomFieldsFromResponse:function(e){var t={};return i().each(this.getFields(),(function(a){var s,r,n=a.name;if(n.match(/cfv\[(\d+)\](\[(\d+)\])?/)){var d=a.stripped_id;if(d){var l=i().findWhere(e,{id:d})||{};switch(a.template){case"text":case"numeric":case"monetary":case"url":case"address":case"textarea":case"checkbox":case"radio":case"select":case"price":if(t[n]="",!l)return;if(!(s=i().first(l.values)))return;s.enum?t[n]=s.enum:Object.prototype.toString.call(s.value).length&&(t[n]=i().unescape(s.value));break;case"date":case"date_time":if(t[n]="",!l)return;if(!(s=i().first(l.values)))return;s.enum?t[n]=s.enum:Object.prototype.toString.call(s.value).length&&(t[n]=s.value),t[n]&&(r="date_time"===a.template?APP.system.format.date.full:APP.system.format.date.date,t[n]=(0,c.getMoment)(t[n]),t[n]=t[n].format(r));break;case"multiselect":i().each(a.enums,(function(e){var a=n+"[%d]".replace("%d",e.id);t[a]="",l&&(s=i().findWhere(l.values,{enum:e.id}))&&Object.prototype.toString.call(s.value).length&&(t[a]=s.value)}));break;case"pei":var u,o=a.sub_code&&this.getEnumID(a.enums,a.sub_code),m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";t[n+"[%d][enum]".replace("%d",e)]=a.sub_code?o:i().first(i().values(a.enums)).id,t[n+"[%d][value]".replace("%d",e)]=""};l&&l.values&&l.values.length?(i().each(l.values,(function(e,a){t[n+"[%d][enum]".replace("%d",a)]=e.enum,t[n+"[%d][value]".replace("%d",a)]=i().unescape(e.value)})),u=i().any(l.values,(function(e){return e.enum===o})),o&&!u&&m.call(this,l.values.length)):m.call(this);break;case"smart_address":a.enums&&i().each(a.enums,(function(e){var a=i().findWhere(l.values,{enum:e})||{};t[n+"[%d]".replace("%d",e)]=i().unescape(a.value||"")}))}}}}),this),t},extractCustomFieldsForRequest:function(e){var t={};return i().each(e,(function(e,a){var s=a.match(/cfv\[(\d+)\](\[(\d+)\])?(\[(\w+)\])?/i);if(s){var r=s[1],n=s[3],d=s[5];if(r){var l={id:r,values:[]};if(n||d)if(t[r]||(t[r]=l),d&&n)if(t[r].values[n])t[r].values[n][d]=e;else{var u={};u[d]=e,t[r].values.push(u)}else{if(n&&!d)return i().isArray(t[r].values)&&(t[r].values={}),void(t[r].values[n]=e);!d||n?e.length&&t[r].values.push(n):t[r].values.push({subtype:d,value:e})}else if(l.values.push({value:e}),t[r]=l,i().contains(a,"file_uuid"))try{var c=JSON.parse(e),o=c.file_name,m=c.file_size,p=c.file_uuid;t[r].values[0].file_name=o,t[r].values[0].file_size=m,t[r].values[0].file_uuid=p}catch(t){console.error('There was an error at "JSON.parse method". Value:',e)}}}}),this),i().each(t,(function(e){var t=i().find(this._fields,(function(t){return t.stripped_id===e.id||"linked_entity"===t.template&&parseInt(e.id)===t.id||"legal_entity"===t.template&&parseInt(e.id)===t.id||"items"===t.default_code&&parseInt(e.id)===t.id||"file"===t.template&&parseInt(e.id)===t.id||"payer"===t.template&&parseInt(e.id)===t.id||"supplier"===t.template&&parseInt(e.id)===t.id}))||{};if("pei"===t.template&&(e.values=i().filter(e.values,(function(e){return e.value}))),i().contains(["legal_entity","linked_entity","payer"],t.template)&&(e.values=[{value:i().reduce(e.values,(function(e,a){if(i().contains(["legal_entity","payer"],t.template))return e[a.subtype]=a.value,e;var s=parseInt(a.value);return e[a.subtype]=i().isNaN(s)||String(s).length!==a.value.length?a.value:s,e}),{})}]),"supplier"===t.template&&(e.values=[{value:{entity_id:parseInt(e.values[0].value)}}]),"items"===t.default_code&&i().propertyOf(e)(["values",0,"value"]))try{e.values=JSON.parse(e.values[0].value)}catch(t){e.values[0].value=""}}),this),i().values(t)},setFields:function(e){this._fields=i().map(e,this.convertField,this),this._fields=i().reject(this._fields,(function(e){return-1!==["date_create","date_modify"].indexOf(e.id)}))},getFields:function(){if(!this._fields)throw new Error("Fields not defined yet!");return this._fields},convertField:function(e){var t={id:e.id,element_type:e.element_type,sub_code:e.sub_code,stripped_id:e.stripped_id,title:e.title,name:"",default_code:!!e.default_code&&e.default_code,pei_type:e.pei_type,sort_index:e.sort_index,settings:e.settings||{},disabled:!!e.disabled||!1};switch(e.custom_field?t.name=i().isString(e.id)?"cfv[".concat(e.id.replace("_".concat(e.sub_code),""),"]"):"cfv[".concat(e.id,"]"):t.name=e.id,i().isUndefined(e.is_required)||(t.is_required=e.is_required),t.is_visible=!(0,o.hasKeys)(e,["settings","is_visible"])||e.settings.is_visible,e.type_code){case"streetaddress":t.template="address";break;case"textarea":t.template="textarea";break;case"url":t.template="url";break;case"checkbox":t.template="checkbox";break;case"date":case"birthday":t.template="date";break;case"date_time":t.template="date_time";break;case"task_type":t.enums=i().union([{id:1,value:APP.todo_types[1]},{id:2,value:APP.todo_types[2]}],i().map(APP.constant("task_types"),(function(e){return{id:e.id,value:e.option}}))),t.enums_no_empty=!0,t.template="select";break;case"task_result":t.id="result_text",t.template="text";break;case"multiselect":t.enums=e.enums,t.template="multiselect";break;case"numeric":t.template="numeric";break;case"radiobutton":t.enums=e.enums,t.template="radio";break;case"select":t.enums=e.enums,t.enums_no_empty=e.enums_no_empty,t.template="select";break;case"text":t.template=this.getTextOrNumericTemplate(e.default_code);break;case"smart_address":t.template=e.type_code,t.enums=e.enums,t.variants=e.variants;break;case"multitext":t.template="pei",t.enums=e.enums,t.enums_names=e.enums_names,t.multiple=!0,i().each(t.enums,(function(t){t.option=(e.enums_names[t.value.toLowerCase()]||{}).medium}));break;case"category":t.enums=e.enums,t.template="select";break;case"items":t.template="items";break;case"chained_list":t.template="chained_list",t.settings=e.template_params;break;case"price":t.template="price";break;case"monetary":t.template="monetary",t.settings=e.template_params;break;default:t.template=e.template||e.type_code}switch(e.id){case"name":t.template="name";break;case"responsible_id":case"main_user_id":t.template="manager";break;case"status":t.template="status";break;case"budget":t.template="budget";break;case"ltv":case"average_check":case"next_price":t.template="price";break;case"next_date":t.template="next_date";break;case"thread":case"main_contact":case"company_name":case"contact_company_name":t.template="linked"}if(!t.template)throw new Error("Can't resolve template name for field ".concat(JSON.stringify(e)));return t},getTextOrNumericTemplate:function(e){return e&&i().includes(["SUPPLIER_VAT_ID","SUPPLIER_TAX_REGISTRATION_REASON_CODE","SUPPLIER_PRIMARY_STATE_REGISTRATION_NUMBER","SUPPLIER_BANK_IDENTIFICATION_CODE","SUPPLIER_ACCOUNT_NUMBER"],e.toUpperCase())?"numeric":"text"},findCustomFieldValue:function(e,t,a){var s=i().findWhere((t||{}).custom_fields,{id:e}),r=s&&s.values?s.values:"";switch(a){case"text":case"numeric":case"monetary":case"url":case"address":case"textarea":case"date":case"date_time":case"price":r=(r=i().first(r))&&r.value?r.value:"";break;case"checkbox":if(i().isArray(r)){r=i().first(r),r=Boolean(null==r?void 0:r.value);break}r=Boolean(r);break;case"select":case"radio":r=(r=i().first(r))&&r.enum?r.enum:"";break;case"multiselect":r=i().map(r,(function(e){return e.enum.toString()}));break;case"items":r=i().first(r)}return r},getValues:function(){var e,t,a={},s=this.isNew();return e=s?{}:i().clone(this.attributes),i().each(this.getFields(),(function(s){var r;switch(t="result_text"===s.id?(e.result||{}).text:void 0===e[s.id]?this.findCustomFieldValue(s.stripped_id,e,s.template):"task_type"===s.id?(e[s.id]||{}).type:e[s.id],s.template){case"name":i().isObject(t)&&(t=t.text||""),s.element_type===APP.element_types.todo&&(t=n()._twig.filter("task_text",t)),a[s.id]=i().extend({value:t},s.element_type===APP.element_types.contacts?{first_name:e.first_name,last_name:e.last_name}:{});break;case"text":case"numeric":case"monetary":case"url":case"address":case"textarea":case"linked":i().isObject(t)&&(t=t.text||""),a[s.id]={id:s.stripped_id,title:s.title,value:t};break;case"price":i().isObject(t)&&(t=t.text||""),a[s.id]={id:s.stripped_id,title:s.title,value:t,is_price:!0};break;case"task_date":a[s.id]={id:this.get("task_id"),type:this.get("task_type_id"),main_user:this.get("task_responsible_id"),text:this.get("task_text"),complete_till:t.complete_till,duration:t.duration};break;case"date":case"date_time":i().isObject(t)&&(t=t.text||""),t&&(r="date_time"===s.template?APP.system.format.date.full:APP.system.format.date.date,t=(t=(0,c.getMoment)(t)).format(r)),a[s.id]={placeholder:"",value:t};break;case"checkbox":a[s.id]={value:t?"1":"",checked:!!t};break;case"radio":a[s.id]={selected:t,enums:i().map(s.enums,(function(e){return{id:e.id,value:e.value,prefix:"cfv_".concat(s.id,"_").concat(e.id)}}),this)};break;case"select":a[s.id]={selected:t,placeholder:(0,c.i18n)("Select"),enums:s.enums,enums_no_empty:s.enums_no_empty};break;case"multiselect":a[s.id]={selected:i().map(t,(function(e){return parseInt(e)})),placeholder:(0,c.i18n)("Select"),enums:i().map(s.enums,(function(e){return{id:e.id,value:e.value,prefix:"cfv_".concat(s.id,"_").concat(e.id),name:"".concat(s.name,"[").concat(e.id,"]")}}),this)};break;case"pei":a[s.id]=this._getPeiValues(t,s);break;case"smart_address":s.enums=s.enums||[],a=i().extend(a,this._getSmartAddressValues(t,s));break;case"budget":a[s.id]={value:t,placeholder:"0"};break;case"next_date":a[s.id]={value:t,failed:l()(t,APP.system.format.date.date).unix()<l()().unix()&&!!l()().diff(l()(t,APP.system.format.date.date),"days")};break;case"manager":a[s.id]={value:[i().findWhere((0,u.get)(),{id:t})||{id:"not_assigned",title:(0,c.i18n)("User deleted")}]};break;case"file":a[s.id]={value:i().propertyOf(t)([0,"value"])||{}};break;case"linked_entity":case"legal_entity":case"payer":a[s.id]={value:i().compact([i().propertyOf(t)([0,"value"])||""])};break;default:a[s.id]={value:t}}a[s.id]&&(a[s.id].id=s.id,a[s.id].placeholder=i().isUndefined(a[s.id].placeholder)?"...":a[s.id].placeholder,a[s.id].name=a[s.id].name||s.name,a[s.id].default_code=!!s.default_code&&s.default_code,a[s.id].settings=a[s.id].settings||s.settings||{},this._editable||(a[s.id].disabled=!0))}),this),a},_getPeiValues:function(e,t){var a,s=[],r=t.sub_code&&this.getEnumID(t.enums,t.sub_code),n=!1;return i().isArray(e)&&e.length?(s=i().map(e,(function(e,a){return{enum:e.enum,value:e.value,placeholder:"...",enum_name:t.name+"[%d][enum]".replace("%d",a),name:t.name+"[%d][value]".replace("%d",a),hidden:!!t.sub_code&&this.getEnumName(t.enums,e.enum)!==t.sub_code,disabled_select:!!t.sub_code}}),this),a=i().any(s,(function(e){return e.enum===r})),r&&!a&&s.push(this._setEmptyPeiValues(t,r,s.length))):(n=!0,s.push(this._setEmptyPeiValues(t,r))),{empty:n,values:s}},_setEmptyPeiValues:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0";return{placeholder:"...",enum_name:e.name+"[%d][enum]".replace("%d",a),name:e.name+"[%d][value]".replace("%d",a),enum:e.sub_code?t:null,disabled_select:!!e.sub_code}},_getSmartAddressValues:function(e,t){var a={},s=[];if(t.sub_code)switch(a[t.id]={name:t.name+"[%d]".replace("%d",t.sub_code),placeholder:APP.lang["".concat(t.sub_code,"_placeholder")],value:(i().findWhere(e,{enum:t.sub_code})||{}).value||""},t.sub_code){case"country":t.template="select",a[t.id]=i().extend(a[t.id],{selected:a[t.id].value,placeholder:a[t.id].placeholder,enums:i().map(t.variants.country,(function(e,t){return{id:t.toUpperCase(),value:e}}))});break;case"zip":t.template="zip";break;default:t.template="text"}else s=i().map(t.enums,(function(a){return{enum:a,value:(i().findWhere(e,{enum:a})||{}).value||"",placeholder:"...",name:t.name+"[%d]".replace("%d",a)}}),this),a[t.id]={values:s};return a},getDefaults:function(){var e=i().clone(this.defaults);return i().each(this.getFields(),(function(t){switch(t.template){case"text":case"numeric":case"url":case"address":case"textarea":case"checkbox":case"radio":case"select":case"multiselect":break;case"date":case"date_time":e[t.name]&&parseInt(e[t.name])==e[t.name]&&(e[t.name]=(0,c.getMoment)(e[t.name]).format((0,m.format)("date_time"===t.template?"full":"date")))}}),this),e},getEnumID:function(e,t){return e?(i().findWhere(e,{value:t.toUpperCase()})||{}).id:t},getEnumName:function(e,t){return e?(i().findWhere(e,{id:t})||{}).value.toLowerCase():t},set:function(e,t,a){return!0===(("object"==typeof e?t:a)||{}).skip_check_editable||this._editable?p.default.Model.prototype.set.apply(this,arguments):this},editable:function(e){return void 0!==e&&(this._editable=!!e),this._editable},hasRightsFor:function(){return!0}});var v="../build/transpiled/interface/element_model";window.define(v,(function(){var e="undefined",a=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return a&&a.default||a})),window.require([v])}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_18_50_52"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8810d783-30f5-4235-982d-b1b0e58ec6db",e._sentryDebugIdIdentifier="sentry-dbid-8810d783-30f5-4235-982d-b1b0e58ec6db")}catch(e){}}();
//# sourceMappingURL=70112.dc17ffdb700e74667db7.js.map