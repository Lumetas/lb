"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[52434],{976453:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y,getBlockAction:()=>b});var r=n(629133),a=n.n(r),i=n(138843),o=n(445368),s=n(500034),l=n(955026),u=n(288410),c=n(700839),d=n(29368),f=n(704652),p=n(661533);function _(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){_(i,r,a,o,s,"next",e)}function s(e){_(i,r,a,o,s,"throw",e)}o(void 0)}))}}function m(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var h=d.default.EXPORT_IMPORT_ALLOWED_BOT_TYPES,w=function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(e){e.target.readyState===r.DONE&&(e.target.error?n(e.target.error):t(e.target.result))},r.readAsText(e)}))},b=function(e){var t=a().propertyOf(e)(["question","0","handler"]);switch(t){case"action":t=a().propertyOf(e)(["question","0","params","name"]);break;case"trigger":t=a().propertyOf(e)(["question","0","params","trigger","action"])}return t},v=function(e){if(""===e.trim())return!0;var t=a().toArray(JSON.parse(e));return a().every(t,(function(e){return function(e){switch(e){case d.HANDLER_IDS.distribution:return(0,s.isFeatureAvailable)("distribution_salesbot_handler");case d.HANDLER_IDS.opt_in:return(0,s.isFeatureAvailable)("opt_in_message_salesbot_handler");case d.HANDLER_IDS.list_message:return(0,s.isFeatureAvailable)("list_message_salesbot_handler");case d.HANDLER_IDS.send_external_message:return(0,s.isFeatureAvailable)("unified_send_external_message");case d.HANDLER_IDS.send_message:return!(0,s.isFeatureAvailable)("unified_send_external_message")&&(0,s.isFeatureAvailable)("extended_messaging_in_bot");default:return!0}}(b(e))}))};const y={export:function(e){return g((function(){var t,n,r,o;return m(this,(function(s){switch(s.label){case 0:return t=e.type_functionality,n=e.modelJSON,r={type_functionality:t,model:a().pick(n,["text","name","positions","type"])},v(r.model.text)?[4,(0,f.default)(r.model.text)]:[2,Promise.reject("Bot you're trying to export has unsupported blocks for export.")];case 1:return o=s.sent(),a().isEmpty(o)||(r.attachments=o),(0,i.default)({filename:n.name,extension:"json",content:JSON.stringify(r)}),[2,Promise.resolve()]}}))}))()},readImportedBotFile:function(e){return g((function(){var t,n,r;return m(this,(function(i){switch(i.label){case 0:return t=[],[4,w(e)];case 1:n=i.sent();try{if(!(r=JSON.parse(n)))throw new Error}catch(e){throw new Error("Incorrect json")}if(a().includes(h,r.type_functionality)||t.push({error:'Incorrect "type_functionality"'}),r.model){try{if(r.model.text.trim()&&JSON.parse(r.model.text),!v(r.model.text))throw new Error((0,o.i18n)("We are unable to import the bot as it includes the feature that is not available in {{brand_name.without_article}}"))}catch(e){if(e.message)throw new Error(e.message);t.push({error:'Incorrect "model.text"'})}try{r.model.positions.trim()&&JSON.parse(r.model.positions)}catch(e){t.push({error:'Incorrect "model.positions"'})}r.model.type!==d.default.BOT_VISUAL&&t.push({error:'Incorrect "model.type"'}),r.model.name||t.push({error:'Incorrect "model.name"'})}else t.push({error:'Incorrect "model"'});if(t.length)throw t;return[2,r]}}))}))()},prepareDataForCloning:function(e,t){return g((function(){var n,r,i,o,s,d,f,_,g;return m(this,(function(m){switch(m.label){case 0:return n=JSON.parse(e),r=JSON.parse(t),i=function(e){var t=e.actions,n=(null==t?void 0:t.length)&&t[0].params.handler;return a().contains(["widget","widget_amo"],n)},0===(o=a().filter(n,(function(e){return i(e)}))).length?[2,{positions:e,text:t}]:(s=new c.default([],{area:"salesbot_designer"}),[4,Promise.all([s.fetch(),u.default.prototype.init_in_salesbot_designer({widget_name:null,status:"installed",disable_repeated_render:!0,disable_repeated_advanced_settings:!0,disable_repeated_menu_page_init:!0})])]);case 1:return m.sent(),d=a().reduce(o,(function(e,t){var n,r=t.actions[0].params.params,a=s.get(r.widget_id),i=APP.widgets.list[a.get("code")];try{n=i.callbacks.onSalesbotDesignerSave(r.widget_source_code,r.params)}catch(e){console.error(e)}return e[t.id]={widget_id:r.widget_id,widget_source_code:r.widget_source_code,widget_source:n},e}),{}),[4,p.ajax({url:"/private/ajax/v2/json/salesbot/widgets/",type:"POST",data:JSON.stringify({request:{salesbot:{widgets:d}}}),contentType:"application/json"})];case 2:return f=m.sent(),_=r,g=a().map(n,(function(e){var t=e;if(e&&i(e)&&(0,l.hasKeys)(f,["_embedded","items"])){var n=f._embedded.items[t.id].widget_instance_id;t.actions[0].params.params.widget_instance_id=n,_[t.step]&&(_[t.step].question[0].params.widget_instance_id=n)}return t})),[2,{positions:JSON.stringify(g),text:JSON.stringify(_)}]}}))}))()}}},704652:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var r=n(629133),a=n.n(r),i=n(474564),o=n(976453),s=n(29368);function l(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){l(i,r,a,o,s,"next",e)}function s(e){l(i,r,a,o,s,"throw",e)}o(void 0)}))}}function c(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var d,f=[s.HANDLER_IDS.show,s.HANDLER_IDS.send_img,s.HANDLER_IDS.send_message],p=(d=u((function(e){var t,n,r;return c(this,(function(a){switch(a.label){case 0:return[4,new Promise((function(t,n){(0,i.getFile)({id:e}).subscribe({next:function(e){t({src:e.path,name:e.name})},error:function(){n()}})}))];case 1:return t=a.sent(),[4,fetch(t.src)];case 2:return[4,a.sent().blob()];case 3:return n=a.sent(),[4,new Promise((function(e,t){var r=new FileReader;r.onloadend=function(){return e(r.result)},r.onerror=t,r.readAsDataURL(n)}))];case 4:return r=a.sent(),[2,{id:e,base64:r,name:t.name}]}}))})),function(e){return d.apply(this,arguments)}),_=function(){var e=u((function(e,t){var n,r,i;return c(this,(function(o){switch(o.label){case 0:return n=function(e,t){var n=a().propertyOf(e)(["question","0","params"])||{};switch(t){case s.HANDLER_IDS.show:return n.media;case s.HANDLER_IDS.send_img:return n.values;case s.HANDLER_IDS.send_message:return a().pluck(n.attachments,"value");default:throw new Error("incorrect block action presented")}}(e,t),r=[],n&&n.length?(a().each(n,(function(e){try{r.push(p(e))}catch(e){}})),[4,Promise.allSettled(r)]):[2,[]];case 1:return i=o.sent(),[2,a().chain(i).map((function(e){return e.value})).compact().value()]}}))}));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=u((function(e){var t,n,r,i,s,l;return c(this,(function(u){switch(u.label){case 0:return t=[],n=JSON.parse(e),r=a().toArray(n),a().each(r,(function(e){var n=(0,o.getBlockAction)(e);if(a().includes(f,n)){var r=_(e,n);t.push(r)}})),[4,Promise.all(t)];case 1:return i=u.sent(),s=function(e,t){return a().each(t,(function(t){e[t.id]=t})),e},l=a().reduce(i,s,{}),[2,a().isEmpty(l)?null:l]}}))}));return function(t){return e.apply(this,arguments)}}();const m=g},700839:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var r=n(629133),a=n.n(r),i=n(974839),o=n.n(i),s=n(727406),l=n(955026);const u=(0,s.wrapCacheCollection)(o().Collection.extend({url:function(){return"/ajax/v1/widgets/list?filter[widget_locations]=".concat(this.area,"&full=1")},initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.area)throw new Error("Widgets area must be in options");this.area=t.area},parse:function(e){return(0,l.hasKeys)(e,["response","widgets"])?a().map(e.response.widgets,(function(e){var t,n=e.langs[e.current_language][e.name],r=n;return e.dp&&e.dp.title&&(r=e.langs[e.current_language][e.dp.title]),{name:n,code:e.widget_code,id:e.widget_id,widget_code:e.widget_code,short_desc:(e.langs[e.current_language]["widget.short_description"]||"").replace(/<[^>]+>/g,""),descr:(e.langs[e.current_language]["widget.description"]||"").replace(/<[^>]+>/g,""),login:e.langs[e.current_language]["settings.login"],logo:e.logo,logo_small:e.logo_small||null,settings:{widget:{settings:{}}},template_params:{settings:{logo:e.logo},fields:{}},active:e.active,langs:e.langs[APP.lang_id],rating:e.rating,sort:4,actions_type:e.dp.action_multiple?"multiple":"single",widget:!0,action:"send_widget_hook",action_title:r,error:null,has_profile:!0,original_widget:e,support:{link:e.support.link||null,email:e.support.email||null,name:e.support.name||null,price:e.support.price||null},salesbot:e.salesbot_designer||null,integrationUuid:e.oauth_client_uuid||(null===(t=e.client)||void 0===t?void 0:t.uuid)||null}})):[]}}));var c="../build/transpiled/network/widgets/collection";window.define(c,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([c])},138843:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var r=n(633879),a=n(641963);const i=function(e){var t=e.filename,n=e.extension,i=e.content;(0,r.isDownloadAsBlobAvailable)()?(0,r.default)({filename:t,extension:n,content:i}):(0,a.default)({filename:t,extension:n,content:i})}},641963:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});const r=function(e){var t=e.filename,n=e.extension,r=e.content,a=document.createElement("a");a.download="".concat(t,".").concat(n),a.href="data:text/plain;charset=utf-8,"+encodeURIComponent(r),a.click()}},633879:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l,isDownloadAsBlobAvailable:()=>o});var r=!1;try{var a=new Blob,i=URL.createObjectURL(a);r=Boolean(a)&&Boolean(i)}catch(e){}var o=function(){return r},s=function(e){return"json"===e?"application/json":"text/plain"};const l=function(e){var t=e.filename,n=e.extension,r=e.content,a=new Blob([r],{type:s(n)}),i=document.createElement("a");i.download="".concat(t,".").concat(n),i.href=URL.createObjectURL(a),i.click()}}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_17_08_33"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d1a1733e-593d-42e3-9d13-f5c8e46dcdb3",e._sentryDebugIdIdentifier="sentry-dbid-d1a1733e-593d-42e3-9d13-f5c8e46dcdb3")}catch(e){}}();
//# sourceMappingURL=52434.cd6f6ad2367799c78e01.js.map