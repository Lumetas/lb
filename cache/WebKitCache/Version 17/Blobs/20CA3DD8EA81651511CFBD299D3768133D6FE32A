mw.loader.impl(function(){return["ext.visualEditor.core.utils.parsing@pxlsz",function($,jQuery,require,module){ve.isBlockElement=function(element){const elementName=typeof element==='string'?element:element.nodeName;return ve.elementTypes.block.includes(elementName.toLowerCase());};ve.isVoidElement=function(element){const elementName=typeof element==='string'?element:element.nodeName;return ve.elementTypes.void.includes(elementName.toLowerCase());};ve.elementTypes={block:['div','p','table','tbody','thead','tfoot','caption','th','tr','td','ul','ol','li','dl','dt','dd','h1','h2','h3','h4','h5','h6','hgroup','article','aside','body','nav','section','footer','header','figure','figcaption','fieldset','details','blockquote','hr','button','canvas','center','col','colgroup','embed','map','object','pre','progress','video'],void:['area','base','br','col','embed','hr','img','input','link','meta','param','source','track','wbr']};ve.matchTag=function(html,tag){return html.match(new RegExp('<'+tag+'(>|\\s[^>]*>)'));};ve.addHeadTag=function(docHtml,tagHtml){function insertAfter(match,text){const offset=match.index+match[0].length;
return docHtml.slice(0,offset)+text+docHtml.slice(offset);}const headMatch=ve.matchTag(docHtml,'head');if(headMatch){return insertAfter(headMatch,tagHtml);}else{const htmlMatch=ve.matchTag(docHtml,'html');if(htmlMatch){return insertAfter(htmlMatch,'<head>'+tagHtml+'</head>');}else{return'<head>'+tagHtml+'</head>'+docHtml;}}};ve.createDocumentFromHtml=function(html){if(html!==''){if(!ve.matchTag(html,'body')){html='<body>'+html+'</body>';}html=ve.addHeadTag(html,'<meta name="format-detection" content="telephone=no" data-ve-tmp/>');}const newDocument=new DOMParser().parseFromString(html,'text/html');const tmpMeta=newDocument.querySelector('meta[data-ve-tmp]');if(tmpMeta){tmpMeta.parentNode.removeChild(tmpMeta);}return newDocument;};ve.fixBase=function(targetDoc,sourceDoc,fallbackBase){let baseNode=targetDoc.getElementsByTagName('base')[0];if(baseNode){if(!targetDoc.baseURI||targetDoc.baseURI==='about:blank'){baseNode.setAttribute('href',ve.resolveUrl(baseNode.getAttribute('href'),sourceDoc));
if(!targetDoc.baseURI&&fallbackBase){baseNode.setAttribute('href',fallbackBase);}}baseNode.href=baseNode.href;}else if(fallbackBase){baseNode=targetDoc.createElement('base');baseNode.setAttribute('href',fallbackBase);targetDoc.head.appendChild(baseNode);}};ve.properInnerHtml=function(element){return ve.fixupPreBug(element).innerHTML;};ve.properOuterHtml=function(element){return ve.fixupPreBug(element).outerHTML;};ve.fixupPreBug=function(element){if(ve.isPreInnerHtmlBroken===undefined){const div=document.createElement('div');div.innerHTML='<pre>\n\n</pre>';ve.isPreInnerHtmlBroken=div.innerHTML==='<pre>\n</pre>';}if(!ve.isPreInnerHtmlBroken){return element;}const $element=$(element).clone();$element.find('pre, textarea, listing').each((i,el)=>{let matches;if(el.firstChild&&el.firstChild.nodeType===Node.TEXT_NODE){matches=el.firstChild.data.match(/^(\r\n|\r|\n)/);if(matches&&matches[1]){el.firstChild.insertData(0,matches[1]);}}});return $element.get(0);};ve.normalizeAttributeValue=function(name,value,nodeName='div'){
const node=document.createElement(nodeName);node.setAttribute(name,value);return node.getAttribute(name);};ve.resolveUrl=function(url,base){const node=base.createElement('a');node.setAttribute('href',url);return node.href||url;};
}];});
mw.loader.impl(function(){return["ext.visualEditor.desktopArticleTarget.init@1rhjh",{"main":"modules/ve-mw/preinit/ve.init.mw.DesktopArticleTarget.init.js","files":{"modules/ve-mw/preinit/ve.init.mw.DesktopArticleTarget.init.js":function(require,module,exports){(function(){const configData=require('./data.json'),veactionToMode={edit:'visual',editsource:'source'};let init=null,conf=null,tabMessages=null,pageExists=null,viewUrl=null,veEditUrl=null,tabPreference=null;let veEditSourceUrl,targetPromise,currentUrl,initialWikitext,oldId,isLoading,tempWikitextEditor,tempWikitextEditorData,$toolbarPlaceholder,$toolbarPlaceholderBar,contentTop,wasFloating,active=false,targetLoaded=false,plugins=[],welcomeDialogDisabled=false,educationPopupsDisabled=false,$targetContainer=null;if(mw.config.get('wgMFMode')){mw.log.warn('Attempted to load desktop target on mobile.');return;}function showLoading(){if(isLoading){return;}isLoading=true;$('html').addClass('ve-activated ve-loading');if(!init.$loading){init.progressBar=new mw.libs.ve.ProgressBarWidget();init.$loading=$('<div>').addClass('ve-init-mw-desktopArticleTarget-loading-overlay').append(init.progressBar.$element);}$(document).on('keydown',onDocumentKeyDown);$toolbarPlaceholderBar.append(init.$loading);}
function incrementLoadingProgress(){init.progressBar.incrementLoadingProgress();}function clearLoading(){init.progressBar.clearLoading();isLoading=false;$(document).off('keydown',onDocumentKeyDown);$('html').removeClass('ve-loading');if(init.$loading){init.$loading.detach();}if(tempWikitextEditor){teardownTempWikitextEditor();}hideToolbarPlaceholder();}function onWindowScroll(){const scrollTop=$(document.documentElement).scrollTop();const floating=scrollTop>contentTop;if(floating!==wasFloating){const width=$targetContainer.outerWidth();$toolbarPlaceholder.toggleClass('ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating',floating);$toolbarPlaceholderBar.css('width',width);wasFloating=floating;}}const onWindowScrollListener=mw.util.throttle(onWindowScroll,250);function showToolbarPlaceholder(){if(!$toolbarPlaceholder){$toolbarPlaceholder=$('<div>').addClass('ve-init-mw-desktopArticleTarget-toolbarPlaceholder');$toolbarPlaceholderBar=$('<div>').addClass('ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar');
$toolbarPlaceholder.append($toolbarPlaceholderBar);}contentTop=$targetContainer.offset().top;wasFloating=null;onWindowScroll();const scrollTopBefore=$(document.documentElement).scrollTop();$targetContainer.prepend($toolbarPlaceholder);window.addEventListener('scroll',onWindowScrollListener,{passive:true});if(wasFloating){window.scrollTo(0,scrollTopBefore+$toolbarPlaceholder.outerHeight());}setTimeout(()=>{$toolbarPlaceholder.addClass('ve-init-mw-desktopArticleTarget-toolbarPlaceholder-open');});}function hideToolbarPlaceholder(){if($toolbarPlaceholder){window.removeEventListener('scroll',onWindowScrollListener);$toolbarPlaceholder.detach();$toolbarPlaceholder.removeClass('ve-init-mw-desktopArticleTarget-toolbarPlaceholder-open');}}function setupTempWikitextEditor(data){let wikitext=data.content;if(wikitext){wikitext+='\n';}tempWikitextEditor=new mw.libs.ve.MWTempWikitextEditorWidget({value:wikitext});tempWikitextEditorData=data;$('.ve-init-mw-desktopArticleTarget-targetContainer #firstHeading').addClass('ve-init-mw-desktopArticleTarget-uneditableContent');
$('#mw-content-text').before(tempWikitextEditor.$element).addClass('oo-ui-element-hidden');$('html').addClass('ve-tempSourceEditing').removeClass('ve-loading');tempWikitextEditor.adjustSize().moveCursorToStart();ve.track('editAttemptStep',{action:'ready',mode:'source',platform:'desktop'});mw.libs.ve.tempWikitextEditor=tempWikitextEditor;mw.hook('ve.wikitextInteractive').fire();}function syncTempWikitextEditor(){let wikitext=tempWikitextEditor.getValue();if(wikitext.endsWith('\n')){wikitext=wikitext.slice(0,-1);}if(wikitext!==tempWikitextEditorData.content){tempWikitextEditorData.content=wikitext;tempWikitextEditorData.fromEditedState=true;}tempWikitextEditorData.initialSourceRange=tempWikitextEditor.getRange();tempWikitextEditor.$element.prop('readonly',true);}function teardownTempWikitextEditor(){tempWikitextEditor.$element.remove();mw.libs.ve.tempWikitextEditor=tempWikitextEditor=null;tempWikitextEditorData=null;$('#mw-content-text').removeClass('oo-ui-element-hidden');$('html').removeClass('ve-tempSourceEditing');
}function abortLoading(){$('html').removeClass('ve-activated');active=false;updateTabs(false);if($('#ca-view a').length){history.pushState({tag:'visualeditor'},'',$('#ca-view a').attr('href'));}clearLoading();}function onDocumentKeyDown(e){if(e.which===27){abortLoading();e.preventDefault();}}function getSectionFromUrl(url){const section=url.searchParams.get('section');if(section&&/^(new|\d+|T-\d+)$/.test(section)){return section;}return null;}function getTarget(mode,section){if(!targetPromise){mw.libs.ve.targetLoader.addPlugin(()=>mw.loader.using(conf.preloadModules).catch(()=>$.Deferred().resolve()));['ext.visualEditor.desktopArticleTarget',...plugins].forEach(mw.libs.ve.targetLoader.addPlugin);plugins=[];targetPromise=mw.libs.ve.targetLoader.loadModules(mode).then(()=>{if(!active){targetPromise=null;return $.Deferred().reject().promise();}const target=ve.init.mw.targetFactory.create(conf.contentModels[mw.config.get('wgPageContentModel')],{modes:getAvailableModes(),defaultMode:mode});
target.on('deactivate',()=>{active=false;updateTabs(false);});target.on('reactivate',()=>{currentUrl=new URL(location.href);activateTarget(getEditModeFromUrl(currentUrl),getSectionFromUrl(currentUrl));});target.setContainer($targetContainer);targetLoaded=true;return target;},(e)=>{mw.log.warn('VisualEditor failed to load: '+e);return $.Deferred().reject(e).promise();});}targetPromise.then((target)=>{target.section=section;});return targetPromise;}function trackActivateStart(initData,url=currentUrl){if(url.searchParams.get('wvprov')==='sticky-header'){initData.mechanism+='-sticky-header';}ve.track('trace.activate.enter',{mode:initData.mode});initData.action='init';initData.integration='page';ve.track('editAttemptStep',initData);mw.libs.ve.activationStart=ve.now();}function getTabMessage(tabMsg){let tabMsgKey=tabMessages[tabMsg];const skinMsgKeys={edit:'edit',create:'create',editlocaldescription:'edit-local',createlocaldescription:'create-local'};const key=skinMsgKeys[tabMsg];if(!tabMsgKey&&key){
tabMsgKey=mw.config.get('skin')+'-view-'+key;if(!mw.message(tabMsgKey).exists()){tabMsgKey='skin-view-'+key;}}const msg=mw.message(tabMsgKey);if(!msg.isParseable()){mw.log.warn('VisualEditor: MediaWiki:'+tabMsgKey+' contains unsupported syntax. '+'https://www.mediawiki.org/wiki/Manual:Messages_API#Feature_support_in_JavaScript');return undefined;}return msg.text();}function setEditorPreference(editor){if(!init.isVisualAvailable()){return $.Deferred().resolve().promise();}if(editor!=='visualeditor'&&editor!=='wikitext'){throw new Error('setEditorPreference called with invalid option: ',editor);}let key=pageExists?'edit':'create',sectionKey='editsection';if(mw.config.get('wgVisualEditorConfig').useSingleEditTab&&tabPreference==='remember-last'){if($('#ca-view-foreign').length){key+='localdescription';}if(editor==='wikitext'){key+='source';sectionKey+='source';}const fallbackSelector=function(selector,fallback){const $result=$(selector);return $result.length>0?$result:$(fallback);};
fallbackSelector('#ca-edit a span','#ca-edit a').text(getTabMessage(key));fallbackSelector('.mw-editsection a span','.mw-editsection a').text(getTabMessage(sectionKey));}mw.cookie.set('VEE',editor,{path:'/',expires:30*86400,prefix:''});if(mw.user.isNamed()&&mw.user.options.get('visualeditor-editor')!==editor){return new mw.Api().saveOption('visualeditor-editor',editor).then(()=>{mw.user.options.set('visualeditor-editor',editor);});}return $.Deferred().resolve().promise();}function updateTabs(editing,mode,isNewSection){let $tab;if(editing){if(isNewSection){$tab=$('#ca-addsection');}else if($('#ca-ve-edit').length){if(!mode||mode==='visual'){$tab=$('#ca-ve-edit');}else{$tab=$('#ca-edit');}}else{$tab=$('#ca-edit');}}else{$tab=$('#ca-view');}$('#p-views').find('li.selected').removeClass('selected');$('#ca-edit, #ca-ve-edit, #ca-addsection').not($tab).removeClass('selected');$tab.addClass('selected');}function scrollToSection(section){if(section==='0'||section==='new'){return;}let $heading;
$('#mw-content-text .mw-editsection a:not( .mw-editsection-visualeditor )').each((i,el)=>{const linkUrl=new URL(el.href);if(section===getSectionFromUrl(linkUrl)){$heading=$(el).closest('.mw-heading');return false;}});if(!$heading||!$heading.length){return;}let offset=0;const enableVisualSectionEditing=mw.config.get('wgVisualEditorConfig').enableVisualSectionEditing;if(enableVisualSectionEditing===true||enableVisualSectionEditing==='desktop'){offset=$('#mw-content-text').offset().top;}else{offset=parseInt($heading.css('margin-top'))+$toolbarPlaceholder.outerHeight();}mw.libs.ve.smoothScrollTo($heading.offset().top-offset);}function activateTarget(mode,section,tPromise,modified){let dataPromise;updateTabs(true,mode,section==='new');if(!targetLoaded){dataPromise=mw.libs.ve.targetLoader.requestPageData(mode,mw.config.get('wgRelevantPageName'),{sessionStore:true,section,oldId,targetName:'mwTarget',modified,editintro:currentUrl.searchParams.get('editintro'),preload:currentUrl.searchParams.get('preload'),
preloadparams:mw.util.getArrayParam('preloadparams',currentUrl.searchParams),wikitext:mode==='visual'&&modified?$('#wpTextbox1').textSelection('getContents'):undefined});dataPromise.then((response)=>{if(isLoading&&mode==='source'&&section!=='new'&&!(response.visualeditor&&response.visualeditor.recovered)){setupTempWikitextEditor(response.visualeditor);}}).then(incrementLoadingProgress);}showToolbarPlaceholder();mw.hook('ve.activationStart').fire();let visibleSection=null;let visibleSectionOffset=null;if(section===null){let firstVisibleEditSection=null;$('#firstHeading, #mw-content-text .mw-editsection').each((i,el)=>{const top=el.getBoundingClientRect().top;if(top>0){firstVisibleEditSection=el;return false;}});if(firstVisibleEditSection&&firstVisibleEditSection.id!=='firstHeading'){const firstVisibleSectionLink=firstVisibleEditSection.querySelector('a');const linkUrl=new URL(firstVisibleSectionLink.href);visibleSection=getSectionFromUrl(linkUrl);const firstVisibleHeading=$(firstVisibleEditSection).closest('.mw-heading')[0];
visibleSectionOffset=firstVisibleHeading.getBoundingClientRect().top;}}else if(mode==='visual'){scrollToSection(section);}showLoading(mode);incrementLoadingProgress();active=true;tPromise=tPromise||getTarget(mode,section);tPromise.then((target)=>{target.visibleSection=visibleSection;target.visibleSectionOffset=visibleSectionOffset;incrementLoadingProgress();target.setDefaultMode(mode);if(tempWikitextEditor){syncTempWikitextEditor();}const deactivating=target.deactivatingDeferred||$.Deferred().resolve();return deactivating.then(()=>{target.currentUrl=new URL(location.href);const activatePromise=target.activate(dataPromise);target.toolbarSetupDeferred.then(()=>{hideToolbarPlaceholder();});return activatePromise;});}).then(()=>{if(mode==='visual'){ve.track('editAttemptStep',{action:'ready',mode});}else if(!tempWikitextEditor){ve.track('editAttemptStep',{action:'ready',mode});mw.hook('ve.wikitextInteractive').fire();}ve.track('editAttemptStep',{action:'loaded',mode});}).always(clearLoading);
}function activatePageTarget(mode,section,modified,linkUrl){trackActivateStart({type:'page',mechanism:mw.config.get('wgArticleId')?'click':'new',mode},linkUrl);if(!active){history.replaceState({tag:'visualeditor'},'',currentUrl);history.pushState({tag:'visualeditor'},'',linkUrl||(mode==='source'?veEditSourceUrl:veEditUrl));currentUrl=linkUrl||veEditUrl;activateTarget(mode,section,undefined,modified);}}function getLastEditor(){let editor=mw.cookie.get('VEE','');if(mw.user.isNamed()||!editor||!(editor==='visualeditor'||editor==='wikitext')){editor=mw.user.options.get('visualeditor-editor');}return editor;}function getEditPageEditor(){const isRedLink=!!+currentUrl.searchParams.get('redlink');if(!mw.config.get('wgVisualEditorConfig').useSingleEditTab&&!isRedLink){return'wikitext';}if(currentUrl.searchParams.get('section')==='new'){return'wikitext';}if(currentUrl.searchParams.has('veswitched')){return'wikitext';}switch(tabPreference){case'prefer-ve':return'visualeditor';case'prefer-wt':
return'wikitext';case'multi-tab':return isRedLink?getLastEditor():'wikitext';case'remember-last':default:return getLastEditor();}}function getAvailableEditPageEditor(){switch(getEditPageEditor()){case'visualeditor':if(init.isVisualAvailable()){return'visual';}if(init.isWikitextAvailable()){return'source';}return null;case'wikitext':default:return init.isWikitextAvailable()?'source':null;}}function checkPreferenceOrStorage(prefName,storageKey,cookieName){storageKey=storageKey||prefName;cookieName=cookieName||storageKey;return!!(mw.user.options.get(prefName)||(!mw.user.isNamed()&&(mw.storage.get(storageKey)||mw.cookie.get(cookieName,''))));}function setPreferenceOrStorage(prefName,storageKey,cookieName){storageKey=storageKey||prefName;cookieName=cookieName||storageKey;if(!mw.user.isNamed()){if(!mw.storage.set(storageKey,1)){mw.cookie.set(cookieName,1,{path:'/',expires:30*86400,prefix:''});}}else{new mw.Api().saveOption(prefName,'1');mw.user.options.set(prefName,'1');}}conf=mw.config.get('wgVisualEditorConfig');
tabMessages=conf.tabMessages;viewUrl=new URL(mw.util.getUrl(mw.config.get('wgRelevantPageName')),location.href);currentUrl=new URL(location.href);oldId=mw.config.get('wgRevisionId')||$('input[name=parentRevId]').val();if(oldId===mw.config.get('wgCurRevisionId')||mw.config.get('wgEditLatestRevision')){oldId=undefined;}pageExists=!!mw.config.get('wgRelevantArticleId');const isViewPage=mw.config.get('wgIsArticle')&&!currentUrl.searchParams.has('diff');const wgAction=mw.config.get('wgAction');const isEditPage=wgAction==='edit'||wgAction==='submit';const pageCanLoadEditor=isViewPage||isEditPage;const pageIsProbablyEditable=mw.config.get('wgIsProbablyEditable')||mw.config.get('wgRelevantPageIsProbablyEditable');const enable=!!+mw.user.options.get('visualeditor-enable');const tempdisable=!!+mw.user.options.get('visualeditor-betatempdisable');const autodisable=!!+mw.user.options.get('visualeditor-autodisable');tabPreference=mw.user.options.get('visualeditor-tabs');function isOnlyTabVE(){return conf.useSingleEditTab&&getAvailableEditPageEditor()==='visual';
}function isOnlyTabWikitext(){return conf.useSingleEditTab&&getAvailableEditPageEditor()==='source';}init={addPlugin:function(plugin){plugins.push(plugin);},setupEditLinks:function(){if(init.isWikitextAvailable()&&!isOnlyTabVE()){$('.mw-editsection a:not( .mw-editsection-visualeditor ),'+'#ca-edit a,'+'#ca-addsection a').each((i,el)=>{if(!el.href){return;}const linkUrl=new URL(el.href);if(linkUrl.searchParams.has('action')){linkUrl.searchParams.delete('action');linkUrl.searchParams.set('veaction','editsource');$(el).attr('href',linkUrl.toString());}});}if(init.isAvailable){if(!init.isSingleEditTab&&init.isVisualAvailable()&&!(conf.disableForAnons&&mw.user.isAnon())){init.setupMultiTabSkin();}else if(pageCanLoadEditor&&((init.isVisualAvailable()&&isOnlyTabVE())||(init.isWikitextAvailable()&&isOnlyTabWikitext()))){$('.mw-editsection a').off('.ve-target').on('click.ve-target',(e)=>{init.onEditSectionLinkClick(isOnlyTabVE()?'visual':'source',e);});$('#ca-edit').off('.ve-target').on('click.ve-target',(e)=>{
init.onEditTabClick(isOnlyTabVE()?'visual':'source',e);});}if(!mw.user.isAnon()&&pageCanLoadEditor&&init.isVisualAvailable()&&(!init.isSingleEditTab||isOnlyTabVE())){$('#catlinks').prepend($('<span>').addClass('ve-init-mw-desktopArticleTarget-categoryEdit mw-editsection-like').on('click',init.onCategoryEditLinkClick).append($('<span>').addClass('mw-editsection-bracket').text('['),$('<a>').text(mw.msg('editsection')),$('<span>').addClass('mw-editsection-bracket').text(']')));}}},setupMultiTabSkin:function(){init.setupMultiTabs();init.setupMultiSectionLinks();},setupMultiTabs:function(){const $caEdit=$('#ca-edit');const $caVeEdit=$('#ca-ve-edit');if(pageCanLoadEditor){$caVeEdit.off('.ve-target').on('click.ve-target',init.onEditTabClick.bind(init,'visual'));}if(pageCanLoadEditor){$caEdit.off('.ve-target').on('click.ve-target',init.onEditTabClick.bind(init,'source'));}if(pageCanLoadEditor&&init.isWikitextAvailable()){$('#ca-addsection').off('.ve-target').on('click.ve-target',init.onEditTabClick.bind(init,'source'));
}if(init.isVisualAvailable()){if(conf.tabPosition==='before'){$caEdit.addClass('collapsible');}else{$caVeEdit.addClass('collapsible');}}},setupMultiSectionLinks:function(){if(pageCanLoadEditor){const $editsections=$('#mw-content-text .mw-editsection');$editsections.find('.mw-editsection-visualeditor').off('.ve-target').on('click.ve-target',init.onEditSectionLinkClick.bind(init,'visual'));if(init.isWikitextAvailable()){$editsections.find('a:not( .mw-editsection-visualeditor )').off('.ve-target').on('click.ve-target',init.onEditSectionLinkClick.bind(init,'source'));}}},isUnmodifiedLeftClick:function(e){return e&&((e.which&&e.which===1&&!(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey))||e.isTrigger);},onEditTabClick:function(mode,e){if(!init.isUnmodifiedLeftClick(e)){return;}if(!active&&mode==='source'&&!init.isWikitextAvailable()){return;}e.preventDefault();if(isLoading){return;}const section=$(e.target).closest('#ca-addsection').length?'new':null;if(active){targetPromise.then((target)=>{if(target.getDefaultMode()==='source'){
if(mode==='visual'){target.switchToVisualEditor();}else if(mode==='source'){target.switchToWikitextSection(section);}}else if(target.getDefaultMode()==='visual'){if(mode==='source'){if(section){target.switchToWikitextSection(section);}else{target.editSource();}}}});}else{const link=$(e.target).closest('a')[0];const linkUrl=link&&link.href?new URL(link.href):undefined;if(section!==null){init.activateVe(mode,linkUrl,section);}else{init.activateVe(mode,linkUrl);}}},activateVe:function(mode,linkUrl,section){const wikitext=$('#wpTextbox1').textSelection('getContents'),modified=mw.config.get('wgAction')==='submit'||(mw.config.get('wgAction')==='edit'&&wikitext!==initialWikitext);if(section===undefined){const sectionVal=$('input[name=wpSection]').val();section=sectionVal!==''&&sectionVal!==undefined?sectionVal:null;}if($.fn.dialog){$('.ui-dialog-content').dialog('close');}$(window).off('beforeunload.editwarning');activatePageTarget(mode,section,modified,linkUrl);},onEditSectionLinkClick:function(mode,e,section){
const link=$(e.target).closest('a')[0];if(!link||!link.href){return;}const linkUrl=new URL(link.href);const title=mw.Title.newFromText(linkUrl.searchParams.get('title')||'');if(!init.isUnmodifiedLeftClick(e)||!(linkUrl.searchParams.has('action')||linkUrl.searchParams.has('veaction'))||linkUrl.host!==location.host||title&&title.getPrefixedText()!==new mw.Title(mw.config.get('wgRelevantPageName')).getPrefixedText()){return;}e.preventDefault();if(isLoading){return;}trackActivateStart({type:'section',mechanism:section==='new'?'new':'click',mode},linkUrl);if(!active){history.replaceState({tag:'visualeditor'},'',currentUrl);history.pushState({tag:'visualeditor'},'',linkUrl);currentUrl=linkUrl;if(section===undefined){section=getSectionFromUrl(linkUrl);}const tPromise=getTarget(mode,section);activateTarget(mode,section,tPromise);}},onCategoryEditLinkClick:function(e){if(!init.isUnmodifiedLeftClick(e)){return;}e.preventDefault();if(isLoading){return;}trackActivateStart({type:'page',mechanism:'click',mode:'visual'});
if(currentUrl.searchParams.get('action')!=='edit'&&!(currentUrl.searchParams.get('veaction')in veactionToMode)){if(history.pushState){history.replaceState({tag:'visualeditor'},document.title,currentUrl);history.pushState({tag:'visualeditor'},document.title,veEditUrl);}currentUrl=veEditUrl;}init.disableWelcomeDialog();activateTarget('visual',null,getTarget('visual',null).then((target)=>{target.once('surfaceReady',()=>{const windowAction=ve.ui.actionFactory.create('window',target.getSurface());windowAction.open('meta',{page:'categories'});});return target;}));},shouldShowWelcomeDialog:function(){return!(!mw.config.get('wgVisualEditorConfig').showBetaWelcome||this.isWelcomeDialogSuppressed()||currentUrl.searchParams.has('collabSession')||checkPreferenceOrStorage('visualeditor-hidebetawelcome','ve-beta-welcome-dialog'));},isWelcomeDialogSuppressed:function(){return!!(welcomeDialogDisabled||new URL(location.href).searchParams.has('vehidebetadialog')||new URL(location.href).searchParams.has('hidewelcomedialog')
);},stopShowingWelcomeDialog:function(){setPreferenceOrStorage('visualeditor-hidebetawelcome','ve-beta-welcome-dialog');},disableWelcomeDialog:function(){welcomeDialogDisabled=true;},shouldShowEducationPopups:function(){return!(educationPopupsDisabled||checkPreferenceOrStorage('visualeditor-hideusered','ve-hideusered'));},stopShowingEducationPopups:function(){setPreferenceOrStorage('visualeditor-hideusered','ve-hideusered');},disableEducationPopups:function(){educationPopupsDisabled=true;}};function isSupportedEditPage(url){return configData.unsupportedEditParams.every((param)=>!url.searchParams.has(param));}init.isSingleEditTab=conf.useSingleEditTab&&tabPreference!=='multi-tab';veEditUrl=new URL(pageCanLoadEditor?currentUrl:viewUrl);if(oldId){veEditUrl.searchParams.set('oldid',oldId);}veEditUrl.searchParams.delete('veaction');veEditUrl.searchParams.delete('action');if(init.isSingleEditTab){veEditUrl.searchParams.set('action','edit');veEditSourceUrl=veEditUrl;}else{veEditSourceUrl=new URL(veEditUrl);
veEditUrl.searchParams.set('veaction','edit');veEditSourceUrl.searchParams.set('veaction','editsource');}init.isAvailable=VisualEditorSupportCheck();const enabledForUser=((conf.enableBetaFeature?enable:!tempdisable)&&!autodisable);init.isVisualAvailable=(url=currentUrl)=>(init.isAvailable&&(url.searchParams.get('veaction')==='edit'||(conf.namespaces.includes(new mw.Title(mw.config.get('wgRelevantPageName')).getNamespaceId())&&enabledForUser))&&isSupportedEditPage(url)&&Object.prototype.hasOwnProperty.call(conf.contentModels,mw.config.get('wgPageContentModel'))&&getSectionFromUrl(url)!=='new');init.isWikitextAvailable=(url=currentUrl)=>(init.isAvailable&&(url.searchParams.get('veaction')==='editsource'||(conf.enableWikitext&&mw.user.options.get('visualeditor-newwikitext')))&&mw.config.get('wgPageContentModel')==='wikitext');function getAvailableModes(){const availableModes=[];if(init.isVisualAvailable()){availableModes.push('visual');}if(init.isWikitextAvailable()){availableModes.push('source');
}return availableModes;}init.setEditorPreference=setEditorPreference;init.updateTabs=updateTabs;mw.libs.ve=$.extend(mw.libs.ve||{},init);if(init.isVisualAvailable()){$('html').addClass('ve-available');}else{$('html').addClass('ve-not-available');}function getEditModeFromUrl(url){if(mw.config.get('wgDiscussionToolsStartNewTopicTool')){return null;}if(isViewPage&&init.isAvailable){const mode=veactionToMode[url.searchParams.get('veaction')]||(url.searchParams.has('collabSession')?'visual':null);if(mode&&getAvailableModes().includes(mode)){return mode;}}if(isEditPage&&isSupportedEditPage(url)){if(!enabledForUser||$('#ca-viewsource').length||mw.config.get('wgAction')==='submit'){return null;}return getAvailableEditPageEditor();}return null;}$(()=>{$targetContainer=$(document.querySelector('[data-mw-ve-target-container]')||document.getElementById('content'));if(pageCanLoadEditor){$targetContainer.addClass('ve-init-mw-desktopArticleTarget-targetContainer');}let showWikitextWelcome=true;const numEditButtons=$('#ca-edit, #ca-ve-edit').length,
section=getSectionFromUrl(currentUrl);const requiredSkinElements=$targetContainer.length&&$('#mw-content-text').length&&(isEditPage||numEditButtons);if(currentUrl.searchParams.get('action')==='edit'&&$('#wpTextbox1').length){initialWikitext=$('#wpTextbox1').textSelection('getContents');}if((init.isVisualAvailable()||init.isWikitextAvailable())&&pageCanLoadEditor&&pageIsProbablyEditable&&!requiredSkinElements){mw.log.warn('Your skin is incompatible with VisualEditor. '+'See https://www.mediawiki.org/wiki/Extension:VisualEditor/Skin_requirements for the requirements.');if(numEditButtons>0){const err=new Error('Incompatible with VisualEditor');err.name='VeIncompatibleSkinWarning';mw.errorLogger.logError(err,'error.visualeditor');}}else if(init.isAvailable){const mode=getEditModeFromUrl(currentUrl);if(mode){showWikitextWelcome=false;trackActivateStart({type:section===null?'page':'section',mechanism:(section==='new'||!mw.config.get('wgArticleId'))?'url-new':'url',mode});activateTarget(mode,section);
}else if(init.isVisualAvailable()&&pageCanLoadEditor&&init.isSingleEditTab){$(document.body).append($('<a>').attr({accesskey:mw.msg('accesskey-ca-ve-edit'),href:veEditUrl}).on('click.ve-target',init.onEditTabClick.bind(init,'visual')).addClass('oo-ui-element-hidden'));}if(init.isVisualAvailable()&&isEditPage&&$('#wpTextbox1').length){mw.loader.load('ext.visualEditor.switching');mw.hook('wikiEditor.toolbarReady').add(($textarea)=>{mw.loader.using('ext.visualEditor.switching').then(()=>{const showPopup=currentUrl.searchParams.has('veswitched')&&!mw.user.options.get('visualeditor-hidesourceswitchpopup'),toolFactory=new OO.ui.ToolFactory(),toolGroupFactory=new OO.ui.ToolGroupFactory();toolFactory.register(mw.libs.ve.MWEditModeVisualTool);toolFactory.register(mw.libs.ve.MWEditModeSourceTool);const switchToolbar=new OO.ui.Toolbar(toolFactory,toolGroupFactory,{classes:['ve-init-mw-editSwitch']});switchToolbar.on('switchEditor',(m)=>{if(m==='visual'){$('#wpTextbox1').trigger('wikiEditor-switching-visualeditor');
init.activateVe('visual');}});switchToolbar.setup([{name:'editMode',type:'list',icon:'edit',title:mw.msg('visualeditor-mweditmode-tooltip'),label:mw.msg('visualeditor-mweditmode-tooltip'),invisibleLabel:true,include:['editModeVisual','editModeSource']}]);const popup=new mw.libs.ve.SwitchPopupWidget('source');switchToolbar.tools.editModeVisual.toolGroup.$element.append(popup.$element);switchToolbar.emit('updateState');$textarea.wikiEditor('addToToolbar',{section:'secondary',group:'default',tools:{veEditSwitch:{type:'element',element:switchToolbar.$element}}});popup.toggle(showPopup);if($('#ca-edit').hasClass('visualeditor-showtabdialog')){$('#ca-edit').removeClass('visualeditor-showtabdialog');const windowManager=new OO.ui.WindowManager();$(OO.ui.getTeleportTarget()).append(windowManager.$element);const editingTabDialog=new mw.libs.ve.EditingTabDialog();windowManager.addWindows([editingTabDialog]);windowManager.openWindow(editingTabDialog).closed.then((data)=>{windowManager.destroy();if(data&&data.action==='prefer-ve'){
location.href=veEditUrl;}else if(data&&data.action==='multi-tab'){location.reload();}});}});});mw.libs.ve.setEditorPreference('wikitext');mw.storage.session.remove('ve-docstate');}init.setupEditLinks();}if(pageCanLoadEditor&&showWikitextWelcome&&(init.isVisualAvailable()||init.isWikitextAvailable()||$('#wpTextbox1').length)&&isEditPage&&init.shouldShowWelcomeDialog()&&pageIsProbablyEditable){mw.loader.using('ext.visualEditor.welcome').then(()=>{if(!init.shouldShowWelcomeDialog()){return;}const windowManager=new OO.ui.WindowManager();const welcomeDialog=new mw.libs.ve.WelcomeDialog();$(OO.ui.getTeleportTarget()).append(windowManager.$element);windowManager.addWindows([welcomeDialog]);windowManager.openWindow(welcomeDialog,{switchable:init.isVisualAvailable(),editor:'source'}).closed.then((data)=>{windowManager.destroy();if(data&&data.action==='switch-ve'){init.activateVe('visual');}});init.stopShowingWelcomeDialog();});}if(currentUrl.searchParams.has('venotify')){currentUrl.searchParams.delete('venotify');
history.replaceState(null,'',currentUrl);}});}());
},"modules/ve-mw/preinit/data.json":{"unsupportedEditParams":["undo","undoafter","preview"]}}},{"css":[".ve-active .ve-init-mw-desktopArticleTarget-targetContainer #siteNotice,.ve-active .mw-indicators,.ve-active #t-print,.ve-active #t-permalink,.ve-active #p-coll-print_export,.ve-active #t-cite,.ve-active .ve-init-mw-desktopArticleTarget-editableContent,.ve-active .ve-init-mw-tempWikitextEditorWidget{display:none}.ve-deactivating .ve-ui-surface{display:none}.ve-activating{ }.ve-activating .ve-ui-surface{height:0;padding:0 !important; overflow:hidden} .ve-loading .ve-init-mw-desktopArticleTarget-targetContainer \u003E :not(.ve-init-mw-desktopArticleTarget-toolbarPlaceholder):not(.ve-init-mw-desktopArticleTarget),.ve-loading .ve-init-mw-desktopArticleTarget-originalContent,.ve-activated:not(.ve-loading) .ve-init-mw-desktopArticleTarget-uneditableContent{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;opacity:0.5}.ve-activated .ve-init-mw-desktopArticleTarget-targetContainer #firstHeading{ -webkit-user-select:text;-moz-user-select:text;user-select:text;pointer-events:auto;cursor:text}.ve-activated .ve-init-mw-desktopArticleTarget-targetContainer #firstHeading a{ pointer-events:none}.ve-activated .ve-init-mw-desktopArticleTarget-originalContent #catlinks{cursor:pointer}.ve-activated .ve-init-mw-desktopArticleTarget-originalContent #catlinks:hover{ background:rgba(109,169,247,0.15)}.ve-activated .ve-init-mw-desktopArticleTarget-originalContent #catlinks a{opacity:1} .ve-init-mw-desktopArticleTarget-loading-overlay{z-index:2;position:absolute;width:100%;top:1em}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder{overflow:hidden;transition:height 250ms ease;height:0;padding-bottom:2px; }.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{transform:translateY(-100%);transition:transform 250ms ease}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-open .ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{transform:translateY(0)}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating{transition:none}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating .ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{position:fixed;top:0;z-index:1;background:var(--background-color-base,#fff)} .oo-ui-element-hidden{display:none !important; } .ve-init-mw-desktopArticleTarget-categoryEdit{float:right;margin-top:1ex} .ve-init-mw-desktopArticleTarget-toolbarPlaceholder-bar{height:42px;border-bottom:1px solid #c8ccd1;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating,.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-open{height:42px} .ve-init-mw-desktopArticleTarget-toolbar,.ve-init-mw-desktopArticleTarget-toolbarPlaceholder{font-size:0.875em; margin:-1.14em -1.14em 1.14em -1.14em; }@media screen and (min-width:982px){.ve-init-mw-desktopArticleTarget-toolbar,.ve-init-mw-desktopArticleTarget-toolbarPlaceholder{ margin:-1.43em -1.71em 1.43em -1.71em}}.ve-init-mw-desktopArticleTarget-toolbarPlaceholder-floating{margin-top:0;margin-bottom:0} .ve-activated .vector-menu-tabs .selected{box-shadow:inset 0 -1px 0 #e1f1fc}"]},{"accesskey-ca-ve-edit":"v","editsection":"править","visualeditor-mweditmode-tooltip":"Переключить редактор","visualeditor-ca-editsource":"Править код","visualeditor-ca-createsource":"Создать код","visualeditor-ca-editlocaldescriptionsource":"Редактировать источник локального описания","visualeditor-ca-createlocaldescriptionsource":"Создать локально как код","editsectionhint":"Редактировать раздел «$1»","visualeditor-ca-editsource-section":"править код","visualeditor-ca-editsource-section-hint":"Редактировать код раздела «$1»","skin-view-edit":"Править","vector-view-edit":"Править","skin-view-create":"Создать","vector-view-create":"Создать","skin-view-edit-local":"Редактировать локальное описание","skin-view-create-local":"Создать локально"}];});
mw.loader.impl(function(){return["ext.visualEditor.progressBarWidget@kxifz",function($,jQuery,require,module){mw.libs.ve=mw.libs.ve||{};mw.libs.ve.ProgressBarWidget=function VeUiMwProgressBarWidget(){this.progressStep=0;this.progressSteps=[[30,3000],[70,2000],[100,1000]];this.$bar=$('<div>').addClass('ve-init-mw-progressBarWidget-bar').css('width',0);this.$element=$('<div>').addClass('ve-init-mw-progressBarWidget').append(this.$bar);};mw.libs.ve.ProgressBarWidget.prototype.setLoadingProgress=function(target,duration){const $bar=this.$bar.stop();$bar.css('transition','width '+duration+'ms ease-in');setTimeout(()=>{$bar.css('width',target+'%');});};mw.libs.ve.ProgressBarWidget.prototype.incrementLoadingProgress=function(){const step=this.progressSteps[this.progressStep];if(step){this.setLoadingProgress(step[0],step[1]);this.progressStep++;}};mw.libs.ve.ProgressBarWidget.prototype.clearLoading=function(){this.progressStep=0;this.setLoadingProgress(0,0);};
},{"css":[".ve-init-mw-progressBarWidget{height:1em;overflow:hidden;margin:0 25%}.ve-init-mw-progressBarWidget-bar{height:1em;width:0} .ve-init-mw-progressBarWidget{background-color:#fff;box-sizing:border-box;height:0.875em;border:1px solid #36c;border-radius:0.875em;box-shadow:0 1px 1px rgba(0,0,0,0.15)}.ve-init-mw-progressBarWidget-bar{background-color:#36c;height:0.875em}"]}];});
mw.loader.impl(function(){return["ext.visualEditor.supportCheck@jj8np",function($,jQuery,require,module){(function(){window.VisualEditorSupportCheck=function(){return((function(){try{new Function('(a = 0) => a');return true;}catch(e){return false;}}())&&/./g.flags==='g'&&!!('contentEditable'in document.createElement('div'))&&!!document.createElementNS&&(function(){let doc;try{doc=new DOMParser().parseFromString('<body></body>','text/html');}catch(e){}return doc instanceof HTMLDocument;}())&&!!(('classList'in document.createElement('_'))||('classList'in document.createElementNS('http://www.w3.org/2000/svg ','g')))&&!!('createSVGRect'in document.createElementNS('http://www.w3.org/2000/svg','svg')));};}());
}];});
mw.loader.impl(function(){return["ext.visualEditor.targetLoader@tlm6f",function($,jQuery,require,module){mw.libs.ve=mw.libs.ve||{};mw.libs.ve.decodeURIComponentIntoArticleTitle=function(s,preserveUnderscores){try{s=decodeURIComponent(s);}catch(e){return s;}if(preserveUnderscores){return s;}return s.replace(/_/g,' ');};mw.libs.ve.unwrapParsoidSections=function(element,keepSection){Array.prototype.forEach.call(element.querySelectorAll('section[data-mw-section-id]'),(section)=>{const parent=section.parentNode,sectionId=section.getAttribute('data-mw-section-id');if(sectionId!==null&&+sectionId>0){section.firstChild.setAttribute('data-mw-section-id',sectionId);}if(keepSection!==undefined&&sectionId===keepSection){return;}while(section.firstChild){parent.insertBefore(section.firstChild,section);}parent.removeChild(section);});};mw.libs.ve.stripParsoidFallbackIds=function(element){Array.prototype.forEach.call(element.querySelectorAll('span[typeof="mw:FallbackId"][id]:empty'),(legacySpan)=>{legacySpan.parentNode.removeChild(legacySpan);});};mw.libs.ve.restbaseIdRegExp=/^mw[a-zA-Z0-9\-_]{2,6}$/;mw.libs.ve.stripRestbaseIds=function(doc){
const restbaseIdRegExp=mw.libs.ve.restbaseIdRegExp;Array.prototype.forEach.call(doc.querySelectorAll('[id^="mw"]'),(element)=>{if(restbaseIdRegExp.test(element.id)){element.removeAttribute('id');}});};mw.libs.ve.reduplicateStyles=function(element){Array.prototype.forEach.call(element.querySelectorAll('link[rel~="mw-deduplicated-inline-style"]'),(link)=>{const href=link.getAttribute('href');if(!href||!href.startsWith('mw-data:')){return;}const key=href.slice('mw-data:'.length);const style=element.querySelector('style[data-mw-deduplicate="'+key+'"]');if(!style){return;}const newStyle=link.ownerDocument.createElement('style');newStyle.setAttribute('data-mw-deduplicate',key);for(let i=0;i<style.childNodes.length;i++){newStyle.appendChild(style.childNodes[i].cloneNode(true));}Array.prototype.forEach.call(link.attributes,(attr)=>{if(attr.name!=='rel'&&attr.name!=='href'){newStyle.setAttribute(attr.name,attr.value);}});link.parentNode.replaceChild(newStyle,link);});Array.prototype.forEach.call(element.querySelectorAll('style[data-mw-deduplicate]:empty'),(style)=>{
const key=style.getAttribute('data-mw-deduplicate');const firstStyle=element.querySelector('style[data-mw-deduplicate="'+key+'"]');if(!firstStyle||firstStyle===style){return;}for(let i=0;i<firstStyle.childNodes.length;i++){style.appendChild(firstStyle.childNodes[i].cloneNode(true));}});};mw.libs.ve.deduplicateStyles=function(element){function isFosterablePosition(node){const fosterablePositions=['table','thead','tbody','tfoot','tr'];return node&&fosterablePositions.includes(node.parentNode.nodeName.toLowerCase());}const styleTagKeys={};Array.prototype.forEach.call(element.querySelectorAll('style[data-mw-deduplicate]'),(style)=>{const key=style.getAttribute('data-mw-deduplicate');if(!styleTagKeys[key]){styleTagKeys[key]=true;return;}if(!isFosterablePosition(style)){const link=style.ownerDocument.createElement('link');link.setAttribute('rel','mw-deduplicated-inline-style');link.setAttribute('href','mw-data:'+key);Array.prototype.forEach.call(style.attributes,(attr)=>{if(attr.name!=='rel'&&attr.name!=='data-mw-deduplicate'){
link.setAttribute(attr.name,attr.value);}});style.parentNode.replaceChild(link,style);}else{style.innerHTML='';}});};mw.libs.ve.fixFragmentLinks=function(container,docTitle,prefix){const docTitleText=docTitle.getPrefixedText();prefix=prefix||'';Array.prototype.forEach.call(container.querySelectorAll('a[href*="#"]'),(el)=>{let fragment=null;if(el.getAttribute('href').startsWith('#')){fragment=el.getAttribute('href').slice(1);}else{const targetData=mw.libs.ve.getTargetDataFromHref(el.href,el.ownerDocument);if(targetData.isInternal){const title=mw.Title.newFromText(targetData.title);if(title&&title.getPrefixedText()===docTitleText){fragment=new URL(el.href).hash.slice(1);}}}if(fragment!==null){if(!fragment){el.setAttribute('href','#');}else{if(prefix){const target=container.querySelector('#'+$.escapeSelector(fragment));if(target){target.setAttribute('id',prefix+fragment);target.setAttribute('data-mw-id-fixed','');}}el.setAttribute('href','#'+prefix+fragment);}el.removeAttribute('target');
}});Array.prototype.forEach.call(container.querySelectorAll('h1, h2, h3, h4, h5, h6'),(el)=>{if(el.hasAttribute('id')&&!el.hasAttribute('data-mw-id-fixed')){el.removeAttribute('id');}});};mw.libs.ve.getTargetDataFromHref=function(href,doc){function regexEscape(str){return str.replace(/([.?*+^$[\]\\(){}|-])/g,'\\$1');}function returnExternalData(){return{isInternal:false};}function returnInternalData(titleish){const data=mw.libs.ve.parseParsoidResourceName(titleish);data.isInternal=true;return data;}let url;try{url=new URL(href,doc.baseURI);}catch(e){return returnExternalData();}const externalLinkUrlProtocolsRegExp=new RegExp('^('+mw.config.get('wgUrlProtocols')+')','i');if(!externalLinkUrlProtocolsRegExp.test(url.toString())){return returnInternalData(url.toString());}if(url.searchParams.get('action')==='edit'&&url.searchParams.get('redlink')==='1'){url.searchParams.delete('action');url.searchParams.delete('redlink');}const keys=[];url.searchParams.forEach((val,key)=>{keys.push(key);});
const queryLength=keys.length;const relativeHref=url.toString().replace(/^https?:/i,'');const scriptBase=new URL(mw.config.get('wgScript'),doc.baseURI).toString().replace(/^https?:/i,'');if(relativeHref.startsWith(scriptBase)){if(queryLength===1&&url.searchParams.get('title')){return returnInternalData(url.searchParams.get('title')+url.hash);}}const articleBase=new URL(mw.config.get('wgArticlePath'),doc.baseURI).toString().replace(/^https?:/i,'');const articleBaseRegex=new RegExp(regexEscape(articleBase).replace(regexEscape('$1'),'(.*)'));const matches=relativeHref.match(articleBaseRegex);if(matches){if(queryLength===0&&matches&&!matches[1].split('#')[0].includes('?')){return returnInternalData(matches[1]);}}return returnExternalData();};mw.libs.ve.encodeParsoidResourceName=function(title){const idx=title.indexOf('#');let anchor=null;if(idx!==-1){anchor=title.slice(idx+1);title=title.slice(0,idx);}let encodedTitle=title.replace(/[%? [\]#|<>]/g,(match)=>mw.util.wikiUrlencode(match));if(anchor!==null){
encodedTitle+='#'+mw.util.escapeIdForLink(anchor);}return'./'+encodedTitle;};mw.libs.ve.parseParsoidResourceName=function(resourceName){const matches=resourceName.match(/^(\.\/|)(.*)$/);return{title:mw.libs.ve.decodeURIComponentIntoArticleTitle(matches[2])};};mw.libs.ve.normalizeParsoidResourceName=function(resourceName){return mw.libs.ve.parseParsoidResourceName(resourceName).title;};
mw.libs.ve=mw.libs.ve||{};mw.libs.ve.smoothScrollTo=function(scrollTop){const supportsSmoothScroll='scrollBehavior'in document.documentElement.style;if(supportsSmoothScroll){window.scroll({top:scrollTop,behavior:'smooth'});}else{let scrollContainer;if(OO&&OO.ui){scrollContainer=OO.ui.Element.static.getRootScrollableElement(document.body);}else{scrollContainer=document.documentElement;}$(scrollContainer).animate({scrollTop});}};
(function(){mw.libs.ve=mw.libs.ve||{};const conf=mw.config.get('wgVisualEditorConfig'),pluginCallbacks=[],modules=['ext.visualEditor.articleTarget',...conf.pluginModules.filter(mw.loader.getState)];const url=new URL(location.href);mw.libs.ve.initialUrl=url;if(mw.user.options.get('visualeditor-newwikitext')||url.searchParams.get('veaction')==='editsource'){modules.push('ext.visualEditor.mwwikitext');}if(mw.user.options.get('visualeditor-collab')||url.searchParams.has('collabSession')){modules.push('ext.visualEditor.collab');}if(conf.editCheck&&conf.editCheckABTest){let inABTest;if(mw.user.isAnon()){const token=mw.cookie.get('VEECid','',mw.user.generateRandomSessionId());mw.cookie.set('VEECid',token,{path:'/',expires:90*86400,prefix:''});inABTest=parseInt(token.slice(0,8),16)%2===1;}else{inABTest=mw.user.getId()%2===1;}conf.editCheckABTestGroup=inABTest?'test':'control';mw.config.set('wgVisualEditorEditCheckABTestBucket','2025-09-editcheck-'+conf.editCheckABTest+'-'+(inABTest?'test':'control')
);}const editCheck=conf.editCheck||!!url.searchParams.get('ecenable')||!!window.MWVE_FORCE_EDIT_CHECK_ENABLED;if(conf.editCheckTagging||editCheck){modules.push('ext.visualEditor.editCheck');}const namespaces=mw.config.get('wgNamespaceIds');if(Object.keys(namespaces).some((name)=>mw.Title.wantSignaturesNamespace(namespaces[name]))){modules.push('ext.visualEditor.mwsignature');}mw.libs.ve.targetLoader={addPlugin:function(plugin){if(typeof plugin==='string'){modules.push(plugin);}else{pluginCallbacks.push(plugin);}},loadModules:function(mode){mw.hook('ve.loadModules').fire(this.addPlugin.bind(this));ve.track('trace.moduleLoad.enter',{mode});return mw.loader.using(modules).then(()=>{ve.track('trace.moduleLoad.exit',{mode});pluginCallbacks.push(ve.init.platform.getInitializedPromise.bind(ve.init.platform));return $.when(...pluginCallbacks.map((callback)=>{try{return callback();}catch(e){mw.log.warn('Failed to load VE plugin:',e);return null;}}));});},createCheckboxFields:function(checkboxesDef,widgetConfig){
const checkboxFields=[],checkboxesByName={};if(checkboxesDef){Object.keys(checkboxesDef).forEach((name)=>{const options=checkboxesDef[name];let accessKey=null,title=null;if(options.tooltip){accessKey=mw.message('accesskey-'+options.tooltip).text();title=mw.message('tooltip-'+options.tooltip).text();}if(options['title-message']){title=mw.message(options['title-message']).text();}const $label=mw.message(options['label-message']).parseDom();const config=$.extend({accessKey,classes:['ve-ui-mwSaveDialog-checkbox-'+name]},widgetConfig);let checkbox;switch(options.class){case'OOUI\\DropdownInputWidget':checkbox=new OO.ui.DropdownInputWidget($.extend(config,{value:options.default,options:options.options}));break;default:checkbox=new OO.ui.CheckboxInputWidget($.extend(config,{selected:options.default}));break;}checkboxFields.push(new OO.ui.FieldLayout(checkbox,{align:'inline',label:$label,title,invisibleLabel:!!options.invisibleLabel,classes:['ve-ui-mwSaveDialog-field-'+name]}));
checkboxesByName[name]=checkbox;});}return{checkboxFields,checkboxesByName};},requestPageData:function(mode,pageName,options={}){if(mode==='visual'&&options.section==='new'){throw new Error('Adding new section is not supported in visual mode');}const apiRequest=mode==='source'?this.requestWikitext.bind(this,pageName,options):this.requestParsoidData.bind(this,pageName,options);if(options.sessionStore){let sessionState;try{sessionState=JSON.parse(mw.storage.session.get('ve-docstate'));}catch(e){}if(sessionState){const request=sessionState.request||{};const enableVisualSectionEditing=conf.enableVisualSectionEditing;const section=request.mode==='source'||enableVisualSectionEditing===true||enableVisualSectionEditing===options.targetName?options.section:null;if(request.pageName===pageName&&request.mode===mode&&request.section===section){const dataPromise=$.Deferred().resolve({visualeditor:$.extend({content:mw.storage.session.get('ve-dochtml')},sessionState.response,{recovered:true})}).promise();
if(sessionState.response.oldid===mw.config.get('wgCurRevisionId')){return dataPromise;}else{ve.track=function(){};return mw.loader.using('oojs-ui-windows').then(()=>OO.ui.confirm(mw.msg('visualeditor-autosave-modified-prompt-message'),{title:mw.msg('visualeditor-autosave-modified-prompt-title'),actions:[{action:'accept',label:mw.msg('visualeditor-autosave-modified-prompt-accept'),flags:['primary','progressive']},{action:'reject',label:mw.msg('visualeditor-autosave-modified-prompt-reject'),flags:'destructive'}]}).then((confirmed)=>{if(confirmed){return dataPromise;}else{mw.storage.session.remove('ve-docstate');return apiRequest();}}));}}}}return apiRequest();},requestParsoidData:function(pageName,options={},noRestbase=false,noMetadata=false){const section=options.section!==undefined?options.section:null,useRestbase=!noRestbase&&(conf.fullRestbaseUrl||conf.restbaseUrl)&&section===null;const data={action:'visualeditor',paction:useRestbase?'metadata':'parse',page:pageName,badetag:options.badetag,
uselang:mw.config.get('wgUserLanguage'),editintro:options.editintro,preload:options.preload,preloadparams:options.preloadparams,formatversion:2};if(options.oldId!==undefined){data.oldid=options.oldId;}const start=ve.now();ve.track('trace.apiLoad.enter',{mode:'visual'});let apiXhr,apiPromise;let switched=false,fromEditedState=false;if(!useRestbase&&options.wikitext!==undefined){data.paction='parse';data.stash=true;switched=true;fromEditedState=options.modified;data.wikitext=options.wikitext;data.section=options.section;data.oldid=options.oldId;apiXhr=new mw.Api().post(data);}else{if(useRestbase&&noMetadata){apiPromise=$.Deferred().resolve({visualeditor:{}}).promise();}else{apiXhr=new mw.Api().get(data);}}if(!apiPromise){apiPromise=apiXhr.then((response)=>{ve.track('trace.apiLoad.exit',{mode:'visual'});mw.track('timing.ve.'+options.targetName+'.performance.system.apiLoad',ve.now()-start);if(response.visualeditor){response.visualeditor.switched=switched;response.visualeditor.fromEditedState=fromEditedState;
}return response;});}let dataPromise,abort;if(useRestbase){ve.track('trace.restbaseLoad.enter',{mode:'visual'});const headers={Accept:'text/html; charset=utf-8; profile="https://www.mediawiki.org/wiki/Specs/HTML/2.8.0"','Accept-Language':mw.config.get('wgVisualEditor').pageLanguageCode,'Api-User-Agent':'VisualEditor-MediaWiki/'+mw.config.get('wgVersion')};let restbaseXhr,pageHtmlUrl;if(options.wikitext!==undefined&&!$('[name=wpSection]').val()){if(conf.fullRestbaseUrl){pageHtmlUrl=conf.fullRestbaseUrl+'v1/transform/wikitext/to/html/';}else{pageHtmlUrl=conf.restbaseUrl.replace('v1/page/html/','v1/transform/wikitext/to/html/');}switched=true;fromEditedState=options.modified;window.onbeforeunload=null;$(window).off('beforeunload');restbaseXhr=$.ajax({url:pageHtmlUrl+encodeURIComponent(pageName)+(data.oldid===undefined?'':'/'+data.oldid),type:'POST',data:{title:pageName,wikitext:options.wikitext,stash:'true'},headers,dataType:'text'});}else{if(conf.fullRestbaseUrl){pageHtmlUrl=conf.fullRestbaseUrl+'v1/page/html/';
}else{pageHtmlUrl=conf.restbaseUrl;}restbaseXhr=$.ajax({url:pageHtmlUrl+encodeURIComponent(pageName)+(data.oldid===undefined?'':'/'+data.oldid)+'?redirect=false&stash=true',type:'GET',headers,dataType:'text'});}const restbasePromise=restbaseXhr.then((response,status,jqxhr)=>{ve.track('trace.restbaseLoad.exit',{mode:'visual'});mw.track('timing.ve.'+options.targetName+'.performance.system.restbaseLoad',ve.now()-start);return[response,jqxhr.getResponseHeader('etag')];},(xhr,code,_)=>{if(xhr.status===404){return $.Deferred().resolve(['',undefined]).promise();}else{mw.log.warn('RESTBase load failed: '+xhr.statusText);return $.Deferred().reject(code,xhr,_).promise();}});dataPromise=$.when(apiPromise,restbasePromise).then((apiData,restbaseData)=>{if(apiData.visualeditor){if(restbaseData[0]||!apiData.visualeditor.content){apiData.visualeditor.content=restbaseData[0];apiData.visualeditor.etag=restbaseData[1];}apiData.visualeditor.switched=switched;apiData.visualeditor.fromEditedState=fromEditedState;
}return apiData;});abort=function(){if(apiXhr){apiXhr.abort();}restbaseXhr.abort();};}else{dataPromise=apiPromise;if(apiXhr){abort=apiXhr.abort;}}return dataPromise.then((resp)=>{const etagRegexp=/^(?:W\/)?"?([^"/]+)(?:\/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}))(?:\/([^"]+))?"?$/;if(useRestbase&&resp.visualeditor.content&&(!resp.visualeditor.etag||!etagRegexp.test(resp.visualeditor.etag))){return mw.libs.ve.targetLoader.requestParsoidData(pageName,$.extend({},options,{badetag:resp.visualeditor.etag||''}),true);}resp.veMode='visual';return resp;}).promise({abort});},requestWikitext:function(pageName,options={}){const data={action:'visualeditor',paction:'wikitext',page:pageName,uselang:mw.config.get('wgUserLanguage'),editintro:options.editintro,preload:options.preload,preloadparams:options.preloadparams,formatversion:2};if(options.section!==null&&options.section!==undefined){data.section=options.section;}if(options.oldId!==undefined){data.oldid=options.oldId;}const dataPromise=new mw.Api().get(data);
return dataPromise.then((resp)=>{resp.veMode='source';return resp;}).promise({abort:dataPromise.abort});}};}());
(function(){mw.libs.ve=mw.libs.ve||{};mw.libs.ve.targetSaver={preloadDeflate:function(){mw.loader.load('mediawiki.deflate');},deflate:function(html){return mw.loader.using('mediawiki.deflate').then(()=>mw.deflateAsync(html));},getHtml:function(newDoc,oldDoc){function copyAttributes(from,to){Array.prototype.forEach.call(from.attributes,(attr)=>{to.setAttribute(attr.name,attr.value);});}if(oldDoc){for(let i=0,len=oldDoc.head.childNodes.length;i<len;i++){newDoc.head.appendChild(oldDoc.head.childNodes[i].cloneNode(true));}copyAttributes(oldDoc.documentElement,newDoc.documentElement);copyAttributes(oldDoc.head,newDoc.head);copyAttributes(oldDoc.body,newDoc.body);}$(newDoc).find(['script','noscript','object','style:not( [ data-mw ] ):not( [ data-mw-deduplicate ] )','embed','a[href^="javascript:"]','img[src^="data:"]','div[id="myEventWatcherDiv"]','div[id="sendToInstapaperResults"]','div[id="kloutify"]','div[id^="mittoHidden"]','div.hon.certificateLink','div.donut-container',
'div.shield-container'].join(',')).each((j,el)=>{function truncate(text,l){return text.length>l?text.slice(0,l)+'…':text;}const errorMessage='DOM content matching deny list found:\n'+truncate(el.outerHTML,100)+'\nContext:\n'+truncate(el.parentNode.outerHTML,200);mw.log.error(errorMessage);const err=new Error(errorMessage);err.name='VeDomDenyListWarning';mw.errorLogger.logError(err,'error.visualeditor');$(el).remove();});$(newDoc).find('[data-mw-section-id]:not( section )').removeAttr('data-mw-section-id');mw.libs.ve.deduplicateStyles(newDoc.body);return'<!doctype html>'+ve.properOuterHtml(newDoc.documentElement);},deflateDoc:function(doc,oldDoc){return this.deflate(this.getHtml(doc,oldDoc));},saveDoc:function(doc,extraData,options){return this.deflateDoc(doc).then((html)=>this.postHtml(html,null,extraData,options));},postWikitext:function(wikitext,extraData,options){return this.postContent($.extend({wikitext},extraData),options);},postHtml:function(html,cacheKey,extraData={},options={}){
let data;if(cacheKey){data=$.extend({cachekey:cacheKey},extraData);}else{data=$.extend({html},extraData);}return this.postContent(data,options).then(null,(code,response)=>{if(options.onCacheKeyFail){options.onCacheKeyFail();}if(code==='badcachekey'){return this.postHtml(html,null,extraData,options);}return $.Deferred().reject(code,response).promise();});},postContent:function(data,options={}){const api=options.api||new mw.Api();let start;if(options.now){start=options.now();}data=$.extend({action:'visualeditoredit',paction:'save',useskin:mw.config.get('skin'),mobileformat:!!mw.config.get('wgMFMode'),formatversion:2,errorformat:'html',errorlang:mw.config.get('wgUserLanguage'),errorsuselocal:true},data);const action=data.action;const request=api.postWithToken('csrf',data,{contentType:'multipart/form-data',trackEditAttemptStepSessionId:true});return request.then((response,jqxhr)=>{const responseData=response[action];if(options.track&&options.eventName){const eventData={bytes:require('mediawiki.String').byteLength(jqxhr.responseText),
duration:options.now()-start};const fullEventName='performance.system.'+options.eventName+(responseData.cachekey?'.withCacheKey':'.withoutCacheKey');options.track(fullEventName,eventData);}let error;if(!responseData){error={code:'invalidresponse',html:mw.message('api-clientside-error-invalidresponse').parse()};}else if(responseData.result!=='success'){return $.Deferred().reject('no-error-no-success',response).promise();}else{switch(responseData.paction){case'save':case'serialize':if(typeof responseData.content!=='string'){error={code:'invalidcontent',html:mw.message('api-clientside-error-invalidresponse').parse()};}break;case'diff':if(typeof responseData.diff!=='string'){error={code:'invalidcontent',html:mw.message('api-clientside-error-invalidresponse').parse()};}break;}}if(error){return $.Deferred().reject(error.code,{errors:[error]}).promise();}return responseData;},(code,response)=>{const responseText=OO.getProp(response,'xhr','responseText');if(responseText&&options.track&&options.eventName){
const eventData={bytes:require('mediawiki.String').byteLength(responseText),duration:options.now()-start};let fullEventName;if(code==='badcachekey'){fullEventName='performance.system.'+options.eventName+'.badCacheKey';}else{fullEventName='performance.system.'+options.eventName+'.withoutCacheKey';}options.track(fullEventName,eventData);}return $.Deferred().reject(code,response).promise();});}};}());
},{},{"api-clientside-error-invalidresponse":"Неверный ответ от сервера.","visualeditor-autosave-modified-prompt-accept":"Продолжить редактирование","visualeditor-autosave-modified-prompt-message":"Эта страница была отредактирована с момента последней загрузки. {{GENDER:|Вы}} хотели бы возобновить {{GENDER:|своё}} редактирование старой версии или начать новое редактирование последней версии?","visualeditor-autosave-modified-prompt-reject":"Начать новую правку","visualeditor-autosave-modified-prompt-title":"Возобновить вашу правку?"}];});
mw.loader.impl(function(){return["ext.visualEditor.tempWikitextEditorWidget@84mnd",function($,jQuery,require,module){mw.libs.ve=mw.libs.ve||{};mw.libs.ve.MWTempWikitextEditorWidget=function VeUiMwTempWikitextEditorWidget(config){const conf=mw.config.get('wgVisualEditor'),dir=conf.pageLanguageDir,lang=conf.pageLanguageCode;this.$element=$('<textarea>').addClass('ve-init-mw-tempWikitextEditorWidget ').addClass('mw-editfont-'+mw.user.options.get('editfont')).addClass('mw-content-'+dir).attr({lang,dir}).val(config.value);};mw.libs.ve.MWTempWikitextEditorWidget.prototype.moveCursorToStart=function(){this.$element[0].setSelectionRange(0,0);this.focus();return this;};mw.libs.ve.MWTempWikitextEditorWidget.prototype.adjustSize=function(){this.$element.height(this.$element[0].scrollHeight);return this;};mw.libs.ve.MWTempWikitextEditorWidget.prototype.focus=function(){this.$element[0].focus();return this;};mw.libs.ve.MWTempWikitextEditorWidget.prototype.getValue=function(){return this.$element.val();};mw.libs.ve.MWTempWikitextEditorWidget.prototype.getRange=function(){const input=this.$element[0],start=input.selectionStart,
end=input.selectionEnd,isBackwards=input.selectionDirection==='backward';return{from:isBackwards?end:start,to:isBackwards?start:end};};
},{"css":[".ve-init-mw-tempWikitextEditorWidget{border:0;padding:0;color:inherit;line-height:1.5em;width:100%;-moz-tab-size:4;tab-size:4;  }.ve-init-mw-tempWikitextEditorWidget:focus{outline:0;padding:0}.ve-init-mw-tempWikitextEditorWidget::selection{background:rgba(109,169,247,0.5); }"]}];});
mw.loader.impl(function(){return["ext.visualEditor.track@10mz7",function($,jQuery,require,module){ve.track=mw.track;ve.trackSubscribe=mw.trackSubscribe;ve.trackSubscribe('activity.',(topic,data)=>{mw.track('visualEditorFeatureUse',ve.extendObject(data,{feature:topic.split('.')[1]}));});
}];});
mw.loader.impl(function(){return["ext.visualEditor.ve@19fgx",function($,jQuery,require,module){window.ve={};ve.now=function(){const perf=window.performance;const navStart=perf&&perf.timing&&perf.timing.navigationStart;ve.now=navStart&&perf.now?function(){return navStart+perf.now();}:Date.now;return ve.now();};
}];});
