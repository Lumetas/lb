"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[15656],{595689:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var i=n(629133),o=n.n(i),r=n(827378),s=n.n(r),a=n(937634),l=n(460159),d=n.n(l),u=n(313981),c=n(353256);function _(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,n){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n||e):o.value}},p(e,t,n||e)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=h(e);if(t){var o=h(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}(this,n)}}const g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(r,e);var t,n,i=m(r);function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i.apply(this,arguments)}return t=r,n=[{key:"initialize",value:function(e){var t=this;p(h(r.prototype),"initialize",this).apply(this,arguments);var n=e.getText,i=e.setText,s=e.onLoad;this.getText=n,this.setText=i,this.onLoad=s,this.unmountControl=o().noop,d()._preload(["langs/ai"])().then((function(){return t.unmountControl=t.mountControl()}))}},{key:"destroy",value:function(){this.unmountControl(),p(h(r.prototype),"destroy",this).call(this,!0)}},{key:"mountControl",value:function(){var e=s().createElement(c.AiRewriter,{getText:o().bind(this.getText,this),setText:o().bind(this.setText,this),onLoad:o().bind(this.onLoad,this),offset:{bottom:41,right:-17}}),t=a.createRoot(this.el);return t.render(e),function(){t.unmount()}}}],n&&_(t.prototype,n),r}(u.default);var y="../build/transpiled/interface/controls/ai_rewriter/ai_rewriter";window.define(y,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([y])},673951:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var i=n(629133),o=n.n(i),r=n(460159),s=n.n(r),a=n(313981),l=n(474564),d=n(285188),u=n(386769),c=n(661533);function _(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}(this,n)}}var y=["ðŸ‘","ðŸ‘Ž","â¤ï¸","ðŸ¤”","ðŸ˜‚"],v=null,b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(r,e);var t,n,i=g(r);function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i.apply(this,arguments)}return t=r,n=[{key:"template",get:function(){return"/tmpl/controls/emoji/reactions.twig"}},{key:"reactions_height",get:function(){return this.params.supported_reactions.all?220:26}},{key:"events",value:function(){var e;return h(e={},"click ".concat(this._selector("symbol")),"handleReactionSendClick"),h(e,"click ".concat(this._selector("increase_button")),"handleIncreaseButtonClick"),h(e,"mouseleave","handleReactionAndBubleMouseLeave"),h(e,"mouseover","handleTipMenuMouseOver"),h(e,"reaction:show","handleReactionRequestShow"),h(e,"bubble:hide","onBubbleHide"),e}},{key:"_selectors",value:function(){return{symbol:".emoji-reactions__symbol",wrapper:".feed-context-menu__wrapper",reaction_wrapper:".emoji-reactions__content",increase_button:".js-emoji-increase"}}},{key:"_classes",value:function(){return{buble_wrapper:"control-emoji-reactions-buble-wrapper",increased:"feed-context-menu__wrapper-increased",single_control:"emoji-reactions__single",scroll_control:"emoji-reactions__scroll",scroll_control_wrapper:"emoji-reactions__content-scroll"}}},{key:"onBubbleHide",value:function(){this._removeClass("buble_wrapper",d.default.$buble),d.default._hide()}},{key:"handleReactionAndBubleMouseLeave",value:function(e){var t=this;c(null==e?void 0:e.relatedTarget).closest(this._selector("buble_wrapper")).length||c(null==e?void 0:e.relatedTarget).closest(this._selector("wrapper")).length||(this.hide_tip_menu_timeout=o().delay((function(){clearTimeout(t.hide_tip_menu_timeout),t.onBubbleHide(),t.tipMenuHide()}),250))}},{key:"handleTipMenuMouseOver",value:function(){d.default.hideCancel(),clearTimeout(this.hide_tip_menu_timeout)}},{key:"handleReactionSendClick",value:function(e){var t=c(e.currentTarget).data("reaction");this.sendReaction(t)}},{key:"sendReaction",value:function(e){o().isUndefined(e)||(d.default.push(e,this.params.supported_reactions_origin),this.onBubbleHide(),this.tipMenuHide(),(0,l.sendReaction)(this.message_id,e).subscribe())}},{key:"handleIncreaseButtonClick",value:function(e){e.stopPropagation&&e.stopPropagation(),this.showBubble()}},{key:"setPositions",value:function(e,t){var n=document.body.getBoundingClientRect(),i=e.getBoundingClientRect();t.css("height","");var o={top:this.render_type===u.TIP_RENDER_TYPE.up?i.top-220+this.$control.height()+22:i.bottom-n.top-this.$control.height()-20,left:i.x,height:220};for(var r in o)t.css(r,o[r])}},{key:"showBubble",value:function(){var e,t=this;return(e=function(){return function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(e){switch(e.label){case 0:return[4,t.ready_promise];case 1:return e.sent(),t.setPositions(t.el,d.default.$buble),t._addClass("increased"),t._addClass("buble_wrapper",d.default.$buble),d.default.show(),t.$control.remove(),t.blockScroll(),d.default.attach({onEmojiSelect:o().bind(t.sendReaction,t)}),[2]}}))},function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){_(r,i,o,s,a,"next",e)}function a(e){_(r,i,o,s,a,"throw",e)}s(void 0)}))})()}},{key:"initialize",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.message_id=n.message_id,o().isUndefined(n.tipMenuHide))throw new Error("method to hide cannot be undefiend");this.tipMenuHide=n.tipMenuHide,this.blockScroll=n.blockScroll||o().noop;var i={type:"",reactions:y,supported_reactions:n.supported_reactions,is_scroll:!1,is_increasing:!1,supported_reactions_origin:n.origin};switch(!0){case i.supported_reactions.all:i.type="all",i.is_increasing=!0;break;case Boolean((null===(e=i.supported_reactions.list)||void 0===e?void 0:e.length)||(null===(t=i.supported_reactions.ranges)||void 0===t?void 0:t.length)):var r=i.supported_reactions.list||[];switch(i.type="list",i.reactions=o().reduce(i.supported_reactions.ranges,(function(e,t){return e.concat(d.default.getEmojisBetween(t.from,t.to))}),r),!0){case 1===i.reactions.length:i.wrapper_class_name=this._class("single_control");break;case i.reactions.length>1&&i.reactions.length<7:break;case i.reactions.length>=7&&i.reactions.length<=15:i.wrapper_class_name=this._class("scroll_control_wrapper"),i.class_name=this._class("scroll_control"),i.is_scroll=!0;break;case i.reactions.length>15:i.is_increasing=!0,i.reactions=o().first(i.reactions,5);break;default:return}break;default:return}this.params=i}},{key:"handleBubleMouseEnter",value:function(){clearTimeout(this.hide_tip_menu_timeout)}},{key:"handleReactionRequestShow",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.TIP_RENDER_TYPE.down;this.$control=c(s()({ref:this.template}).render(this.params)),v!==this.params.supported_reactions_origin&&(d.default.$latest=d.default.getLatest(20,null,this.params.supported_reactions_origin),d.default.updateLatest(),v=this.params.supported_reactions_origin),(null===(t=this.params.supported_reactions)||void 0===t?void 0:t.list)?(d.default.$supported=d.default.getSupportedReactions(this.params.supported_reactions.list),d.default.$buble.find(".control-emoji-buble").children().not("#emoji_latest, #emoji_supported").hide()):(d.default.$buble.find(".control-emoji-buble").children().show(),d.default.$buble.find("#emoji_supported").hide()),n===u.TIP_RENDER_TYPE.down?this.$el.append(this.$control):this.$el.prepend(this.$control),this.render_type=n,this.params.is_increasing&&(d.default.addConsumer(),this.$buble=d.default.$buble,this.$buble.on("mouseenter.buble",o().bind(this.handleBubleMouseEnter,this)),this.$buble.on("mouseleave.buble",o().bind(this.handleReactionAndBubleMouseLeave,this)),this.$buble.on("click.buble",(function(e){return e.stopPropagation()})),this.ready_promise=d.default.ready())}}],n&&p(t.prototype,n),r}(a.default),E="../build/transpiled/interface/controls/emoji/emoji_reactions";window.define(E,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([E])},343808:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var i=n(661533),o=n.n(i),r=n(629133),s=n.n(r),a=(n(693671),n(313981)),l=n(129578);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t,n){return _="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n||e):o.value}},_(e,t,n||e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function f(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=p(e);if(t){var o=p(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}(this,n)}}function g(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="",i=0;i<e.length;i+=1)"BR"===e[i].nodeName&&i!==e.length-1&&i>0?n+="\n":"DIV"===e[i].nodeName?(n+="\n",n+=g(e[i].childNodes)):n+=e[i].textContent;return t.no_nbsp&&(n=n.replace(/\u00a0/g," ")),n}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(r,e);var t,n,i=m(r);function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i.apply(this,arguments)}return t=r,n=[{key:"_classes",value:function(){return{list:"fields-mention-list"}}},{key:"_selectors",value:function(){return{input:this.$input.selector,contenteditable:this.$contenteditable.selector}}},{key:"document_events",get:function(){var e;return c(e={"fields_mention:update-value":"onInputUpdateOutside"},"blur ".concat(this._selector("contenteditable")),"onContentEditableBlur"),c(e,"input ".concat(this._selector("contenteditable")),"onContentEditableInputThrottled"),c(e,"shown.atwho ".concat(this._selector("contenteditable")),"onShowAddContainerClass"),e}},{key:"initialize",value:function(e){var t='<span data-id="${id}">[${option}]</span>';this.$contenteditable=e.contenteditable,this.$input=e.input,this._mentions=this.prepareMentions(e.mentions||(0,l.getFieldsParams)()),this._without_input_value_update=e.without_input_value_update||!1,this._should_put_value=e.should_put_value,this._start_with_space=!1!==e.start_with_space,this.updateContentEditableOutside(),this.onContentEditableInputThrottled=s().throttle(this.onContentEditableInput,500),this._should_put_value&&(t=t.replace("[${option}]","${id}")),this.$contenteditable.atwho({at:"[",data:this._mentions,displayTpl:"<li>${option}</li>",insertTpl:t,searchKey:"option",limit:100,maxLen:20,startWithSpace:this._start_with_space}),this._atwho=this.$contenteditable.data("atwho"),_(p(r.prototype),"initialize",this).call(this,arguments)}},{key:"prepareMentions",value:function(e){var t=[APP.element_types.leads,APP.element_types.customers,APP.element_types.contacts,APP.element_types.companies],n=s().max(t),i=s().sortBy(e,(function(e){var i=e.element_type,o=e.sort,r=s().isUndefined(i)?t.length:t.indexOf(i),a=s().isUndefined(o)?Number.MAX_SAFE_INTEGER:o;return i>n||!s().isNumber(i)?[t.length+1,a]:[r,a]})),o=s().groupBy(i,(function(e){return s().isUndefined(e.element_type)&&s().isUndefined(e.sort)?"no_element_type_no_sort":"with_element_type_or_sort"}));return f(o.with_element_type_or_sort||[]).concat(f(o.no_element_type_no_sort||[]))||[]}},{key:"destroy",value:function(){this._atwho&&this._atwho.$inputor.atwho("destroy"),_(p(r.prototype),"destroy",this).call(this,arguments)}},{key:"onShowAddContainerClass",value:function(e,t){t.$el.find(".atwho-view").addClass(this._class("list")).find("ul").addClass("custom-scroll")}},{key:"onInputUpdateOutside",value:function(){this.updateContentEditableOutside(),this.$input.trigger("change")}},{key:"onContentEditableInput",value:function(){this.$contenteditable.trigger("autosize:resized"),this.$input.val(this.getRawValue()).trigger("change")}},{key:"onContentEditableBlur",value:function(){this._without_input_value_update||this.$input.val(this.getRawValue()).trigger("change")}},{key:"getFormattedValue",value:function(){return g(this.$contenteditable.get(0).childNodes)}},{key:"getRawValue",value:function(){var e=this.$contenteditable.clone();return e.find(".atwho-inserted").each((function(e,t){var n=o()(t).find("span[data-id]");n&&n.replaceWith(n.attr("data-id"))})),g(e.get(0).childNodes,{no_nbsp:!0}).trim()}},{key:"getFieldTemplateById",value:function(e){var t=s().findWhere(this._mentions,{id:e});return t?['<span class="atwho-inserted" data-atwho-at-query="[" contenteditable="false">','<span data-id="'.concat(t.id,'">').concat(s().escape(this._should_put_value?t.id:"[".concat(t.option,"]")),"</span>"),"</span>"].join(""):""}},{key:"updateContentEditableOutside",value:function(){var e=this,t=(s().escape(this.$input.val())||"").replace(/[\n]/g,"<br>").replace(/{{[a-zA-Z0-9._-]+}}/gm,(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.getFieldTemplateById(t.trim())||t})),n=this.getFormattedValue();this.$contenteditable.is(":focus")||t===n||(this.$contenteditable.html(t+"&nbsp;"),this.$contenteditable.trigger("autosize:resized"))}}],n&&u(t.prototype,n),r}(a.default);y.extend(y);const v=y;var b="../build/transpiled/interface/controls/fields_mention";window.define(b,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([b])},565672:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var i=n(661533),o=n.n(i),r=n(629133),s=n.n(r),a=n(460159),l=n.n(a),d=n(128508),u=n(987081),c=n(445368),_=n(193727),p=n(137233),h=n(271311),f=n(210734),m=n(118973),g=n(474564),y=n(304483),v=n(845043);function b(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function E(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){b(r,i,o,s,a,"next",e)}function a(e){b(r,i,o,s,a,"throw",e)}s(void 0)}))}}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}const T=f.default.extend({controlClassName:"feed-note__joined-attach",initialize:function(){return E((function(){var e=arguments;return x(this,(function(t){return f.default.prototype.initialize.apply(this,e),this.file_id=this.$el.data("file-id"),this.rx_subscriptions=new u.Subscription,"progress"===this._elem("preload_panel").data("loading-status")&&(this._elem("preload_img").addClass(this._class("loading_file")),this._socketFileLoading()),this.compressImage(),[2]}))})).apply(this)},_classes:function(){return{disabled:"feed-note__joined-attach__link_disabled",preview:"feed-note__media-preview__file",download_link:"feed-note__joined-attach__link",preload_link:"preload-file__item-download-text",preload_panel:"preload-file__item-download",preload_img:"preload-file__item-img",preload_btn:"svg-common--download-files-dims",image_resizer:"js-image-resizer",lost_text:"preload-file__item-lost-text",progress_title:"preload-progress-bar__title",progress_bar:"preload-progress-bar__block",loading_file:"preload-file__item-img-loading"}},events:function(){var e;return w(e={},"click ".concat(this._selector("preview")),"fileDownload"),w(e,"click ".concat(this._selector("download_link")),"fileDownload"),w(e,"click ".concat(this._selector("preload_link")),"preloadFile"),w(e,"click ".concat(this._selector("preload_btn")),"preloadFile"),w(e,"click ".concat(this._selector("lost_text")),"openDescrLostFile"),e},status_codes:{STATUS_NOT_STARTED:"ready",STATUS_IN_PROGRESS:"progress",STATUS_DONE:"finished",STATUS_FAILED:"failed",STATUS_LOST:"lost"},preloadFile:function(){return E((function(){return x(this,(function(e){return this._elem("preload_img").addClass(this._class("loading_file")),this._elem("preload_panel").html(l()({ref:"/tmpl/notes/types/amojo/progress_bar.twig"}).render()),this._socketFileLoading(),this._makeRequest(this.file_id),[2]}))})).apply(this)},compressImage:function(){var e;this._elem("image_resizer").each((e=E((function(e,t){var n,i,r,a,l;return x(this,(function(e){return n=o()(t),i=n.find(".feed-note__media-preview__picture"),r=i.get(0),(a=new Image).className="feed-note__media-preview__picture",l=function(){if(!s().contains(_.EXT_FOR_COMPRESSION,(0,p.getFileExtension)(r.src))||r.naturalWidth<440||r.naturalHeight<440)return n.find(".spinner-icon").remove(),void(r.style.opacity=1);setTimeout(E((function(){var e;return x(this,(function(t){switch(t.label){case 0:return[4,(0,_.compressImage)({originalImage:r,imagePreviewWidth:110,imagePreviewHeight:110})];case 1:return e=t.sent(),a.src=URL.createObjectURL(e),n.prepend(a),n.find(".spinner-icon").remove(),[2]}}))})))},r.complete?l():r.onload=function(){l()},[2]}))})),function(t,n){return e.apply(this,arguments)}))},checkStatus:function(e){switch(e.processed_count>0&&(this.need_reload=!0),e.status){case this.status_codes.STATUS_DONE:this.rx_subscriptions.unsubscribe(),this.rerender(e);break;case this.status_codes.STATUS_IN_PROGRESS:this.rerender(e);break;case this.status_codes.STATUS_FAILED:this.rx_subscriptions.unsubscribe(),this.errorUpload();break;case this.status_codes.STATUS_LOST:this.rx_subscriptions.unsubscribe(),this.renderLostFile();break;default:this.errorUpload()}},openDescrLostFile:function(){new v.default({text:(0,c.i18n)("File not found"),message:[{text:"Automatically downloading files is disabled"}],no_actions:!0})},rerender:function(e){var t=this._getRenderData(e).numerator;this._findElem("progress_bar").width(t+"%"),this._findElem("progress_title").text(t+"%")},renderLostFile:function(){this._elem("preload_panel").html(l()({ref:"/tmpl/notes/types/amojo/lost_file.twig"}).render())},errorUpload:function(){this._elem("preload_img").removeClass(this._class("loading_file")),this._elem("preload_panel").html(l()({ref:"/tmpl/notes/types/amojo/fail_file.twig"}).render())},_getRenderData:function(e){return s().extend({numerator:this._getPercentage(e)},e)},_getPercentage:function(e){var t;return e.status===this.status_codes.STATUS_DONE?t=100:(t=Math.round(e.progress/e.total*100),t=s().isNaN(t)?0:t),t},_makeRequest:function(e){(0,g.downloadFile)(e,s().bind(this.errorUpload,this)).subscribe(s().noop(),s().bind(this.errorUpload,this))},_socketFileLoading:function(){var e=this,t=h.default.socket.pipe(d.map((function(e){var t=e.data;try{return JSON.parse(t)}catch(e){return t}})),d.filter((function(e){return"file_loading_updated"===e.type})),d.filter((function(t){return t.data.file_id===e.file_id})),d.map((function(e){return e.data}))),n=h.default.socket.pipe(d.map((function(e){var t=e.data;try{return JSON.parse(t)}catch(e){return t}})),d.filter((function(e){return"message_updated"===e.type})));this.rx_subscriptions.add(t.subscribe(s().bind(this.checkStatus,this))),this.rx_subscriptions.add(n.subscribe(s().bind(this.deleteSubscriptions,this)))},deleteSubscriptions:function(){this.rx_subscriptions.unsubscribe()},fileDownload:function(e){return E((function(){var t,n,i;return x(this,(function(r){switch(r.label){case 0:e.preventDefault(),e.stopPropagation(),(t=o()(e.currentTarget)).addClass(this._class("disabled")),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch(t.attr("href"),{redirect:"manual"})];case 2:return 404===(n=r.sent()).status?(new y.default).showError((0,c.i18n)("File not found or deleted"),!1):401===n.status?(new y.default).showError((0,c.i18n)("Start by refreshing the page â€” this often helps."),!1):(0,m.downloadFile)(t.attr("href")),[3,4];case 3:return i=r.sent(),console.error("Fetch error: ",i),[3,4];case 4:return t.removeClass(this._class("disabled")),[2]}}))})).apply(this)}});var A="../build/transpiled/interface/notes/controls/file_download";window.define(A,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([A])},445227:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var i=n(526471);const o=i.default.View.extend({revert:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._cached_form_html=null,i.default.View.prototype.revert.apply(this,t)},getInputValue:function(e){var t=i.default.View.prototype.getInputValue.apply(this,arguments),n=this.model.get(e.attr("name"));return"radio"===e.attr("type")&&n&&!t?n:t}});var r="../build/transpiled/interface/notes/form";window.define(r,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([r])},439182:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var i=n(629133),o=n.n(i),r=n(661533),s=n.n(r),a=n(345839),l=n.n(a),d=n(162262),u=n.n(d),c=n(161320),_=n.n(c),p=n(974839),h=n.n(p),f=n(168807),m=n(500034),g=n(23456),y=n(791844),v=n(206572),b=n(512739),E=n(76733),w=n(393455),x=o().invert(w.default);const T=h().Model.extend({constructor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!e._date_create&&e.date_create&&e.msec_created_at&&(e._date_create=e.date_create,e.date_create=e.msec_created_at),h().Model.apply(this,arguments)},initialize:function(e){var t=this.get("type");switch(o().isString(t)&&this.set("type",x[t]),this.get("object_type")||this.set("object_type",this._getObjectType()),!0){case"tasks"===this.get("object_type").code:u().mixin(this,y.default);break;case this.get("type")===APP.note_types.task_result:u().mixin(this,v.default);break;case this.get("element_type")===APP.element_types.catalog_elements:u().mixin(this,E.default);break;default:u().mixin(this,b.default)}(this.get("is_add")||this.get("is_new"))&&this.set(o().extend(this._generateEmpty(),o().pick(e,"data","type","object_type")))},get:function(e){return"type"===e&&this.get("note_type")?this.get("note_type"):"object_type"===e&&this.get("note_type")?this._getObjectType():"_date_create"===e&&o().isUndefined(this.attributes._date_create)?this.get("date_create"):"can_be_retrieved_by_url"===e&&o().result(this.collection,"_has_url_copying_feature",!1)?"tasks"!==(this.get("object_type")||{}).code||!this.isFutureTask():h().Model.prototype.get.apply(this,arguments)},toJSON:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=h().Model.prototype.toJSON.apply(this,t);return this.get("note_type")?o().extend({},i,{type:this.get("type"),object_type:this.get("object_type")}):i},parse:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!o().isEmpty(this.links)&&o().isEmpty(e.links)?e:h().Model.prototype.parse.apply(this,arguments)},_getObjectType:function(){return this.get("chat_id")?{code:"chats",id:"wtf?!"}:{code:"notes",id:AMOCRM.element_types.notes}},_generateEmpty:function(){return{}},_getSyncData:function(){return{}},isFutureTask:function(){return"tasks"===this.get("object_type").code&&!this.get("status")&&this.get("complete_till")>_()().tz(APP.system.timezone).unix()},isNew:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l().Model.prototype.isNew.apply(this,t)},_updateModel:o().noop,sync:function(e,t,n){return this._pending||(this._pending=!0,this._loading=new Promise(o().bind((function(t,i){var r=APP.data.current_card?{parent_element_id:APP.data.current_card.id,parent_element_type:APP.data.current_card.element_type}:null;this.trigger("request",this),this.get("element_id")?s().ajax({url:"/private/notes/edit2.php".concat(r?"?".concat(s().param(r)):""),data:this._getSyncData(e),dataType:"json",type:"POST"}).always(o().bind((function(){this._pending=!1}),this)).done(o().bind((function(e){if("ok"===e.status?(this._updateModel(e),n.success&&n.success(),t({status:1})):i({status:0,response:e}),(0,m.isFeatureAvailable)("is_customization_for_global")){var o="task-event-sent",r="other";if(f.storeWithExpiration.get(o))return;"leads"===APP.data.current_entity&&(r="Lead card");var s=_()().add(1,"days").startOf("day").diff(_()());(0,g.kommoLogAmplitude)("taskSet",{"Task source":r}),f.storeWithExpiration.set(o,"Y",s)}}),this)).fail((function(){i({status:0})})):(this._pending=!1,this.get("id")||this.set("id","".concat((0,f.randHex)(),"-").concat((0,f.randHex)())),n.success&&n.success(),t())}),this))),this._loading}});var A="../build/transpiled/interface/notes/model";window.define(A,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([A])},76733:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var i=n(629133),o=n.n(i),r=n(512739);const s=o().extend({},r.default,{_getSyncData:function(e){var t=r.default._getSyncData.apply(this,arguments);if("create"===e){var n=o().propertyOf(this.collection)(["element_info","catalog_id"])||0;t.CATALOG_ID=this.get("catalog_id")||n}return t}});var a="../build/transpiled/interface/notes/models/mixins/catalog_element_note";window.define(a,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([a])},512739:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var i=n(629133),o=n.n(i),r=n(161320),s=n.n(r),a=n(661533);const l={_tempTemplate:o().template('<% if (data && data.text) { %><div id="note_temp_<%= id %>"><input type="hidden" value="<%= date_create %>" name="comments[<%= id %>][DATE_CREATE]" ><input type="hidden" value="<%= created_by %>" name="comments[<%= id %>][CREATED_BY]" ><textarea class="hidden" name="comments[<%= id %>][body]"><%= data.text %></textarea><input type="hidden" value="<%= data.params.link %>" name="comments[<%= id %>][ATTACHEMENT]" ></div><% } %>'),_updateModel:function(e){e.note&&e.note.id&&(this.set("id",e.note.id),this.id=e.note.id)},_getSyncData:function(e){var t=o().propertyOf(this.get("data"))("params")||{},n=this.get("note_id")||this.get("id");switch(e){case"create":return o().extend({DATE_CREATE:this.get("date_create"),ACTION:"ADD_NOTE",BODY:this.get("data").text,ELEMENT_ID:this.get("element_id"),ELEMENT_TYPE:this.get("element_type")},t.drive?t.drive:{ATTACH:t.link},this.get("msec_created_at")>0?{msec_created_at:this.get("msec_created_at")}:{});case"update":return{ID:parseInt(n),ACTION:"EDIT_NOTE",BODY:this.get("data").text};case"delete":return{ID:parseInt(n),ACTION:"NOTE_DELETE"}}},pin:function(){var e=this.get("note_id")||this.get("id");return a.ajax({url:"/ajax/v3/notes/".concat(e),type:"patch",contentType:"application/json; charset=utf-8",data:JSON.stringify({pinned:this.get("pinned")})})},_generateEmpty:function(){return{type:APP.note_types.common,editable:!0,deletable:!1,date_create:s()().unix(),data:{text:"",params:{}},created_by:(APP.constant("user")||{}).id,object_type:{code:"notes",id:5}}}};var d="../build/transpiled/interface/notes/models/mixins/note";window.define(d,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([d])},791844:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var i=n(629133),o=n.n(i);const r={_tempTemplate:o().template('<div id="note_temp_<%= id %>"><input type="hidden" value="" name="comments[<%= id %>][DATE_CREATE]"><input type="hidden" value="<%= created_by %>" name="comments[<%= id %>][CREATED_BY]"><textarea class="hidden" name="comments[<%= id %>][body]"><%= data.text %></textarea><input type="hidden" value="<%= responsible_user %>" name="comments[<%= id %>][MAIN_USER]" /><input type="hidden" value="<%= type %>" name="comments[<%= id %>][TASK_TYPE]" /><input type="hidden" value="<%= complete_till %>" name="comments[<%= id %>][END_DATE]" /><input type="hidden" value="<%= duration %>" name="comments[<%= id %>][DURATION]" /></div>'),_updateModel:function(e){e.task&&(e.task.id&&this.set("id",e.task.id),e.task.date&&this.set("complete_till",e.task.date),e.task.result_id&&this.set("result_id",e.task.result_id))},_getSyncData:function(e){switch(e){case"create":return{ACTION:"ADD_TASK",BODY:this.get("data").text,MAIN_USER:this.get("responsible_user_id"),TASK_TYPE:this.get("type"),END_DATE:this.get("complete_till"),DISABLE_WEBHOOKS:"N",ELEMENT_ID:this.get("element_id"),ELEMENT_TYPE:this.get("element_type"),DURATION:this.get("duration")};case"update":return{ID:parseInt(this.get("id")),ACTION:"EDIT_TASK",BODY:this.get("data").text,MAIN_USER:this.get("responsible_user_id"),TASK_TYPE:this.get("type"),END_DATE:this.get("complete_till"),MAIN_USER_CHANGED:this.get("responsible_user_id"),ELEMENT_ID:this.get("element_id"),ELEMENT_TYPE:this.get("element_type"),DURATION:this.get("duration")};case"delete":return{ID:parseInt(this.get("id")),ACTION:"TASK_DELETE",ELEMENT_ID:this.get("element_id"),ELEMENT_TYPE:this.get("element_type")};case"complete":return{ID:parseInt(this.get("id")),ACTION:"COMPLETE_TASK",result:this.get("result_text"),ELEMENT_ID:this.get("element_id"),ELEMENT_TYPE:this.get("element_type")}}},_generateEmpty:function(){var e=APP.constant("user")||{};return{type:1,editable:!0,deletable:!1,data:{text:APP.lang.tasks_follow_up,params:{}},responsible_user_id:e.id,created_by:e.id,object_type:{code:"tasks",id:4}}},_getResult:function(){return this.get("result_note")&&this.get("result_note").get("data")?this.get("result_note"):this.get("status")&&this.collection?this.collection.getOriginCollection(this).tasks_results.findWhere({element_id:this.id}):void 0},complete:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.sync("complete",this,{success:o().bind((function(){e.silent||this.trigger("sync",this)}),this)})},_setModelResult:function(e){var t=this._getResult(),n="update",i={element_id:this.id,is_new:!0,object_type:{id:5,code:"notes"},type:APP.note_types.task_result},r=this.get("result_id"),s=o().propertyOf(this.get("result"))("data");return t||(r&&(i.id=r),t=this.collection.getOriginCollection(this).tasks_results.add(i),n="create"),t.set("data",o().extend(t.get("data"),{text:e})),s&&(s.text=e,this.set("result",o().extend(this.get("result"),s))),{model:t,action:n}},result:function(e){var t=this._setModelResult(e);return t.model.sync(t.action,this,{success:o().bind((function(){this.trigger("sync",this)}),this)})},resultNotSync:function(e){this._setModelResult(e),this.trigger("sync",this)}};var s="../build/transpiled/interface/notes/models/mixins/task";window.define(s,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([s])},206572:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var i=n(161320),o=n.n(i);const r={_updateModel:function(e){e.note&&e.note.id&&this.set("id",e.note.id)},_getSyncData:function(e){switch(e){case"create":return{ACTION:"ADD_NOTE",NOTE_TYPE:this.get("type"),BODY:this.get("data").text,ELEMENT_ID:this.get("element_id"),ELEMENT_TYPE:4};case"update":return{ID:parseInt(this.get("id")),ACTION:"EDIT_NOTE",NOTE_TYPE:this.get("type"),BODY:this.get("data").text,ELEMENT_TYPE:4}}},_generateEmpty:function(){var e=APP.constant("user")||{};return{created_by:e.id,data:{text:"",params:{}},date_create:o()().unix(),deletable:!0,editable:!0,element_type:4,responsible_user_id:e.id,type:13,object_type:{code:"notes",id:5}}}};var s="../build/transpiled/interface/notes/models/mixins/task_result";window.define(s,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([s])},393455:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var i=n(629133),o=n.n(i),r=n(418860),s=[1,2,3,6,9,8,12,14,16,18,19,20,22,23,25,26,27,28,31,32,34,37],a=[1,2,3,14,20,24,26,57,62,63,64,69,70,88,94,95,97,98,99,100,118,120,135,136,137];const l=o().extend({},o().invert(APP.note_types),{15:"mail_message",6:"system_note",10:"call_in_out",11:"call_in_out",4:"note",9:"system_note",8:"system_note",14:"main_user_changed",16:"site_visit",18:"system_note",19:"system_note",20:"lead_auto_created",22:"customer_created",23:"transaction",62:"invoice",25:"service_message",26:"system_note",27:"system_note",57:"customer_status_changed",92:"merge",101:"dropbox",102:"sms",103:"sms",104:"mention",118:"invoice_created",24:"geolocation",28:"message_cashier",29:"payed_1c",31:"intent",32:"followed_link",33:"payed_quickbooks",34:"extended_service_message",35:"zoom_meeting",36:"bill_paid",tabula_note:"tabula_note",37:"key_action_completed",120:"talk_closed",135:"talk_marked_answered",136:"subscribed_to_notification",137:"unsubscribed_from_notification",_isSystem:function(e,t){return!!(o().contains(s,e)&&o().contains(["systemnotes","notes"],t)||o().contains(a,e)&&"event"===t)},_get:function(e,t,n){switch(!0){case"event"===t&&e===r.default.LEAD_ADDED_EVENT:return"lead_created";case"event"===t&&e===r.default.CONTACT_ADDED_EVENT:return"contact_created";case"event"===t&&e===r.default.COMPANY_ADDED_EVENT:return"company_created";case"event"===t&&e===r.default.CUSTOMER_ADDED_EVENT:return"customer_created";case"event"===t&&e===r.default.LEAD_STATUS_CHANGED_EVENT:return"lead_status_changed";case"opened_talks"===t:return"opened_talks";case"tasks"===t:return"task";case"event"===t&&(e===r.default.FIELD_CHANGED_EVENT||e===r.default.PRICE_CHANGED_EVENT||e===r.default.NAME_CHANGED_EVENT||e===r.default.LTV_CHANGED_EVENT):return"field_changed";case"event"===t&&(e===r.default.TAG_ADDED||e===r.default.TAG_DELETED):return"tag_event";case"event"===t&&e===r.default.TALK_CLOSED:return"talk_closed";case"event"===t&&e===r.default.TALK_READ:return"talk_marked_answered";case"event"===t&&(e===r.default.CHAT_VIDEO_OPENED||e===r.default.TAG_ADDED||e===r.default.TAG_DELETED||e===r.default.CHAT_VIDEO_OPENED||e===r.default.CHAT_VIDEO_CLOSED||e===r.default.CHAT_PICTURE_OPENED||e===r.default.CHAT_PICTURE_CLOSED||e===r.default.SUBSCRIBED_TO_NOTIFICATION||e===r.default.UNSUBSCRIBED_FROM_NOTIFICATION):return"system_note";case"event"===t&&(e===r.default.SEGMENT_ATTACHED||e===r.default.SEGMENT_DETACHED):return"segment_change";case"event"===t&&e===r.default.TRANSACTION_ADDED_EVENT:return"transaction";case"notes"===t&&(e===APP.note_types.invoice_paid||e===APP.note_types.bill_paid)&&n&&"QuickBooks"===n:return"payed_quickbooks";case"notes"===t&&e===APP.note_types.ai_result:return"ai_result";default:return this[e]}}});var d="../build/transpiled/interface/notes/templates";window.define(d,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([d])},429512:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(629133),o=n.n(i),r=n(214558),s=n(926168),a=n(445368),l=n(955026);const d={getCFTemplateParams:function(e,t){var n={},i={};return o().each(e,(function(e){"file"===e.type?n["".concat(t,".cf.").concat(e.id)]=o().propertyOf(e.values[0])("value"):n["".concat(t,".cf.").concat(e.id)]=o().pluck(e.values,"value").join("CHAINED_LIST"===e.code?" / ":", "),o().has(e,"code")&&o().contains(["PHONE","EMAIL","IM","SMART_ADDRESS"],e.code)&&(i={},o().each(e.values,(function(e){i.hasOwnProperty(e.code)||(i[e.code]=[]),i[e.code].push(e.value)})),o().each(i,(function(i,o){n["".concat(t,".cf.").concat(e.id,".").concat(o)]=i.join(", ")})))})),n},getEntityTemplateParams:function(e,t){var n,i={},s=APP.constant("lead_statuses")||{},d=(0,r.get)("inactive"),u=(0,r.get)(t.main_user_id),c=null;switch(u||(u=o().findWhere(d,{id:t.main_user_id.toString()})),i["".concat(e,".id")]=t.id,i["".concat(e,".name")]=t.name,u&&(i["".concat(e,".responsible")]=u.title,i["".concat(e,".responsible.id")]=u.id,i["".concat(e,".responsible.name")]=u.title,i["".concat(e,".responsible.email")]=u.login,i["".concat(e,".responsible.phone")]=u.phone),i=o().extend(i,this.getCFTemplateParams(t.custom_fields,e)),t.element_type){case APP.element_types.leads:c=s["s_".concat(t.status_id)],o().isUndefined(c)&&(c=o().propertyOf(s)([t.pipeline_id,"statuses","s_".concat(t.status_id)])||{}),n=t.price,n=(0,a.currency)(n,1,0,!1).trim(),n="".concat(n," ").concat(APP.system.locale.currency_symbol),i["".concat(e,".status")]=c.name||c.option||"",i["".concat(e,".price")]=n,i["".concat(e,".personal_page_link")]=o().propertyOf(o().values(APP.constant("card_element").statistic))(["0","personal_page_link"]);break;case APP.element_types.contacts:i["contact.first_name"]=t.first_name||t.name,i["contact.last_name"]=t.last_name||t.name,(0,l.hasKeys)(APP.constant("card_element"),["profiles","facebook","profile_avatar"])?i["contact.avatar"]=APP.constant("card_element").profiles.facebook.profile_avatar:t.avatar&&(i["contact.avatar"]=t.avatar);break;case APP.element_types.customers:n=t.next_price,n=(0,a.currency)(n,1,0,!1).trim(),n="".concat(n," ").concat(APP.system.locale.currency_symbol),i["".concat(e,".next_date")]=t.next_date,i["".concat(e,".next_price")]=n}return i},getTemplateParams:function(e){var t=this,n=(0,r.current)(),i={"profile.name":n.name,"profile.phone":n.personal_mobile},a=this.options.getExtraData(),l=[],d=o().first(a.elements)||{},u=o().last(a.elements)||{},c=e.entity_to_use;return u.element_type===APP.element_types.companies&&u!==d?l.push(d,u):l.push(d),o().each(l,(function(e){o().extend(i,t.getEntityTemplateParams((0,s.convertElementType)(e.element_type,"single"),e))})),c&&o().extend(i,this.getEntityTemplateParams((0,s.convertElementType)(c.element_type,"single"),c)),i}};var u="../build/transpiled/interface/notes/views/add/mixins/template_params";window.define(u,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([u])},915656:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var i=n(629133),o=n.n(i),r=n(184437),s=n(955026),a=n(500034),l=n(439182),d=n(704479);const u=d.default.extend({_selectors:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return o().extend({},d.default.prototype._selectors.apply(this,t),{editable_control:".js-control-contenteditable",textarea:"[contenteditable]",text_input:'[name="text"]',file_input:'[type="file"]',helper:".feed-compose__shortcuts-helper-wrapper"})},events:o().extend({},d.default.prototype.events||{},{"keyup [contenteditable]":"onKeyPressed","input [contenteditable]":"onInput"}),_getTemplate:function(){return"/tmpl/notes/adding/note/index.twig"},_generateEmptyModel:function(e){return e=e||this.options,new l.default({is_new:!0,object_type:{code:"notes",id:5},element_id:e.element_id,element_type:e.element_type,editable:!0,visible:!0})},setParamsOnSwitch:o().noop,getExistingText:function(){return this._form.model.get("text")},setTextFromAiHelpers:function(e){var t=e.text;(0,a.isFeatureAvailable)("ai_rewriter_fast_reply")&&(null==e?void 0:e.isAnswer)&&(t=this._elem("textarea").text()+(e.text||"")),this.setExistingText(t)},setExistingText:function(e){var t=e||this.options.text;e&&this._form.model.set("text",t),this._elem("textarea").text(t),this._elem("text_input").val(t),APP.is_touch_device||o().isUndefined(t)||!this._elem("textarea").is(":focus")||(0,r.setCursorToEnd)(this._elem("textarea")),this.toggleHelpers()},onFoldCompose:function(){this._initAttachWrap()},onOpenCompose:function(){this.$el.one("controls:view:init",this._selector("editable_control"),o().bind((function(){APP.is_touch_device||(0,r.setCursorToEnd)(this._findElem("textarea"))}),this))},initialize:function(e){e.models=[this._generateEmptyModel(e)],d.default.prototype.initialize.apply(this,arguments),this.models=[]},setMainId:function(e){this.model&&o().isFunction(this.model.set)&&this.model.set("element_id",e),this.options&&(this.options.element_id=e)},destroy:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];d.default.prototype.cancel.apply(this,t),d.default.prototype.destroy.apply(this,t)},onKeyPressed:function(e){38===e.keyCode&&this._isToggleSwitchAllowed()&&o().isFunction(this.options.toggleSwitcher)&&this.options.toggleSwitcher(),this.toggleHelpers()},onInput:function(){var e=this._elem("textarea").text();e||this.toggleAiRewrite(e)},toggleHelpers:function(){var e=this._elem("textarea").text();this.toggleAiRewrite(e),e?(this._elem("textarea").addClass("control-contenteditable__area--no-helper"),this._elem("helper").addClass("hidden")):(this._elem("textarea").removeClass("control-contenteditable__area--no-helper"),this._elem("helper").removeClass("hidden"))},toggleAiRewrite:function(e){(0,s.isOnlyLetters)(e.trim())&&e&&e.length<1e4?this._elem("ai_rewriter").removeClass("hidden"):this._elem("ai_rewriter").addClass("hidden")},getText:function(){return this.getExistingText()},_isToggleSwitchAllowed:function(){return!this._getMessageValue()},_getMessageValue:function(){return this._findElem("text_input").val()},_render:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];d.default.prototype._render.apply(this,t),this.$el.attr("data-dnd-before",APP.lang.notes_dnd_title_before).attr("data-dnd-after",APP.lang.notes_dnd_title_after).attr("class","js-note feed-compose_note"),this.initFieldsMention(),(0,a.isFeatureAvailable)("is_ai_functionality_enabled_in_feed")&&this.initRewriterControl()},cancel:o().noop,_setEditClick:o().noop,reset:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];d.default.prototype.cancel.apply(this,t)},resetCompose:function(){this._findElem("textarea").text("").trigger("indent:check"),this._findElem("text_input").val("").trigger("change"),this._form&&this._form.revert(),this._setChanges(!1),this.model=this._generateEmptyModel(),this.models=[]},_removeFileClick:function(){d.default.prototype._removeFileClick.apply(this,arguments),this._findElem("file_input")[0].value=""},validate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._form.model.get("text")||this._changes.files||(e=o().extend(e||{},{text:!1}),this.$el.addClass("note-has-error")),e},save:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this.model,r=(new Date).getTime()/1e3;return this.model.set("date_create",Math.floor(r)),this.model.set("msec_created_at",r),d.default.prototype.save.apply(this,t).then(o().bind((function(){this.model.set({is_new:!1,deletable:!0}).unset("visible"),!i.get("id")&&this.models[0]&&this.models[0].get("id")&&(i=this.models[0],this.models=o().without(this.models,this.models[0])),this.options.onAdd(o().flatten([o().extend(i.toJSON(),{_links:i.links}),o().map(this.models,(function(e){return o().extend(e.toJSON(),{_links:e.links})}))])),this.resetCompose()}),this))}});var c="../build/transpiled/interface/notes/views/add/note";window.define(c,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([c])},675920:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var i=n(629133),o=n.n(i),r=n(393455),s=n(632925);const a=s.default.extend({_getJoinedType:function(){switch(r.default._get(this.model.get("type"),this.model.get("object_type").code,"")){case"attachment":return"attachment";case"note":return"note";case"transaction":return"transactions";default:return"joined"}},_getTemplate:function(e){var t=this._getJoinedType();return e&&"transactions"!==t?s.default.prototype._getTemplate.apply(this,arguments):"/tmpl/notes/types/".concat(t,".twig")},_getRenderParams:function(){var e=o().map(this.models,(function(e){return o().extend(e.toJSON(),{_links:e.links})}));return o().extend(s.default.prototype._getRenderParams.apply(this,arguments),{joined:e})},toggleVisible:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=o().filter(this.models,(function(e){return!e.get("visible")}));"joined"===this._getJoinedType()&&i.length!==this.models.length?(this.el.style.display="",this.render()):s.default.prototype.toggleVisible.apply(this,t)}});var l="../build/transpiled/interface/notes/views/joined/joined";window.define(l,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([l])},704479:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var i=n(629133),o=n.n(i),r=n(214558),s=n(814095),a=n(675920);const l=a.default.extend({_files_remove:[],file_uploader_component:s.default,events:o().extend({},a.default.prototype.events||{},{"click .js-note-pinner":"togglePinClick"}),_getRenderParams:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=o().map(this.models,(function(e){return o().extend(e.toJSON(),{_links:e.links})})),r=this.model.links&&this.model.links.download&&this.model.links.download.href.match(/\.([a-z]{0,4})$/gi,"$1");return o().extend(a.default.prototype._getRenderParams.apply(this,t),{joined:o().map(o().filter(i,(function(e){return e.id!==this.model.id}),this),(function(e){var t=e._links.download&&e._links.download.href.match(/\.([a-z]{0,4})$/gi,"$1");return o().extend(e,{is_image:!!t&&o().contains([".png",".jpg",".jpeg",".gif"],t[0].toLowerCase())})})),is_image:!!r&&o().indexOf([".png",".jpg",".jpeg",".gif"],r[0].toLowerCase())>=0})},destroy:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._removeFilesEvents(),a.default.prototype.destroy.apply(this,t)},edit:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=null;o().isFunction(this.options.scrollUpdate)&&(i=this.options.scrollUpdate()),a.default.prototype.edit.apply(this,t),this._initAttachWrap(),o().isFunction(this._toggleAttachFileInput)&&this._toggleAttachFileInput(),o().isFunction(i)&&(this.model.trigger("notes:update-sticky"),i())},cancel:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._removeFilesEvents(),a.default.prototype.cancel.apply(this,t)},_removeFilesEvents:function(){this.file_uploader&&(this._destroyComponent(this.file_uploader),this.file_uploader=null)},removeFile:function(e){var t=this.file_uploader&&this.file_uploader.attachments_collection&&this.file_uploader.attachments_collection.length;e&&(this._files_remove=this._files_remove.concat(o().filter(this.models,(function(t){return(t.id||"").toString()===e.toString()})))),this._setChanges({files:Boolean(this.model.id)||Boolean(t)})},_initAttachWrap:function(){this._removeFilesEvents(),this._setChanges({files:!1}),this.file_uploader=this._addComponent(this.file_uploader_component,this.getOptionsFileUploader())},getOptionsFileUploader:function(){return{el:this.$el,url_upload:this.getUploadUrl(),onCompleteUploadFile:o().bind(this.onCompleteUploadFile,this),onRemoveFile:o().bind(this.removeFile,this),onBeforeUploadFile:o().bind(this._destroyFileAndUpdateModels,this),getEditing:o().bind((function(){return this._editing}),this),onAddAttach:o().bind((function(){this._setChanges({files:!0})}),this)}},getUploadUrl:function(){return["/private/notes/upload.php?ACTION=ADD_NOTE&",this.model.get("element_id")?"ELEMENT_ID=".concat(this.model.get("element_id")):"TEMP=Y","&ELEMENT_TYPE=",this.model.get("element_type")].join("")},_copyFormToModel:function(){this.model.set("data",o().extend(this.model.get("data"),{text:this._form.model.get("text")}))},onCompleteUploadFile:function(e,t,n){var i=this.model.clone();i.set({id:null,is_new:!1,editable:!0,deletable:!0,date_create:this.model.get("_date_create")||this.model.get("date_create"),created_by:(0,r.current)("id"),type:APP.note_types.attachment,params:e.note.params,data:{text:e.note.params.text,params:e.note.params}}),i.links=e.note.links||{download:{href:"/download/".concat(e.note.params.link)}},this.model.collection&&this.model.collection.add(i),i.save().then((function(){t()}),(function(){n()})),this.models.push(i)},_destroyFileAndUpdateModels:function(){return o().map(this._files_remove,(function(e){return e.destroy().then(o().bind((function(e){this.models=o().without(this.models,e),this._files_remove=o().without(this._files_remove,e)}),this,e))}),this)},togglePinClick:function(e){var t=this.options.scrollUpdate(),n=o().find(this.models,(function(e){return e.id}));e.stopPropagation(),o().forEach(this.models,(function(e){e.set("pinned",!e.get("pinned")),e.id&&e.pin()})),this._render(),n.trigger("note:view:update",n),t()},updateUploadUrl:function(){this.file_uploader.url_upload=this.getUploadUrl()},save:function(){return this._findElem("submit").trigger("button:load:start",["white"]),new Promise(o().bind((function(e,t){if(!o().isEmpty(this.validate()))return this._findElem("submit").trigger("button:load:stop"),void t();this.model._pending?t("Already saving"):(this.updateUploadUrl(),this.file_uploader.uploadFiles().then(o().bind((function(){for(var n=this,i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];this._changes.form?0===this.model.get("element_id")?setTimeout((function(){a.default.prototype.save.apply(n,o).then(e,t)}),0):a.default.prototype.save.apply(this,o).then(e,t):(this._findElem("submit").trigger("button:load:stop",["white"]),this.cancel(),e())}),this),t))}),this))}});var d="../build/transpiled/interface/notes/views/joined/note";window.define(d,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([d])},386769:(e,t,n)=>{n.r(t),n.d(t,{TIP_RENDER_TYPE:()=>v,default:()=>x});var i=n(629133),o=n.n(i),r=n(460159),s=n.n(r),a=n(809228),l=n.n(a),d=n(445368),u=n(214558),c=n(500034),_=n(474564),p=n(673951),h=n(210734),f=n(580326),m=n(761634),g=n(567042),y=n(661533),v={up:"up",down:"down"},b=".feed-note__content .js-feed-note__date, .card-task__date",E=".control-emoji-reactions-buble-wrapper",w="feed-context-menu__controller";o().once((function(){return h.default.forceDirectiveLoad("js-tip-holder",document.createElement("div"))}))();const x={events:{"click .js-feed-note__date":"onContextMenuOverDate","mouseenter .js-feed-note__date":"onContextMenuOverDate","mouseleave .js-feed-note__date":"onContextMenuLeaveDate","mouseenter .card-task__date":"onContextMenuOverDate","mouseleave .card-task__date":"onContextMenuLeaveDate"},onContextMenuOverDate:function(e){var t=this,n=y(e.currentTarget),i=n.closest(".feed-note__content, .card-task__inner");clearTimeout(this._context_menu_leave_menu_tt),clearTimeout(this._context_menu_show_timeout),e.stopPropagation&&e.stopPropagation(),this._$context_menu_date_target&&this._$context_menu_date_target.get(0)!==n.get(0)&&this.hideContextMenuTip(),i.hasClass("quotation__message_type-text")||this.$context_menu_tip||(this.initContextMenuTip(),(0!==this.context_menu_tip_items.length||this.isReactionSupported())&&(this._$context_menu_date_target=n,n.addClass(w),this._context_menu_show_timeout=o().delay((function(){clearTimeout(t._context_menu_show_timeout),t.showContextMenuTip()}),100)))},onContextMenuLeaveDate:function(){var e=this;clearTimeout(this._context_menu_show_timeout),this._context_menu_leave_date_tt=setTimeout((function(){return e.hideContextMenuTip()}),200)},onContextMenuWrapperClick:function(e){e.stopPropagation()},showContextMenuTip:function(){var e=this;if(this.$context_menu_tip=y(s()({ref:"/tmpl/notes/defaults/context_menu.twig"}).render({items:this.context_menu_tip_items})),this.$context_menu_tip.on("mouseleave",E,(function(t){return e.onContextMenuLeaveHide(t)})).on("click",".feed-note__reaction",(function(t){return e.onContextMenuToggleReaction(t)})).on("click",".feed-context-menu__item.js-tips-item",(function(t){return e.onContextMenuItemClick(t)})).on("mouseover",(function(t){return e.onContextMenuMouseOver(t)})).on("mouseleave",(function(t){return e.onContextMenuLeaveHide(t)})).on("click",(function(t){return e.onContextMenuWrapperClick(t)})),this.$context_menu_tip_inner=this.$context_menu_tip.children(),this._$body.append(this.$context_menu_tip),this.isReactionSupported()){var t=o().propertyOf(this.model.get("recipient")||this.model.get("author"))("origin");this.emoji_reactions=this._addComponent(p.default,{origin:t,supported_reactions:this.supported_reactions,el:this.$context_menu_tip,message_id:this.model.get("id"),tipMenuHide:o().bind(this.hideContextMenuTip,this),blockScroll:o().bind(this._onIntentOpenedBlockScroll,this)})}var n=this.setContextMenuTipPosition();this.$context_menu_tip_inner.trigger("tip:show"),this.$context_menu_tip.trigger("reaction:show",[n]).addClass("tips_slide-down"),this.hasContextMenuCopyItem()&&(this._context_menu_copy_link=this.initContextMenuCopyLink())},onContextMenuMouseOver:function(){clearTimeout(this._context_menu_leave_menu_tt),clearTimeout(this._context_menu_leave_date_tt)},hideContextMenuTip:function(){this._context_menu_copy_link&&(this._context_menu_copy_link.destroy(),this._context_menu_copy_link=null),(this._$context_menu_date_target||this.$(b)).removeClass(w),this._$context_menu_date_target=null,this.$context_menu_tip&&(this.$context_menu_tip.trigger("bubble:hide").remove(),this.$context_menu_tip=null),o().isFunction(this._onIntentClosedUnblockScroll)&&this._onIntentClosedUnblockScroll()},onContextMenuLeaveHide:function(e){var t=this;y(null==e?void 0:e.relatedTarget).closest(E).length||y(null==e?void 0:e.relatedTarget).closest(".feed-context-menu__wrapper").length||(this._context_menu_leave_menu_tt=setTimeout((function(){return t.hideContextMenuTip()}),200))},onContextMenuItemClick:function(e){e.stopPropagation();var t=y(e.currentTarget).attr("data-type");this.onContextMenuClick(t),"copy_link"!==t&&this.hideContextMenuTip()},isInstagramComment:function(){return(0,c.isFeatureAvailable)("ig_replies_to_comments")&&o().propertyOf(this.model.get("message_attributes"))(["facebook","comment_url"])&&"instagram_business"===o().propertyOf(this.model.get("author"))("origin")},isCustomPostComment:function(){var e=o().propertyOf(this.model.get("message_attributes"))(["custom","post","url"]),t=o().propertyOf(this.model.get("message_attributes"))(["custom","thread_last_message_at"]),n="amocrm"!==o().propertyOf(this.model.get("author"))(["origin"]);return(e||t)&&n},isIncoming:function(){var e=f.AmoJoMediator.get()[this.model.get("chat_id")]||{contacts:{},users:{}},t=this.model.get("author");return t&&Boolean(e&&e.contacts[t?t.id:0])},isAiResponseAvailable:function(){var e;return(0,c.isFeatureAvailable)("is_customization_for_global")&&(0,c.isFeatureAvailable)("is_ai_functionality_enabled_in_feed")&&(0,c.isFeatureAvailable)("ai_answer")&&this.model.get("text")&&(null===(e=this.model.get("dialog"))||void 0===e?void 0:e.id)},isAvailableForChatting:function(){var e,t=(0,m.get)()[null===(e=this.model.get("author"))||void 0===e?void 0:e.id];return!t||t.is_available_for_chatting},hasContextMenuCopyItem:function(){return this.model.get("can_be_retrieved_by_url")},hasContextMenuQuoteItem:function(){return this.model.get("can_be_replied")||this.model.get("can_be_forwarded")},hasContextMenuForwardItem:function(){return this.model.get("chat_id")&&this.model.get("author")&&this.options.type!==g.default.TYPE_DIRECT},initContextMenuTip:function(){var e=o().propertyOf(this.model.get("author"))("id")===(0,u.current)("amojo_id"),t=this.hasContextMenuCopyItem(),n=this.hasContextMenuQuoteItem(),i=this.hasContextMenuForwardItem(),r=this.isInstagramComment(),s=this.isCustomPostComment(),a=r||s,l=this.isAiResponseAvailable(),c=this.isAvailableForChatting();this.context_menu_tip_items=[],r&&this.model.get("can_be_replied")&&(this.context_menu_tip_items.push({class_name:"feed-context-menu__item",id:"answer-to-comment",text:(0,d.i18n)("Reply with comment"),svg_icon:"inbox--comment-thread",additional_data:'data-type="answer_to_comment"'}),this.context_menu_tip_items.push({class_name:"feed-context-menu__item",id:"add-reply",text:(0,d.i18n)("Reply with message"),svg_icon:"inbox--meta-logo",additional_data:'data-type="answer_to_direct"'})),s&&(this.context_menu_tip_items.push({class_name:"feed-context-menu__item",id:"answer-to-comment",text:(0,d.i18n)("Reply with comment"),svg_icon:"inbox--comment-thread",additional_data:'data-type="answer_to_comment"'}),this.context_menu_tip_items.push({class_name:"feed-context-menu__item",id:"add-reply",text:(0,d.i18n)("Reply with message"),svg_icon:"inbox--bubble",additional_data:'data-type="answer_to_direct"'})),!e&&!a&&n&&c&&this.context_menu_tip_items.push({class_name:"feed-context-menu__item",id:"add-reply",text:(0,d.i18n)("mail_letter_reply"),svg_icon:"inbox--reply",additional_data:'data-type="add_reply"'}),i&&this.context_menu_tip_items.push({class_name:"feed-context-menu__item",id:"add-quotation",text:(0,d.i18n)("Forward"),svg_icon:"inbox--quotation",additional_data:'data-type="add_quotation"'}),l&&this.context_menu_tip_items.push({class_name:"feed-context-menu__item",id:"generate-response",text:(0,d.i18n)("Generate response"),svg_icon:"inbox--summarize",additional_data:'data-type="generate_response"'});var _=o().result(this,"getContextMenuLinkTo","");t&&_&&this.context_menu_tip_items.push({class_name:"feed-context-menu__item",id:"copy_link",text:'<span class="js-copy-text">'.concat((0,d.i18n)("Copy link"),"</span>"),svg_icon:"inbox--copy-link",should_be_raw:!0,additional_data:'data-type="copy_link" data-clipboard-text="'.concat(this.getContextMenuLinkTo(),'"')}),this.supported_reactions=this.model.get("supported_reactions")||{}},onContextMenuToggleReaction:function(e){var t=y(e.currentTarget),n=t.data("emoji"),i=t.find(".feed-note__reaction-avatar-container"),r=o().map(i,(function(e){return y(e).data("user-id")})),s=o().contains(r,APP.constant("user").amojo_id)?"":n;(0,_.sendReaction)(this.model.get("id"),s).subscribe({error:function(){t.addClass("animated shake"),o().delay((function(){t.removeClass("animated shake")}),200)}})},setContextMenuTipPosition:function(){var e,t=this._$context_menu_date_target||this.$(b),n=t.offset(),i=Math.round(n.top),o=Math.round(n.left),r=t.height(),s=this.$context_menu_tip_inner.height()+((null===(e=this.emoji_reactions)||void 0===e?void 0:e.reactions_height)||0)+40,a=i+r-(parseInt(this.$context_menu_tip.css("padding-top"))+2),l=this._$window.height();return a+s<l?(this.$context_menu_tip.css({left:o,top:a}),v.down):(this.$context_menu_tip.addClass("feed-context-menu__wrapper-up"),this.$context_menu_tip.css({left:o,bottom:l-i-20}),v.up)},initContextMenuCopyLink:function(){var e=this,t=new(l())(this.$context_menu_tip.find('[data-type="copy_link"]').get(0));return t.on("success",(function(t){var n=y(t.trigger).find(".js-copy-text"),i=n.text();n.css("width",n.width()).text((0,d.i18n)("Copied")),setTimeout((function(){n.text(i).css("width",""),e.hideContextMenuTip()}),1e3)})),t},isReactionSupported:function(){return this.model.get("can_be_reacted")&&!o().isEmpty(this.supported_reactions)},onContextMenuClick:function(){}};var T="../build/transpiled/interface/notes/views/mixins/context_menu";window.define(T,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([T])},330985:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var i=n(629133),o=n.n(i),r=n(845043);const s={events:{"click .js-note-delete-btn":"delete"},delete:function(e){var t=this;return!0===this.model.get("deletable")&&(e=o().isString(e)?e:APP.lang["note_delete_msg".concat("tasks"===this.model.get("object_type").code?"_task":"")],this.$el.trigger("actions:toggle",[!1]),new r.default({class_name:"modal-list",text:e,accept:function(){var e=this;e.requestStart(),Promise.all(o().map(t.models,(function(e){return e.destroy({wait:!0})}))).then((function(){e.requestSuccess(APP.lang.multiple_delete_success_msg)}),(function(t){t&&t.response&&t.response.error_message?e.requestFail(t.response.error_message,!1):e.requestFail()}))}})),!1}};var a="../build/transpiled/interface/notes/views/mixins/deletable";window.define(a,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([a])},674853:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var i=n(629133),o=n.n(i),r=n(267651),s=n.n(r),a=n(500034),l=n(445227),d=n(353256),u=n(661533),c=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0]&&t[0].stopPropagation&&t[0].stopPropagation()};const _={_uneditable_selector:":input, label",events:{keydown:"hotkeys","click .js-note":"_setEditClick","click .js-note-edit-mode-btn":"_setEditClick","click .js-note-edit-cancel":"cancel","click .js-note-add-cancel":"cancel","click .js-note-submit:not(.button-input-disabled)":"save","click .js-note-delete-btn":"delete","focus textarea":"_putCursorToEnd"},hotkeys:function(e){switch(!0){case 27===e.keyCode:this.cancel();break;case 13===e.keyCode&&(e.ctrlKey||e.metaKey):this.save()}},cancel:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];c.apply(this,t),this._editing=!1,this._form&&(this._form.revert(),this._form.destroy(),this._form=null),this._setChanges(!1),this._render(),this.model.trigger("notes:update-sticky")},_setEditClick:function(e){var t=u(e.target),n=t.add(e.target.parentNode).add(e.target.parentNode.parentNode),i=t.closest(".amo-player-container").length;!n.is(this._uneditable_selector)&&!this.isEditable()||n.is("a")||i||e.stopPropagation(),n.is("a, :input, label")||!this.isEditable()||i||(this._$document.trigger({type:"controls:hide",target:this.el}),this.setEdit())},setEdit:function(){!this._editing&&this.isEditable()&&(o().isFunction(this.options.onEdit)?this.options.onEdit(this):this.edit())},_setChanges:function(e){o().isBoolean(e)&&!1===e?this._changes={}:o().extend(this._changes,e),this._highlightSave(this.hasChanges())},hasChanges:function(){return o().chain(this._changes).values().compact().value().length},_copyFormToModel:function(){this.model.set("data",o().extend({},this.model.get("data"),{text:this._form.model.get("text")}))},save:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(c.apply(this,t),this.model._pending||!o().isEmpty(this.validate()))return new Promise(o().bind((function(e,t){this._findElem("submit").trigger("button:load:stop"),t("Model is loading or no changes")}),this));((0,a.isFeatureAvailable)("airewriter")||(0,a.isFeatureAvailable)("kommo_ai_trial_started")&&!(0,a.isFeatureAvailable)("kommo_ai_trial_ended"))&&s().publish(d.FEED_COMPOSE_SUBMIT),this._findElem("submit").trigger("button:load:start",["white"]),this._copyFormToModel(),this._findElem("cancel").hide();var i=function(){this._findElem("submit").trigger("button:load:stop"),this._findElem("cancel").show()};return this.model.save().then(o().bind(i,this),o().bind(i,this)).then(o().bind(this.cancel,this))},edit:function(e){this.toggleActions&&this.toggleActions(!1),this._editing=!0,this._changes={},this._render("edit"),APP.is_touch_device||!1===e||this.$("textarea").trigger("controls:textarea:autosize").focus(),this._initForm()},_initForm:function(){this._changes={},this._form=this._addComponent(l.default,{el:this.el}),this._form.model.on("has_changes has_reverted",o().bind((function(e){e&&this._setChanges({form:"has_changes"===e.type})}),this),this)},_highlightSave:function(e){var t=this._findElem("submit");!1===e&&t.trigger("button:load:stop"),t.trigger("button:".concat(e?"enable":"disable"))},_putCursorToEnd:function(e){var t,n=e.currentTarget,i=u(n),r=i.is("[contenteditable]")?"text":"val";n.setSelectionRange?(t=2*i[r]().length,o().delay((function(){n.setSelectionRange(t,t)}),1)):i[r](i[r]()),n.scrollTop=999999},validate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._form.model.get("text")||(e=o().extend(e||{},{text:!1}),this.$el.addClass("note-has-error")),e},isEditable:function(){var e,t,n="editable";return"tasks"===this.model.get("object_type").code&&(t=!!(e=1===this.model.get("status"))&&this.model._getResult(),(!e||e&&!t)&&(n="completable")),!0===this.model.get(n)}};var p="../build/transpiled/interface/notes/views/mixins/editable";window.define(p,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([p])},465890:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var i=n(629133),o=n.n(i),r=n(817932),s=n(498457);const a={initialize:function(){var e=this;this.listenTo(this.model,"search:highlight:init",(function(t){e.model.set("_search_highlights",t,{silent:!0})})).listenTo(this.model,"search:highlight:set",(function(t){e.model.set("_search_highlights",t,{silent:!0}),e._render()})).listenTo(this.model,"search:highlight:unset",(function(){e.model.unset("_search_highlights",{silent:!0}),e._render()}))},_getHighlightParams:function(){if(!this.model.get("_search_highlights"))return{};var e=(0,r.processHighlights)(this._getTextToHighlight(),this.model.get("_search_highlights"));return{search_highlight_active:!0,search_highlighted:this._getPreparedHighlightedString((0,s.default)(e))}},_getTextToHighlight:function(){var e=o().propertyOf(this.model.get("object_type"))("code");switch(!0){case!o().isUndefined(this.model.get("chat_id")):return o().propertyOf(this.model.get("message"))("text")||"";case"tasks"===e:case"notes"===e:return o().propertyOf(this.model.get("data"))("text")||"";default:return""}},_getPreparedHighlightedString:function(e){return o().reduce(e,(function(e,t){if(o().keys(t).length){var n=t.value.split("\n");e+=o().map(n,(function(e,t){var i="";return e&&(i+='<span style="background: yellow; color: #000">'.concat(e,"</span>")),t!==n.length-1&&(i+="\n"),i})).join("")}else e+=t;return e}),"")}};var l="../build/transpiled/interface/notes/views/mixins/search_highligter";window.define(l,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([l])},315819:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var i=n(827378),o=n.n(i),r=n(937634),s=n(460159),a=n.n(s);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function d(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);s=!0);}catch(e){a=!0,o=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const c={renderTemplateInfo:function(e,t){return(i=function(){var i,r,s,l,d,c,_;return function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(p){switch(p.label){case 0:return i=t.template,r=i.id,s=i.pricingType,l=t.onTemplateFetched,[4,Promise.all([Promise.all([n.e(70013),n.e(17815),n.e(24402),n.e(4623)]).then(n.bind(n,843019)),a()._preload(["langs/feedTemplateInfo"])()])];case 1:return d=u.apply(void 0,[p.sent(),1]),c=d[0].TemplateInfo,_=o().createElement(c,{id:r,pricingType:s,onTemplateFetched:l}),e.render(_),[2]}}))},function(){var e=this,t=arguments;return new Promise((function(n,o){var r=i.apply(e,t);function s(e){d(r,n,o,s,a,"next",e)}function a(e){d(r,n,o,s,a,"throw",e)}s(void 0)}))})();var i},mountTemplateInfo:function(e){var t=e.el,n=r.createRoot(t);return this.renderTemplateInfo(n,e),function(){n.unmount()}}};var _="../build/transpiled/interface/notes/views/mixins/templateInfo";window.define(_,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([_])},15813:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var i=n(629133),o=n.n(i),r=function(e){return"tasks"===e.get("object_type").code&&!e.get("status")};const s={events:{"mouseenter .js-note-context":"maybeSomeActionsYes","mouseleave .js-note-context":"maybeSomeActionsNo",swipe:"switchActionsSwipe","actions:toggle":"toggleActionsTrigger"},switchActionsSwipe:function(e,t,n){1===t&&0===n&&this.toggleActions(!1),-1===t&&0===n&&this.maybeSomeActionsYes()},maybeSomeActionsYes:function(){var e=this.$el.find(".feed-note__context");!o().find(this.models,(function(e){return e.id}))||r(this.model)||this._editing||(this.$el.addClass("fixed"),e.addClass("feed-note__context_opened"))},maybeSomeActionsNo:function(){this.$el.addClass("fixed").find(".feed-note__context").removeClass("feed-note__context_opened")},toggleActionsTrigger:function(e,t){t=o().isBoolean(t)?t:!this.$el.hasClass("hovered"),this.toggleActions(t)},toggleActions:function(e){!this.model.get("editable")&&!this.model.get("deletable")||this._editing||!o().find(this.models,(function(e){return e.id}))||r(this.model)||(e?this.$el.addClass("hovered"):this.$el.removeClass("hovered fixed").find(".feed-note:first").css(Modernizr.prefixed("transform"),""))}};var a="../build/transpiled/interface/notes/views/mixins/togglable";window.define(a,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([a])},632925:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var i=n(661533),o=n.n(i),r=n(629133),s=n.n(r),a=n(460159),l=n.n(a),d=n(162262),u=n.n(d),c=n(313981),_=n(323344),p=n(214558),h=n(129578),f=n(450422),m=n(500034),g=n(804317),y=n(393455),v=n(15813),b=n(674853),E=n(330985),w=n(429512),x=n(465890),T=n(386769),A=n(315819),C=n(343808),P=n(595689);function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(565672);var S=s().invert(APP.note_types),O=s().invert(APP.element_types),I=[];o()(window).on("resize",s().debounce((function(){s().each(I,(function(e){e.checkHeaderExpander()}))}),150));var N=c.default.extend({className:"feed-note-wrapper",events:{"click .js-note-toggle":"toggleText","click .feed-note__header.expandable":"expandHeader","click .js-amojo-reply":"onAmoJoReplyClick","mouseover .feed-note__delivery-status":"handleDeliveryStatusHover","paste .control-contenteditable__area":"_handlePaste"},_selectors:function(){return{submit:".js-note-submit, .js-task-submit, .js-todo-result, .js-task-result-button",cancel:".js-note-edit-cancel, .js-task-edit-cancel",header:".feed-note__header",header_inner:".feed-note__header-inner",input:".js-control-contenteditable-input",contenteditable:".control-contenteditable__area",info_bubble:".info-bubble",ai_rewriter:".js-feed-airewriter",file_input:'input[type="file"]',templateInfo:".js-template-info"}},_classes:function(){return{animate_entrance:"feed-note-wrapper_animate-entrance"}},initialize:function(e){var t,n;c.default.prototype.initialize.apply(this,arguments),e=e||{},this.models=e.models||[],this.options=s().pick(e,(function(e,t){return"models"!==t})),!this.model&&e.models&&(this.model=e.models[0]),s().each(this.models,(function(i){i.get("element_id")||(t=i.get("linked"),n=t&&t.id||e.element_id,i.set("element_id",n))}),this),s().each(this.models,(function(e){this.listenTo(e,"change:visible",this.toggleVisible),this.listenTo(e,"render",s().bind(this._reRenderFromEvent,this)),this.listenTo(e,"destroy",s().bind((function(){1===this.models.length&&this.model===e||2===this.models.length&&this.model.isNew()?this.destroy(!0):(this.models=s().without(this.models,e),this.render(),e===this.model&&(this.model=s().first(this.models)))}),this))}),this),this.model.get("visible")||this.toggleVisible(),I.push(this),u().mixin(this,w.default)},destroy:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=I.indexOf(this);i>-1&&I.splice(i,1),c.default.prototype.destroy.apply(this,t),s().isFunction(this.options.onDestroy)&&this.options.onDestroy(this),s().isFunction(this.unmountTemplateInfo)&&this.unmountTemplateInfo()},_handlePaste:function(e){(0,g.pasteFiles)({event:e,fileInput:this._elem("file_input").get(0)})},initRewriterControl:function(){var e=this;!this.ai_rewriter_control&&s().contains(["chat","note"],this.options._type)&&(this.ai_rewriter_control=this._addComponent(P.default,{el:this._elem("ai_rewriter"),getText:function(){return e.getText()},setText:function(t){return e.setExistingText(t)},onLoad:this.options.toggleComposeLoader}))},toggleAiRewriter:function(e){e?this.initRewriterControl():this.ai_rewriter_control&&(this.ai_rewriter_control.destroy(),this.ai_rewriter_control=null)},initFieldsMention:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.options.getMainContactId(),t=this.getTemplateParams({entity_to_use:s().findWhere(this.options.getExtraData().elements,{id:e})}),n=[],i=(0,h.getFieldsAsObject)(!1);this._fields_mention&&this._destroyComponent(this._fields_mention),s().each(t,(function(e,t){t="{{".concat(t,"}}"),s().isUndefined(i[t])||n.push({id:e,option:i[t].name,sort:i[t].sort,element_type:i[t].element_type})})),this._fields_mention=this._addComponent(C.default,{input:this._elem("input"),contenteditable:this._elem("contenteditable"),should_put_value:!0,mentions:n})},_getTemplateName:function(){var e=this.model.get("object_type")||{},t=this.model.get("data")||{},n=t&&t.params&&t.params.service||null;return y.default._get(this.model.get("type"),e.code,n)},_getTemplate:function(e){var t="/tmpl/notes/types/".concat(this._getTemplateName(),".twig");return"edit"===e&&(t="/tmpl/notes/defaults/note_edit.twig"),t},_getRenderClassName:function(){return[]},_getUsers:function(){var e=this.options.getExtraData(this.model).users;return s().isEmpty(e)?s().reduce((0,p.get)()||{},(function(e,t){return e[t.id]=s().extend({},t,{full_name:t.option}),e}),{}):e},_getRenderParams:function(e){return s().extend({},this.model.toJSON(),{is_edit:"edit"===e,note_types:S,main_element_type:this.options.element_type,element_type_code:O[this.model.get("element_type")],template:this._getTemplateName(),is_free_user:APP.constant("user_rights").is_free_user,current_user_id:(0,p.current)("id"),hide_linked:this.isLinkedFieldHidden(),_links:this.model.links,system_props:{need_msec:(0,p.current)("settings").need_msec||!1},extra:s().extend(this.options.getExtraData(this.model),{users:this._getUsers()})})},_reRenderFromEvent:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;this._render.apply(this,function(e){if(Array.isArray(e))return k(e)}(i=t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())},render:function(){return l()._preload(["/tmpl/notes/wrapper.twig"],s().bind(this._render,this))()},_render:function(e){var t,n=this,i=this.model.get("object_type")||{},r=this.$el.hasClass(this._class("animate_entrance"))?this._class("animate_entrance"):"";this.el.className=s().union([this.className,"".concat(this.className,"-").concat(this._getTemplateName()),r],this._getRenderClassName(e)).join(" "),this.el.style.height="";var a=s().clone(this._getRenderParams(e));a.joined=s().sortBy(a.joined,(function(e){return e.data.text}));var d=this._getHighlightParams();this.el.innerHTML=l()({ref:this._getTemplate(e)}).render(s().isEmpty(d)?a:o().extend(!0,{},a,d)),s().isFunction(this._addSubscribers)&&this._addSubscribers(a),y.default._isSystem(this.model.get("type"),i.code,this.model.get("note_type"))&&this.el.classList.add("".concat(this.className,"_system")),"edit"===e&&this.el.classList.add("".concat(this.className,"-in-edit")),this.model.get("id")&&this.$el.attr("data-id",this.model.get("id")),(null===(t=a.template)||void 0===t?void 0:t.external_id)&&(0,m.isFeatureAvailable)(m.Features.IS_CUSTOMIZATION_FOR_GLOBAL)&&(this.unmountTemplateInfo=this.mountTemplateInfo({el:this._findElem("templateInfo").get(0),template:{id:a.template.external_id,pricingType:a.pricing_type},onTemplateFetched:function(e){if(e&&e.type){var t=n.model.get("template")||{};n.model.set("template",(i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){D(e,t,n[t])}))}return e}({},t),o=null!=(o={templateType:e.type})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(o)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(o,e))})),i))}var i,o}})),!this.model.collection||this.el.parentNode&&"[object DocumentFragment]"!==this.el.parentNode.toString()?this._afterRender(e):this.model.collection.once("views:tasks:autosize views:added",s().bind(this._afterRender,this,e))},_afterRender:function(){var e=this;setTimeout((function(){e.checkHeaderExpander()}))},isLinkedFieldHidden:function(){return!(!(0,f.isAmoChatsFullEnabled)()||"contacts"!==O[this.model.get("element_type")])},toggleVisible:function(){this.model.get("is_add")||(this.el.style.display=this.model.get("visible")?"":"none")},onAmoJoReplyClick:function(e){e.stopPropagation(),this.model.trigger("notes:compose:switch","chat",{user_id:o()(e.currentTarget).attr("data-id")})},handleDeliveryStatusHover:function(e){var t=o()(e.currentTarget).find(this._selector("info_bubble"));if(t.length){t.css("width","max-content"),t.removeClass("info-bubble--below");var n=this.$el.offset().left+10,i=t.offset().left,r=t.outerWidth();if(n>i){var s=Math.min(Math.round(r+i-n),425);t.css("width",s)}else r>425&&t.css("width",425);t.offset().top<0&&t.addClass("info-bubble--below")}},toggleText:function(e){var t=o()(e.currentTarget);e.preventDefault(),t.parent().hide().siblings().show(),this.model.trigger("notes:update-sticky")},expandHeader:function(){this._findElem("header").toggleClass("expanded"),this._findElem("header_inner").toggleClass("h-feed-note__header-expanded")},checkHeaderExpander:function(){if(y.default._isSystem(this.model.get("type"),(this.model.get("object_type")||{}).code)){var e=this._findElem("header_inner");e.length&&this._findElem("header").toggleClass("expandable",e[0].scrollWidth>e[0].offsetWidth)}},getContextMenuLinkTo:function(){var e=this.model.id,t=this.model.get("msec_created_at")||this.model.get("created_at")||this.model.get("date_create"),n=(0,_.removeQueryParam)(["t","tid","cid"]);return window.location.origin+window.location.pathname+(0,_.setQueryParam)({t,tid:e},{query_string:n,only_query_string:!0})}});u().mixin(N,v.default,b.default,E.default,x.default,T.default,A.default);const M=N;var R="../build/transpiled/interface/notes/views/note";window.define(R,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([R])},817932:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p,processHighlights:()=>_});var i=n(629133),o=n.n(i),r=n(827378),s=n.n(r),a=n(577486),l=n(296760);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function u(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var c=function(e,t){var n=e.split(new a.UnsafeRegExp(t,"i"));return 1===n.length?n:o().reduce(n,(function(e,i,o){return o===n.length-1?(e.push(i),e):(e.push(i,{value:t}),e)}),[])},_=function(e,t){var n,i,r=function(e,t){return o().reduce(t,(function(t,n,i){var r;return i?o().reduce(t,(function(e,t){var i;if(o().isObject(t))return e;var r=e.indexOf(t),s=c(t,n);return(i=e).splice.apply(i,[r,1].concat(u(s))),e}),u(t)):((r=t).push.apply(r,u(c(e,n))),t)}),[])}(e,t);return n=r,i=o().reduce(n,(function(e,t,n){var i=e[e.length-1];return n?o().isObject(t)?o().isObject(i)?(i.value+=t.value,e):(e.push(t),e):!t.trim()&&o().isObject(i)?(i.value+=t,e):(e.push(t),e):(e.push(t),e)}),[]),o().compact(i)};const p=function(e){var t=e.children,n=e.highlights,i=e.className,r=void 0===i?"":i,a=e.markClassName,d=e.converters,u=void 0===d?[]:d,c=e.lengthRef,p=function(e,t){return o().reduce(t,(function(e,t){return t(e)}),e)}(_(t,n),u);return c&&(c.current=o().reduce(p,(function(e,t){return o().isObject(t)?e+t.value.length:e+t.length}),0)),s().createElement("span",{className:r},o().map(p,(function(e,t){return o().isObject(e)?s().createElement(l.default,{className:a,key:t},e.value):s().createElement("span",{key:t},e)})))}},296760:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var i=n(827378),o=n.n(i);const r=function(e){var t=e.children,n=void 0===t?"":t,i=e.className,r=void 0===i?"":i;return o().createElement("span",{className:r,style:{background:r?void 0:"var(--palette-highlight-mark-background)",color:r?void 0:"var(--palette-highlight-mark-text-color)"}},n)}},498457:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var i=n(629133),o=n.n(i),r=function(e){var t=e.match(/<a/);return o().isNull(t)||!o().isNumber(t.index)?-1:t.index},s=function(e){var t=e.match(/<a .+>/);return o().isNull(t)||!o().isNumber(t.index)?-1:t.index};const a=function(e){return o().reduce(e,(function(e,t,n){var i=e.length-1,a=e[i];return n?o().isString(t)&&o().isString(a)?(e[i]=a+t,e):o().isObject(t)&&o().isString(a)&&function(e){for(var t="open",n=!1,i=!1,o=0;e&&o>-1;)(o="open"===t?r(e):s(e))>-1&&"open"===t?n=!0:o>-1&&"closed"===t&&(i=!0),n&&i?(e=e.slice(o+2),n=!1,i=!1,t="open"):t="open"===t?"closed":"open";return"open"===t&&-1===o}(a)?(e[i]=a+t.value,e):e.concat(t):e.concat(t)}),[])}},193727:(e,t,n)=>{n.r(t),n.d(t,{EXT_FOR_COMPRESSION:()=>s,compressImage:()=>a});var i=n(629133),o=n.n(i),r=n(137233),s=[".png",".jpg",".jpeg",".bmp",".webp"],a=function(e){var t=e.originalImage,n=e.imagePreviewHeight,i=e.imagePreviewWidth,a=(0,r.getFileExtension)(t.src);if(!o().contains(s,a))return Promise.reject("Format ".concat(a," not supported for compression"));var l=document.createElement("canvas"),d=l.getContext("2d");if(!d)return Promise.reject("Canvas context is null");var u=t.naturalWidth,c=t.naturalHeight,_=n/c>i/u?n/c*4:i/u*4,p=u*_,h=c*_;return l.width=p,l.height=h,new Promise((function(e){d.drawImage(t,0,0,u*_,c*_),l.toBlob((function(t){t&&e(t)}),"image/".concat(a.slice(1)),.8)}))}},804317:(e,t,n)=>{n.r(t),n.d(t,{pasteFiles:()=>u});var i=n(629133),o=n.n(i),r=n(211792),s=n(806071);function a(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}var l,d,u=(l=function(e){var t,n,i;return function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(a){return t=e.event,n=e.fileInput,i=function(e){var t,n;if(null==(t="originalEvent"in e?e.originalEvent.clipboardData:e.clipboardData)?void 0:t.getData("text/plain"))return[];var i=null!==(n=null==t?void 0:t.files)&&void 0!==n?n:[];return o().flatten(o().map(i,(function(e){var t=e.name,n=e.type;if(!o().contains(s.PICTURE_ACCEPTED_TYPES,n))return[];var i=o().last(t.split("."));return[new File([e],"".concat((0,r.v4)(),".").concat(i),{type:n})]})))}(t),i.length>0&&(function(e){var t=e.fileInput,n=e.files,i=new DataTransfer;o().each(n,(function(e){i.items.add(e)})),t.files=i.files}({fileInput:n,files:i}),n.dispatchEvent(new Event("change"))),[2]}))},d=function(){var e=this,t=arguments;return new Promise((function(n,i){var o=l.apply(e,t);function r(e){a(o,n,i,r,s,"next",e)}function s(e){a(o,n,i,r,s,"throw",e)}r(void 0)}))},function(e){return d.apply(this,arguments)})}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_18_50_52"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a9b1a8e3-a60f-4bcc-b7c5-ae39027f1c54",e._sentryDebugIdIdentifier="sentry-dbid-a9b1a8e3-a60f-4bcc-b7c5-ae39027f1c54")}catch(e){}}();
//# sourceMappingURL=15656.41b692c9b068a82f1a34.js.map