"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[75897],{538641:(t,e,r)=>{r.r(e),r.d(e,{default:()=>h});var n=r(661533),s=r.n(n),i=r(629133),o=r.n(i),a=r(460159),l=r.n(a),c=r(313981),u=r(955026),d=r(304483);const h=c.default.extend({_template:"/tmpl/common/modal/progress/index.twig",error_modal_templates:"/tmpl/common/modal/progress/error.twig",_classes:function(){return{bar:"progress__bar",bar_filled:"progress__filler",continue_btn:"js-progress-cont-to-work",cancel_btn:"js-progress-cancel",header:"progress__header",hidden:"h-hidden",messages:"progress__messages",modal_actions:"modal-body__actions",progress_errored:"progress__inner_errored",progress_text:"progress__status-text",progress_wrapper:"progress__inner"}},has_done:!1,events:function(){var t=o().result(c.default.prototype,"events",{});return t["click ".concat(this._selector("continue_btn"))]="onContinueClick",t["click ".concat(this._selector("cancel_btn"))]="onCancelClick",t},status_codes:{STATUS_NOT_STARTED:1,STATUS_IN_PROGRESS:2,STATUS_DONE:3,STATUS_FAILED:4},initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(c.default.prototype.initialize.call(this),this.options=t,this.job_id=t.job_id,this.destroyModalDone=o().isFunction(t.destroyModalDone)?t.destroyModalDone:o().noop,this.destroyModalClose=o().isFunction(t.destroyModalClose)?t.destroyModalClose:o().noop,this.onProgressComplete=o().isFunction(this.options.onProgressComplete)?this.options.onProgressComplete:o().noop,this.onCancel=o().isFunction(this.options.onCancel)?this.options.onCancel:o().noop,!o().isFunction(this.options.getTextMessages))throw new Error("Progress modal messages callback is not defined!");this.getTextMessages=this.options.getTextMessages,this.initModal()},initModal:function(){this.modal=new d.default({class_name:"modal-list modal-progress",disable_overlay_click:!0,preload_templates:[this._template],init:o().bind((function(t){this.setElement(t).render({status:this.status_codes.STATUS_NOT_STARTED,total:0,processed_count:0}).getProgress().then(o().bind((function(t){!0===this.checkStatus(t)&&this.startPolling()}),this)).catch(o().bind(this.showError,this))}),this),destroy:o().bind((function(){this.destroy_from_modal=!0,this.destroy(),this.has_done?this.destroyModalDone():this.destroyModalClose()}),this)})},destroy:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];clearInterval(this.status_interval),c.default.prototype.destroy.apply(this,e),!this.options.not_reload&&this.need_reload&&this.destroy_from_modal&&this._$document.trigger("page:reload")},_getRenderData:function(t){return o().extend({numerator:this._getPercentage(t),need_show_button:this.options.need_show_button,show_cancel:this.options.show_cancel},t,this.getTextMessages(t))},render:function(t){var e=this._getRenderData(t);return this.$el.html(l()({ref:this._template}).render(e)).trigger("modal:centrify"),this},rerender:function(t){var e=this._getRenderData(t),r=e.numerator;this._findElem("bar").width("".concat(r,"%")),this._findElem("bar_filled").width("".concat(r,"%")),this._findElem("progress_text").text("".concat(r,"%")),this._findElem("header").text(e.title),this.options.skip_continue_button||this._toggleClass("hidden","modal_actions",e.status!==this.status_codes.STATUS_DONE&&!this.options.need_show_button),e.messages&&(this._addClass("progress_errored","progress_wrapper"),this._findElem("messages").show().text(e.messages)),this.$el.trigger("modal:centrify")},checkStatus:function(t){switch(t.processed_count>0&&(this.need_reload=!0),t.status){case this.status_codes.STATUS_DONE:return clearInterval(this.status_interval),this.has_done=!0,this.rerender(t),this.onProgressComplete(t),this.options.skip_continue_button&&o().delay(o().bind((function(){this.modal.destroy()}),this),600),!1;case this.status_codes.STATUS_IN_PROGRESS:return this.rerender(t),!0;default:return this.render(t),!0}},getProgress:function(){return new Promise(o().bind((function(t,e){this._xhr&&4!==this._xhr.readyState&&this._xhr.abort(),this._xhr=this._makeRequest().done(o().bind((function(r){var n=this.parseResponse(r);r.error||!o().isEmpty(n.errors)||n.data&&n.data[0].status===this.status_codes.STATUS_FAILED?e(n):t(n.data[0])}),this)).fail(e)}),this))},startPolling:function(){this.status_interval=setInterval(o().bind((function(){this.getProgress().then(o().bind(this.checkStatus,this)).catch(o().bind(this.showError,this))}),this),3e3)},_parseResponse:function(t){return t.multiactions&&t.multiactions.status||{}},parseResponse:function(t){return t=(0,u.cleanResponse)(t),this._parseResponse(t)},onContinueClick:function(){return this.modal.destroy()},onCancelClick:function(){return this.onCancel(),this.modal.destroy()},showError:function(t){"abort"!==t.statusText&&(this.status_interval&&clearInterval(this.status_interval),this.options.progress_error?this.showProgressError():(this.modal.disable_overlay_click=!1,this.modal.showError(null,!1)))},showProgressError:function(){this.error_modal||(this.modal.$el.hide(),this.error_modal=this._addComponent(d.default,{class_name:"modal-list modal-progress-error",preload_templates:[this.error_modal_templates],init:o().bind(this.onInitProgressError,this),destroy:o().bind((function(){this.error_modal&&(this.error_modal.$el.off("click".concat(this.ns)),this.error_modal=null,this.modal.destroy())}),this)}),this.error_modal.$el.one("click".concat(this.ns),".js-progress-cont-to-work",o().bind((function(){this.has_done=!1,this.error_modal.destroy()}),this)))},onInitProgressError:function(t){t.trigger("modal:loaded").html(this.getHtmlProgressError()).trigger("modal:centrify"),this.$el.hide()},getHtmlProgressError:function(){return l()({ref:this.error_modal_templates}).render(this.options.error_modal_params)},_makeRequest:function(){return s().ajax({url:"/ajax/v1/multiactions/status",dataType:"json",type:"GET",data:s().param({request:{multiactions:{status:[{job_id:this.job_id}]}}})})},_getPercentage:function(t){var e;return t.status===this.status_codes.STATUS_DONE?e=100:(e=Math.round(t.processed_count/t.total*100),e=o().isNaN(e)?0:e),e}})},565894:(t,e,r)=>{r.r(e),r.d(e,{default:()=>d});var n=r(661533),s=r.n(n),i=r(629133),o=r.n(i),a=r(445368),l=r(955026),c=r(63872),u=r(538641);const d=c.default.extend({_ProgressModal:u.default,_action_type:null,setElement:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=c.default.prototype.setElement.apply(this,e);return this.tryToAppendAffectableCount(),n},render:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=c.default.prototype.render.apply(this,e);return this.tryToAppendAffectableCount(),n},msgids:null,setParams:function(t){return c.default.prototype.setParams.call(this,o().extend({},t,this._callbacks))},_makeRequest:function(t){return s().ajax({url:"/ajax/v1/multiactions/set",data:this._getRequestData(t),type:"POST",dataType:"json"})},_getRequestData:function(t){return{request:{multiactions:{add:[o().extend({entity_type:(e=APP.getBaseEntity(),1==("contacts"===e)?""===APP.data.element_type?APP.element_types.contacts_and_companies:APP.element_types[APP.data.element_type]:APP.element_types[e]),multiaction_type:this._getActionType(),data:this.getDataForRequest(t)},this._getRequestFilterData())]}}};var e},_getActionType:function(){if(!this._action_type)throw new Error("Multiactions type for request is not defined!");return this._action_type},_getRequestFilterData:function(){var t=this.options.handle_through_params||{};return this.options.handle_through?t.pipeline_filter&&t.pipeline_filter.length?this._getCustomPipelineFilter(t):this._getCurrentPageFilter():{ids:this.options.id}},_getCustomPipelineFilter:function(t){var e=this._getCurrentPageFilter(),r=t.pipeline_id,n={},s=t.pipeline_filter;return(0,l.hasKeys)(e,["filter","filter","status_id"])&&(e.filter.filter.status_id=s.concat()),(0,l.hasKeys)(e,["filter","filter","pipe",r])&&(e.filter.filter.pipe[r]=s.concat()),(0,l.hasKeys)(e,["filter","filter"])&&!o().isEmpty(e.filter.filter.pipe)||r&&(n[r]=s.concat(),e.filter.filter=o().extend({pipe:n},e.filter.filter)),"customers-pipeline"===APP.data.current_entity&&s.length&&(e.filter=o().isObject(e.filter)?e.filter:{},e.filter.filter=o().isObject(e.filter.filter)?e.filter.filter:{},e.filter.status_id=o().pluck(s,"id")),o().extend(e,{ids:this.options.id})},_getCurrentPageFilter:function(){var t=APP.data.current_view.search.filter,e=t.getCurrentFilter(),r=this.options.handle_through_params||{},n=APP.data.current_view._getInstance();return r.exclude_ids&&r.exclude_ids.length&&(o().isObject(e.filter)||(e.filter={}),e.filter["!ids"]=[].concat(r.exclude_ids)),o().isFunction(n.hookActiveFilter)&&(e=n.hookActiveFilter(e,t.params)),e},tryToAppendAffectableCount:function(){var t=o().propertyOf(this.options),e=t("handle_through")?t("handle_through_count"):(t("id")||[]).length,r=e&&o().result(this,"msgids",{});r.elem&&e>1&&this._findElem("actions").append('<span class="modal-body__will-affect-count"> '.concat([(0,a.i18n)("Will affect"),(0,a.numeralWord)(e,(0,a.i18n)(r.elem),!0)].join(" "),"</span>"))},actionComplete:function(t){t=(0,l.cleanResponse)(t),this._elem("save_btn").trigger("button:load:stop"),this.isValidResponse(t)?(this._xhr=null,this._callbacks.complete.call(this,t)):(this._xhr=null,this._callbacks.failed.call(this,t))},isValidResponse:function(t){var e=t.multiactions&&t.multiactions.set&&t.multiactions.set.data&&t.multiactions.set.data[0]||{};return this._job_id=e.job_id,!!this._job_id},_callbacks:{complete:function(){var t=this._ProgressModal;return this.destroy(),new t({job_id:this._job_id,getTextMessages:o().bind(this.getTextMessages,this),onProgressComplete:this._callbacks.afterImport})},failed:function(){this.modal.showError()},afterImport:o().noop,afterDestroy:o().noop,destroy:o().noop},getTextMessages:function(t){var e,r,n=o().result(this,"msgids",null);if(!n)throw new Error("No text messages defined for progress dialog!");switch(t.status){case 1:case 2:return{title:(0,a.i18n)(n.title.process),button_text:(0,a.i18n)(n.button_text)};case 3:return 1==!!t.errors?(e=o().reduce(t.errors,(function(t,e){return t+e.count}),0),r=Math.max(t.total-e,0),{title:"$1: $2 $3 $4".replace("$1",(0,a.i18n)(n.title.error)).replace("$2",r).replace("$3",(0,a.i18n)("out of")).replace("$4",t.total),messages:this.getErrorTextMessage(t),button_text:(0,a.i18n)(n.button_text)}):{title:(0,a.i18n)(n.title.success),button_text:(0,a.i18n)(n.button_text)}}},getErrorTextMessage:function(t){var e=o().result(this,"msgids",null);if(!e)throw new Error("No text messages defined for error dialog!");var r=o().filter(t.errors,(function(t){return t.count})),n=o().reduce(r,(function(t,r){switch(APP.lang_id){case"ru":t.push("$1 $2 $3".replace("$1",(0,a.numeralWord)(r.count,(0,a.i18n)(e.not_processed))).replace("$2",r.count).replace("$3",(0,a.numeralWord)(r.count,(0,a.i18n)(e.elem))));break;case"en":case"es":case"pt":case"id":case"tr":case"ch":t.push("$1 $2 $3".replace("$1",r.count).replace("$2",(0,a.numeralWord)(r.count,(0,a.i18n)(e.elem))).replace("$3",(0,a.numeralWord)(r.count,(0,a.i18n)(e.not_processed))))}switch(r.type){case"required_fields":t.push((0,a.i18n)("Not all the mandatory fields were filled in"));break;case"not_enough_rights":t.push((0,a.i18n)("Insufficient rights"))}return t}),[]);return o().chain(n).map((function(t){return t.charAt(0).toUpperCase()+t.slice(1)})).value().join(". ")}})},43205:(t,e,r)=>{r.r(e),r.d(e,{richLinks:()=>_});var n=r(629133),s=r.n(n),i=r(989388),o=r(128125),a=r(523764),l=r(577486);function c(t,e,r,n,s,i,o){try{var a=t[i](o),l=a.value}catch(t){return void r(t)}a.done?e(l):Promise.resolve(l).then(n,s)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(n,s){var i=t.apply(e,r);function o(t){c(i,n,s,o,a,"next",t)}function a(t){c(i,n,s,o,a,"throw",t)}o(void 0)}))}}function d(t,e){var r,n,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],n=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var h=new a.IndexedDBCache("rich_links"),_=function(t){var e,r=t.onStartRichLinksResolve,n=void 0===r?s().noop:r,a=t.onEndRichLinksResolve,c=void 0===a?s().noop:a,_=t.onAllRichLinksResolve,p=void 0===_?s().noop:_,f=t.richesResolverRunner,m=[],g=!1,y=(e=u((function(t){var e,r,o;return d(this,(function(a){switch(a.label){case 0:e=s().map(t,(function(t){return t.link})),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(0,i.getRichLinks)(e)];case 2:return r=a.sent(),[3,4];case 3:return a.sent(),c(),p(),[2];case 4:return o=[],n(),[4,new Promise((function(t){setTimeout(t,0)}))];case 5:return a.sent(),s().forEach(r,(function(e,r){var n=t[r],i=n.link,a=n.resolve,c=function(t,e){var r=s().propertyOf(t),n=r("url")||e,i=r("title"),o=r(["images","0","secure_url"])||r(["images","0","url"]),a=r("site_name"),c=function(t){var e=new l.UnsafeRegExp("[a-zA-Zа-яА-ЯёЁ0-9_-]+(\\.[a-zA-Zа-яА-ЯёЁ0-9_-]+)*\\.[a-zA-Zа-яА-ЯёЁ]{2,9}"),r=t.match(e);return r&&r[0]||null}(n);return{site_name:a||null,domain:c||null,title:i||null,img:o||null,link:n||null}}(e,i);s().chain(c).keys().without("domain","link").every((function(t){return null===c[t]})).value()||(a(c),o.push({key:i,val:c}))})),c(),p(),o.length?[4,h.set(o)]:[3,7];case 6:a.sent(),a.label=7;case 7:return[2]}}))})),function(t){return e.apply(this,arguments)}),b=function(){var t=u((function(t){var e;return d(this,(function(r){switch(r.label){case 0:return e=[],[4,h.load()];case 1:return r.sent(),t.length?(n(),[4,new Promise((function(t){setTimeout(t)}))]):[2];case 2:return r.sent(),s().forEach(t,(function(t){var r=function(t){var e,r=t.textWithLink,n=t.resolve,s=(e=r,o.default.getFirstLink({input_text:e,without_email:!0}));return s?{link:s,resolve:n}:null}(t);if(r){var n=r.link,s=r.resolve,i=h.get(n);i?s(i):e.push(r)}})),c(),e.length?[4,y(e)]:[3,4];case 3:return r.sent(),[2];case 4:return p(),[2]}}))}));return function(e){return t.apply(this,arguments)}}(),v=function(){var t=m;g=!1,m=[],b(t).then()},w=s().debounce((function(){g||(g=!0,f(v))}),50);return{getRichLink:function(t){return new Promise((function(e){m.push({textWithLink:t,resolve:e}),w()}))}}},p="../build/transpiled/interface/amojo/rich_links/rich_links";window.define(p,(function(){var t="undefined",r=typeof e===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof module===t?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:e;return r&&r.default||r})),window.require([p])}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_17_08_33"},function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(new Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="313696a0-d3f6-4408-8760-c9f2fcdce14c",t._sentryDebugIdIdentifier="sentry-dbid-313696a0-d3f6-4408-8760-c9f2fcdce14c")}catch(t){}}();
//# sourceMappingURL=75897.839dfc4b419bddd36e2d.js.map