"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[60882,35503],{714124:(e,t,i)=>{i.r(t),i.d(t,{default:()=>c});var s=i(629133),n=i.n(s),a=i(161320),r=i.n(a),o=i(445368),l=i(450422),d=i(661533);const c={onSyncDataSetClick:function(){var e=this;this.sync_data_enabed&&!(0,l.isAmoChatsFullEnabled)()&&(this.sync_data_enabed=!1,this._elem("sync_btn").trigger("button:load:start"),d.ajax({url:"/ajax/v2/helpbot/train",type:"POST",contentType:"application/json"}).success((function(){setTimeout(n().bind(e.checkSyncStatus,e),3e3)})))},checkSyncStatus:function(){var e,t=this;this.getHelpbotSettings().success((function(i){1===i._embedded.items.train.status?(t.need_update_last_sync&&(e="".concat((0,o.i18n)("Last update")," ").concat(r().unix(i._embedded.items.train.updated_at).calendar()),t._elem("last_sync").html(e)),t.sync_data_enabed=!0,t._elem("sync_btn").trigger("button:load:stop")):setTimeout(n().bind(t.checkSyncStatus,t),3e3)}))},getHelpbotSettings:function(){return d.ajax({url:"/private/ajax/v2/json/helpbot/settings",type:"GET",contentType:"application/json"})}}},956332:(e,t,i)=>{i.r(t),i.d(t,{default:()=>p});var s=i(661533),n=i.n(s),a=i(460159),r=i.n(a),o=i(629133),l=i.n(o),d=i(313981),c=i(445368),u=i(955026);function _(e,t,i,s,n,a,r){try{var o=e[a](r),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,n)}window.APP=window.APP||{},window.APP.player_prepare={};const p=d.default.extend({ns:".player",template:l().template('<div id="amo-player" class="amo-player-container"><div class="amo-player-container--inner"><div class="amo-player-container--play"><span></span></div><div class="amo-player-container--pause"><span></span><span></span></div><div class="amo-player-container--stop"><span></span></div><div class="amo-player-container--scrubber"><div class="amo-player-container--progress"><div class="amo-player-container--loaded"></div></div></div><div class="amo-player-container--time"><em class="amo-player-container--played">00:00</em>/<strong class="amo-player-container--duration">00:00</strong></div><div class="amo-player-container--movement-speed"></div></div></div>'),movement_speed_items:[{option:"0.5x",id:.5},{option:"1x (".concat((0,c.i18n)("normal speed"),")"),id:1},{option:"1.25x",id:1.25},{option:"1.5x",id:1.5},{option:"2x",id:2}],initialize:function(e){d.default.prototype.initialize.apply(this,arguments),this.options=n().extend({append_to:".custom-scroll",$container:this._$document,input_special_class:"",selector:!1},e),this.default_selector="#amo-player",this.default_width=495,this.bindEvents()},destroy:function(){this._$body.removeAttr("bgsound"),this._removalObserver(!1),this.options.$container.off(this.ns),this.last_audio&&this.last_audio.jPlayer("stop").remove(),this.remove()},prepare:function(){return n().extend({},this.default_prepare,APP.player_prepare)},bindEvents:function(){this.options.$container.on("click".concat(this.ns),".js-call-play",l().bind((function(e){var t,i=n()(e.currentTarget);i.hasClass("amo-player--playing")?this.stop(i):(t=i.attr("data-prepare"),this.stop(),this.show(i),i.removeClass("icon--play").addClass("amo-player--playing"),l().isString(t)&&l().isFunction(this.prepare()[t])?this.prepare()[t].call(this,i):this.play(i)),e.preventDefault(),e.stopPropagation()}),this)).on("change".concat(this.ns),"#amo-player .control--select--input",l().bind((function(e){"1"===n()(e.currentTarget).val()&&this.changeSelectedSpeedCaption(),this.last_audio&&this.last_audio.jPlayer("option","playbackRate",n()(e.currentTarget).val())}),this))},changeSelectedSpeedCaption:function(){n()("#amo-player").find(".control--select--button-inner").text("1x")},_getPlayer:function(e){var t=n()(this.default_selector);return e&&this.options.selector&&(t=e.closest(this.options.selector)),t},_getContainer:function(e){var t=e.closest(this.options.append_to);return t.length||(t=this._$body),t},showError:function(e,t,i,s){var n=this._getPlayer(e);(0,u.hasKeys)(s,["jPlayer","error","type"])&&"e_url"===s.jPlayer.error.type&&(n.data("attempt")>=2?(n.attr("data-error-text",t).addClass("js-ready js-error").find(".spinner-icon").remove(),this.stopTimer=setTimeout(l().bind(this.stop,this,e),1500)):(n.attr("data-attempt",2).addClass("js-ready").append('<span class="modal-overlay__spinner spinner-icon spinner-icon-abs-center" style="z-index: 3"></span>'),this.play(e,!1,0!==i&&i)))},fileHash:function(e){var t,i=0;if(0===e.length)return i;for(t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i&=i;return i},show:function(e){var t,i,s,a,o,d,c,u,_=this._getContainer(e),p="static"===_.css("position")?0:_.scrollTop(),h="static"===_.css("position")?0:_.scrollLeft();this.options.selector||(n()(this.default_selector).remove(),_.append(this.template()),i=r()({ref:"/tmpl/controls/select.twig"}).render({class_name:"amo-player-container--movement-speed-select",name:"movement_speed",id:"movement_speed",selected:1,input_special_class:this.options.input_special_class,items:this.movement_speed_items}),_.find(".amo-player-container--movement-speed").append(i),t=this._getPlayer(),this.changeSelectedSpeedCaption(),this._removalObserver(!0,_),c=_.offset().left,s=e.offset().left-c,a=e.offset().top-_.offset().top,(u=_.width())<(o=t.width())&&(o=u),(d=s+e.width()/2-o/2)<0&&(d=0),d+o>_.width()&&(d=_.width()-o),l().isFunction(this.options.setPositions)&&this.options.setPositions.call(this,e,t),t.css({top:a+e.height()/2-t.height()/2+p,left:d+h,width:o}).one("click",".amo-player-container--stop",l().bind(this.stop,this,void 0)).on("click",".amo-player-container--progress",l().bind((function(e){var t=n()(e.currentTarget),i=t.offset(),s=t.outerWidth(),a=e.pageX-i.left,r=this.last_audio.data().jPlayer.status.duration,o=a*parseInt(r)/s;this.current_time_by_click=o}),this)).on("click",l().bind((function(e){0===n()(e.target).closest(".control--select").length&&e.stopPropagation()}),this)),l().isFunction(this.options.afterSetPositions)&&this.options.afterSetPositions.call(this,e,t),t.addClass("js-loading"))},play:function(e,t,s){return(a=function(){var a,r;return function(e,t){var i,s,n,a,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,s=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((n=(n=r.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){r.label=a[1];break}if(6===a[0]&&r.label<n[1]){r.label=n[1],n=a;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(a);break}n[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],s=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}(this,(function(o){switch(o.label){case 0:return(t=t||e.attr("href"))?[4,i.e(53081).then(i.t.bind(i,53081,23))]:(this.stop(e),[2]);case 1:return o.sent(),r=this.fileHash(t),n()(document.body).attr("bgsound",t),l().isUndefined(s)||n()("#audio".concat(r)).remove(),n()("#audio".concat(r)).length&&l().isUndefined(s)||(this._$body.append('<div id="audio'.concat(r,'" controls class="amo-player--audio"></div>')),this.last_audio=n()("#audio".concat(r)).jPlayer({cssSelectorAncestor:this.options.selector||this.default_selector,cssSelector:{seekBar:".amo-player-container--progress",playBar:".amo-player-container--loaded",play:".amo-player-container--play",pause:".amo-player-container--pause",currentTime:".amo-player-container--played",duration:".amo-player-container--duration"},solution:"html",supplied:"mp3,wav,oga,m4a",preload:"auto",muted:!1,ended:l().bind(this.stop,this,void 0),error:l().bind((function(t){this.current_time_by_click=this.current_time_by_click||!1,this.showError(e,APP.lang.player_no_file,!1===this.current_time_by_click?t.jPlayer.status.currentTime:this.current_time_by_click,t)}),this),play:l().bind((function(){(a=this._getPlayer(e)).data("attempt","").addClass("js-ready").find(".spinner-icon").remove(),l().isUndefined(s)&&!s||a.removeClass("js-error"),this.current_time_by_click=!1}),this),ready:l().bind((function(i){var r={};r.mp3=t,r.wav=t,n()(i.currentTarget).jPlayer("setMedia",r).jPlayer("play",s||0),(a=this._getPlayer(e)).addClass("js-ready")}),this)})),e.addClass("amo-player--playing icon--stop"),[2]}}))},function(){var e=this,t=arguments;return new Promise((function(i,s){var n=a.apply(e,t);function r(e){_(n,i,s,r,o,"next",e)}function o(e){_(n,i,s,r,o,"throw",e)}r(void 0)}))}).apply(this);var a},stop:function(e){e||(e=n()("a.amo-player--playing")),this._removalObserver(!1),clearTimeout(this.stopTimer),this.last_audio?(this.last_audio.jPlayer("stop").remove(),this.options.selector?e.closest(this.options.selector).find(".amo-player-container--played").text("00:00"):n()(this.default_selector).remove(),this.last_audio=null):n()(this.default_selector).remove(),e.length&&(e.removeClass("amo-player--loading-ajax amo-player--playing icon--stop").addClass("icon--play"),e.hasClass("amo-player--loading-ajax")&&e.addClass("amo-player--dont-play"),l().isFunction(this.options.stop)&&this.options.stop())},_removalObserver:function(e,t){!1!==e?(this._observer=new MutationObserver(l().bind((function(e){l().each(e,(function(e){l().each(e.removedNodes,(function(e){e.parentNode||e!==t.get(0)&&!n().contains(e,t.get(0))||this.stop()}),this)}),this)}),this)),this._observer.observe(document.body,{childList:!0,subtree:!0})):this._observer&&(this._observer.disconnect(),this._observer=null)},default_prepare:{onlinepbx:function(e){e.hasClass("amo-player--loading-ajax")||(e.addClass("amo-player--loading-ajax"),n().ajax({url:e.attr("href"),dataType:"json",success:l().bind((function(t){e.removeClass("amo-player--loading-ajax"),/^http:\/\/(.*)\.(onlinepbx|onpbx)\.ru\/$/.test(t.redirect)?this.showError(e,APP.lang.player_no_file):e.hasClass("amo-player--dont-play")?e.removeClass("amo-player--dont-play"):this.play(e,t.redirect.replace(/^([\s\S]{0,5}):\/\//,"//"))}),this)}))},oktell:function(e){var t;e.hasClass("amo-player--loading-ajax")||void 0===APP.widgets.oktell||(e.addClass("amo-player--loading-ajax"),APP.widgets.oktell.exec("gettemphttppass",{},(function(i){i.result&&i.password?(t="".concat(e.attr("href"),"?temppass=").concat(i.password),this.play(e,t),e.addClass("amo-player--loading-ajax")):(e.removeClass("amo-player--dont-play"),this.showError(e,APP.lang.player_no_file))})))},amo_ringcentral:function(e){var t=e.attr("href"),i=e.closest(".feed-note-wrapper");this.play(e,t),this.last_audio.bind(n().jPlayer.event.play,l().bind((function(){this.last_audio.jPlayer("option","cssSelector",{duration:""}),i.find(".amo-player-container--duration").html(i.find(".feed-note__call-duration").html())}),this))}}});var h="../build/transpiled/components/base/player";window.define(h,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([h])},70744:(e,t,i)=>{i.r(t),i.d(t,{default:()=>y});var s=i(661533),n=i.n(s),a=i(629133),r=i.n(a),o=i(345839),l=i.n(o),d=i(460159),c=i.n(d),u=i(313981),_=i(323344),p=i(955026),h=i(445368),f=i(500034),m=i(640345),g=i(845043),v=function(e,t){n()(this).sortable("refreshPositions"),e.helper.css("margin-top",t)};const y=u.default.extend({_sorting:!1,_sortable:!1,_selectors:function(){return{default_item:".js-filter-preset-link.filter__list__item-default"}},_classes:function(){return{selected:"filter__list__item-selected",editing_item:"filter__list__item-edit-mode",save:"js-filter-save",trash_item:"filter__common_settings__item-trash"}},events:{"keyup .filter_items__user_value":"presetEditHotKeys","click .js-filter-preset-link":"presetLoad","click .js-filter-save":"presetSave","click .filter_items__edit__delete":"presetRemove","click .filter_items__edit__save":"presetEditSave","click .filter_items__edit__btn":"presetEdit","click .filter__list__item-edit-mode":"presetEditPreventExit"},initialize:function(e){u.default.prototype.initialize.apply(this,arguments),this.options=e||{},this.is_admin=(APP.constant("user_rights")||{}).is_admin,this.non_admin_can_save=e.non_admin_can_save||!1,this.getSerializedFilterState=e.getSerializedFilterState,this.hideEditIcon(),this._$body.on("click".concat(this.ns),"#filter_save",r().bind(this.presetSave,this)).on("click".concat(this.ns),r().bind(this.presetEditExit,this)),c()._preload(["/tmpl/filter/bookmark.twig"])()},destroy:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this._$body.off(this.ns),this.makeSortable(!1),this.remove(!1),u.default.prototype.destroy.apply(this,t)},changeDefaultPreset:function(){this.$el.children().removeClass("filter__list__item-default"),this.$el.children().first().addClass("filter__list__item-default")},hideEditIcon:function(){this.$el.find(".filter__list__item-system-preset").length<this.$el.children().not(".filter__common_settings__item-trash").length-1?this.$el.find(".filter__list__item-system-preset").find(".filter_items__edit").css("display","none"):(this.$el.find(".filter__list__item-system-preset").find(".filter_items__edit").css("display","none"),this.$el.find(".filter__list__item-system-preset").first().find(".filter_items__edit").css("display","block"))},presetLoad:function(e){var t=n()(e.currentTarget),i=t.find(".filter__list__item__link:first");if(e.preventDefault(),e.stopPropagation(),this._$document.trigger("suggest:manager:destroy"),!this._sorting){if(t.hasClass("filter__list__item-edit-mode"))return t.find('input[type="text"]').focus(),!1;this.options.filter&&this.options.filter.form.hasChanges()&&this.options.filter.reset({navigate:!1}),this._redirectForApplyPreset(i.attr("href")),!0!==APP.router.prevent_page_confirm&&(t.parent().find(this._selector("selected")).removeClass(this._class("selected")),t.addClass(this._class("selected")))}},_redirectForApplyPreset:function(e){APP.router.navigate(e,{trigger:!0})},isSkipFilterEmpty:function(){return r().isEmpty((0,_.getQueryParam)("skip_filter"))},highlight:function(){var e=[],t=(0,_.removeQueryParam)(["filter[order_by]","order_by","filter[order_type]","order_type","clear_order","term","typing"]),i=decodeURIComponent(t||""),s=this.presetIsTrash(l().history.location.pathname),a=s?this._selector("trash_item"):this._selector("default_item");return this._elem("save").addClass("hidden"),i&&this.isSkipFilterEmpty()?(this.$(".js-filter-preset-link").each(r().bind((function(t,s){var a,r=n()(s),o=(r.children(".filter__list__item__link").attr("href")||"").toString().split("?");a=(a=decodeURIComponent(2===o.length?o[1]:"").replace(/\+/g," ")).replace("&useFilter=y",""),i=i.replace("&useFilter=y",""),a&&i.indexOf(a)>=0?(e.length&&e.removeClass(this._class("selected")),e=r,r.addClass(this._class("selected"))):r.removeClass(this._class("selected"))}),this)),e.length||this.highlightSave()):(this.$(this._selector("selected")).removeClass(this._class("selected")),s?(this.$(a).addClass(this._class("selected")),r().isFunction(this.options.filter.setUrl)&&this.options.filter.setUrl(this.options.filter.form.el.getAttribute("action").replace("/list/","/trash/")),e=this.$(a)):(this.$(a)[(0,_.getQueryParam)("term")?"removeClass":"addClass"](this._class("selected")),r().isFunction(this.options.filter.setUrl)&&this.options.filter.setUrl(this.options.filter.form.el.getAttribute("action").replace("/trash/","/list/")))),e},highlightSave:function(e){e=!1!==this.options.can_save&&e,this.$(this._selector("selected")).removeClass(this._class("selected")),this._elem("save").addClass("hidden"),(this.is_admin||this.non_admin_can_save)&&!1!==e&&this._elem("save").removeClass("hidden").addClass(this._class("selected"))},getPresetEntity:function(){return r().isFunction(this.options.filter.getPresetEntity)?this.options.filter.getPresetEntity():APP.getBaseEntity()},deletePreset:function(e){this._addComponent(m.default,{$el:e,entity_preset:this.getPresetEntity(),id:e.attr("data-id"),complete:r().bind(this.completeDeletePreset,this,e.attr("data-id"))})},completeDeletePreset:function(){this._elem("save").removeClass("hidden"),this.sortMode(!1),this.$preset_in_edit=!1,this.changeDefaultPreset(),this._$document.trigger("search:presets-count:update"),this.options.filter.form.hasChanges()?this.highlightSave():this.highlight(),this.hideEditIcon()},presetRemove:function(e){var t=n()(e.currentTarget).closest("li");return this.$el.removeClass("filter-add-mode-active"),t.attr("data-id")?this.deletePreset(t):(t.addClass("flipOutX"),r().delay(r().bind((function(){t.remove(),this._elem("save").removeClass("hidden"),this.changeDefaultPreset(),this.highlight()}),this),300),r().isFunction(this.options.filter.makeFilterCaptionActive)&&this.options.filter.makeFilterCaptionActive(!0),this.$preset_in_edit=!1,this.add_new_preset=!1),!1},presetSave:function(e){var t=n()(e.currentTarget),i=this.options.filter.form.$el.attr("action"),s=(0,h.parseNum)(this.$("li:last").attr("data-sort")),a=this.getSerializedFilterState?this.getSerializedFilterState():this.options.filter.form.$el.find(":input").filter((function(){return""!==n()(this).val()&&!n()(this).hasClass("js-form-changes-skip")})).serialize(),o=(0,_.QStoJSON)(a);(0,p.hasKeys)(o,["filter[company][date][from]"])||(a=(0,_.removeQueryParam)(["filter[company][date][type]"],a)),(0,p.hasKeys)(o,["filter[main_contact][date][from]"])||(a=(0,_.removeQueryParam)(["filter[main_contact][date][type]"],a)),APP.data.current_view&&APP.data.current_view.filterPrepareAction&&(a=APP.data.current_view.filterPrepareAction(a));var l=n()(c()({ref:"/tmpl/filter/bookmark.twig"}).render({item:{element_id:"filter_preset_save_item",in_edit:!0,link:"".concat(i,"?").concat(a).concat(this.presetIsTrash(i)?"&is_trash=Y":""),label:"",can_edit:!0}}));return l.addClass("from-save filter__common_settings__item__add-mode"),l.attr("data-sort",s>=99999?s+1:99999).css("opacity",0).css(Modernizr.prefixed("transform"),"scale(0.8)").css(Modernizr.prefixed("transition"),"opacity 0.2s, ".concat(Modernizr.prefixed("transform")," 0.2s")),t.closest("li").length?t.closest("li").addClass("hidden").before(l):(this.$el.append(l),r().isFunction(this.options.filter.makeFilterCaptionActive)&&this.options.filter.makeFilterCaptionActive(!1)),l.focus().css("opacity","").css(Modernizr.prefixed("transform"),""),l.find(".filter_items__user_value").attr("data-is-new",1).removeAttr("readonly").focus(),t.closest(".filter-search__left").trigger("click"),this.$el.addClass("filter-add-mode-active"),this.$preset_in_edit=l,this.add_new_preset=!0,!1},presetEditSave:function(e){var t=n()(e.currentTarget).closest("li"),i=n().trim(t.find(".filter_items__user_value").val()||""),s=this.options.filter.form.$el.attr("action"),a=t.find(".filter__list__item__link").attr("href").toString().replace("".concat(s,"?"),"")+(this.presetIsTrash(s)?"&is_trash=Y":""),o=t.attr("data-id"),l=this;return t.hasClass("filter__list__item-system-preset")&&(t.removeClass("filter__list__item-edit-mode"),l.sortMode(!1),this.$preset_in_edit=!1,this.hideEditIcon(),l.changeDefaultPreset()),i.length?(this.presetSaveRequest(t,{action:o?"PUT":"POST",name:i,selection:o||"",query:a,sort:t.attr("data-sort"),pipeline_id:"leads"===APP.getBaseEntity()?r().propertyOf(APP)(["data","current_view","pipeline_id"]):""}).then((function(){l.sortMode(!1),l.changeDefaultPreset()})),this.$preset_in_edit=!1):this.presetShake(t),!1},presetEdit:function(e){if(this.$preset_in_edit&&!this.$preset_in_edit.find(".filter_items__user_value").val())return this.presetShake(this.$preset_in_edit),!1;var t=n()(e.currentTarget).closest("li"),i=t.parent().children(".filter__list__item-edit-mode"),s=i.length?i.attr("data-id"):"",a=this.options.filter.form.$el.attr("action"),o=i.length?i.find(".filter__list__item__link").attr("href").toString().replace("".concat(a,"?"),"")+(this.presetIsTrash(a)?"&is_trash=Y":""):"",l=t.find(".filter_items__user_value");return i.length&&this.presetSaveRequest(i,{action:s?"PUT":"POST",name:n().trim(i.find(".filter_items__user_value").val()||""),selection:s||"",query:o,pipeline_id:"leads"===APP.getBaseEntity()?r().propertyOf(APP)(["data","current_view","pipeline_id"]):""}),this.sortMode(!0),t.addClass("filter__list__item-edit-mode"),l.prev("span").remove(),l.show().removeAttr("readonly").val(l.val()),l.focus(),this.$preset_in_edit=t,this.makeSortable(!0),e.stopPropagation(),!1},presetEditHotKeys:function(e){var t=n()(e.currentTarget);switch(e.keyCode){case 13:this.presetEditSave({currentTarget:t.closest("li").find(".filter_items__edit__save")});break;case 27:this._$document.trigger("mouseup")}},makeSortable:function(e){var t=this;!0===e?(this._sortable=!0,this.$el.sortable({containment:this.$el,items:".js-filter__common_settings__item-sortable",axis:"y",tolerance:"pointer",scroll:!1,handle:".filter_items__handle",refreshPositions:!0,sortAnimate:!0,start:function(e,i){t._sorting=!0,i.item.addClass("sorted"),v.call(this,i,t._$window.scrollTop())},stop:function(e,i){r().delay(r().bind((function(){this._sorting=!1}),t),200),i.item.css("margin-top","").removeClass("sorted")},update:r().bind(this.updateSort,this),sort:function(e,i){var s=t._$window,n=s.scrollTop(),a=s.height(),r=i.item.offset().top;n-r>-70&&(n-=10),n+a-(r+i.item.height())<70&&(n+=10),s.scrollTop(n),v.call(this,i,n)}})):this._sortable&&(this.$el.sortable("destroy"),this._sortable=!1)},getSortData:function(e){return e.item.parent().find(".js-filter__common_settings__item-sortable").map((function(){var e=n()(this),t=((0,h.parseNum)(n()(this).prev("li").attr("data-sort"))||0)+1;return e.attr("data-sort",t),{id:e.attr("data-id"),sort:t}}))},updateSort:function(e,t){var i=this.getSortData(t),s=t.item.data("xhr");void 0!==s&&4!==s.readyState&&s.abort(),s=this.savePreset("PATCH",{filter:n().makeArray(i)}),t.item.data("xhr",s)},isPresetPrivate:function(){var e=this.getPresetEntity();return"talks"===e||e&&APP.isCard()},sortMode:function(e,t){var i,s,n=this.$el.find("li:not(.filter__list__item-save):not(.filter__common_settings__item-trash)"),a=n.first().attr("data-id");(0,f.isFeatureAvailable)("show_default_preset_modal")&&t&&!this.add_new_preset?(e&&(this._id_first_preset=a),e||this._id_first_preset===a||(i=n.first().attr("title"),s=this.isPresetPrivate()?(0,h.i18n)('"%s" will be set as your default preset filter. This will not affect other users.').replace("%s",i):(0,h.i18n)('The "%s" preset will be used by you and all users as the default preset.').replace("%s",i),new g.default({text:(0,h.i18n)("Please note"),message:[{text:s}],no_actions:!0}))):this._showRibbonText(e),this.add_new_preset=!1,e?n.addClass("filter__list__item-edit-sortable-mode"):n.removeClass("filter__list__item-edit-sortable-mode"),n.closest(".filter__list__item-system-can-edit")&&(n.removeClass("filter__list__item-system-can-edit"),n.first().hasClass("filter__list__item-system-preset")&&n.first().addClass("filter__list__item-system-can-edit"))},_showRibbonText:function(e){this.options.filter._elem("ribbon_text").remove(),e&&(this.options.filter.$el.append('<div class="'.concat(this.options.filter._class("ribbon_text"),'">').concat((0,h.i18n)("First preset is used by default"),"</div>")),this.options.filter._dropElemCache("ribbon_text"))},presetEditExit:function(){if(this.$preset_in_edit)return n()(".modal").length||this.presetEditSave({currentTarget:this.$preset_in_edit}),!1},presetShake:function(e){e.one(APP.animation_event,(function(){APP.is_touch_device||n()(this).find(":input").focus(),n()(this).off(APP.animation_event).removeClass("shake")})).addClass("shake")},savePreset:function(e,t){var i=this.getPresetEntity();return n().ajax({url:"/api/".concat(i,"/custom_presets/").concat("PUT"===e?t.selection:""),contentType:"application/json",type:e,dataType:"json",data:JSON.stringify(t)})},presetSaveRequest:function(e,t){var i=[],s=e.hasClass(this._class("selected")),a="",o=!1;return this.preset_saving?n().Deferred.reject():(this.preset_saving=!0,this.savePreset(t.action,t).always(r().bind((function(){this.preset_saving=!1}),this)).done(r().bind((function(r){var d,u,_=r.response;this.$el.removeClass("filter-add-mode-active"),("PUT"===t.action?_:_.accessEdit)?(d=_.query?_.query:t.query,u=_.id,a="".concat(l().history.location.pathname,"?").concat(d,"&sel=").concat(u),e.hasClass("filter__list__item-edit-sortable-mode")&&(o=!0),e.replaceWith(i=n()(c()({ref:"/tmpl/filter/bookmark.twig"}).render({item:{link:a,label:t.name,id:u||t.selection,can_edit:!0,sort:t.sort}}))),o&&i.addClass("filter__list__item-edit-sortable-mode"),(s||"add"===t.ACTION)&&this.presetSaveRequestRestoreSelection({$new_el:i,url:a,selected:s,action:t.ACTION})):this.presetEditExit()}),this)))},presetSaveRequestRestoreSelection:function(e){this.$(this._selector("selected")).removeClass(this._class("selected")),e.$new_el.addClass(this._class("selected")),APP.router.navigate(e.url,{replace:e.selected,trigger:"add"===e.action})},presetIsTrash:function(e){return e.indexOf("/trash")>=0}})},781424:(e,t,i)=>{i.r(t),i.d(t,{default:()=>r});var s=i(629133),n=i.n(s),a=i(93103);const r=a.default.extend({getHighlightedItem:function(e,t){var i,s=n().keys(t.users);return s.length?(i=n().chain(s).sortBy((function(e){return e})).first().value(),n().first(n().values(t.users[i]))):a.default.prototype.getHighlightedItem.apply(this,arguments)}});var o="../build/transpiled/components/filter/users_select";window.define(o,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([o])},568547:(e,t,i)=>{i.r(t),i.d(t,{default:()=>h});var s,n,a,r=i(629133),o=i.n(r),l=i(445368),d=i(450422),c=i(500034),u={widget:5},_=(0,i(506379).getGrouppedTriggers)("name"),p={TOKEN_TYPES:{ADS:1,FORMS:2,CONVERSIONS_API:3},ACTIONS:{RENEWABLE_ACTION_TYPES:{lead_added:1,lead_status_changed:14,lead_appeared_in_status:15,customer_added:20,customer_period_changed:21,customer_appeared_in_period:22,customer_status_changed:57,customer_appeared_in_status:58,segment_attached:94,action_relative_date:121},CUSTOM_DELAY_OPTION_ID:-1,KEYACTION_CONDITION_ID:116,RELATIVE_DATE_CONDITION_ID:121,TRIGGERS_WITH_DELAY_FIRST:o().compact([_.lead_added.id,_.lead_status_changed.id,_.lead_appeared_in_status.id,_.site_visit.id,_.customer_added.id,_.customer_status_changed.id,_.customer_appeared_in_status.id,_.talk_closed.id,_.last_incoming_message.id,_.outgoing_message.id]),TRIGGERS_WITH_ENTITY_SELECT:[[_.lead_status_changed.id,_.customer_status_changed.id],[_.lead_appeared_in_status.id,_.customer_appeared_in_status.id],[_.lead_responsible_changed.id,_.customer_responsible_changed.id]],TRIGGER_GROUPS:[{name:"pipeline",triggers:[_.lead_added.id,_.customer_added.id,_.lead_status_changed.id,_.customer_status_changed.id,_.lead_appeared_in_status.id,_.customer_appeared_in_status.id,_.lead_responsible_changed.id,_.customer_responsible_changed.id,_.invoice_added.id,_.invoice_paid.id,_.transaction_added.id],title:(0,l.i18n)("Pipeline triggers")},{name:"scheduled",triggers:[],title:(0,l.i18n)("Scheduled triggers")},{name:"behavior",triggers:[_.form_filled.id,_.mail_in.id,_.call_in.id,_.key_action_completed.id,_.site_visit.id],title:(0,l.i18n)("Behavior-based triggers")},{name:"conversational",triggers:[_.talk_created.id,_.last_incoming_message_date.id,_.incoming_outgoing_message_first_time_that_cool_down.id,_.incoming_mentioned_event.id,_.incoming_comment_event.id,_.seen_messages.id,_.talk_closed.id,_.chat.id,_.first_incoming_message.id,_.last_incoming_message.id,_.outgoing_message.id,_.incoming_message.id,_.incoming_message_first_time_that_hidden_cool_down.id,_.emotion_added.id,_.instagram_user_followed.id],title:(0,l.i18n)("Conversational triggers")}],SPECIFIC_SOURCES:(s={},n=_.seen_messages.id,a={origins:["instagram_business","facebook","onlinechat","waba"],types:o().keys(u),types_id:o().values(u)},n in s?Object.defineProperty(s,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[n]=a,s)},UNIT_ITEMS:[{id:"1048576",option:(0,l.i18n)("MB"),name:"MB"},{id:"1024",option:(0,l.i18n)("KB"),name:"KB"},{id:"1073741824",option:(0,l.i18n)("GB"),name:"GB"},{id:"1",option:(0,l.i18n)("Bytes"),name:"Bytes"}],FILE_ORIGIN_TYPE_ITEMS:[{id:"origin_type_custom_field",name:"origin_type_custom_field",option:(0,l.i18n)("Used in fields")},{id:"origin_type_note",name:"origin_type_note",option:(0,l.i18n)("Attached in notes")},{id:"origin_type_manual_load",name:"origin_type_manual_load",option:(0,l.i18n)("Uploaded in media tab")},{id:"origin_type_chat",name:"origin_type_chat",option:(0,l.i18n)("Sent in chats")}],CONVERSIONS_EVENTS_TYPE:[{id:"lead",option:(0,l.i18n)("Lead"),name:"lead"},{id:"purchase",option:(0,l.i18n)("Purchase"),name:"purchase"}],IMAGES:{TOTAL_LIMIT:20}};(0,c.isFeatureAvailable)("tags_triggers")&&o().findWhere(p.ACTIONS.TRIGGER_GROUPS,{name:"pipeline"}).triggers.push(_.tag_changed.id),(0,c.isFeatureAvailable)("field_value_changed_trigger")&&o().findWhere(p.ACTIONS.TRIGGER_GROUPS,{name:"pipeline"}).triggers.push(_.field_value_changed.id),(0,d.isAmoChatsFullEnabled)()&&p.ACTIONS.TRIGGER_GROUPS.push({name:"segments",triggers:[_.segment_attached.id,_.segment_detached.id],title:(0,l.i18n)("Segments")});const h=p;var f="../build/transpiled/interface/settings/digital_pipeline/constants";window.define(f,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([f])},136675:(e,t,i)=>{i.r(t),i.d(t,{default:()=>c});var s=i(661533),n=i.n(s),a=i(629133),r=i.n(a),o=i(543666),l=i(407710),d=i(955026);const c={add:function(e,t,i,s){return t=this.getTypeCode(t),o.WriteFirstLeadSourcesCollection.clearAllCache(),l.ChatSourcesCollection.clearAllCache(),n().ajax({method:"POST",url:"/ajax/settings/pipeline/sources/add",data:{request:{pipeline_id:e,type:t,params:i}},xhr:s})},smart_delete:function(e,t,i){var s,n=!1;return o.WriteFirstLeadSourcesCollection.clearAllCache(),l.ChatSourcesCollection.clearAllCache(),this.list(e,t).then(r().bind((function(e){return e[this.getTypeCode(t)]&&(s=e[this.getTypeCode(t)])[i]&&(n=s[i].source_id),this.delete(n)}),this))},delete:function(e){return o.WriteFirstLeadSourcesCollection.clearAllCache(),l.ChatSourcesCollection.clearAllCache(),n().ajax({method:"POST",url:"/ajax/settings/pipeline/sources/delete",data:{request:{id:e}}})},deleteAllByType:function(e){return o.WriteFirstLeadSourcesCollection.clearAllCache(),l.ChatSourcesCollection.clearAllCache(),n().ajax({method:"POST",url:"/ajax/settings/pipeline/sources/delete",data:{request:{type:e}}})},edit:function(e,t){return o.WriteFirstLeadSourcesCollection.clearAllCache(),l.ChatSourcesCollection.clearAllCache(),n().ajax({method:"POST",url:"/ajax/settings/pipeline/sources/edit",data:{request:{id:e,params:t}}})},list:function(e,t){var i={},s=n().Deferred();return e&&(i.pipeline_id=e),t&&(i.type=this.getTypeCode(t)),n().ajax({method:"GET",url:"/ajax/settings/pipeline/sources/list",data:i}).done(r().bind((function(e){(e=(0,d.cleanResponse)(e))&&e.sources&&s.resolve(e.sources)}))),s},listSources:function(e,t){var i={filter:{origin:[]}},s=[],a=n().Deferred();return e&&(i.only="chats"),t&&i.filter.origin.push(t),n().ajax({method:"GET",url:"/ajax/v4/sources",data:i}).done(r().bind((function(e){e=(0,d.cleanResponse)(e),s=r().propertyOf(e)(["_embedded","sources"])||[],a.resolve(s)}))),a},getTypeCode:function(e){var t=r().invert(APP.constant("leads_sources_types"));return!(!e||!t[e])&&t[e]},switchDuplicationControlEnabled:function(e,t,i){var s={pipeline_id:e},a=n().Deferred();return t?(s.all="Y",s.enabled=i?"Y":"N"):(s.all="N",s.enabled=i),n().ajax({method:"POST",url:"/ajax/settings/pipeline/sources/duplication_control",data:s}).done(r().bind((function(e){(e=(0,d.cleanResponse)(e))&&e.success?a.resolve():a.reject()}))).fail((function(){a.reject()})),a}};var u="../build/transpiled/interface/settings/digital_pipeline/leads_sources";window.define(u,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([u])},790401:(e,t,i)=>{i.r(t),i.d(t,{default:()=>v});var s,n=i(661533),a=i.n(n),r=i(629133),o=i.n(r),l=i(955026),d=i(568547);function c(e,t,i,s,n,a,r){try{var o=e[a](r),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,n)}function u(e){return function(){var t=this,i=arguments;return new Promise((function(s,n){var a=e.apply(t,i);function r(e){c(a,s,n,r,o,"next",e)}function o(e){c(a,s,n,r,o,"throw",e)}r(void 0)}))}}function _(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function p(e,t){var i,s,n,a,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,s=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((n=(n=r.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){r.label=a[1];break}if(6===a[0]&&r.label<n[1]){r.label=n[1],n=a;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(a);break}n[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],s=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}var h={},f={},m=[d.default.TOKEN_TYPES.ADS,d.default.TOKEN_TYPES.FORMS,d.default.TOKEN_TYPES.CONVERSIONS_API],g={profile:{},link:"",result:!1};o().each(["vk","facebook","instagram_business"],(function(e){o().each(m,(function(t){var i,s,n;h[e]&&h[e][t]||(h[e]=o().extend((i={},s=t,n=a().extend(!0,{},g),s in i?Object.defineProperty(i,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[s]=n,i),h[e]))})),f[e]={}}));const v=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"setPipeline",value:function(e){e!==this.pipeline_id&&(s=null),this.pipeline_id=e}},{key:"getToken",value:function(e){if(!this.pipeline_id)throw new Error("No pipeline_id, need use 'setPipeline'");return!0!==e&&s?a().Deferred().resolve(s):"customers"===this.pipeline_id?a().ajax("/ajax/settings/pipeline/customers/token").then(o().bind((function(e){return s=e.data.triggers_token}),this)):a().ajax("/ajax/settings/pipeline/leads/".concat(this.pipeline_id,"/token")).then(o().bind((function(e){return s=e.response.token}),this))}},{key:"getFormPages",value:function(e){return this._getFormPages(e).then((function(e){return e=e.pages.data,o().each(e,(function(e){e.label=e.name,e.value=e.id})),e}))}},{key:"removeForm",value:function(e,t){return this.getToken().then((function(i){return a().ajax({url:"/api/forms/".concat(e,"/delete"),data:t,beforeSend:function(e){e.setRequestHeader("X-Auth-Token",i)},type:"POST"})}))}},{key:"_getFormPages",value:function(e){return this.getToken().then((function(t){return a().ajax({url:"/api/forms/".concat(e,"/pages"),beforeSend:function(e){e.setRequestHeader("X-Auth-Token",t)},type:"POST",dataType:"json",data:{account_id:APP.constant("account").id}}).then((function(e){return e=(0,l.cleanResponse)(e),(0,l.hasKeys)(e,["pages","data"])?a().Deferred().resolve(e):a().Deferred().reject(e)})).fail((function(e){return a().Deferred().reject(e)}))}))}},{key:"logoutForm",value:function(e){var t=d.default.TOKEN_TYPES.FORMS;return this.logout(e,{type:t}).then((function(){h[e][t]=a().extend(!0,{},g)}))}},{key:"logoutAds",value:function(e){var t=d.default.TOKEN_TYPES.ADS;return this.logout(e,{type:t}).then((function(){h[e][t]=a().extend(!0,{},g)}))}},{key:"logoutMetaConversions",value:function(e){var t=this;return u((function(){var i;return p(this,(function(s){return i=d.default.TOKEN_TYPES.CONVERSIONS_API,[2,t.logout("meta_conversions").then((function(){h[e][i]=a().extend(!0,{},g)}))]}))}))()}},{key:"logout",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getToken().then((function(s){return a().ajax({method:"POST",url:"/api/triggers/handler/".concat("instagram_business"===e?"facebook":e,"/logout"),beforeSend:o().bind((function(e){e.setRequestHeader("X-Auth-Token",s)}),t),data:i})}),this)}},{key:"checkAuthForms",value:function(e){var t=d.default.TOKEN_TYPES.FORMS,i={type:t,service:"forms"};return h[e][t].result?Promise.resolve(h[e][t]):this._checkAuth({service_name:e,type:t,data:i}).then((function(i){var s=h[e][t];return i&&(s.result=i.result,s.profile=i.profile),s}))}},{key:"checkAuthAds",value:function(e){var t=d.default.TOKEN_TYPES.ADS,i={type:t};return h[e][t].result?Promise.resolve(h[e][t]):this._checkAuth({service_name:e,type:t,data:i})}},{key:"checkAuthMetaConversions",value:function(){var e=this;return u((function(){var t,i,s;return p(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=d.default.TOKEN_TYPES.CONVERSIONS_API,h.facebook[t].result?[2,Promise.resolve(h.facebook[t])]:[4,e.makeRequest("meta_conversions",{})];case 1:return i=n.sent().response,[2,{result:null==(s=null==i?void 0:i.auth)?void 0:s.result,link:null==s?void 0:s.link}];case 2:return n.sent(),[2,{result:!1}];case 3:return[2]}}))}))()}},{key:"_checkAuth",value:function(e){var t=e.service_name,i=e.type,s=e.data;return this.makeRequest(t,s).then((function(e){var s=h[t][i];return e=(0,l.cleanResponse)(e),(0,l.hasKeys)(e,["auth","result"])&&(s.result=e.auth.result),(0,l.hasKeys)(e,["auth","profile"])&&(s.profile=e.auth.profile),(0,l.hasKeys)(e,["auth","link"])&&(s.link=e.auth.link),{result:s.result,profile:s.profile,link:s.link}}))}},{key:"makeRequest",value:function(e,t){return this.getToken().then((function(){return a().ajax({url:"/api/triggers/handler/".concat("instagram_business"===e?"facebook":e,"/check_auth?source=v3"),beforeSend:function(e){e.setRequestHeader("X-Auth-Token",s)},data:t,type:"POST",dataType:"json"})}))}},{key:"checkGroupAuth",value:function(e,t){return this.makeRequest(e,{group_id:t,service:"forms"}).then((function(i){var s=f[e];return i=(0,l.cleanResponse)(i),s[t]||(s[t]={}),(0,l.hasKeys)(i,["auth","result"])&&(s[t].result=i.auth.result),(0,l.hasKeys)(i,["auth","link"])&&(s[t].link=i.auth.link),{result:s[t].result,link:s[t].link}}))}},{key:"isAuthorized",value:function(e,t){if(!t||!e)throw new Error("No type or service_name");return h[e][t].result}},{key:"isAuthorizedGroup",value:function(e,t){if(!t||!e)throw new Error("No group_id or service_name");return!!f[e][t]&&f[e][t].result}},{key:"getCurrentProfileHandler",value:function(e){if(!e)throw new Error("No service_name");return h[e][d.default.TOKEN_TYPES.ADS].profile}},{key:"getAuthLink",value:function(e,t){if(!t||!e)throw new Error("No type or service_name");return h[e][t].link}},{key:"getAuthLinkGroup",value:function(e,t){if(!t||!e)throw new Error("No group_id or service_name");return f[e][t]?f[e][t].link:""}},{key:"reset",value:function(e,t){if(!t||!e)throw new Error("No type or service_name");h[e][t].result=!1,h[e][t].profile={}}},{key:"getMetaConversionsPages",value:function(){var e=this;return u((function(){var t,i,s,n,r,o;return p(this,(function(l){switch(l.label){case 0:return[4,e.getToken()];case 1:return r=l.sent(),[4,a().ajax({url:(null===(n=APP.constant("settings_pipeline_template_params"))||void 0===n||null===(s=n.data)||void 0===s||null===(i=s.endpoints)||void 0===i||null===(t=i.meta_conversions)||void 0===t?void 0:t.pages)||"/api/triggers/handler/meta_conversions/pages",beforeSend:function(e){e.setRequestHeader("X-Auth-Token",r)},type:"GET"})];case 2:return[2,null==(o=l.sent().response)?void 0:o.pages]}}))}))()}}],i&&_(t.prototype,i),e}());var y="../build/transpiled/interface/settings/services/api";window.define(y,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([y])},681673:(e,t,i)=>{i.r(t),i.d(t,{default:()=>o});var s=i(629133),n=i.n(s),a=i(345839),r=i.n(a);const o=r().Model.extend({url:function(){return APP.constant("account").amo_messenger.server+"/api/amo/bots/"+this.id},isNew:function(){var e=parseInt(this.id);return n().isNaN(e)||0===e},isEmpty:function(){return n().isEmpty(this.get("positions"))||n().isEmpty(this.get("text"))},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.method="GET",e.crossDomain=!0,e.headers={Authorization:"Bearer ".concat(APP.constant("amo_messenger").token)},r().Model.prototype.fetch.call(this,e)},parse:function(e){return{id:e.id,name:e.title}}});var l="../build/transpiled/network/bots/businessbot_model";window.define(l,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([l])},283346:(e,t,i)=>{i.r(t),i.d(t,{default:()=>o});var s=i(629133),n=i.n(s),a=i(974839),r=i.n(a);const o=r().Collection.extend({url:"/private/ajax/v2/json/helpbot/",initialize:function(){this.fetched=!1},fetch:function(){return this.fetched=!1,r().Collection.prototype.fetch.call(this).then(n().bind((function(){this.fetched=!0}),this))}});var l="../build/transpiled/network/bots/helpbot_collection";window.define(l,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([l])},379177:(e,t,i)=>{i.r(t),i.d(t,{default:()=>_});var s=i(629133),n=i.n(s),a=i(974839),r=i.n(a),o=i(29368),l=i(976453),d=i(168807),c=i(487770),u="/ajax/v2/salesbot/";const _=r().Model.extend({url:function(){return this.isNew()?u:u+this.id},isNew:function(){var e=parseInt(this.id);return n().isNaN(e)||0===e},isEmpty:function(){return n().isEmpty(this.get("positions"))||n().isEmpty(this.get("text"))},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.url="/ajax/v4/bots/"+this.get("id"),n().isArray(e.with)&&e.with.length&&(e.url+="?with=",n().each(e.with,(function(t){e.url+="".concat(t,",")})),e.url=e.url.slice(0,-1)),r().Model.prototype.fetch.call(this,e)},_calcConversation:function(e){return e.launches>0?Math.round(e.success/e.launches*100):0},parse:function(e){var t;return n().isUndefined(e)||(t=n().propertyOf(e)(["_embedded","items",0])||e,(n().isUndefined(t.stats)||null===t.stats)&&(t.stats={launches:0,success:0,active:0}),t.settings&&(t.settings.is_sandbox=t.settings.is_sandbox||t.settings.is_broadcast_sandbox),t.is_active=!!n().isUndefined(n().propertyOf(t)(["settings","active"]))||t.settings.active,t.is_launched=t.stats.active>0,t.stats.conversion=this._calcConversation(t.stats)),r().Model.prototype.parse.apply(this,arguments),n().property(["items",0])(this.embedded)||e},export:function(){var e=this.toJSON();return l.default.export({type_functionality:this.getFunctionalityTypeSmarty(),modelJSON:e})},save:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n().omit(this.toJSON(),"bots_triggers");d.storeWithExpiration.remove(c.default.SALESBOT_CACHE_CODE),e.wait=!0,this.isNew()&&(t=[t]),n().propertyOf(t)("text")&&n().isObject(t.text)&&(t.text=JSON.stringify(t.text)),e.attrs={salesbot:t};var i=e.success||n().noop;return e.success=n().bind((function(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];this.get("text")&&n().isObject(this.get("text"))&&this.set({text:JSON.stringify(this.get("text"))}),i.apply(e.context,s)}),this),r().Model.prototype.save.call(this,t,e)},getFunctionalityTypeSmarty:function(){var e=this.get("type_functionality");return n().isNumber(e)?e:(e=n().invert(o.default.API_V4_TYPES_MAP)[e],n().isNumber(e)?e:this.getFunctionalityType())},getFunctionalityType:function(){return(this.get("settings")||{}).type_functionality||o.default.BOT_TYPE_REGULAR},isFunctionalityType:function(e){return n().contains([].concat(e),this.getFunctionalityType())}});var p="../build/transpiled/network/bots/model";window.define(p,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([p])},535503:(e,t,i)=>{i.r(t),i.d(t,{default:()=>p});var s=i(629133),n=i.n(s),a=i(974839),r=i.n(a),o=i(727406),l=i(379177),d=i(29368),c=i(445368),u=i(661533),_="/ajax/v4/bots/?with=launches";const p=(0,o.wrapCacheCollection)(r().Collection.extend({url:function(e){return e=n().defaults({},e,{navigate:"self"}),this.links[e.navigate]?this.links[e.navigate].href:this.initial_url},model:l.default,pagination_support:!0,FIELDS:[{id:"bots_name",code:"bots_name",shown:!0,template:"bots_name",title:(0,c.i18n)("Name"),type_code:"text",filterable:!1,sortable:!1,width:25},{id:"bots_triggers",code:"bots_triggers",shown:!0,template:"bots_triggers",title:(0,c.i18n)("Triggers"),type_code:"text",filterable:!1,sortable:!1,width:25},{id:"bots_conversion",code:"bots_conversion",shown:!0,template:"percent",title:(0,c.i18n)("Conversion"),type_code:"text",filterable:!1,sortable:!1,width:25},{id:"bots_total_launches",code:"bots_total_launches",shown:!0,template:"text",title:(0,c.i18n)("Total launched"),type_code:"text",filterable:!1,sortable:!1,width:25},{id:"bots_current_launched",code:"bots_current_launched",shown:!0,template:"text",title:(0,c.i18n)("Total launched"),type_code:"text",filterable:!1,sortable:!1,width:25}],initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.bot_types=n().isUndefined(t.types)?[]:[].concat(t.types),this.active_status=n().isUndefined(t.active_status)?d.default.ACTIVE_STATUS:t.active_status,this.links_initial={},this.sort_id=t.sort_id||"asc",this.links={},this.limit=t.limit||50,this.initial_url="".concat(window.location.origin+_,"&page=1&limit=").concat(this.limit,"&sort%5Bid%5D=").concat(this.sort_id),n().isEmpty(this.bot_types)||n().each(this.bot_types,n().bind((function(e,t){this.initial_url+="&filter%5Btype_functionality%5D%5B".concat(t,"%5D=").concat(d.default.API_V4_TYPES_MAP[parseInt(e)])}),this)),this.active_status!==d.default.ANY_STATUS&&(this.initial_url+="&is_active=".concat(this.active_status)),this.on("destroy sync",(function(e){e.collection&&this.clearCache({namespace_full:!0})}),this)},isLastPage:function(){return!n().isEmpty(this.links)&&n().isEmpty(this.links.next)||n().propertyOf(this.attributes)("_total_items")===this.length},getCacheId:function(e){var t="";return n().isEmpty(this.bot_types)||(t=JSON.stringify(this.bot_types)),(this.url(e)||_)+t},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().defaults(e,{navigate:"next",remove:!1,add:!0,merge:!0}),e.url=this.url(e),r().Collection.prototype.fetch.apply(this,arguments)},set:function(e,t){var i=this.getCache(this.getCacheId({navigate:"first"}));t=t||{};var s=r().Collection.prototype.set.apply(this,arguments);if(t.cache_update&&e.get("id")){if(i._embedded.items.find((function(t){return t.id===e.get("id")})))return void e.attributes;i._embedded.items.push(e.attributes)}return!n().isEmpty(this.links)&&n().isEmpty(this.links_initial)&&(this.links_initial=n().clone(this.links)),s},parse:function(e){return r().Collection.prototype.parse.apply(this,arguments),n().property(["items"])(this.embedded)||e},comparator:function(e){return 0===parseInt(e.id)?-1/0:-e.id},fetchOne:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this;return new Promise((function(s,n){var a=i.model;if(i.get(e)&&!t)return s(i.get(e));var r=new a({id:e});r.fetch({with:["launches","stats","text","positions"]}).then((function(){i.set(r,{merge:!0,remove:!1}),s(r)}),n)}))},fetchMultiple:function(e){var t=this,i={id:e},s=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).is_need_to_unshift_new_items||!1;return new Promise((function(e,a){u.ajax({url:"/ajax/v4/bots/list",type:"POST",dataType:"json",data:JSON.stringify(i)}).then((function(i){n().propertyOf(i)(["_embedded","items"])&&n().each(i._embedded.items,(function(e){s?t.unshift(e,{merge:!0,remove:!1}):t.set(e,{merge:!0,remove:!1})})),e(i)}),a)}))}}));var h="../build/transpiled/network/bots/salesbot_collection";window.define(h,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([h])},584104:(e,t,i)=>{i.r(t),i.d(t,{getGrouppedTriggers:()=>a});var s=i(249017),n=new Map,a=function(e){if(n.has(e))return n.get(e);var t=Object.fromEntries(s.TRIGGERS.map((function(t){return[t[e],t]})));return n.set(e,t),t}},406026:(e,t,i)=>{i.r(t),i.d(t,{getGrouppedTriggers:()=>s.getGrouppedTriggers});var s=i(584104)},506379:(e,t,i)=>{i.r(t),i.d(t,{TRIGGERS:()=>s.TRIGGERS,getGrouppedTriggers:()=>n.getGrouppedTriggers});var s=i(249017),n=i(406026)},249017:(e,t,i)=>{i.r(t),i.d(t,{TRIGGERS:()=>s});var s=[{id:1,name:"lead_added",label:"Created in pipeline stage"},{id:13,name:"lead_responsible_changed",label:"Resp. user changed"},{id:14,name:"lead_status_changed",label:"Moved to pipeline stage"},{id:15,name:"lead_appeared_in_status",label:"Moved to or created in stage"},{id:16,name:"mail_in",label:"Email received"},{id:17,name:"call_in",label:"Call received"},{id:18,name:"site_visit",label:"Website visited (trigger)"},{id:19,name:"chat",label:"First chat of the day"},{id:20,name:"customer_added",label:"Customer created"},{id:21,name:"customer_period_changed",label:null},{id:22,name:"customer_appeared_in_period",label:null},{id:26,name:"transaction_added",label:"Purchase"},{id:43,name:"customer_responsible_changed",label:"Resp. user changed"},{id:46,name:"form_filled",label:"Form submitted"},{id:57,name:"customer_status_changed",label:"Moved to pipeline stage"},{id:58,name:"customer_appeared_in_status",label:"Moved to or created in stage"},{id:62,name:"invoice_paid",label:"When an invoice/purchase is paid"},{id:63,name:"tag_added",label:null},{id:64,name:"tag_removed",label:null},{id:94,name:"segment_attached",label:"Segment attached"},{id:95,name:"segment_detached",label:"Segment detached"},{id:116,name:"key_action_completed",label:null},{id:119,name:"talk_created",label:"Any new conversation"},{id:120,name:"talk_closed",label:"Talk closed"},{id:121,name:"relative_date",label:null},{id:123,name:"invoice_added",label:"When an invoice/purchase is added"},{id:124,name:"first_incoming_message",label:"Incoming conversation"},{id:140,name:"incoming_outgoing_message_first_time_that_cool_down",label:"First chat of the day"},{id:141,name:"last_incoming_message",label:"Message received (advanced)"},{id:142,name:"outgoing_message",label:"Message sent"},{id:143,name:"incoming_message",label:"Message received"},{id:144,name:"seen_messages",label:"Message seen"},{id:145,name:"incoming_outgoing_message_first_time_that_cool_down",label:null},{id:146,name:"incoming_outgoing_message_first_time_that_cool_down",label:"Any new conversation"},{id:147,name:"field_value_changed",label:"Field updated"},{id:154,name:"incoming_mentioned_event",label:"Story mention"},{id:155,name:"incoming_comment_event",label:"Comment received"},{id:156,name:"instagram_user_followed",label:"New Instagram follower"},{id:160,name:"tag_changed",label:null},{id:161,name:"incoming_message_first_time_that_hidden_cool_down",label:null},{id:163,name:"last_incoming_message_date",label:"Last incoming message"},{id:170,name:"emotion_added",label:"Emotion is detected"}]}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_17_08_33"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="df538711-9191-46de-9171-4dba1f40fe4d",e._sentryDebugIdIdentifier="sentry-dbid-df538711-9191-46de-9171-4dba1f40fe4d")}catch(e){}}();
//# sourceMappingURL=60882.1317f0a32ca388706e66.js.map