"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[1103,98857],{246922:(e,t,i)=>{i.r(t),i.d(t,{default:()=>m});var n=i(629133),s=i.n(n),r=i(267651),o=i.n(r),a=i(214558),d=i(500034),l=i(353256),c=i(661533),h=!1,_=!1,u=0,f=function(){return{min_width:30,max_width:50,entity:APP.getBaseEntity(),entity_type:APP.element_types[APP.getBaseEntity()]}};const m={init:function(){this._$cr_resizer=this.$el.find(".js-card-column-resizer"),this._$cr_fields=this.$el.find(".js-card-fields"),this.$el.on("mousedown.card:col-resizer touchstart.card:col-resizer",".js-card-column-resizer",s().bind(this._updateCRContainerWidth,this)),c(document).on("mouseup.card:col-resizer touchend.card:col-resizer",s().bind(this._stopCRHandler,this))},destroy:function(){c(document).off(".card:col-resizer")},_updateCRContainerWidth:function(e){e.preventDefault(),h=!0,u=e.clientX||e.originalEvent.touches[0].clientX,this._cr_container_width=this.$el.get(0).offsetWidth,this._cr_fields_min_width=parseInt(this.$el.find(".js-card-fields").css("min-width")),this._cr_fields_start_width=this._$cr_fields.get(0).offsetWidth,this._cr_fixed_notes=this.$el.find(".js-note.outside, .js-future-tasks-fixable"),this._cr_fixed_notes_widths=c.makeArray(this._cr_fixed_notes.map((function(e,t){return t.offsetWidth}))),this._$cr_resizer.addClass("is-dragging"),c("body").addClass("block-selection-prepended"),c(document).on("mousemove.card:col-resizer touchmove.card:col-resizer",s().bind(this._resizeCRHandler,this))},_resizeCRHandler:function(e){var t,i,n,r=s().result(this,"_getColumnResizerParams",f);e.preventDefault(),h&&(_=!0,t=u-(e.clientX||e.originalEvent.touches[0].clientX),((i=100*(n=this._cr_fields_start_width-t)/this._cr_container_width)<r.min_width||n<=this._cr_fields_min_width)&&((n=(i=r.min_width)*this._cr_container_width/100)<this._cr_fields_min_width&&(n=this._cr_fields_min_width),t=this._cr_fields_start_width-n),i>r.max_width&&(i=r.max_width,t=this._cr_fields_start_width-i*this._cr_container_width/100),this._$cr_fields.css("width","".concat(i,"%")),((0,d.isFeatureAvailable)("airewriter")||(0,d.isFeatureAvailable)("kommo_ai_trial_started")&&!(0,d.isFeatureAvailable)("kommo_ai_trial_ended"))&&o().publish(l.AI_HELPER_RESIZE),this._cr_fixed_notes.each(s().bind((function(e,i){c(i).css("width",this._cr_fixed_notes_widths[e]+t)}),this)))},_stopCRHandler:function(){var e=parseFloat(this._$cr_fields.get(0).style.width),t=s().result(this,"_getColumnResizerParams",f),i=(0,a.current)("settings")||{};h=!1,this._$cr_resizer.hasClass("is-dragging")&&(c(document).off("mousemove.card:col-resizer touchmove.card:col-resizer"),this._$cr_resizer.removeClass("is-dragging"),c("body").removeClass("block-selection-prepended"),c(window).trigger("resize"),_&&(s().isEmpty(i.layout_width)||(i.layout_width[t.entity]||(i.layout_width[t.entity]={}),i.layout_width[t.entity].width=e,(0,a.current)("settings",i)),c.ajax({url:"/ajax/card/layout/set/",type:"POST",data:{entity_type:t.entity_type,value:e},success:function(e){s().isNull(i.layout_width)&&(i.layout_width=e.response.settings,(0,a.current)("settings",i))}}))),_=!1}};var p="../build/transpiled/interface/card/mixins/column_resizer";window.define(p,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([p])},210481:(e,t,i)=>{i.r(t),i.d(t,{default:()=>_});var n=i(661533),s=i.n(n),r=i(629133),o=i.n(r),a=i(460159),d=i.n(a),l=i(168807),c=i(955026),h=!1;s()(document).on("mouseup.linked:form",(function(){h=!1}));const _={addNewVariant:function(e,t){var i,n,r=s()(e.currentTarget).closest(".linked-form__field-add-multiple"),a=r.prev(".linked-form__field"),d=a.find('input[type="text"]:first'),c=(0,l.randString)(10);t=t||this,this.hideTip(),d.val()?(i=a.clone(),r.before(i),(n=i.find("input")).val(""),o().each(n,(function(e){var i=s()(e),n=i.attr("name").replace(/\]\[([a-zA-Z]+)\]\[/,"][".concat(c,"]["));i.attr("name",n),t.model.set(n,t.getInputValue(i))}),this),n.trigger("change").trigger("controls:change"),t.model.setDefaults(),this.checkChanges(),this.focusAndSetCursorToEnd(i.find('input[type="text"]:first'))):this.focusAndSetCursorToEnd(d)},tipChecks:{company:function(e){return!!e.find(":input:visible").attr("data-value-id")}},hideTip:function(){this.$tip&&(this.cf_edit_prevented=!1,s()(document).trigger("controls:hide",["tip"]),this.$tip=!1)},initTipAction:function(e){var t=s()(e.currentTarget),i=t.attr("data-widget")||!1,n=t.closest(".js-linked-has-actions");n.get(0)||(n=s()(".js-linked-has-actions[data-value=".concat(t.data("value"),"]")));var r,a=n.find(':input[name!=""]').val(),d=t.attr("data-type"),l=APP.constant("user_rights").is_free_user;o().contains(["profile_link","set_main_profile","unlink_profile"],d)&&(a=t.attr("data-value")),"profile_link"===d&&(d="link"),this.cf_edit_prevented=!1,i&&!l?o().isObject(APP.widgets.cf_actions[d])&&(r=APP.widgets.cf_actions[d][i],o().isFunction(r)&&(this.hideTip(),r({value:a,model:this.model}))):"function"==typeof this.tipActions[d]&&(e.preventDefault(),this.hideTip(),this.tipActions[d].call(this,n,a,t)),e.stopPropagation()},showActions:function(e){var t,i,n,r,a,l=s()(e.currentTarget),_=l.find(":input:visible"),u=l.attr("data-pei-code"),f=l.attr("data-check"),m=0;if(this.mousemove&&h&&_.val())_.addClass("prevent-readonly").attr("readonly",!0);else if(!s()(e.target).closest(".js-control--suggest--list").length&&_.val()){if(!f||this.tipChecks[f](l)){if(e.stopPropagation(),i=APP.widgets.cf_actions[u]||{},n=o().keys(i),this.hideTip(),this.$tip=l.children(".js-tip").get(0)?l.children(".js-tip"):l.children(".js-tip-holder").children(".js-tip"),this.$tip.find("div[data-type=".concat(u,"]")).not(":first").remove(),o().each(n,(function(e,t){var i,s=APP.widgets.list[n[t]]||!1,o="";s&&(i=this.$tip.find("div[data-type=".concat(u,"]:first")),0!==m&&(i=i.clone(),this.$tip.children(".js-tip-items").prepend(i)),o=s.langs.widget.call_action||s.langs.widget.name||"---",r="email"===u?'<span class="tips-icon icon icon-inline icon-mail-dark"></span> ':'<span class="tips-icon icon icon-inline icon-phone-dark"></span> ',i.attr("data-widget",n[t]).html(r+o),m++)}),this),this.write_first_lead_sources_collection&&"phone"===u&&this.model.get("ID")&&(this.$tip.find('[data-type="write_first"]').remove(),a=this.write_first_lead_sources_collection.getIdsGroupedByOrigin(),this.write_first_lead_sources_collection.each((function(e){var t=this.$tip.find('[data-type="copy"]'),i=e.getOrigin(),n=e.getSourceId(),s=a[i].length>1||Boolean(e.getName())?e.getNameWithOrigin():e.getFormattedOriginName({with_widget_name:!1});t.before(d()({ref:"/tmpl/common/tip_item.twig"}).render({item:{class_name:"js-cf-actions-item",additional_data:o().compact(['data-type="write_first"',n?'data-source-id="'.concat(n,'"'):null,'data-source-origin="'.concat(i,'"'),'data-contact-id="'.concat(this.model.get("ID"),'"')]).join(" "),should_be_raw:!0,image_icon:e.getOriginIconUrl(),text:s}}))}),this)),this.model.get("disabled")){if(this.$tip.find('.js-cf-actions-item[data-type="edit"]').hide(),1===(t=this.$tip.find('.js-cf-actions-item:not([data-type="edit"])')).length)return t.trigger("click"),!1}else this.$tip.find('.js-cf-actions-item[data-type="edit"]').show();return"email"===u&&((0,c.isValidEmailForSending)(_.val())&&(0,c.hasKeys)(APP.constant("amomail"),["mailboxes","active"])&&APP.constant("amomail").mailboxes.active>0?this.$tip.find('[data-type="email_with_template"]').removeClass("hidden"):this.$tip.find('[data-type="email_with_template"]').addClass("hidden")),this.$tip.trigger("tip:show",[!0]),this.$tip.is(":visible")||(this.$tip=!1),!1}this.cf_edit_prevented=!1,this.focusAndSetCursorToEnd(_)}},showHiddenFieldsOnFocus:function(){var e=this.$(".linked-form__fields > div").filter((function(){return!s()(this).hasClass("linked-form__field-no-value")&&!s()(this).hasClass("linked-form__field-shower")})).last();this.showHiddenFields();var t=e.next().find("input:visible, textarea:visible");t.length&&this.focusAndSetCursorToEnd(t)},showHiddenFields:function(e){s()(e&&e.currentTarget||this.$(".js-linked-show-all-fields")).closest(".linked-form__field-shower").remove(),this.$(".linked-form__field-no-value").children(".linked-form__field, .linked-form__multiple-container").unwrap(),this.$("textarea").trigger("controls:textarea:autosize")},focusOnName:function(e){s()(e.currentTarget).closest(".linked-form__field__value-name").removeClass("empty").addClass("focused")},unfocusOnName:function(e){var t=s()(e.currentTarget),i=t.closest(".linked-form__field__value-name");i.removeClass("focused"),t.val()||1!==t.parent().find(".text-input").length||i.addClass("empty")},moveOnHasActionsField:function(){h&&!this.mousemove&&(this.mousemove=!0)},beforeFocusHasActionsField:function(e){var t=s()(e.currentTarget);this.cf_edit_prevented=!1,h=!0,this.mousemove=!1,APP.is_touch_device&&t.val()&&t.prop("readonly",!0),t.val()&&(this.cf_edit_prevented=!0)},selectInHasActionsField:function(e){s()(e.currentTarget).select()},focusHasActionsField:function(e){var t=s()(e.currentTarget);this.cf_edit_prevented&&t.val()?t.addClass("prevent-readonly").attr("readonly",!0):t.removeClass("prevent-readonly").prop("readonly",!1)},unfocusHasActionsField:function(e){var t=s()(e.currentTarget);t.val()?t.closest(".js-linked-has-actions,.js-linked-with-actions").addClass("js-linked-has-value"):t.closest(".js-linked-has-actions,.js-linked-with-actions").removeClass("js-linked-has-value")},focusField:function(e){var t=s()(e.currentTarget),i=t.val();if(this.$tip&&this.$tip.is(":visible"))return this.hideTip(),t.blur(),!1;this.cf_edit_prevented&&t.closest(".js-linked-has-actions").length||(t.addClass("js-linked-in-edit").closest(".linked-form__field").addClass("linked-form__field-focused"),t.get(0).setSelectionRange&&t.is('input[type="text"], textarea')&&t.get(0).setSelectionRange(i.length,i.length))},unfocusField:function(e){s()(e.currentTarget).removeClass("js-linked-in-edit").closest(".linked-form__field").removeClass("linked-form__field-focused")},focusAndSetCursorToEnd:function(e){if(e.length){var t=(e.val()||"").length;e.removeClass("prevent-readonly").prop("readonly",!1).focus(),e[0].setSelectionRange(t,t)}},showHideAddVariant:function(e){var t=s()(e.currentTarget),i=t.closest(".linked-form__field-pei"),n="show";i.siblings().length>=500?n="hide":t.val()?n="show":i.prev(".linked-form__field-pei").length||(n="hide"),i.next(".linked-form__field-add-multiple")[n]()}};var u="../build/transpiled/interface/card/mixins/common";window.define(u,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([u])},288473:(e,t,i)=>{i.r(t),i.d(t,{ErrorTipView:()=>w,ErrorsModel:()=>g,Validation:()=>k});var n=i(661533),s=i.n(n),r=i(629133),o=i.n(r),a=i(345839),d=i.n(a),l=i(460159),c=i.n(l),h=i(313981),_=i(445368),u=i(577486);i(368439);var f={leads:".linked-form__field",contacts:".linked-form__field",companies:".linked-form__field"},m={leads:".linked-form__field__value",contacts:".linked-form__field__value, .card-cf-value-wrapper, .contact_name_wrapper__suggest, .linked-form__field__value-name",companies:".linked-form__field__value, .card-cf-value-wrapper, .contact_name_wrapper__suggest, .linked-form__field__value-name"},p=o().invert(APP.element_types),v=d().Model.prototype.toJSON,g=d().Model.extend({count:function(){return o().keys(this.toJSON()).length},clear:function(){o().each(o().keys(this.toJSON()),(function(e){this.unset(e,{silent:!0}),this.trigger("tip:remove",e)}),this)}}),w=h.default.extend({className:"js-validation-tip validation-tip",template:o().template("<%= count %> ".concat((0,_.i18n)("step_of")," <%= all_count %>")),_selectors:function(){return{cf_group:".js-cf-group-wrapper, .js-card-main-fields"}},initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.code)throw new Error("options.code not passed to error tip view");return this.model.on("change",this.render,this),this.model.on("tip:remove",this.checkRemove,this),this.model.on("tip:scroll_to",this.scrollTo,this),this.$scroller=e.$scroller,this.code=e.code,this.render(),this},render:function(){return this.model.get(this.code)&&this.$el.html(this.template({all_count:this.model.count(),count:o().indexOf(o().keys(this.model.toJSON()),this.code)+1})),this},animate:function(){this.$el.prepareTransition().addClass("showed")},checkRemove:function(e){this.code===e&&this.remove()},scrollTo:function(e){var t,i,n=this.$scroller;if(this.code===e){if(!(t=(this.$el.is(":visible")?this.$el:this.$el.closest("form")).offset()))return;this.model.trigger("tabs:switch",this.$el.closest(this._selector("cf_group")).attr("data-id")||"default"),i=n[0].scrollTop+t.top-5,APP.is_touch_device?n.scrollTop(i):n.animate({scrollTop:i},300)}}}),k=h.default.extend({has_errors:!1,errors_count:0,index:1,pipeline_prefix:"p_",status_prefix:"s_",buttonTemplate:c()._preload(["/tmpl/cards/forms/validation.twig"],"_buttonTemplate"),_buttonTemplate:function(e,t){this._removeButtonCap(),e.prepend(c()({ref:"/tmpl/cards/forms/validation.twig"}).render(o().extend({},t,{text:(0,_.i18n)("card_validation_error"),no_button:!0,class_name:"validation-button-cap__tooltip validation-button-cap__tooltip_showed"})))},_selectors:function(){return{form_container:".card-holder__container",main_form:"#edit_card",name:"#person_n",save_btn:"#save_and_close_contacts_link",validation_counter:"#validation_counter",validation_tooltip:".validation-button-cap__tooltip",cf_group:".js-cf-group-wrapper, .js-card-main-fields",main_fields:".js-card-main-fields",validate_input:":input:not(.js-form-changes-skip)"}},_classes:function(){return{validation_class:"validation-not-valid"}},_events:function(){var e={"click .validation-button-cap__arrow":"changeIndex","mouseenter .validation-button-cap":"onButtonHover","mouseleave .validation-button-cap":"onButtonHover","mouseenter .validation-button-cap__tooltip":"onToolTipHover"};return e["input ".concat(this._selector("validate_input"))]="checkErrorChange",e["change ".concat(this._selector("validate_input"))]="checkErrorChange",e["controls:change ".concat(this._selector("validate_input"))]="checkErrorChange",e},initialize:function(e){if(e=s().extend({rules:APP.constant("card_validation_rules")},e||{}),this.model=new g,this._enabled=parseInt(e.element_type)===APP.element_types.leads,!this._enabled)return this;if(this.model.on("change",this.checkErrorsHash,this),!e.rules)throw new Error("Validation rules should be present in the parameters!");if(!e.linked)throw new Error("Linked forms should be present in the parameters!");this.rules=this.replaceContactNameWithN(e.rules),this.linked=e.linked,this.onError=e.onError,this.formModel=e.formModel},destroy:function(){this.stopValidating(!0)},changeIndex:function(e){var t=s()(e.currentTarget).hasClass("left")?-1:1;this.setIndex(this.index+t)},onButtonHover:function(e){var t;switch(e.type){case"mouseenter":t=!0;break;case"mouseleave":t=!1}o().isBoolean(t)&&this._findElem("validation_tooltip").toggle(t).prepareTransition().toggleClass("validation-button-cap__tooltip_showed",t)},onToolTipHover:function(){this.onButtonHover({type:"mouseleave"})},checkErrorChange:o().debounce((function(e){var t,i=s()(e.currentTarget),n=!1,r=!1,a="leads",d=i.attr("name");if(d&&!o().contains(["lead[STATUS]","lead[PIPELINE_ID]"],d)){if(t=o().find(this.linked.form_views,(function(e){return!!s().contains(e.el,i[0])&&e}),this)){if(a=p[t.model.get("ELEMENT_TYPE")],t.model.is_add&&!t.hasChanges())return void this.clearFormErrors(t.$el,v.call(t.model),a);r=t.$el,n=v.call(t.model)}n||(n=this.mainFormData()),r||(r=this._elem("main_form")),this.checkFormErrors(r,n,a)}}),100),setIndex:function(e){var t=this.model.keys().length;switch(!0){case e>t:this.index=1;break;case 0===e:this.index=t;break;default:this.index=e}this.scrollTo(this.index)},stopValidating:function(e){this.undelegateEvents(this._events()).stopListening(),!0===e&&(this._clearTabsNotifications(),this.renderButtonCap(0),this.model.clear(),this._findElem("validation_class").removeClass(this._class("validation_class")))},check:function(e){var t=0,i=this.model.count();return e=e||{},this.index=1,e.status_id&&this._enabled&&(t=this.checkErrors({rules:this.rules,status_id:e.status_id,pipeline_id:e.pipeline_id,form_view:e.form_view,linked:this.linked}))>0&&!i&&(this.setIndex(1),this.delegateEvents(this._events())),t},scrollTo:function(e){this.model.trigger("tip:scroll_to",this.model.keys()[e-1]),this.renderButtonCap()},renderButtonCap:function(e){e=o().isUndefined(e)?this.model.count():e,this._removeButtonCap(),e?(this._elem("save_btn").hide(),this.buttonTemplate(this._elem("save_btn").parent(),{index:this.index,count:e})):this._elem("save_btn").show()},_removeButtonCap:function(){this._findElem("validation_counter").remove(),this._findElem("validation_tooltip").remove()},checkErrorsHash:function(){var e=this.model.count();this.renderButtonCap(e),e||this.stopValidating()},mainFormData:function(){return this.formModel.toJSON()},prepareRules:function(e,t,i){var n,s,r={};return o().each(e,(function(e,a){e=i?e[this.pipeline_prefix+i]:o().find(e),n=o().keys(e),s=o().indexOf(n,this.status_prefix+t),n=143===parseInt(t)?[n[s]]:o().difference(n,o().drop(n,++s)),r[a]=o().flatten(o().filter(e,(function(e,t){return o().indexOf(n,t)>=0}),this))}),this),this.replaceContactNameWithN(r)},hasErrors:function(){return this.model.count()>0},setError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!e.rule_name)throw new Error("Cant't set error with no rule_name");if(!e.$form_el)throw new Error("Parameter params.form_el not passed");var i=e.input_names||[e.rule_name],n=(e.salt||"")+e.rule_name,s={entity:e.entity,code:n,$form_el:e.$form_el,input_names:i};t?(!0!==this.model.get(n)&&(this.model.set(n,!0),this.toggleErrorTip(s,!0)),o().isFunction(this.onError)&&this.onError()):this.model.get(n)&&(this.model.unset(n),this.toggleErrorTip(s,!1))},updateRules:function(e){e.status_id&&(e.rules=e.rules||o().clone(this.rules),this._rules=this.prepareRules(e.rules,e.status_id,e.pipeline_id))},checkErrors:function(e){var t=0;return e=e||{},this.updateRules(e),e.form_view?t+=this.checkLinkedErrors(e.form_view):(t+=this.checkFormErrors(this._elem("main_form"),this.mainFormData(),"leads"),t+=this.checkLinkedErrors()),t},checkLinkedErrors:function(e){var t=0;return o().isUndefined(e)||o().isArray(e)||(e=[e]),e=e||this.linked.form_views,o().findLastIndex(e,(function(e){return(!e.model.is_add||e.model.is_add&&e.model.hasChanges())&&(t+=this.checkFormErrors(e.$el,v.call(e.model),p[e.model.get("ELEMENT_TYPE")]))&&o().isFunction(e.showHiddenFields)&&e.showHiddenFields(),t>=30}),this),t},clearFormErrors:function(e,t,i){this.checkFormErrors(e,t,i,!0)},checkFormErrors:function(e,t,i,n){var s,r,a,d,l=0,c="removeAttr";if(this._rules)return o().each(this._rules[i],(function(c){d=c.replace(/(\[|\])/gi,"\\$1"),s=o().pick(t,(function(e,t){return t.search(new u.UnsafeRegExp("(".concat(d,").*"),"gi"))>=0&&!/\[(__UNIQUE__|DESCRIPTION)\]/.test(t)}),this),o().isEmpty(s)||(r=o().pick(s,(function(e){return!e})),a=!0!==n&&o().isEqual(r,s),l+=a&&o().keys(r).length?1:0,this.setError({entity:i,$form_el:e,salt:i+e.attr("id"),input_names:o().keys(a?r:s),rule_name:c},a))}),this),l>0&&(c="attr"),e[c]("data-errors",l),e[c]("data-errors-more",(0,_.i18n)("required_numeral_more")),e[c]("data-errors-word",(0,_.numeralWord)(l,(0,_.i18n)("required_numeral"))),l},toggleErrorTip:function(e,t){var i,n,s=this,r=parseInt(e.$form_el.attr("data-errors")||0),a=1,d=[];o().each(e.input_names,(function(l){var c,h,_,u,p=(c=l,h=s.formModel.getCFId(c),_=f[e.entity],(u=e.$form_el.find("".concat(_,'[data-id="').concat(h,'"]'))).length?u:e.$form_el.find('input[name="'.concat(c,'"]')).closest(_)),v=p.attr("data-id");if(!o().contains(d,v)){o().isUndefined(v)||d.push(v);var g=p.closest(this._selector("cf_group"));g.length&&"default"!==g.attr("data-id")||(g=this._findElem("main_fields")),o().isUndefined(n)&&(n=parseInt(g.attr("data-errors")||String(0))),t?(i=new w({model:this.model,code:e.code,$scroller:this._elem("form_container")}),p.find(m[e.entity]).append(i.el),i.animate()):(a=-1,this.model.trigger("tip:remove",e.code)),e.$form_el.attr("data-errors",r+a),p[t?"addClass":"removeClass"]("validation-not-valid"),g.attr("data-errors",n+a),this.model.trigger("tabs:notification",g.attr("data-id")||"default",n+a)}}),this)},_clearTabsNotifications:function(){this._findElem("cf_group").each(o().bind((function(e,t){var i=s()(t);i.attr("data-errors")&&(i.removeAttr("data-errors"),this.model.trigger("tabs:notification",i.attr("data-id")||"default",0))}),this))},replaceContactNameWithN:function(e){var t=this;return o().isString(e)?e.replace("contact[NAME]","contact[N]"):o().isArray(e)?o().map(e,(function(e){return t.replaceContactNameWithN(e)})):o().isObject(e)?o().reduce(e,(function(e,i,n){return e[n]=t.replaceContactNameWithN(i),e}),{}):e}}),y="../build/transpiled/interface/card/validation";window.define(y,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([y])},698857:(e,t,i)=>{i.r(t),i.d(t,{default:()=>_});var n=i(629133),s=i.n(n),r=i(460159),o=i.n(r),a=i(313981),d=i(656580),l=i(445368),c=i(304483),h=i(729115);const _=a.default.extend({_template:"/tmpl/leads/loss_reason/modal.twig",_selectors:function(){return{save:".modal-body__actions__save"}},events:function(){var e=s().result(a.default.prototype,"events",{});return e["click .button-cancel"]="_onCancel",e["click ".concat(this._selector("save"),":not(.button-input-disabled)")]="onModalAcceptClick",e},initialize:function(e){this.options=e||{},this._selected_id=this.options.selected_id,this._onAccept=this.options.onAccept||s().noop,a.default.prototype.initialize.call(this),d.default.getLossReasons().then(s().bind(this.initModal,this))},onModalAcceptClick:function(){var e=s().find(this._items,(function(e){return e.id===parseInt(this.form.model.get("lead[LOSS_REASON_ID]"))}),this);this._onAccept({id:e&&e.id||0,name:e&&e.name}),this._setChanges(!1),this.modal.destroy()},initModal:function(e){var t=this;if(this._items=s().sortBy(e._embedded.items,"sort"),!this._items.length)return this._onAccept({id:0}),void this.destroy();this.modal=new c.default({class_name:"modal-list modal-loss-reason",disable_overlay_click:!0,preload_templates:[this._template],init:function(e){this.$el.on("click",(function(e){e.stopPropagation()})),t.setElement(e),t.render()}})},render:function(){return this.$el.html(o()({ref:this._template}).render({default:{id:0,name:(0,l.i18n)("No reason")},selected:this._selected_id,items:this._items})),this.$el.trigger("modal:loaded").trigger("modal:centrify"),this.form=new h.default.View({el:this.el}),this.listenTo(this.form.model,"has_changes",s().bind(this._setChanges,this,!0)).listenTo(this.form.model,"has_reverted",s().bind(this._setChanges,this,!1)),this},_setChanges:function(e){this.has_changes=e},_onCancel:function(){s().isFunction(this.options.onCancel)&&this.options.onCancel(),this.modal.destroy()}});var u="../build/transpiled/interface/leads/loss_reason_modal";window.define(u,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([u])}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_17_08_33"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a1e84633-73df-4a83-877b-e3a11434257c",e._sentryDebugIdIdentifier="sentry-dbid-a1e84633-73df-4a83-877b-e3a11434257c")}catch(e){}}();
//# sourceMappingURL=1103.bb15f96416f727f73205.js.map