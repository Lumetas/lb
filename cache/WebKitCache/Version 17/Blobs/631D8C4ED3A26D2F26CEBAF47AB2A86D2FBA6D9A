"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[87043],{756542:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var i=n(629133),o=n.n(i);const s={_correctNameInputs:function(e){return(e=o().clone(e))["contact[FN]"]||e["contact[LN]"]?(e["contact[FIRST_NAME]"]=e["contact[FN]"],e["contact[LAST_NAME]"]=e["contact[LN]"]):e["contact[N]"]&&(e["contact[NAME]"]=e["contact[N]"]),delete e["contact[N]"],delete e["contact[FN]"],delete e["contact[LN]"],e},_patchContactNameRevert:function(e,t,n,i){return n!==i[1]&&n!==i[2]||e.length?[]:(delete this.model.defaults[n],delete this.model.attributes[n],e=this.$(':input[name="'.concat(i[0],'"]')),t=n===i[1]?t:o().compact([e.val(),t]).join(" "),n=i[0],this.model.defaults[n]=t,[e,t,n])}};var r="../build/transpiled/interface/card/mixins/contact_name_juggling";window.define(r,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([r])},179488:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var i=n(629133),o=n.n(i),s=n(450422),r=n(661533);const a={rebuildFieldKeys:function(e,t){var n=this,i=["country","sub_types"],s=["ENUMS"];return o().isObject(e)||o().isArray(e)?e=o().reduce(e,(function(e,a,c){return(o().isObject(a)||o().isArray(a))&&t&&(a=n.rebuildFieldKeys(a,t)),r.isNumeric(c)?c=o().isUndefined(a.ID)?c:a.ID:o().isString(c)&&!o().contains(i,c)&&(c=c.toUpperCase()),o().contains(s,c)&&o().isEmpty(a)?delete e[c]:e[c]=a,e}),{}):e},updateCf:function(){var e,t=this,n=APP.data.current_card.element_type,i=t.cf._main_cf.cf_collection.models,s=[],a={},c={};n===APP.element_types.leads?e=APP.element_types.customers:n===APP.element_types.customers&&(e=APP.element_types.leads),o().each(t.cf._linked_cf,(function(e){i=i.concat(e.cf_collection.models)})),o().each(APP.constant("account").cf,(function(t,i){o().isNull(t.CATALOG_ID)||o().isUndefined(t.CATALOG_ID)?(o().isEmpty(t.ELEMENT_TYPES)||o().contains([APP.element_types.leads,APP.element_types.customers],n)&&!o().contains(t.ELEMENT_TYPES,n)&&o().contains(t.ELEMENT_TYPES,e)||"Y"===t.PREDEFINED)&&(a[i]=t):a[i]=t})),o().each(i,(function(e){r.isNumeric(e.get("id"))&&s.push(e.attributes)})),o().each(s,(function(e){e.description&&o().isObject(e.description)&&(e.description=JSON.stringify(e.description)),(e=t.rebuildFieldKeys(e,!0)).ELEMENT_TYPES=[e.ELEMENT_TYPE],delete e.ELEMENT_TYPE,e.PREDEFINED=e.PREDEFINED?"Y":"N","N"===e.PREDEFINED&&(c[e.ID]=e)})),APP.constant("account").cf=o().extend(a,c)},openCfModal:function(e){var t=this;Promise.all([n.e(60291),n.e(1594)]).then(n.bind(n,360291)).then((function(n){var i=n.default;t._openCfModal(i,e)}))},_openCfModal:function(e,t){var n,i=this,a=!1,c=!0;this.cf||(t=t||{},(0,s.isAmoChatsFullEnabled)()&&(n=!1),o().isFunction(this.isAddContactCFAvailable)&&(c=this.isAddContactCFAvailable()),this.cf=new e({init:function(){o().isFunction(t.init)&&t.init()},linked_types:this._linked_types,enable_required:n,can_add_contact_cf:c,getTabsParams:o().bind((function(e){var t={items:[]};return this.tabs&&o().extend(t,{items:this.tabs.get(),selected:this.tabs._selected_tab,readonly:this.readonly_tabs,onHide:o().bind(this._defaultHideTabs,e),onShow:o().bind(this._defaultShowTab,e)}),t}),this),getTopHeight:o().bind((function(){var e=r.makeArray(this.$el.find(".card-entity-form__top, .card-tabs-wrapper").map((function(){return this.offsetHeight})));return o().reduce(e,(function(e,t){return e+t}),0)}),this),onChange:function(){a=!0,i.setNeedReload()},onDestroy:function(){a&&i.updateCf(),i.cf=null,i.tabs.render(),a&&r(document).trigger("page:reload")}}),r("#widgets_block").after(this.cf.el),this.cf.load())}};var c="../build/transpiled/interface/card/mixins/custom_fields";window.define(c,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([c])},144185:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var i=n(161320),o=n.n(i),s=n(629133),r=n.n(s);const a={getNameInput:function(e){switch(e){case APP.element_types.leads:return"lead[NAME]";case APP.element_types.contacts:case APP.element_types.companies:return"contact[N]";case APP.element_types.customers:default:return"name"}},changeNameEntity:function(e){var t=this.getNameInput(e.element_type),n=this.$el.find('[name="'.concat(t,'"]'));this.model.isDefault(t)?(n.val(e.new_value),this.model.set(t,e.new_value,{update_default:!0}),n.trigger("input")):this.model.setDefault(t,e.new_value)},changeStringFields:function(e,t,n){n.val(t.new_value),this.model.set(e,t.new_value,{update_default:!0})},changeFile:function(e,t,n){var i=r().propertyOf(t)(["metadata","new","file_uuid"])||"";n.val(i),this.model.set(e,i,{update_default:!0}),n.trigger("controls:change")},changeCheckbox:function(e,t,n){n.prop("checked","1"===t.new_value),this.model.set(e,t.new_value,{update_default:!0})},changeDateFields:function(e,t,n){var i=t.field_type===APP.cf_types.date_time?APP.system.format.date.full:APP.system.format.date.date,s=r().isString(t.new_value)?t.new_value.trim():"".concat(t.new_value);s=s?o()(s,"X").tz(APP.system.timezone).format(i):"",n.val(s),this.model.set(e,s,{update_default:!0}),n.trigger("input")}};var c="../build/transpiled/interface/card/mixins/fields";window.define(c,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([c])},472044:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var i=n(629133),o=n.n(i),s=n(460159),r=n.n(s),a=n(656580),c=n(445368);const l={addLead:function(e){var t=this,n=this.quick_lead.$el.closest(".js-card-leads"),i=n.find(".js-card-leads-count"),s=n.find(".js-card-leads-budget"),r=parseInt(i.attr("data-count"))+1,l=parseInt(s.attr("data-budget"))+parseInt(e.budget),d=e.main_contact&&e.main_contact.id;!d&&e.company_name&&(d=e.company_name.id),!this.id&&parseInt(d)>0&&(this.setId(parseInt(d)),this.setChanges({quick_lead:!0})),i.attr("data-count",r).text(r),s.attr("data-budget",l).text((0,c.currency)(l)),a.default.getPipelines().then((function(i){var s={};o().find(i.pipelines,(function(t){var n=o().findWhere(t.statuses,{id:parseInt(e.status)});return n&&(s={name:t.name,status:n}),n})),t.appendLead(n,{id:e.id,name:e.name.text,status:parseInt(e.status),budget:parseInt(e.budget),status_color:s.status.color,status_text:s.status.name,pipeline:s,single_pipeline:1===o().keys(i.pipelines).length})}))},appendLead:function(e,t){var n,i;switch(t.status){case 142:(n=e.find(".js-card-leads-won-wrapper").find(".card-leads__won-won__top-sum")).text((0,c.currency)(parseInt(n.text().replace(/[^\d]/g,""))+t.budget)),e.find(".js-card-leads-won-wrapper").show().children(".js-card-leads-wonlost-body").prepend(r()({ref:"/tmpl/cards/leads/wonlost_item.twig"}).render({id:t.id,name:t.name,budget:t.budget}));break;case 143:(n=e.find(".js-card-leads-lost-wrapper").find(".card-leads__won-lost__top-sum")).text((0,c.currency)(parseInt(n.text().replace(/[^\d]/g,""))+t.budget)),e.find(".js-card-leads-lost-wrapper").show().children(".js-card-leads-wonlost-body").prepend(r()({ref:"/tmpl/cards/leads/wonlost_item.twig"}).render({id:t.id,name:t.name,budget:t.budget}));break;default:i={lead_info:{lead_mark:"yellow",id:t.id,name:{text:t.name,url:"/leads/detail/".concat(t.id)},status:{bg_color:t.status_color,option:t.status_text}}},t.budget&&(i.lead_info.budget=t.budget),t.pipeline&&(i.pipeline=!t.single_pipeline&&t.pipeline,i.lead_info.status.name=t.status_text,i.lead_info.status.color=t.status_color),e.find(".js-card-leads-wrapper").prepend(r()({ref:"/tmpl/cards/leads/item.twig"}).render(i))}}};var d="../build/transpiled/interface/card/mixins/lead_adding";window.define(d,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([d])},750823:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var i=n(629133),o=n.n(i),s=n(460159),r=n.n(s),a=n(543666),c=n(926168),l=n(450422),d=n(580326),u=n(664431),f=n(304483),_=n(661533),p=[APP.element_types.leads,APP.element_types.customers];const h={initLinked:function(){var e=this;this.id&&o().contains(p,this.element_type)&&(this.write_first_lead_sources_collection=new a.WriteFirstLeadSourcesCollection,this.write_first_lead_sources_collection.fetch()),this.linked_forms=new u.default.View({el:this.$el.find(".js-card-fields__linked-block"),element_type:this.element_type,element_id:this.id,write_first_lead_sources_collection:this.write_first_lead_sources_collection,onAdd:o().bind((function(){this.validator&&this.validator.model.count()&&this.validator.check({form_view:this,status_id:this.getStatusId(),pipeline_id:this.getPipelineId()})}),this),onModify:o().bind(this.setChanges,this,{linked_changes:!0}),onRevert:o().bind(this.setChanges,this,{linked_changes:!1}),onSaveForm:o().bind((function(e){!this.id&&e.main_id&&this.setId(e.main_id)}),this),onValidate:o().bind((function(e){var t=0===this.validator.check({form_view:e,status_id:this.getStatusId(),pipeline_id:this.getPipelineId()});return t||this.validator.scrollTo(1),t}),this),edit:{onUnlink:o().bind((function(e){this.validator.clearFormErrors(this.$el,this.model.toJSON(),o().invert(APP.element_types)[e.element_type]),parseInt(e.element_type)===APP.element_types.companies&&_("#new_company_form").show(),this.setNeedReload(),this._onLinkedFormsUnlink({element_id:e.element_id,element_type:e.element_type})}),this),onChangeMainContact:o().bind((function(){this.setNeedReload()}),this),onSuggestCompany:o().bind((function(e){this.linkCompanyFromContactSuggest(e)}),this)},add:{prepareSave:function(){var t=this.$(".main-entity-id"),n="";return t.length&&(n+="&".concat(t.attr("name"),"=").concat(e.id?e.id:""),2===e.element_type&&o().each(["lead[PIPELINE_ID]","lead[STATUS]"],(function(t){n+="&".concat(t,"=").concat(e.form.model.get(t))}))),n},onSuggestCompany:o().bind((function(e){this.linkCompanyFromContactSuggest(e)}),this),onBeforeSuggestContact:o().bind((function(e,t){var n=!0;return _("#linked_form_".concat(t.id)).length&&(e.val("").focus(),new f.default({class_name:"modal-list",init:r()._preload(["/tmpl/common/modal/error.twig"],(function(t){t.trigger("modal:loaded").html(r()({ref:"/tmpl/common/modal/error.twig"}).render({no_retry:!0,text:APP.lang["card_".concat(e.attr("data-linked-type"),"_already_in_list")]})).trigger("modal:centrify")})),destroy:function(){e.focus()}}),n=!1),n}),this),onSuggestContact:function(t,n){var i=this;e.linkElement(t,_.extend(n,{callback:function(t){e.linked_forms.cancelAddForm({currentTarget:i.$el.closest(".linked-form__fields").children(".js-linked-cancel")},t),e.setNeedReload()}}))},onSave:function(t){var n=this;e._checkAutosave(),e.appendLinked({result:t,$form:this.$el,linked_type:this.$el.attr("data-entity"),callback:function(){n.$el.trigger("form:cancel",[!1]),e.setNeedReload()}})}}})},destroyLinked:function(){this.write_first_lead_sources_collection&&this.write_first_lead_sources_collection.clearCache(),this.linked_forms.destroy()},linkElement:function(e,t){var n=this,i=e.parents("form"),o=i.attr("data-entity"),s="contacts"===o?"contact":"company",r=i.find(".main-entity-id"),a="",c=this.getPipelineId(),l=this.getStatusId(),u="";i.attr("data-loading","Y").find(".main-entity-id").val(this.id?this.id:""),"contact"===s&&_("#contact_company_input").attr("disabled","disabled"),r.length&&(a="&".concat(r.attr("name"),"=").concat(this.id)),c&&l&&this.element_type===APP.element_types.leads&&(u="&lead[PIPELINE_ID]=".concat(c,"&lead[STATUS]=").concat(l)),_.ajax({url:i.attr("action"),type:"POST",data:"".concat(i.serialize(),"&").concat(s,"[ID]=").concat(t.id).concat(a).concat(u),dataType:"json"}).always((function(){"contact"===s&&_("#contact_company_input").removeAttr("disabled")})).done((function(e){d.AmoJoMediator.addChat(e.amojo_chats),e.main_id&&(n.setId(e.main_id),n._checkAutosave()),n.appendLinked({result:e,$form:i,linked_type:o,callback:t.callback})})).fail((function(){APP.notifications.show_message_error({text:"Linking element failed"})}))},appendLinked:function(e){var t,n=this,i=e.result,s=_("#".concat(e.linked_type,"_list")),a=(0,c.convertElementType)(n.element_type,"single"),d=!1;if(o().isUndefined(e.result.element)){switch(i={element:[],custom_fields:e.result.CF,main:{ID:e.result.main_id||n.id},main_element_type:n.element_type,entity_type:e.linked_type,grant_edit:!0,fields_hidden:!0},n.element_type){case APP.element_types.customers:case APP.element_types.leads:o().isUndefined(e.result.contact)?(i.element=e.result.company,s=_("#companies_list")):i.element=e.result.contact;break;case APP.element_types.contacts:o().isUndefined(e.result.company)||(i.element=e.result.company);break;case APP.element_types.companies:o().isUndefined(e.result.contact)||(i.element=e.result.contact)}n._onLinkedFormsLink({element_id:i.element.ID,element_type:i.element.ELEMENT_TYPE})}if(i.entity_type===(0,c.convertElementType)(APP.element_types.companies,"string")&&this.linked_forms.form_models.each((function(e){parseInt(e.get("ELEMENT_TYPE"))===APP.element_types.companies&&parseInt(e.get("ID"))>0&&(d=!0)})),!d&&i.element){switch(i.element.NAME=o().escape(i.element.NAME),i.element.COMPANY_NAME=o().escape(i.element.COMPANY_NAME),t=_('<li class="linked-forms__item '.concat(i.fields_hidden?"":"linked-forms__item-active",'" data-main-item="false">').concat(r()({ref:"/tmpl/cards/forms/form.twig"}).render(i),"</li>")),o().isArray(i.element)&&t.addClass("hidden").hide(),i.element.main_contact&&(t.addClass("linked-forms__main_item"),t.attr("data-main-item","true")),s.closest(".linked-forms-holder").removeClass("hidden"),s.append(t),this.linked_forms.addEditForm(t.children("form")),e.$form.find(".js-control--suggest--list").trigger("suggest:reset",[[],""]),e.linked_type){case"companies":_("#new_company_form").hide();break;case"contacts":(0,l.isAmoChatsFullEnabled)()&&_("#new_contact_form").hide()}({})[i.element.ID]={id:i.element.ID,name:i.element.NAME},n.element_type!==APP.element_types.leads&&n.element_type!==APP.element_types.customers||_("#companies_list").find("li").length||o().isUndefined(e.result.company)||o().isUndefined(e.result.contact)||!e.result[a]||parseInt(e.result.company.ID)!==parseInt(e.result[a].COMPANY_UID)||n.appendLinked({result:{element:e.result.company,custom_fields:e.result.CF,main:{ID:e.result.main_id||n.id},main_element_type:n.element_type,entity_type:"companies",grant_edit:!0},slideup:!0,linked_type:"companies",$form:_("#new_company")})}"function"==typeof e.callback&&e.callback(t)},linkCompanyFromContactSuggest:function(e){var t=_("#new_company_n");_("#companies_list").children("li").length||this.linkElement(t,{id:e.attr("data-value-id"),callback:o().bind((function(){t.closest("form").trigger("form:cancel"),t.trigger("change"),this.setNeedReload()}),this)})},_onLinkedFormsLink:function(e){this.notes.notes.trigger("linked:link",e).handleEntityLink(e)},_onLinkedFormsUnlink:function(e){o().each(d.AmoJoMediator.get(),(function(t){o().any(t.contacts,(function(t){return parseInt(t.id)===parseInt(e.element_id)}))&&d.AmoJoMediator.removeChat(t.chat_id)})),this.notes.notes.trigger("linked:unlink",e).handleEntityUnlink(e)}};var m="../build/transpiled/interface/card/mixins/linked_forms";window.define(m,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([m])},264659:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(629133),o=n.n(i),s=n(460159),r=n.n(s),a=n(926168),c=n(661533),l=".js-control-loss-reason-dropdown";const d={init:function(){this.$el.on("change",'input[name="lead[LOSS_REASON_ID]"]',o().bind(this.onLossReasonChange,this))},destroy:function(){c(document).off("controls:view:init.loss-reason-events")},onLossReasonChange:function(e){this.notes.notes.trigger("notes:loss-reason-changed",e.currentTarget.value),this.save()},_changeStatus:function(e,t){var n=this;this.checkChanges()&&(0,a.isLostStatus)(this.getStatusId())&&!t&&this.$form.find(l).off("controls:view:init.loss-reason-events").one("controls:view:init.loss-reason-events",(function(){n.$el.find(".pipeline-select-view__loss-reason").trigger("controls:loss-reason:init")}))},renderStatus:function(e,t){var n=c("#card_status_view_mode"),i=this.form.model.defaults["lead[LOSS_REASON_ID]"]||0,o=this.notes.notes.findCollection(this.id),s=o&&this.notes._getExtraData(o.first()).loss_reasons||{},d=(s[i]||{}).name;parseInt(n.attr("data-pipeline-id"))===e.pipeline_id&&parseInt(n.attr("data-status-id"))===e.status_id&&!0!==t||(this.$el.find(l).remove(),i&&!s[i]&&(d=APP.lang.loss_reason_deleted),(0,a.isLostStatus)(e.status_id)&&this.$el.find(".pipeline-select-view.card-cf-lead-status-select").prepend(c(r()({ref:"/tmpl/cards/leads/loss_reason.twig"}).render({id:i,name:d}))))}};var u="../build/transpiled/interface/card/mixins/loss_reason";window.define(u,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([u])},76405:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var i=n(629133),o=n.n(i),s=n(460159),r=n.n(s),a=n(156040),c=n(656580),l=n(859200),d=n(661533);function u(e,t,n,i,o,s,r){try{var a=e[s](r),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,o)}const f={_init:function(){var e=this,t=(0,l.getRights)()||{};this.id&&this.element_type===APP.element_types.leads&&t.duplicate_search&&(0,a.onPageFullyLoaded)((function(){return e._loadDobules()}))},destroy:function(){this._merge&&(this._merge.destroy(),this._merge=null)},_loadDobules:function(){return(e=function(){var e,t,n;return function(e,t){var n,i,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&s[0]?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(i){switch(i.label){case 0:e=this,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,c.default.getLeadDoubles(this.id)];case 2:return t=i.sent(),(n=o().propertyOf(t)("doubles")||[]).length?(this._double_ids=n,[3,4]):[2];case 3:return i.sent(),[2];case 4:return this.$el.on("click",'.js-multisuggest-fake[data-id="doubles"]',(function(t){t.stopPropagation(),e._startMerge()})),this.$el.find(".doubles_button").find(".js-multisuggest-item:last").after(r()({ref:"interface/common/fast_tags/item.twig"}).render({item:{id:"doubles",title:APP.lang.doubles_suspicion+"?",color:"#ff3682",hidden:!1,is_fake:!0}})),[2]}}))},function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function r(e){u(s,i,o,r,a,"next",e)}function a(e){u(s,i,o,r,a,"throw",e)}r(void 0)}))}).apply(this);var e},_startMerge:function(){var e=this;n.e(27507).then(n.bind(n,427507)).then((function(t){var n=t.default;e._merge||(e._merge=new n({merge_ids:[e.id].concat(e._double_ids),entity_type:APP.getBaseEntity(),merge_type:!1,onDestroy:function(){return e._onDestroyMerge()}}),d(document.body).append(e._merge.el))}))},_onDestroyMerge:function(){this._merge=null}};var _="../build/transpiled/interface/card/mixins/merge";window.define(_,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([_])},288420:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var i=n(629133),o=n.n(i),s=n(161320),r=n.n(s),a=n(168807),c=n(418860);const l={_initNotes:function(e){if(!e)throw new Error("No options passed");this._creating_note_exists=Boolean(e.element_id),this.notes=e.notes,this.notes._setCallbacks({onAdd:o().bind(this._onNotesAdd,this)}),this.notes.notes.on("add",this._updateLastAction,this).on("add remove",this._checkReloadByNotes,this).on("sync destroy",this._checkReloadByTasks,this),this.id&&this.notes.notes.on("sync created",o().bind(this._checkAutosave,this)).on("notes:change-status",this._changeAndUpdateStatus,this)},addNotes:function(e){o().isArray(e)||(e=[e]),this.notes.addNotes(e)},_updateLastAction:o().throttle((function(e){"event"===(e.get("object_type")||{}).code&&parseInt(e.get("type"))===c.default.LEAD_STATUS_CHANGED_EVENT&&this.notes.notes.trigger("notes:status-changed")}),100,{leading:!1}),_changeAndUpdateStatus:function(e,t,n){var i=n===APP.element_types.customers?"customers[status_id]":"lead[STATUS]",s=o().isEqual(parseInt(this.form.model.get(i)),parseInt(this.form.model.defaults[i]));n===APP.element_types.customers&&APP.constant("periodicity_enabled")||(this.form.model.defaults[i]=(e||0).toString(),s&&(t&&this.setPipelineId(t,!0),this.setStatusId(e,!0)))},_onNotesAdd:function(){this.notes.has_timeline&&!this._creating_note_exists&&(this._creating_note_exists=!0,this.addNotes([{id:(0,a.randHex)(),type:APP.note_types.lead_created,object_type:{code:"notes"},created_by:this.user.id,date_create:r()().unix(),element_type:this.element_type,element_id:this.id}]))},_checkReloadByTasks:function(e){if(e!==this.notes.notes&&this.id){var t=e&&e.get("object_type");t&&"tasks"===t.code&&this.setNeedReload()}},_checkReloadByNotes:function(e){e!==this.notes.notes&&this.setChanges({notes_added:!this.id&&this.notes.notes.length})}};var d="../build/transpiled/interface/card/mixins/notes";window.define(d,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([d])},843142:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var i=n(661533),o=n.n(i),s=n(629133),r=n.n(s),a=n(575049),c=n.n(a),l="card-holder__fields_portrait-visible",d=".card-portrait";const u={init:function(){c().tablet()&&(this.$el.on("click",".js-card-fields:not(.".concat(l,")"),r().bind(this._openFieldsInPortrait,this)).on("click",".js-card-portrait-overlay",r().bind(this._closeFieldsInPortrait,this)),o()(window).on("orientationchange".concat(d),r().bind(this._closeFieldsInPortrait,this)))},_openFieldsInPortrait:function(){var e,t=this.$el.find(".js-card-fields");c().portrait()&&!t.hasClass(l)&&(t.toggleClass(l),e=o()('<div class="default-overlay js-card-portrait-overlay" style="z-index: 111"></div>'),this.$el.append(e),e.trigger("overlay:show"))},_closeFieldsInPortrait:function(){this.$el.find(".js-card-fields").removeClass(l),this.$el.find(".js-card-portrait-overlay").trigger("overlay:hide")},destroy:function(){c().tablet()&&o()(window).off(d)}};var f="../build/transpiled/interface/card/mixins/portrait";window.define(f,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([f])},490074:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var i=n(661533),o=n.n(i),s=n(629133),r=n.n(s),a=n(859200),c=n(445368),l=n(450422),d=n(73462);const u={initTabs:function(){this.tabs=new d.default({el:o()("#card_tabs"),notes:this.notes.notes,onHide:r().bind(this._defaultHideTabs,this),onShow:r().bind(this._defaultShowTab,this)}),this.updateTabs(this._getDefaultTabs(),"groups"),r().indexOf(["contacts","companies"],APP.getBaseEntity())>=0&&(this.updateTabs([{id:"linked_leads",name:(0,c.i18n)("Leads")}],"leads"),o()("#linked_customers_tab").length&&this.updateTabs([{id:"linked_customers",name:(0,c.i18n)("Customers")}],"customers")),this.$el.find(".js-card-top-fields-plug").remove()},destroyTabs:function(){this.tabs&&this.tabs.destroy()},updateTabs:function(e,t,n,i){var o,s=APP.constant("old_unsorted_uid"),a=this.tabs._selected_tab;this.tabs&&(s&&(e=r().filter(e,(function(e){return"catalog_elements"!==e.type}))),this.tabs.update(e,t,n,i),a&&(o=this.tabs.get(),!r().findWhere(o,{id:a})&&o.length&&this.switchTab(r().first(o).id)))},showTabNotification:function(e,t){this.tabs&&this.tabs.setNotification(e,t)},switchTab:function(e){this.tabs&&this.tabs.switchTab(e)},_getDefaultTabs:function(e){var t;return e=e||this.$el,r().filter(APP.constant("cf_groups"),(function(n){return t=e.find('.js-cf-group-wrapper[data-id="'.concat(n.id,'"]')),n.name&&t.find("> .linked-form__field:not(.hidden):not(.u-hidden-cf), > .linked-form__multiple-container").length}),this)},_defaultHideTabs:function(e){e=e||this.$el,(0,l.isAmoChatsFullEnabled)()&&(e.find('.js-cf-group-wrapper[data-id="default"]').children().length||(e.find(".card-tabs-wrapper").removeClass("card-tabs-wrapper--no-margin-bottom"),e.find(".card-holder__fields .card-fields__fields-block").removeClass("card-fields__fields-block--no-margin-bottom"))),e.find(".js-cf-group-wrapper").hide(),e.find(".js-card-fields__linked-block, .js-card-main-fields").hide()},_defaultShowTab:function(e,t){var n=(t=t||this.$el).find('.js-cf-group-wrapper[data-id="'.concat(e.id,'"]')),i=t.find(".card-entity-form__main-fields, .js-card-main-fields");(0,l.isAmoChatsFullEnabled)()&&"default"===e.id&&(n.children().length||(t.find(".card-tabs-wrapper").addClass("card-tabs-wrapper--no-margin-bottom"),t.find(".card-holder__fields .card-fields__fields-block").addClass("card-fields__fields-block--no-margin-bottom"))),n.length&&((0,l.isAmoChatsFullEnabled)()&&"default"===e.id&&!n.children().length?n.hide():n.show(),n.find(".text-input-textarea.linked-form__cf").trigger("controls:textarea:autosize"),n.find('input[data-autosized="y"]').trigger("autosize:important")),"default"===e.id&&(t.find(".js-card-fields__linked-block").show(),(0,l.isAmoChatsFullEnabled)()&&!i.children().length?i.hide():i.show(),this.$el.find("input").trigger("autosize:important"))},checkProductsTabExistance:function(){var e=APP.constant("account").products.catalog_id;o()(document).off("updateProductsQuantity").on("updateProductsQuantity",r().bind(this.updateProductsTabQuantity,this)),e&&r().find(this.tabs._tabs,{id:e})&&this.getProductsTabQuantity(e)},getProductsTabQuantity:function(e){var t,n=this;e&&this.id&&!this._count_pending&&(0,a.canCatalog)("view",e)&&(t="/ajax/".concat(APP.data.current_entity,"/").concat(this.id,"/catalog/").concat(e,"/elements/count"),this._products_tab_count_pending=!0,o().ajax({url:t}).done((function(e){n._products_tab_quantity=e.total_count,n._products_tab_count_pending=!1})).then((function(){n.tabs.setNotification(e,n._products_tab_quantity,"info")})))},updateProductsTabQuantity:function(e,t){var n=APP.constant("account").products.catalog_id;void 0!==this._products_tab_quantity&&null!==this._products_tab_quantity&&(this._products_tab_quantity+=t,this.tabs.setNotification(n,this._products_tab_quantity,"info"))}};var f="../build/transpiled/interface/card/mixins/tabs";window.define(f,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([f])},572944:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var i=n(661533),o=n.n(i),s=n(629133),r=n.n(s);const a={init:function(){this.disable_tags||this.$el.on("click","#tags-lib-manage",r().bind((function(){var e=this;n.e(6120).then(n.bind(n,306120)).then((function(t){new(0,t.default)({entity:APP.getBaseEntity(),onDestroy:r().bind(e.onTagsManageModalDestroy,e),item_params:{colored_tags_available:r().contains(["leads","leads-pipeline"],APP.data.current_entity)}}).fetchData()}))}),this))},onTagsManageModalDestroy:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(e.deleted_tags&&e.deleted_tags.length||e.tags_changed)&&o()(document).trigger("page:reload")}}},207427:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var i=n(460159),o=n.n(i),s=n(27969),r=n(390788),a=n(445368),c=n(926168),l=n(580326),d=n(9008),u=n(784854),f=n(304483),_=n(845043),p=n(661533);const h={tipActions:{company:function(e){var t=e.find(":input:visible").attr("data-value-id");t&&APP.router.navigate("/companies/detail/".concat(t),{trigger:!0})},edit:function(e){this.focusAndSetCursorToEnd(e.find(":input:visible"))},map:function(e,t){window.open("//maps.google.com/?q=".concat(encodeURIComponent(t)),"_blank")},editUS:function(e){e.find(".control-address").trigger("address:edit")},mapUS:function(e,t){t=e.find(".js-google-maps-link").val(),window.open("//maps.google.com/?q=".concat(encodeURIComponent(t)),"_blank")},phone:function(e,t){window.location="tel:".concat(t)},email:function(e,t){window.open("mailto:".concat(t,"?bcc=").concat(APP.lang.mail),"_blank")},email_with_template:function(e,t){p(document).trigger("notes:compose:switch",["email",{email:t,name:(0,a.contactName)(this.model.get("contact[N]"))}])},email_from_outside:function(e,t){var n=this.$el.find(".js-tips-item-amocrm-email").data("entity-url"),i=n?"".concat(n,"?compose=mailto:").concat(t):"";i&&APP.router.navigate(i,{trigger:!0})},link:function(e,t){var n=(t||"").toString().match(/^([\w]{0,}:\/\/)([\S\s]+)$/);n&&n.length?window.open(n[1]+n[2],"_blank"):window.open("//".concat(t),"_blank")},copy:function(e,t){return(0,r.copyToClipboard)(null,t)},set_main_profile:function(e,t){var n=new f.default,i=this.$el,s={},r=0,a="contacts"===APP.getBaseEntity();a?(s=i.find(".card-entity-form__top-cover"),r=this.id):(s=i.find(".linked-form__field-userpic"),r=e.closest(".linked-form").find('input[name="ID"]').val()),p.ajax({url:"/ajax/v2/profiles/set_main/",method:"POST",contentType:"application/x-www-form-urlencoded",dataType:"json",data:{profile_id:t,contact_id:r},success:function(t){var c,l,d;t.success?(a?t.data&&t.data.new&&t.data.new.profile_avatar?s.attr("style","background-image: url(".concat(t.data.new.profile_avatar,")")):s.removeAttr("style"):t.data&&t.data.new&&(c=o()({ref:"/tmpl/cards/forms/userpic.twig"}).render({contact_id:r,profile:t.data.new}),s.html(c)),e.find('.js-tips-item[data-type="set_main_profile"]').remove(),l=i.find('input[name="profiles['.concat(t.data.old.id,']"]')),d=o()({ref:"/tmpl/cards/forms/fields/profiles.twig"}).render({profile:t.data.old,value:l.val(),name:l.attr("name")}),l.parent().html(d),n.showSuccess(APP.lang.modal_success)):n.showError(APP.lang.modal_error_caption)},error:function(){n.showError(APP.lang.modal_error_caption)}})},unlink_profile:function(e,t){var n=new f.default,i=this.$el,s={},r=0,c="",l="contacts"===APP.getBaseEntity(),d=0===e.find('.js-tips-item[data-type="set_main_profile"]').length;l?(s=i.find(".card-entity-form__top-cover"),r=this.id):(s=i.find(".linked-form__field-userpic"),r=e.closest(".linked-form").find('input[name="ID"]').val());var u=new _.default({class_name:"modal-list modal-unlink-confirm",decline_text:APP.lang.button_cancel,accept_text:APP.lang.button_yes,button_class:"button-input_blue",text:(0,a.i18n)("Are you sure you want to detach chat?"),accept:function(){this.destroy(),p.ajax({url:"/ajax/v2/profiles/unlink/",method:"POST",contentType:"application/x-www-form-urlencoded",dataType:"json",data:{profile_id:t,contact_id:r,is_main:d?1:0},success:function(t){var a;t.success?(t.new_main?((a=i.find('input[name="profiles['.concat(t.new_main.id,']"]'))).parent().html(o()({ref:"/tmpl/cards/forms/fields/profiles.twig"}).render({profile:t.new_main,value:a.val(),name:a.attr("name")})),l?t.new_main.profile_avatar?s.attr("style","background-image: url(".concat(t.new_main.profile_avatar,")")):s.removeAttr("style"):t.new_main&&(c=o()({ref:"/tmpl/cards/forms/userpic.twig"}).render({contact_id:r,profile:t.new_main}),s.replaceWith(c))):l?s.removeAttr("style"):d&&(c=o()({ref:"/tmpl/cards/forms/userpic.twig"}).render({contact_id:r,profile:{}}),s.replaceWith(c)),p(document).trigger("tip:remove",{$tip:e}),e.remove(),n.showSuccess(APP.lang.modal_success)):n.showError(APP.lang.modal_error_caption)},error:function(){n.showError(APP.lang.modal_error_caption)}})},destroy:function(){!1===u.accepted&&n.destroy()}})},send_message:function(e,t,n){var i,o,s=n.attr("data-chat-id")||null,r=n.attr("data-origin"),a=Number(n.attr("data-linked-entity-id"));if(i=s?l.AmoJoMediator.getChatById(s):l.AmoJoMediator.findFirstChatByOrigin({origin:r,linked_entity_id:a}))try{o=d.ExistingExternalChatTarget.createFromChat(i)}catch(e){o=null}o&&this._$document.trigger("notes:compose:switch",["chat",{external_chat_target:o}]),this._$document.trigger("controls:hide:private")},write_first:function(e,t,n){if(this.write_first_lead_sources_collection){var i=Number(n.attr("data-source-id"))||null,o=n.attr("data-source-origin"),r=this.write_first_lead_sources_collection.get(s.LeadSourceModel.makeModelId({origin:o,source_id:i})),a=new u.WriteFirstExternalChatTarget({contact_name:(0,c.getContactFullName)(this.model.toJSON()),contact_id:Number(n.data("contact-id")),lead_source_model:r,phone:t});this._$document.trigger("notes:compose:switch",["chat",{external_chat_target:a}])}}}};var m="../build/transpiled/interface/card/mixins/tip_actions";window.define(m,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([m])},740625:(e,t,n)=>{n.r(t),n.d(t,{StatusDescriptions:()=>h});var i=n(629133),o=n.n(i),s=n(313981),r=n(399108);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n||e):o.value}},d(e,t,n||e)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function _(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=u(e);if(t){var o=u(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}(this,n)}}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(s,e);var t,n,i=p(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),i.apply(this,arguments)}return t=s,n=[{key:"initialize",value:function(e){this._setOptions(e),d(u(s.prototype),"initialize",this).call(this,e),this._lead_statuses=APP.constant("lead_statuses")||null,this._currentStatusData=null,this.show=o().bind(this._show,this),this.hide=o().bind(this._hide,this),this.destroyNotice=o().bind(this._destroyNotice,this),this.renderNotice=o().bind(this._renderNotice,this)}},{key:"_setOptions",value:function(e){var t,n;this.options=(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){l(e,t,n[t])}))}return e}({},e),n=null!=(n={withPipelines:"pipeline_select"===e.dataType})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t)}},{key:"_show",value:function(e){var t=e.$item,n=e.$container,i=this._parseStatusItem(t);if(i&&n){this._statusDescriptionsNotice||this._renderNotice(),this._currentStatusData=i;var o=this._statusDescription;o?this._statusDescriptionsNotice.show({$activeItemEl:t,$containerEl:n,fullText:o}):this._hide(!0)}}},{key:"_hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._statusDescriptionsNotice&&this._statusDescriptionsNotice.hide(e)}},{key:"_parseStatusItem",value:function(e){var t=o().propertyOf(this)(["options","dataType"]);if(!e||!t)return null;var n,i,s={statusId:null,pipelineId:null};switch(t){case"pipeline_select":var r=e.children("input").attr("id");if(!r)return null;var a=(n=r.split("_"),i=3,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,s=[],r=!0,a=!1;try{for(n=n.call(e);!(r=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(a)throw o}}return s}}(n,i)||_(n,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=a[1],l=a[2];if(o().isUndefined(c)||o().isUndefined(l))return null;s.pipelineId=c,s.statusId=l;break;case"statuses_select":s.statusId=e.data("value")}return s}},{key:"_renderNotice",value:function(){this._statusDescriptionsNotice=this._addComponent(r.StatusDescriptionNotice,{side:this.options.noticeSide})}},{key:"_destroyNotice",value:function(){this._statusDescriptionsNotice&&(this._statusDescriptionsNotice.destroy(!0),this._statusDescriptionsNotice=null)}},{key:"_statusDescription",get:function(){if(!this._lead_statuses||!this._currentStatusData)return null;var e,t=o().propertyOf(this._currentStatusData);return o().propertyOf(this._lead_statuses)((e=this.options.withPipelines?[t("pipelineId"),"statuses"]:[],function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat(["s_"+t("statusId"),"descriptions","0","description"]))||null}}],n&&c(t.prototype,n),s}(s.default)},399108:(e,t,n)=>{n.r(t),n.d(t,{StatusDescriptionNotice:()=>y});var i=n(629133),o=n.n(i),s=n(661533),r=n.n(s),a=n(460159),c=n.n(a);function l(e,t,n,i,o,s,r){try{var a=e[s](r),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,o)}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t,n){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n||e):o.value}},f(e,t,n||e)}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){u(e,t,n[t])}))}return e}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=_(e);if(t){var o=_(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}(this,n)}}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(s,e);var t,n,i=m(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),i.apply(this,arguments)}return t=s,n=[{key:"_template",get:function(){return"/tmpl/controls/pipeline_select/pipeline_status_description_notice.twig"}},{key:"_classes",value:function(){return{notice:"notice-status-description",noticeHoverWrapper:"notice-status-description__hover-wrapper",textContent:"notice-status-description__text",noticeBtn:"notice-status-description__btn",wrapBtn:"notice-status-description__btn--wrap",unwrapBtn:"notice-status-description__btn--unwrap"}}},{key:"events",value:function(){var e;return u(e={},"click ".concat(this._selector("noticeHoverWrapper")),"_onClick"),u(e,"mouseenter ".concat(this._selector("noticeHoverWrapper")),"_onMouseOver"),u(e,"mouseleave ".concat(this._selector("noticeHoverWrapper")),"_onMouseLeave"),u(e,"click ".concat(this._selector("wrapBtn")),"_onWrapBtnClick"),u(e,"click ".concat(this._selector("unwrapBtn")),"_onUnwrapBtnClick"),e}},{key:"initialize",value:function(e){var t,n,i=(t=p({},e),n=null!=(n={container:document.body})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t);this.options=i,f(_(s.prototype),"initialize",this).call(this,i),this.render(),this._hideTimeout=null,this.show=o().bind(this.show,this),this.hide=o().bind(this.hide,this),this._reposition=o().bind(this._reposition,this)}},{key:"show",value:function(e){var t=e.$activeItemEl,n=e.$containerEl,i=e.fullText;clearTimeout(this._hideTimeout),this.$activeItemEl!==t&&(this.isShow=!0,this._isUnwrapText=!1,this._fullText=i,this.$activeItemEl=t,this.$containerEl=n,this._elem("wrapBtn").hide(),this._fullText.length>306?this._elem("unwrapBtn").show():this._elem("unwrapBtn").hide(),this._setText(),this._calculatePosition(),this._setPosition(),this.$el.show(),window.addEventListener("resize",this._reposition))}},{key:"hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];clearTimeout(this._hideTimeout),e?this._hide():this._hideTimeout=setTimeout(o().bind(this._hide,this),100)}},{key:"_hide",value:function(){this.$el.hide(),this._fullText="",this.isShow=!1,this.$activeItemEl=null,this.$containerEl=null,this._isUnwrapText=!1,this._elem("wrapBtn").hide(),this._elem("unwrapBtn").show(),window.removeEventListener("resize",this._reposition,this)}},{key:"_onClick",value:function(e){e.stopPropagation()}},{key:"_onMouseOver",value:function(){clearTimeout(this._hideTimeout)}},{key:"_onMouseLeave",value:function(){this.hide()}},{key:"_setPosition",value:function(){var e=o().propertyOf(this);this.$el.css(p({},e(["position"])))}},{key:"_reposition",value:function(){this._calculatePosition(),this._setPosition()}},{key:"_setText",value:function(){if(this._isUnwrapText)this.$textContentEl.text(this._fullText);else{var e=this._fullText.slice(0,306);e.length<this._fullText.length&&(e=e.trim()+"..."),this.$textContentEl.text(e)}}},{key:"_calculatePosition",value:function(){var e=this.$activeItemEl.get(0).getBoundingClientRect(),t=e.top,n=e.height,i=this.$containerEl.get(0).getBoundingClientRect(),o=i.right,s=i.left,r={};if("left"===this.options.side){var a=this._$window.width();r.top=Math.round(t+n/2+-13),r.right=Math.round(a-s+10)}else r.top=Math.round(t+n/2+-13),r.left=Math.round(o+10);this.position=r}},{key:"_onWrapBtnClick",value:function(e){var t=this;e.stopPropagation(),this._elem("wrapBtn").hide(),this._elem("unwrapBtn").show(),this._isUnwrapText=!1,this.$el.height(this.$el.height()),this._setText();var n=function(e){switch(e.type){case"click":t.$el.height("auto"),document.elementFromPoint(e.clientX,e.clientY).click();break;case"mousemove":setTimeout((function(){return t.$el.height("auto")}),3e3)}t._elem("noticeHoverWrapper").off("mousemove",n).off("click",n)};this._elem("noticeHoverWrapper").on("mousemove",n).on("click",n)}},{key:"_onUnwrapBtnClick",value:function(e){e.stopPropagation(),this._elem("unwrapBtn").hide(),this._elem("wrapBtn").show(),this._isUnwrapText=!0,this._setText()}},{key:"render",value:function(){var e,t=this;return(e=function(){return function(e,t){var n,i,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&s[0]?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(e){switch(e.label){case 0:return[4,c()._preload([t._template])()];case 1:return e.sent(),[2,t._render()]}}))},function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function r(e){l(s,i,o,r,a,"next",e)}function a(e){l(s,i,o,r,a,"throw",e)}r(void 0)}))})()}},{key:"_render",value:function(){return this.setElement(r()(c()({ref:this._template}).render())),this.$el.addClass("".concat(this._class("notice"),"--").concat(this.options.side)),this.options.container.append(this.$el.get(0)),this.$textContentEl=this._elem("textContent"),this}}],n&&d(t.prototype,n),s}(n(313981).default)},630570:(e,t,n)=>{n.r(t),n.d(t,{StatusDescriptionSelect:()=>f});var i=n(629133),o=n.n(i),s=n(210734),r=n(740625);function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n||e):o.value}},c(e,t,n||e)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}(this,n)}}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(s,e);var t,n,i=u(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),i.apply(this,arguments)}return t=s,(n=[{key:"initialize",value:function(e){this.options=e,c(l(s.prototype),"initialize",this).call(this,e),this._initData(),this._statusDescriptions=this._addComponent(r.StatusDescriptions,{dataType:e.dataType,noticeSide:this.noticeSide}),this._onDocumentMove=o().bind(this._onDocumentMove,this),this.onSelectShow=o().bind(this._onSelectShow,this),this.onSelectHide=o().bind(this._onSelectHide,this),this.onItemMouseenter=o().bind(this._onItemMouseenter,this),this.onSelectMouseleave=o().bind(this._onSelectMouseleave,this)}},{key:"noticeSide",get:function(){return"right"}},{key:"_initData",value:function(){this._mouseLocs=[],this._lastDelayLoc=null,this._timeoutId=null,this._$activeItem=null}},{key:"_resetData",value:function(){this._initData()}},{key:"_notionShow",value:function(e){this._timeoutId&&clearTimeout(this._timeoutId),this._$activeItem=e,this._statusDescriptions.show({$item:e,$container:this.$currentSelectList})}},{key:"_possiblyNotionShow",value:function(e){var t=this,n=this._calculateShowDelay();n?this._timeoutId=setTimeout((function(){t._possiblyNotionShow(e)}),n):this._notionShow(e)}},{key:"_calculateShowDelay",value:function(){if(!this._$activeItem)return 0;var e=this.$currentSelectList;if(!e||!e.get(0))return 0;var t=e.offset(),n={x:t.left,y:t.top-75},i={x:t.left+e.outerWidth(),y:n.y},o={x:t.left,y:t.top+e.outerHeight()+75},s={x:t.left+e.outerWidth(),y:o.y},r=this._mouseLocs[this._mouseLocs.length-1],a=this._mouseLocs[0]||r;if(!r)return 0;if(a.x<t.left||a.x>s.x||a.y<t.top||a.y>s.y)return 0;if(this._lastDelayLoc&&r.x===this._lastDelayLoc.x&&r.y===this._lastDelayLoc.y)return 0;var c=function(e,t){return(t.y-e.y)/(t.x-e.x)},l=i,d=s;switch(this.noticeSide){case"left":l=o,d=n;break;case"above":l=n,d=i;break;case"below":l=s,d=o}var u=c(r,l),f=c(r,d),_=c(a,l),p=c(a,d);return u<_&&f>p?(this._lastDelayLoc=r,300):(this._lastDelayLoc=null,0)}},{key:"_onSelectShow",value:function(){this._statusDescriptions.renderNotice(),this.$el.on("mouseleave",this.onSelectMouseleave),this._$document.on("mousemove",this._onDocumentMove)}},{key:"_onSelectHide",value:function(){this._statusDescriptions.destroyNotice(),this._$document.off("mousemove",this._onDocumentMove),this._resetData()}},{key:"_onItemMouseenter",value:function(e){this._timeoutId&&clearTimeout(this._timeoutId),this._possiblyNotionShow(e)}},{key:"_onSelectMouseleave",value:function(){this._timeoutId&&clearTimeout(this._timeoutId),this._statusDescriptions.hide()}},{key:"_onDocumentMove",value:function(e){this._mouseLocs.push({x:e.pageX,y:e.pageY}),this._mouseLocs.length>3&&this._mouseLocs.shift()}}])&&a(t.prototype,n),s}(s.default),_="../build/transpiled/interface/card/status_descriptions/status_description_select";window.define(_,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([_])},224043:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var i=n(629133),o=n.n(i),s=n(460159),r=n.n(s),a=n(445368),c=n(304483);const l={linkClick:function(e){var t=(e=e||this.model).get("category");this.$el.trigger("unsorted:link:click"),new c.default({class_name:"modal-list",focus_element:"#unsorted_link_suggest",init:function(n){var i,s,c,l=this,d=r()({ref:"/tmpl/common/modal/unsorted_linking_up/modal.twig"}),u=r()({ref:"/tmpl/common/modal/unsorted_linking_up/suggest_list_item.twig"}),f={};f.is_retail_functions_enabled=APP.constant("account").is_retail_functions_enabled,f.lang=APP.lang||{},f.suggest={name:"unsorted_leads_search",id:"unsorted_link_suggest",class_name:" linkup-unsorted-suggest ",type:"leads_concat",disable_filter:!0,ajax:{url:"/ajax/unsorted/linkup/",params:"t=".concat(t,"&q=#q#")}},n.trigger("modal:loaded").html(d.render(f)).on("suggest:changed #unsorted_link_suggest",(function(t,i){var o=i.data("value-id"),s=i.data("contact-id"),r=i.data("value-type");n.hide(),n.find("#unsorted--linkup-block").hide(),e.link([{id:o,contact_id:s,type:r}]),l.destroy()})).on("suggest:loaded #unsorted_link_suggest",(function(e,t,n){var r=[];"ok"===(t=t||{}).status&&t.result.length>0&&(i=0,o().each(t.result,(function(e){s={2:(0,a.i18n)("Leads"),12:(0,a.i18n)("Customers")},e.type!==i&&(i=e.type,r.push({id:0,title:s[i],text:u.render({text:s[i],type:"head"}),custom_class:"js--suggest-item--not-selectable",raw_highlight:!0})),e.contact=e.contact||{},c=e.contact,f={id:e.id,title:[e.name,(0,a.contactName)(c.name),c.phone,c.email].join(", "),custom_class:e.custom_class,contact_id:c.id,type:e.type,text:u.render({text:e.name,type:"item",contact:c}),raw_highlight:!0},r.push(f),n.trigger("suggest:reset",[r,['<li data-value-id="<%= data.id %>" data-value-type="<%= data.type %>" data-contact-id="<%= data.contact_id %>" class="control--suggest--list--item <%= data.custom_class %>">','<span class="control--suggest--list--item-inner" title="<%= _.escape(data.title) %>"><%= data.highlighted_text %></span>',"</li>"].join("")])})))})).trigger("modal:centrify")}})},linkFailed:function(e){this.failedModal(e),this.loadStop(),this.$el.trigger("unsorted:link:failed")}};var d="../build/transpiled/interface/leads/pipeline/unsorted/mixins/unsorted_linking_up";window.define(d,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([d])},171701:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var i=n(629133),o=n.n(i),s=n(162262),r=n.n(s),a=n(210481),c=n(207427),l=n(744704),d=n(661533);function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t,n){return _="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n||e):o.value}},_(e,t,n||e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=p(e);if(t){var o=p(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}(this,n)}}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(s,e);var t,n,i=m(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),i.apply(this,arguments)}return t=s,n=[{key:"template",get:function(){return"/tmpl/cards/forms/profile_messengers/wrapper.twig"}},{key:"document_events",value:function(){return{mousedown:"handleMouseDown"}}},{key:"_selectors",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return o().extend({},l.default.prototype._selectors.apply(this,t),{social_profile_actions:".user-messenger-actions-tip .js-cf-actions-item",profile_messengers_item:".profile_messengers-item",js_cf_actions_item_data:'.js-cf-actions-item[data-type="%s"]',profile_messengers_item_name:".profile_messengers-item-name"})}},{key:"initialize",value:function(e){var t,n,i=e.onSuggestManagerDestroy;this.$profile_wrapper=this.$el,this.onSuggestManagerDestroy=i,this.existing_items=this.getExistingItems(),_(p(s.prototype),"initialize",this).call(this,(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){f(e,t,n[t])}))}return e}({},e),n=null!=(n={cant_add:!0,save_later:!0,saveLaterFunc:o().noop,template:this.template,onInit:this._init,existing_items:this.existing_items,$el:this._$body,onSuggestManagerDestroy:this.onSuggestManagerDestroy})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t))}},{key:"_init",value:function(){this.$el.addClass("profile_messengers_opened"),this.$el.addClass("suggest-manager-lib__actions"),d(".card-holder__container").on("scroll",o().bind(this.handleCardHolderScroll,this)),this._findElem("social_profile_actions").on("click",o().bind(this.initTipAction,this))}},{key:"handleMouseDown",value:function(e){d(e.target).closest(".profile_messengers_opened").get(0)||(d(".card-holder__container").off("scroll"),_(p(s.prototype),"destroy",this).call(this,!0))}},{key:"handleCardHolderScroll",value:function(){d(".card-holder__container").off("scroll"),_(p(s.prototype),"destroy",this).call(this,!0)}},{key:"suggestLeaveOnBlur",value:function(){o().noop()}},{key:"getExistingItems",value:function(){var e=this,t=this.$profile_wrapper.find(this._selector("profile_messengers_item"));return o().map(t,(function(t){var n=d(t);return{additional_data:'data-append-to-body="true"',code:n.find(e._selector("js_cf_actions_item_data","send_message")).data("origin"),entity_id:n.find(e._selector("js_cf_actions_item_data","send_message")).data("linked-entity-id"),data_chat_id:n.find(e._selector("js_cf_actions_item_data","send_message")).data("chat-id"),id:n.find(e._selector("js_cf_actions_item_data","unlink_profile")).data("value"),class_div:n.attr("class"),class_svg:n.find("svg").attr("class"),class_span:n.find(e._selector("profile_messengers_item_name")).attr("class"),icon_svg_href:n.find("use").attr("xlink:href").replace(/^#cards--|(?=-dims$)/g,""),icon_img_href:n.find("img").attr("src"),text:n.find(e._selector("profile_messengers_item_name")).text().trim(),profile_link:n.find("a").attr("href"),service:n.data("source")}}))}},{key:"setPositions",value:function(){var e=this.$profile_wrapper.get(0);if(e){var t=e.getBoundingClientRect(),n=t.left,i=t.width,o=t.top;this.$el.css({left:n,top:o,width:i})}}}],n&&u(t.prototype,n),s}(l.default);r().mixin(y,a.default,c.default);const g=y;var v="../build/transpiled/interface/suggest_profiles_manager/suggest_profiles_manager";window.define(v,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([v])},242949:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(629133),o=n.n(i),s=n(249909),r=n(323344),a=n(655656),c=n(966970),l=n(661533);const d={_init:function(){this.id&&(this.is_unsorted=this._checkIsUnsorted(),this.unsorted_model=new a.default,this.unsorted_collection=new c.default({model:this.unsorted_model}),this.$el.on("click","#card_unsorted_decline",o().bind(this._onAcceptDeclineUnsortedClick,this,"decline")).on("click","#card_unsorted_accept",o().bind(this._onAcceptDeclineUnsortedClick,this,"accept")).on("click","#card_unsorted_link",o().bind(this._linkUnsorted,this)),this.unsorted_collection.on("link:start",this._linkStart,this),this.unsorted_collection.on("linked:success",this._successLink,this),this.unsorted_collection.on("unsorted:responsible-assigned",this._onResponsibleAssigned,this))},destroyUnsorted:function(){this.unsorted_collection&&this.unsorted_collection.off()},_checkIsUnsorted:function(){return 0===this.main_user},_onResponsibleAssigned:function(){var e;this.is_unsorted&&(e=!this.$save_btn_container.hasClass("hidden"),this.is_unsorted=!1,this.toggleSaveBlock(e),this.$el.find(".unsorted-actions-card").remove())},_onAcceptDeclineUnsortedClick:function(e){var t=this;"decline"===e?this.unsortedApiMethod(e):this.validate().then((function(n){n&&t.unsortedApiMethod(e)}))},unsortedApiMethod:function(e){var t="accept"===e?"_afterAccept":"_afterDecline";l(document).trigger("card:overlay:show"),s.default[e](this.id).then(o().bind(this[t],this))},_linkUnsorted:function(){return this.unsorted_model=this.unsorted_collection.add(o().extend(this,{uid:this.id,category:APP.constant("unsorted_category")})),this.linkClick(this.unsorted_model),!1},_linkStart:function(e){var t=e.data.links[this.id].type,n=e.data.links[this.id].id;this.unsorted_model.set("linked_element_type",t),this.unsorted_model.set("linked_element_id",n)},_successLink:function(){var e=this.unsorted_model.get("linked_element_type"),t=this.unsorted_model.get("linked_element_id"),n=this._getEntityAfterLink(e,t);this.setNeedReload(),this.setChanges(!1),APP.router.navigate(n,{trigger:!0,replace:!0})},_getEntityAfterLink:function(e,t){var n=e,i=t,s=o().findKey(APP.element_types,(function(e){return e===n}));return"/".concat(s,"/detail/").concat(i,"?need_reload=Y&after_add=yes")},_afterDecline:function(){this.setNeedReload(),this.setChanges(!1),"yes"===(0,r.getQueryParam)("compact")?(window.opener&&window.opener.APP&&window.opener.APP.router.navigate(window.opener.location.pathname+window.opener.location.search,{trigger:!0,important:!0,replace:!0}),window.close()):APP.router.back()},_afterAccept:function(){this.setNeedReload(),this.setChanges(!1),l(document).trigger("page:reload")}};var u="../build/transpiled/interface/unsorted/mixins/card";window.define(u,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([u])},966970:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var i=n(629133),o=n.n(i),s=n(345839),r=n.n(s),a=n(655656),c=r().sync;const l=r().Collection.extend({model:a.default,url:a.default.prototype.url,comparator:function(e){return-e.get("date_create")},syncEnded:function(e){this._is_fetching=!1,e.apply({},Array.prototype.slice.call(arguments,1))},sync:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this._is_fetching)return this._is_fetching=!0,n.data=o().extend(n.data||{},{"order_by[date_create]":"desc"}),n.beforeSend=function(e){e.setRequestHeader("Accept","application/json")},n.success=o().wrap(n.success,o().bind(this.syncEnded,this)),n.error=o().wrap(n.error,o().bind(this.syncEnded,this)),n.remove=!1,c.call(this,e,t,n)},parse:function(e){var t=e.response&&e.response.unsorted;if(this.models.length){var n=o().map(this.models,(function(e){return e.get("uid")}));t.list=o().reject(t.list,(function(e){return o().contains(n,e.uid)}))}return this.summary=t.summary,t.list}});var d="../build/transpiled/interface/unsorted/pipeline/collection";window.define(d,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([d])},655656:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var i=n(629133),o=n.n(i),s=n(345839),r=n.n(s),a=n(445368),c=n(214558),l=n(661533),d=r().sync,u=r().Model.extend({idAttribute:"uid",url:function(e){return"/api/unsorted/".concat(e||"list","/?").concat(u.prototype.getCredentials())},sync:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n.beforeSend=function(e){e.setRequestHeader("Accept","application/json")},d.call(this,e,t,n)},parse:function(e){var t=(0,c.get)(),n=APP.constant("amojo_origins")[e.source_data.service],i=o().findWhere(t,{login:e.source_data.to});return e.manager_name="",n?e.source_data.service_icon=n.icon:e.manager_name=i?i.title:e.source_data.to,e.user_name=e.source_data.name||e.source_data.from,e.source_data.data=(0,a.mergeChatsMessages)(e.source_data.data),e.date_create||(e.date_create=(Date.now()/1e3).toFixed(0)),e.date_create=parseInt(e.date_create),e},getCredentials:function(){return this.user||(this.user=APP.constant("user")),["api_key=".concat(this.user.api_key),"login=".concat(this.user.login)].join("&")},accept:function(e){this.proceed("accept","accepted",{data:e})},decline:function(){this.proceed("decline","declined")},link:function(e){var t={},n=this.get("uid");e=e||[],o().each(e,(function(e){t[n]=e})),this.proceed("link","linked",{data:{links:t}})},proceed:function(e,t,n){var i,s={};this.user||(this.user=APP.constant("user")),s.user_id=this.user.id,s[e]=[this.get("uid")],n=n||{},this.trigger("".concat(e,":start"),n),this.sync("create",this,{url:this.url(e),data:l.param({request:{unsorted:o().extend({lang:APP.lang_id},s,n.data||{})}}),success:o().bind((function(n){if(n&&n.response&&n.response.unsorted){if((n=n.response.unsorted)[e]&&"success"===n[e].status)return i=n[e].data[this.get("uid")],i=!!o().isEmpty(i)||i,void this.trigger("".concat(t,":success"),i,this)}else this.trigger("".concat(t,":failed"),[n]);this.trigger("".concat(e,":finished"),n)}),this),error:o().bind((function(e){this.trigger("".concat(t,":failed"),[e])}),this)})}});const f=u;var _="../build/transpiled/interface/unsorted/pipeline/model";window.define(_,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([_])},249909:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var i=n(629133),o=n.n(i),s=n(214558),r=n(661533);const a={accept:function(e,t){return this.proceed("accept",e,t)},decline:function(e){return this.proceed("decline",e)},link:function(e,t){var n={};return t=t||[],o().each(t,(function(t){n[e]=t})),this.proceed("link",e,{data:{link:[e],links:n}})},proceed:function(e,t,n){var i,a=r.Deferred(),c={};return n=n||{},c.user_id=(0,s.current)("id"),c[e]=[t],r.ajax({url:"/ajax/unsorted/".concat(e),data:r.param({request:{unsorted:o().extend({lang:APP.lang_id},c,n.data||{})}}),dataType:"json",type:"POST"}).then((function(t){var n={finished:!0,response:t};if(t&&t.response&&t.response.unsorted){if((t=t.response.unsorted)[e]&&"success"===t[e].status)return i=o().chain(t[e].data).values().first().value(),i=!!o().isEmpty(i)||i,void a.resolve({success:!0,response:i})}else n.failed=!0;a.resolve(n)}),(function(e){a.resolve({failed:!0,response:e})})),a.promise()}};var c="../build/transpiled/network/leads/unsorted";window.define(c,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([c])},933386:(e,t,n)=>{var i;n.r(t),n.d(t,{SocketEvent:()=>i}),function(e){e.SUBSCRIBE_EVENT="subscribe",e.UNSUBSCRIBE_EVENT="unsubscribe",e.MESSAGE_EVENT="message"}(i||(i={}))},817603:(e,t,n)=>{n.r(t),n.d(t,{initSocketSubscription:()=>r});var i=n(128508),o=n(797078),s=n(933386),r=function(e){var t=e.channelName,n=e.onMessageReceive,a=e.onMessageFilter;o.default.send([{method:s.SocketEvent.SUBSCRIBE_EVENT,params:{channel:t}}]);var c=o.default.subscribe(t).pipe(i.filter((function(e){var n;return a(e)&&(null==e||null===(n=e.body)||void 0===n?void 0:n.channel)===t})),i.map((function(e){return e.body.payload}))).subscribe({next:n,error:function(){return r({channelName:t,onMessageReceive:n,onMessageFilter:a})}});return function(){o.default.send([{method:s.SocketEvent.UNSUBSCRIBE_EVENT,params:{channel:t}}]),c.unsubscribe()}}}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_18_50_52"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="04c1a6e8-a8cd-41a7-9fa2-346992a984b5",e._sentryDebugIdIdentifier="sentry-dbid-04c1a6e8-a8cd-41a7-9fa2-346992a984b5")}catch(e){}}();
//# sourceMappingURL=87043.feb8a2be0264199c0aae.js.map