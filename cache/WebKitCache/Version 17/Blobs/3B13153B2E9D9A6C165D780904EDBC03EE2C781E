"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[93430,63119],{686007:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var i=n(450422);const o={loadConnectSources:function(){var e=this;(0,i.isAmoChatsFullEnabled)()&&n.e(72667).then(n.bind(n,472667)).then((function(t){var n=t.default;e._addComponent(n,{el:e.$el.get(0)})}))}};var r="../build/transpiled/components/amochats_connect_sources/mixins/load_connect_sources";window.define(r,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([r])},493430:(e,t,n)=>{n.r(t),n.d(t,{InboxMessagingTabs:()=>w});var i=n(629133),o=n.n(i),r=n(313981),a=n(323344),s=n(998798),c=n(500034),l=n(258471),u=n(315243),d=n(656669),h=n(56783),f=n(30514),p=n(661533);function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function g(e,t,n,i,o,r,a){try{var s=e[r](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,o)}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return r}}(e,t)||m(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){if(e){if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}var C={inbox:{view:f.InboxTabContent,exclude_types:[]}};(0,c.isFeatureAvailable)("global_inbox")&&(C.mentions={view:h.MentionsTabContent});var w=r.default.extend({is_indestructible:!0,_elem:function(e){return this._is_indestructible?(this._indestructible_elems_cache||(this._indestructible_elems_cache={}),this._indestructible_elems_cache[e]||(this._indestructible_elems_cache[e]=p("<div></div>")),this._indestructible_elems_cache[e]):r.default.prototype._elem.apply(this,arguments)},_selectors:function(){return{tab:".inbox-messaging__tab",tab_by_type:'.inbox-messaging__tab[data-type="%s"]',filter_by_type:'.inbox-messaging__tab[data-type="%s"] .js-inbox-filter'}},_classes:function(){return{open_tools:"js-open-chat-tools",chat_tools:"inbox-messaging-chat-tools",tab_active:"inbox-messaging__tab--active",tab_title:"inbox-messaging__tab-title",search:"inbox-messaging-search",tab_content:"inbox-messaging__tab-content"}},events:function(){var e;return b(e={},"click ".concat(this._selector("tab_title")),"onTabTitleClick"),b(e,"click .".concat(this._class("search")),"onInboxSearchClick"),b(e,"click .".concat(this._class("open_tools")),"onOpenToolsClick"),b(e,"click .js-navigate-link",(function(e){var t=p(e.currentTarget).attr("href");window.location.pathname===t&&(e.preventDefault(),e.stopPropagation())})),e},document_events:function(){return{"click #inbox_messaging_overlay":"onFilterOverlayCloseClick"}},initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.el,n=e.getRightContainer,i=void 0===n?null:n,a=e.toggleRightContainer,s=void 0===a?o().noop:a,c=e.getOnboardingParams,l=void 0===c?o().noop:c,u=e.pageType;r.default.prototype.initialize.apply(this,arguments),this._getRightContainer=i,this._toggleRightContainer=s,this._getOnboardingParams=l,this.pageType=u,this.initTabs({toggleRightContainer:s,getOnboardingParams:l}),t&&(this.unmountInboxMessagingSearch=this.mountInboxMessagingSearch(),this.openFirstNotification(),this.model&&this.listenTo(APP.router,"route",this.onRouteChange))},destroy:function(){this.unmountInboxMessagingSearch&&this.unmountInboxMessagingSearch(),this.onFilterOverlayCloseClick(),r.default.prototype.destroy.apply(this,arguments)},openFirstNotification:function(){var e=this;!(0,s.isImboxSection)()||APP.isCard()||(0,c.isFeatureAvailable)("global_inbox")||this.inbox_view.afterFirstLoad().then((function(){var t=e.inbox_view.notifications.first();t&&o().contains(["fake","amochats_connect_sources"],t.get("id"))?setTimeout(e.collectEmptyDialogsMetrics):APP.router.navigate(t.get("web_link"),{trigger:!0,replace:!0})}))},collectEmptyDialogsMetrics:function(){var e=APP.constant("load_from_server"),t=[l.TrackedMetricName.CHAT_TTI],n=e?l.TrackedMetricType.INBOX_EMPTY_DIALOGS:l.TrackedMetricType.INBOX_EMPTY_DIALOGS_NAVIGATION;e&&t.push(l.TrackedMetricName.CHAT_FCP),l.metricRegistry.changeRegisterTypeWithMetrics((0,l.getDefaultMetricNamespace)(),n,t)},initTabs:function(e){var t=this,n=e.toggleRightContainer,i=e.getOnboardingParams,r=function(e,t){var i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).is_before_opening;t||void 0!==i&&i||"mentions"!==e||APP.router.navigate((0,a.setParam)({mentions:""},{only_path:!1}),{trigger:!1,replace:!0}),n.apply(void 0,arguments)};this.first_inited_tab=null,o().each(C,(function(e,n){var a=t;t._elem("tab_by_type",n).get(0)&&(t["".concat(n,"_view")]=t._addComponent(e.view,{el:t._elem("tab_by_type",n),is_indestructible:t.is_indestructible,exclude_click_types:e.exclude_types,getOnboardingParams:i,getSelectedId:function(){return t.selected_id},getRightContainer:o().bind(t.getRightContainer,t),openTools:o().bind(t.openTools,t),toggleRightContainer:o().bind(r,t,n),onBeforeRightContainerChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.onBeforeRightContainerChange.apply(a,v(t))},onFilterToggle:o().bind(t.filterHandleToggling,t),onRouteChange:o().bind(t.onRouteChange,t)}),t.first_inited_tab||(t.first_inited_tab=t["".concat(n,"_view")]))})),this.model&&this.listenTo(APP.router,"route",this.onRouteChange)},mountInboxMessagingSearch:function(){var e,t=this;if(!(0,s.isImboxSection)()||!(0,c.isFeatureAvailable)("talks_search")||!(0,c.isFeatureAvailable)("global_inbox"))return o().noop;var i,r,a=this,l=(i=function(){var t,i,r,s,c,l,h,f,p;return function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}(this,(function(_){switch(_.label){case 0:return[4,Promise.all([Promise.resolve().then(n.t.bind(n,827378,23)),n.e(37634).then(n.t.bind(n,937634,19)),Promise.all([n.e(98529),n.e(65111)]).then(n.bind(n,809243))])];case 1:switch(t=y.apply(void 0,[_.sent(),3]),i=t[0],r=i.default,s=t[1],c=s.default,l=t[2],h=l.default,f=[],a.pageType){case"chats":f.push(u.AvailableSearchEntities.INBOX,u.AvailableSearchEntities.LEADS);break;case"teams":f.push(u.AvailableSearchEntities.TEAM);break;default:f.push(u.AvailableSearchEntities.INBOX,u.AvailableSearchEntities.LEADS,u.AvailableSearchEntities.TEAM)}return p=r.createElement(h,{enabledSearchEntities:f,initialValue:(0,d.isSearchActive)()?(0,d.get)().term:"",onSearchDataFetched:o().bind(a.onSearchDataFetched,a),onSearchItemClick:o().bind(a.onSearchItemClick,a),onToggleSearchSize:o().bind(a.onToggleSearchSize,a),onSearchValueChange:o().bind(a.onSearchValueChange,a)}),(e=c.createRoot(a._elem("search")[0])).render(p),[2]}}))},r=function(){var e=this,t=arguments;return new Promise((function(n,o){var r=i.apply(e,t);function a(e){g(r,n,o,a,s,"next",e)}function s(e){g(r,n,o,a,s,"throw",e)}a(void 0)}))},function(){return r.apply(this,arguments)});return l(),function(){var n=t._elem("search").html();e&&e.unmount(),t._elem("search").html(n)}},onToggleSearchSize:function(e){this.overlay(!e,"search"),e?this.$el.css("z-index",102):this.$el.css("z-index","")},onSearchItemClick:function(e,t){switch(e){case"inbox":break;case"team":this.mentions_view.navigateToChat(t.id,t.webLink),this.removeHighlightsFromQueryString();break;default:this.removeHighlightsFromQueryString()}this._$document.trigger("card-messages:rerender-highlights")},onSearchDataFetched:function(e){var t=this;o().each(e,(function(e){var n={};"inbox"===e.entity?n=o().propertyOf(e)(["data","entity"])||{}:"leads"===e.entity&&(n={id:o().propertyOf(e)(["data","id"]),type:"leads"}),n.id&&t._$document.trigger("entity:chats-preload",[n.id,n.type])}))},removeHighlightsFromQueryString:function(){var e=(0,a.removeQueryParam)(["highlights","highlightId"]),t=window.location.pathname+(e?"?".concat(e):"");APP.router.navigate(t,{trigger:!1,replace:!0})},onSearchValueChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e.trim()?this._elem("open_tools").hide():this._elem("open_tools").show(),e.trim().length>=3?(0,d.set)({term:e}):(this.removeHighlightsFromQueryString(),this.actualizeActiveTabFilter(),this._$document.trigger("card-messages:rerender-highlights"))},onInboxSearchClick:function(){this.$el.hasClass("inbox-filter_open")&&this.onFilterOverlayCloseClick()},onTabTitleClick:function(e){var t=e.currentTarget,n=p(t).closest(this._selector("tab")).attr("data-type");this.switchTab(n)},onOpenToolsClick:function(){this.openTools()},onRouteChange:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if((0,s.isImboxSection)()){var i=n.silent,o=n.skip_tab_filter_actualization,r=void 0!==o&&o,a=parseInt(t[0])>0?"inbox":t[0];if((0,s.isMentionsPageSection)()&&(a="mentions"),(0,s.isChatToolsPageSection)()&&(a="tools"),a&&(C[a]||"tools"===a)){this.closeViewsInRightContainer(a);var c=Boolean(this._elem("tab_by_type",a).length);"tools"!==a&&c&&this.switchTab(a,{skip_filter_actualization:r}),this.selected_id="inbox"===a?parseInt(t[0]):t[0],this.model.set("current_state",{section:a,selected:this.selected_id}),i||(this.unsetSelected(),(c||"tools"===a)&&this.setSelected(a,t))}else this.unsetSelected()}},openTools:function(e){var t=this;return(0,c.isFeatureAvailable)("chats_chat_tools")?new Promise((function(i,r){Promise.all([n.e(76012),n.e(20983),n.e(56740),n.e(37084),n.e(40446),n.e(1296),n.e(48198),n.e(95882),n.e(18194),n.e(93671),n.e(70013),n.e(38994),n.e(16228),n.e(26263),n.e(21932),n.e(88012),n.e(72191),n.e(15028),n.e(60139),n.e(93103),n.e(26632),n.e(90580),n.e(11958),n.e(12897),n.e(39042),n.e(79954),n.e(14095),n.e(20064),n.e(15656),n.e(7390),n.e(10642),n.e(68924),n.e(56973),n.e(52758),n.e(41136),n.e(39970),n.e(28419),n.e(58551),n.e(21896),n.e(34040),n.e(79328),n.e(47419),n.e(21921),n.e(27992),n.e(74647),n.e(16025),n.e(15081),n.e(16427),n.e(10417),n.e(42162),n.e(69314),n.e(42693),n.e(82984),n.e(58432),n.e(12651),n.e(60882),n.e(6476),n.e(44364),n.e(7426),n.e(21372),n.e(77133),n.e(69329),n.e(72209),n.e(36442),n.e(46826),n.e(37951),n.e(74174),n.e(73969),n.e(76649),n.e(35950),n.e(45606),n.e(48280),n.e(24967),n.e(79835),n.e(70294),n.e(40401),n.e(67462)]).then(n.bind(n,606011)).then((function(n){var r=n.default;if(!t.tools_view){var a=t;t.tools_view=t._addComponent(r,{el:t._elem("chat_tools"),getRightContainer:o().bind(t.getRightContainer,t),toggleRightContainer:t._toggleRightContainer,getOnboardingParams:t._getOnboardingParams,onBeforeRightContainerChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.onBeforeRightContainerChange.apply(a,v(t))},onClose:o().bind(t.actualizeActiveTabFilter,t),onFilterToggle:o().bind(t.filterHandleToggling,t),onRouteChange:o().bind(t.onRouteChange,t)})}t.tools_view.open(e),i(t.tools_view)}),(function(e){return r(e)}))})):Promise.reject()},onFilterOverlayCloseClick:function(){var e=this,t=[this].concat(o().reduce(o().keys(C),(function(t,n){return e["".concat(n,"_view")]?t.concat(e["".concat(n,"_view")]):t}),[]));o().each(t,(function(e){e.search&&e.search.filter&&e.search.filter.close()}))},switchTab:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).skip_filter_actualization,n=void 0!==t&&t,i=this._elem("tab_by_type",e),o=this._findElem("tab_active");o.attr("data-type")!==e&&i.length&&(this.model&&this.model.set("active_tab",e),i.addClass(this._class("tab_active")),o.removeClass(this._class("tab_active")),this["".concat(e,"_view")]&&(this["".concat(e,"_view")].show(),this["".concat(e,"_view")].onVirtualizedResize(),n||this.actualizeActiveTabFilter()))},show:function(){var e;null===(e=this.first_inited_tab)||void 0===e||e.show()},closeViewsInRightContainer:function(){this.mentions_view&&this.mentions_view.opened_direct_chat&&!(0,s.isTeamChatOpened)()&&(this.mentions_view.closeDirectChat(),this.actualizeActiveTabFilter())},getRightContainer:function(){return o().isFunction(this._getRightContainer)?this._getRightContainer():p()},onBeforeRightContainerChange:function(){var e=this.canChangeRightContainerView();return e||this.disallowRightContainerChange(),e},disallowRightContainerChange:function(){var e=this.getCurrentState().section;return this["".concat(e,"_view")].onDisallowRightContainerChange()},canChangeRightContainerView:function(){var e=(this.getCurrentState()||{}).section,t=this["".concat(e,"_view")];return!e||!o().isFunction(t.canDestroyViewInRightContainer)||t.canDestroyViewInRightContainer()},getCurrentState:function(){return this.model&&this.model.get("current_state")},ensureView:function(e){var t=this;return new Promise((function(n,i){"tools"!==e?n(t["".concat(e,"_view")]):t.openTools().then(n,i)}))},setSelected:function(e,t){var n=this;this.ensureView(e).then((function(i){if(i){var r=i;r.afterFirstLoad().then((function(){var i,a=(0,s.isTeamChatOpened)();r.notifications&&!a&&(i="mentions"===e?r.notifications.find((function(e){return o().propertyOf(e.get("entity"))("id")===n.selected_id})):r.notifications.get(n.selected_id)),i&&i.set("selected",!0),"tools"===e&&r.open(t[0]),a&&("create"===t[1]?r.createGroupChat():r.openDirectChat(n.selected_id,!0))}))}}))},unsetSelected:function(){var e=this;o().each(C,(function(t,n){var i=e["".concat(n,"_view")];if(i&&i.notifications){var o=i.notifications.findWhere({selected:!0});o&&o.set("selected",!1)}}))},actualizeActiveTabFilter:function(){var e={};"inbox"===this.model.get("active_tab")&&(e=this.inbox_view.search.filter.getFilterState()),(0,d.set)(e)},filterHandleToggling:function(e){this.$el.toggleClass("inbox-filter_open",e),this.overlay(!e)},overlay:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e&&this.$overlay?(this.$overlay.trigger("overlay:hide"),this.$overlay=null):e||this.$overlay||(this._$body.append(this.$overlay=p('<div class="default-overlay" id="inbox_messaging_overlay'.concat(t?"_".concat(t):"",'" style="z-index: 101"></div>'))),this.$overlay.trigger("overlay:show"))}}),S="../build/transpiled/components/base/inbox/inbox_messaging/InboxMessagingTabs";window.define(S,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([S])},30514:(e,t,n)=>{n.r(t),n.d(t,{InboxTabContent:()=>Q,subscribeInitGoToNotification:()=>H});var i=n(629133),o=n.n(i),r=n(162262),a=n.n(r),s=n(128508),c=n(161320),l=n.n(c),u=n(267651),d=n.n(u),h=n(156040),f=n(797078),p=n(859200),_=n(323344),g=n(445368),b=n(450422),y=n(214558),v=n(500034),m=n(998798),C=n(672034),w=n(397927),S=n(363119),x=n(686007),k=n(382646),O=n(778636),T=n(304483),I=n(621448),P=n(701291),E=n(407769),A=n(656669),R=n(962444),M=n(661533);function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function N(e,t,n,i,o,r,a){try{var s=e[r](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,o)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){N(r,i,o,a,s,"next",e)}function s(e){N(r,i,o,a,s,"throw",e)}a(void 0)}))}}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}var V=APP.constant("account").id,z="inbox:talks:".concat(V),G="system:state:".concat(V),U={create:[119],update:[127,128,134],delete:[120],read:[125],unread:[126],is_starred:[131],is_not_starred:[132],emotionDetection:[170]};f.default.status.subscribe((function(e){e.state===WebSocket.OPEN&&f.default.send([{method:"subscribe",params:{channel:G}}])})),function(){if(APP.constant("account").is_chats_inbox_enabled){var e=[I.InboxBadgeId.BADGE_INBOX],t=(0,v.isFeatureAvailable)("global_inbox");(0,v.isFeatureAvailable)(v.Features.SYSTEM_NAVIGATION_V2)&&e.push(I.InboxBadgeId.BADGE_SUPPORT_CHAT_BRIEF),t&&e.push(I.InboxBadgeId.BADGE_TEAM_UNION),(0,I.listen)(e).subscribe((function(e){if((0,v.isFeatureAvailable)(v.Features.SYSTEM_NAVIGATION_V2))(0,i.each)(e,(function(e,t){switch(t){case I.InboxBadgeId.BADGE_INBOX:(0,w.updateItemCounter)({id:w.CounterId.CHATS_INBOX,count:e});break;case I.InboxBadgeId.BADGE_TEAM_UNION:(0,w.updateItemCounter)({id:w.CounterId.TEAM_INBOX,count:e});break;case I.InboxBadgeId.BADGE_SUPPORT_CHAT_BRIEF:(0,w.updateItemCounter)({id:w.CounterId.CONTACT_SUPPORT,count:e})}}));else{var n=o()(o().values(e)).reduce((function(e,t){return e+t}),0);(0,w.updateItemCounter)({id:w.CounterId.CHATS,count:n>999&&t?"999+":n})}}))}}();var $,H=($=D((function(e,t){var n,i,r,a,s;return L(this,(function(c){return n=t.params,i=t.type,r=t.id,a=o().propertyOf(n)([i,"enabled"]),(0,m.isImboxSection)()&&(0,p.isAdmin)()&&a?((s=function(){return e.add({id:r})})(),e.on("add remove",s),[2,function(){e.off("add remove",s)}]):[2,o().noop]}))})),function(e,t){return $.apply(this,arguments)}),Q=O.default.extend({el:"<div></div>",template:"/tmpl/inbox/inbox_messaging/aside.twig",badge_id:I.InboxBadgeId.BADGE_INBOX,sound_id:"amo_inbox_sound_talks",source:R.default,collection:E.Collection,hidden:!0,no_content_text:(0,g.i18n)("No conversations found"),is_chats_notification_item_enabled:!(0,v.isFeatureAvailable)("global_inbox"),_selectors:function(){return o().extend({},O.default.prototype._selectors.apply(this,arguments),{inbox:"#inbox_messaging_aside",inbox_container:"#inbox_messaging_list",mentions:"#inbox_mentions",connect_source_btn:".search-more .connect-source-item"})},_classes:function(){return o().extend({},O.default.prototype._classes.apply(this,arguments),{aside:"inbox-messaging__aside",is_hidden:"inbox-holder_hidden",tab_counter:"js-talks-tab-counter",list:"inbox-list",list_scrolled:"inbox-list--scrolled",widget_creator:"widget-creator"})},document_events:function(){var e=this;return o().extend({},o().result(O.default.prototype,"document_events",{}),{"page:changed":"updateVirtualizedInboxList","fake-socket-event:inbox:talks:read":function(t,n){O.default.prototype.onMessageRead.call(e,n)}})},events:function(){return o().extend({},o().result(O.default.prototype,"events",{}),{"click .notification-item--go-to-add-channel":"onGoToAddChannelClick","js-widget-creator:create-widget .widget-creator":"onWidgetCreate"})},initialize:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.is_indestructible,i=void 0===n||n,r=t.getSelectedId,a=void 0===r?o().noop:r,s=t.getOnboardingParams,c=t.getRightSideContainer,l=void 0===c?null:c,u=t.openTools;this._is_indestructible=i,this._list_scrolled=!1,this.getSelectedId=a,this.getDirectChatContainer=l,O.default.prototype.initialize.apply(this,arguments),this.openTools=u,(0,h.onPageFullyLoaded)((function(){e.initGoToNotification(s),(0,m.isImboxSection)()&&e.loadConnectSources()}))},destroy:function(){return o().isFunction(this.removeSocketConnectionChangeListener)&&this.removeSocketConnectionChangeListener(),o().isFunction(this.unsubscribeInitGoToNotification)&&this.unsubscribeInitGoToNotification(),O.default.prototype.destroy.apply(this,arguments)},updateVirtualizedInboxList:function(){this.notifications&&(this.onVirtualizedResize(),this.onInboxListModify(),this.checkVisibilityOpenChat())},initAllPromises:function(){this.promise_all_init=[this.requestBadge(),this.initSource(),this.connect(),this.requestPushPermission()],(0,v.isFeatureAvailable)(v.Features.EMOTION_DETECTOR_AVAILABLE)&&o().isUndefined((0,v.getAccountFeatures)()[v.Features.IS_EMOTION_DETECTOR_ENABLED])&&this.promise_all_init.push(this.checkEmotionDetectorEnabled());var e=Promise.all(this.promise_all_init);return(0,h.onPageFullyLoaded)(o().bind(this.initCounters,this)),e},getInitialSortOrder:function(){return(0,P.getInitialSortOrder)()},initQuickActionMenu:function(e){return D((function(){var t,i;return L(this,(function(r){switch(r.label){case 0:return[4,n.e(45611).then(n.bind(n,245611))];case 1:return t=r.sent(),i=t.default,this.notification_quick_action=this._addComponent(i,o().extend({onButtonClick:o().bind(this.processMultiaction,this),onGetQuickActionButtons:o().bind(this.getQuickActionButtons,this,e.model)},e)),[2]}}))})).apply(this)},initCounters:function(){return D((function(){var e,t,n;return L(this,(function(i){switch(i.label){case 0:return e=(0,A.isFilterActive)()?(0,A.get)({parse:!1}):{},[4,Promise.all([this.loadCount(e),this.afterFirstLoad()])];case 1:return t=B.apply(void 0,[i.sent(),1]),n=t[0].count,this.setTotalCount(n),[2]}}))})).apply(this)},initGoToNotification:function(e){return D((function(){var t,n,i,r;return L(this,(function(a){switch(a.label){case 0:return t=this,[4,e()];case 1:return n=a.sent(),(0,v.isFeatureAvailable)("global_inbox")?(i=this,[4,H(this.notifications,{id:"go-to-add-channel",type:"inbox",params:n})]):[3,3];case 2:return i.unsubscribeInitGoToNotification=a.sent(),[3,4];case 3:(0,b.isAmoChatsFullEnabled)()&&o().propertyOf(n)(["inbox","enabled"])&&(this.notifications.add({id:"amochats_connect_sources"}),this._elem("connect_source_btn").addClass("hidden"),r=function(){2===t.notifications.length&&"amochats_connect_sources"===t.notifications.at(0).get("id")&&(t.notifications.remove("amochats_connect_sources"),t._elem("connect_source_btn").removeClass("hidden")),t.notifications.off("add",r)},this.notifications.on("add",r)),a.label=4;case 4:return[2]}}))})).apply(this)},onGoToAddChannelClick:function(){return D((function(){var e;return L(this,(function(t){return e=this,(0,v.isFeatureAvailable)("global_marketplace")?((0,v.isFeatureAvailable)(v.Features.SYSTEM_NAVIGATION_V2)?APP.router.navigate("/settings/widgets",{trigger:!0}):this.openTools("channels"),[2]):(Promise.all([n.e(76012),n.e(20983),n.e(56740),n.e(37084),n.e(40446),n.e(95882),n.e(18194),n.e(93671),n.e(38994),n.e(16228),n.e(26263),n.e(21932),n.e(88012),n.e(6712),n.e(93103),n.e(26632),n.e(90580),n.e(11958),n.e(12897),n.e(39042),n.e(79954),n.e(14095),n.e(20064),n.e(15656),n.e(7390),n.e(10642),n.e(68924),n.e(56973),n.e(52758),n.e(41136),n.e(39970),n.e(28419),n.e(58551),n.e(21896),n.e(34040),n.e(79328),n.e(47419),n.e(21921),n.e(27992),n.e(74647),n.e(16025),n.e(15081),n.e(16427),n.e(10417),n.e(42162),n.e(69314),n.e(42693),n.e(82984),n.e(58432),n.e(12651),n.e(38467),n.e(17433),n.e(74687),n.e(72154),n.e(59886),n.e(61494),n.e(81916),n.e(95971),n.e(40488),n.e(41473),n.e(38706),n.e(36767),n.e(97861)]).then(n.bind(n,440178)).then((function(t){var n=t.default;e.source_modal_creator||(e.source_modal_creator=e._addComponent(n,{onBeforeInitSources:function(){S.default.showMainOverlay(M("#page_holder"),{position_absolute:!0,z_index:105})},onInitSourcesSuccess:function(){S.default.hideMainOverlay()},onInitSourcesError:function(){S.default.hideMainOverlay(),(new T.default).showError(!1,!1)}})),e.source_modal_creator.showModal()})),[2])}))})).apply(this)},onVirtualizedListScroll:function(e){e<=0&&this._list_scrolled?(this._list_scrolled=!1,this._elem("list").removeClass(this._class("list_scrolled"))):this._list_scrolled||(this._list_scrolled=!0,this._elem("list").addClass(this._class("list_scrolled"))),O.default.prototype.onVirtualizedListScroll.apply(this,arguments)},onWidgetCreate:function(){return D((function(){var e,t,i;return L(this,(function(o){switch(o.label){case 0:return e=this,[4,n.e(42627).then(n.bind(n,942627))];case 1:return t=o.sent(),i=t.default,this.modal_create_widget=new i({filter:{filter:this.search.filter.getFilterState()},widget_data:{name:"",element_type:APP.element_types.talk},need_additional_aggregation:!1,getFilterState:function(){return e.search.filter.getFilterState()}}),[2]}}))})).apply(this)},cleanTotalCount:function(){this._elem("widget_creator").text("")},loadCount:function(e){return D((function(){var t,n;return L(this,(function(i){switch(i.label){case 0:if((0,p.getRights)("is_free_user"))return[2,{count:0}];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,M.ajaxPromisify("/ajax/v4/inbox/count",{data:{filter:e}})];case 2:return t=i.sent(),[3,4];case 3:return n=i.sent(),console.error(n),[3,4];case 4:return[2,{count:null==t?void 0:t.count}]}}))}))()},setTotalCount:function(e){var t;o().isUndefined(e)?this.cleanTotalCount():this.count!==e&&(this.total_count=e,this._elem("widget_creator").text("".concat((0,g.i18n)("Total"),": ").concat(e)),null===(t=this.search)||void 0===t||t.checkWidthOptions())},getQuickActionButtons:function(e){var t=[];return e.get("is_read")||t.push({icon:"inbox--double-tick",text:(0,g.i18n)("Mark answered"),callback:{type:"read",data:{ids:[e.get("notification_id")]}}}),"opened"===e.get("status")&&t.push({icon:"tasks--types-icons--63",text:(0,g.i18n)("Talk close"),callback:{type:"close",data:{ids:[e.get("notification_id")]}}}),t},_getDirectChatContainer:function(){return o().isFunction(this.getDirectChatContainer)?this.getDirectChatContainer():O.default.prototype._getDirectChatContainer.apply(this,arguments)},initMultiaction:function(){return D((function(){var e,t;return L(this,(function(i){switch(i.label){case 0:return[4,n.e(59068).then(n.bind(n,59068))];case 1:return e=i.sent(),t=e.default,this.multiaction=this._addComponent(t,{el:this._elem("aside_inner").get(0),notifications:this.notifications,buttons:[{title:(0,g.i18n)("Mark answered"),icon:"inbox--double-tick",type:"read"},{title:(0,g.i18n)("Talk close"),icon:"tasks--types-icons--63",type:"close"}],closeChat:o().bind(this.closeDirectChat,this),onButtonClick:o().bind(this.processMultiaction,this)}),[2]}}))})).apply(this)},processMultiaction:function(e,t){var n={filter:{}};t.choose_all?n.filter=this.search.filter.getFilterState():n.filter.id=t.ids,o().contains(["read","close"],e)&&this.source_loader.handleMultiaction(e,n)},connect:function(){return D((function(){return L(this,(function(e){switch(e.label){case 0:return this._is_indestructible?[3,2]:[4,this.afterFilterInit()];case 1:e.sent(),e.label=2;case 2:return this.inboxTalkChannelSocket(),this.systemChannelSocket(),[2]}}))})).apply(this)},inboxTalkChannelSocket:function(){var e=f.default.subscribe([z]).pipe(s.filter((function(e){var t=o().propertyOf(e.body),n=t("payload"),i=t("channel")===z;return n&&i})),s.map((function(e){return e.body.payload})),s.share()),t=e.pipe(s.filter((function(e){return o().contains(o().union(U.create,U.update),e.type)})),s.map((function(e){var t=e.model;return t.silent=parseInt(o().propertyOf(e.model)(["last_message","id"]))>=0,!o().isEmpty(t.last_reaction)&&t.silent&&(t.silent=l()(t.last_reaction.created_at).isBefore(t.last_message.last_message_at)),[t]}))),n=e.pipe(s.filter((function(e){return o().contains(U.read,e.type)})),s.map((function(e){return[e.model]}))),i=e.pipe(s.filter((function(e){return o().contains(U.delete,e.type)})),s.map((function(e){return[e.model]}))),r=e.pipe(s.filter((function(e){return o().contains(o().union(U.is_starred,U.is_not_starred),e.type)})),s.map((function(e){return{ids:[e.model.id],label:o().contains(U.is_starred,e.type)}}))),a=e.pipe(s.filter((function(e){return o().contains(U.emotionDetection,e.type)})),s.map((function(e){return[e.model]})));this.socket.add(t.subscribe(o().bind(this.onMessageReceived,this))),this.socket.add(n.subscribe(o().bind(this.onMessageRead,this))),this.socket.add(i.subscribe(o().bind(this.onMessageRemove,this))),this.socket.add(r.subscribe(o().bind(this.onMessageLabel,this))),this.socket.add(a.subscribe(o().bind(this.onEmotionDetection,this))),this.removeSocketConnectionChangeListener=f.default.onConnectionChange(o().bind(this.onSocketReconnectSynchronize,this))},systemChannelSocket:function(){var e=f.default.subscribe([G]).pipe(s.filter((function(e){var t=o().propertyOf(e.body),n=t("payload"),i=t("channel")===G;return n&&i})),s.map((function(e){return e.body.payload})),s.share()).pipe(s.filter((function(e){var t=o().chain(U).values().flatten(1).value();return o().contains(t,e.type)})),s.map((function(){return[]})));this.socket.add(e.subscribe(o().bind(this.onMultipleEventHandle,this)))},onMultipleEventHandle:function(){var e=this,t=o().propertyOf(this.notifications.findWhere({selected:!0}))("id");this.no_content=!0,this.cleanTotalCount();var n=[this.loadCount(this.search.filter.getFilterState()),this.apply()];Promise.all(n).then((function(t){var n=B(t,1)[0].count;e.setTotalCount(n)})),(0,I.update)(),this.listenToOnce(this.notifications,"sort",(function(){var n=e.notifications.get(t);n&&n.set("selected",!0),o().delay((function(){return e.updateVirtualizedInboxList()}),100)}))},onEmotionDetection:function(e){var t=this;o().each(e,(function(e){var n=t.notifications.get(e.id);n&&(d().publish("socket-event:talks:emotion",{emotion:e.emotion,talkId:e.id}),n.set("emotion",e.emotion))})),this.onMessageReceived(e)},onMessageRemove:function(e){(0,m.isImboxSection)()&&this.processSocket({models:e,canRemove:function(e){var t=o().keys(e).length,n="opened"===e.status;return 1===t&&n||2===t&&n&&e.is_read}})},onMessageRead:function(e){(0,m.isImboxSection)()&&this.processSocket({models:e,canRemove:function(e){var t=o().keys(e).length,n="false"===e.is_read;return 1===t&&n||2===t&&n&&e.status}})},processSocket:function(e){var t=this,n=e.canRemove,i=e.models,r=this.search.filter.getFilterState();o().each(i,(function(e){var i=new(0,t.notifications.model)(e),o=t.filterEntryCheck(i),a=Boolean(t.notifications.get(i));return o?(a||t.setTotalCount(t.total_count+1),void t.addNotification(i,{merge:!0})):a?(t.setTotalCount(t.total_count-1),void t.notifications.remove(i)):void(n(r)&&t.setTotalCount(t.total_count-1))})),this.notifications.sort()},onMessageReceived:function(e){var t=this;o().each(e,(function(e){var n=new(0,t.notifications.model)(e),i=t.filterEntryCheck(n);!t.notifications.get(n)&&i&&t.setTotalCount(t.total_count+1)})),O.default.prototype.onMessageReceived.apply(this,arguments)},rejectExistingModelOnAdd:function(){var e=O.default.prototype.rejectExistingModelOnAdd.apply(this,arguments);e.length&&this.setTotalCount(this.total_count-e.length)},addNotification:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.get("entity")||{};return t.merge&&(t.parse=!0),e.id===this.getSelectedId()&&e.set("selected",!0),o().contains(["leads","customers"],n.type)&&this._$document.trigger("entity:chats-preload",[n.id,n.type]),O.default.prototype.addNotification.apply(this,arguments)},read:function(){return Promise.resolve()},show:function(){return D((function(){var e,t=arguments;return L(this,(function(n){switch(n.label){case 0:return e=this,this.hidden?(this.hidden=!1,[4,O.default.prototype.show.apply(this,t)]):[2];case 1:return n.sent(),this._removeClass("is_hidden"),this._elem("aside").addClass("slide-in"),this.updateVirtualizedInboxList(),this.autoloadContent(),this.afterFirstLoad().then((function(){e.updateVirtualizedInboxList(),o().delay((function(){return e.updateVirtualizedInboxList()}),100)})),[2]}}))})).apply(this)},checkEmotionDetectorEnabled:function(){return D((function(){var e,t;return L(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,(0,C.getFeaturesByQuery)({queries:[v.Features.IS_EMOTION_DETECTOR_ENABLED],shouldCamelCase:!1})];case 1:return e=n.sent().features,(0,v.updateFeature)(v.Features.IS_EMOTION_DETECTOR_ENABLED,e[v.Features.IS_EMOTION_DETECTOR_ENABLED]),this.updateListView(),[3,3];case 2:return t=n.sent(),console.error(t),[3,3];case 3:return[2]}}))})).apply(this)},canNotFoundNotificationBeShown:function(){return 0===this.notifications.length||1===this.notifications.length&&"go-to-add-channel"===this.notifications.at(0).get("id")},canNotFoundNotificationBeRemoved:function(){var e=this;return!(1===this.notifications.length&&"fake"===this.notifications.at(0).get("id")||2===this.notifications.length&&o().every(["go-to-add-channel","fake"],(function(t){return e.notifications.get(t)})))},canMultiactionsBeShown:function(){var e=["fake","go-to-add-channel"],t=!0;return this.notifications.length<=e.length&&(t=o().filter(this.notifications.models,(function(t){var n=t.id;return o().includes(e,n)})).length!==e.length),t},openMultiaction:function(){this.multiaction&&this.canMultiactionsBeShown()&&this.multiaction.show(!1)},firstApply:function(){var e=(0,_.QStoJSON)((0,_.getQueryString)(),!0),t={};o().each(e.filter,o().bind(this.firstApplyMutator,this,t)),this.apply({is_first:!0,first_preset_data:t})},firstApplyMutator:function(e,t,n){switch(n){case"date_preset":if(!o().isEmpty(t))break;e.updated_at={date_preset:t};break;case"interaction_status[]":if(o().isEmpty(t))break;e.type=t;break;case"inbox_chat_source[]":if(o().isEmpty(t))break;e.source_id=t;break;default:O.default.prototype.firstApplyMutator.apply(this,arguments)}},filterEntryCheck:function(e){var t=this,n=this.getFilterOptions(),i=o().propertyOf(n)("date[type]")||"",r="closed"===i?e.get("closed_at"):e.get("created_at"),a=o().reduce(n,(function(n,a,s){var c=o().compact(o().isArray(a)?a:[a]);if(n&&c.length&&"in_work"!==i){var u=o().propertyOf(e.get("entity"))("main_user_id")||"";switch(s=s.indexOf("[pipe]")>-1?"pipe":s){case"tag[]":var d;n=Boolean(o().chain(null===(d=e.get("entity"))||void 0===d?void 0:d.tags).pluck("id").intersection(o().map(c,(function(e){return parseInt(e)}))).value().length);break;case"segments":var h;n=Boolean(o().chain(null===(h=e.get("entity"))||void 0===h?void 0:h.segments).pluck("id").intersection(o().map(c,(function(e){return parseInt(e)}))).value().length);break;case"pipe":n=t.isPipelineFillerValid(e);break;case"responsible":n=o().contains(c,u.toString());break;case"status[]":n=o().contains(c,e.get("status"));break;case"is_read[]":n=o().contains(c,e.get("is_read").toString());break;case"is_starred[]":n=o().isUndefined(e.get(t.getLabelParamName()))?!o().isUndefined(t.notifications.get(e.get("id"))):o().contains(c,Number(e.get(t.getLabelParamName())).toString());break;case"date_preset":n=function(e,t){var n=(0,k.default)(t),i=parseInt(n.from),o=parseInt(n.to);return e>=i&&e<=o}(r,a);break;case"emotion[]":n=o().contains(c,e.get("emotion"));break;case"updated_at_from":n=function(e,t){var n=APP.system.format.date.date;return e>=l()(t,n).unix()}(r,a);break;case"updated_at_to":n=function(e,t){var n=APP.system.format.date.date;return e<=l()(t,n).set({hours:23,minutes:59,second:59}).unix()}(r,a);break;case"interaction_status[]":n=o().contains(c,e.get("type"));break;case"inbox_chat_source[]":n=o().contains(c,String(e.get("source_id")))}}return n}),!0),s=this.isSubscribedFilterValid({filter_fields:n,model:e}),c=this.isParticipantsFilterValid({filter_fields:n,model:e});return a&&s&&c},isPipelineFillerValid:function(e){var t=this.search.filter.getFilterState().pipe;if(!t)return!0;var n=e.get("entity")||{},i=n.pipeline_id,r=n.status_id;if(!i||!r)return!1;var a=t[i];return!!a&&o().contains(a,r.toString())},showNotification:function(){},isParticipantsFilterValid:function(e){var t=e.filter_fields,n=e.model,i=[],r=o().reduce(["participants_users","participants_groups"],(function(e,r,a){var s,c,l,u=o().propertyOf(t)(r);if(u){var d=o().compact(o().isArray(u)?u:[u]);switch(r){case"participants_users":e[a]=!n.get("participants")||o().intersection(o().map(n.get("participants"),(function(e){return e.toString()})),o().map(d,(function(e){return"bot"===e?"0":e}))).length>0;break;case"participants_groups":e[a]=!n.get("participants")||o().intersection((s=d,c=o().groupBy((0,y.get)(),"group"),l=o().reduce(s,(function(e,t){var n=c["group_".concat(t)];return o().union(e,n)}),[]),o().chain(l).pluck("id").map((function(e){return parseInt(e)})).value()),n.get("participants")).length>0}}else i.push(a);return e}),[!0,!0]);return i.length&&r.length!==i.length&&o().each(i,(function(e){r[e]=!1})),o().compact(r).length>0},isSubscribedFilterValid:function(e){var t=e.filter_fields,n=e.model,i=[],r=o().propertyOf(n.get("subscribers")),a=o().reduce(["subscribed_user","subscribed_group"],(function(e,a,s){var c=o().propertyOf(t)(a);if(c){var l=o().compact(o().isArray(c)?c:[c]);switch(a){case"subscribed_user":e[s]=!n.get("subscribers")||o().intersection(o().map(l,(function(e){return parseInt(e)})),r("users")).length>0;break;case"subscribed_group":e[s]=!n.get("subscribers")||o().intersection(o().map(l,(function(e){return parseInt(e)})),r("groups")).length>0}}else i.push(s);return e}),[!0,!0]);return i.length&&a.length!==i.length&&o().each(i,(function(e){a[e]=!1})),o().compact(a).length>0},createNotificationModel:function(e){this.addNotification(new E.Model(e),{sort:!1})},getCounterEl:function(){return this._elem("tab_counter")},initSearch:function(){return D((function(){var e,t,i,r,a,s;return L(this,(function(c){switch(c.label){case 0:return e=this,[4,Promise.all([Promise.all([n.e(93103),n.e(7390),n.e(69148),n.e(4976)]).then(n.bind(n,4976)),Promise.all([n.e(93103),n.e(90580),n.e(39042),n.e(69148),n.e(21803)]).then(n.bind(n,21803))])];case 1:return t=B.apply(void 0,[c.sent(),2]),i=t[0],r=i.default,a=t[1],s=a.default,this.search=this._addComponent(r,{el:this.el.querySelector(".search-container-wrapper"),FilterComponent:s,getPresets:o().bind(this.requestPresets,this),onFilterItems:function(t){if((0,m.isImboxSection)()){var n=e.search.filter.getFilterState();e.data=[],e.showLoading(),e.multiactionClose(),e.cleanTotalCount();var i=[e.loadCount(n),e.loadData(t)];Promise.all(i).then((function(t){var n=B(t,1)[0].count;e.setTotalCount(n)})),(0,A.set)(n)}},onTermIsValid:o().bind((function(){this.loader&&this._destroyComponent(this.loader)}),this),onTermIsInvalid:o().bind((function(){this.autoloadContent()}),this),startClickDown:o().bind(this.onWindowKeyDown,this),onFilterToggle:this.options.onFilterToggle}),[2]}}))})).apply(this)},convertPresets:function(e){var t=o().reduce(o().toArray(e),(function(e,t){var n,i,o=(n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){j(e,t,n[t])}))}return e}({},t),i=null!=(i={query:t.query.replace(/created_at/g,"updated_at").replace(/pipe/g,"filter[pipe]")})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})),n);return e[t.id]=o,e}),{});return t},requestPresets:function(){var e=this;return this.source_loader.getPresets().then((function(t){return e.presets=e.convertPresets(t),e.presets}))},chooseFavorite:function(e){e.stopPropagation(),e.preventDefault();var t=M(e.currentTarget).closest(".notification-inner").attr("data-id"),n=parseInt(t)&&parseInt(t)||t,i=this.notifications.get(n);if(i){var o=this.getLabelParamName(),r=!i.get(o);i.set(o,r),M.ajax({url:"/ajax/v4/talks/".concat(i.get("notification_id"),"/star"),type:r?"PUT":"DELETE",error:function(e){var t=new T.default;422===e.status?t.showError((0,g.i18n)("You've reached your limit of 1000 starred chats"),!1):t.showError(!1,!1),i.set(o,!1)}})}},reAskNotification:function(e){var t=this;return M.ajax({url:"/ajax/v4/inbox/list",data:{filter:{id:e}}}).then((function(e){o().propertyOf(e)(["_embedded","talks"])&&o().each(e._embedded.talks,(function(e){t.notifications.remove(e.id),t.createNotificationModel(e),t.notifications.sort()}))}))},getLabelParamName:function(){return"is_starred"},reconnectOpenedChat:o().noop,readTypes:o().noop,onItemSelected:o().noop});a().mixin(Q,x.default)},407769:(e,t,n)=>{n.r(t),n.d(t,{Collection:()=>_,Model:()=>g});var i=n(629133),o=n.n(i),r=n(345839),a=n.n(r),s=n(161320),c=n.n(s),l=n(445368),u=n(500034),d=n(567042);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=1e3*Date.now(),p=a().Model.extend({view:null,constructor:function(e){return e.id&&e.entity&&o().extend(e,this.parse(e)),e.notification_id||(e.notification_id=e.id),e.body&&(e.body.rows&&this.getStyleMessage(e.body.rows),this.getIconSub(e.body)),a().Model.apply(this,arguments)},parse:function(e){var t,n=e.entity.title||"",i=e.last_message,r=e.last_reaction,a=e.is_comment,s=o().propertyOf(i),d=0===s("id")||0===s("user_id")?(0,l.i18n)("Salesbot"):s("author"),h=(0,u.isFeatureAvailable)("global_inbox")?"/chats/":"/imbox/";switch(d||(0,u.isFeatureAvailable)("global_inbox")||(d="..."),e.entity.type){case"leads":n=(0,l.leadName)(e.entity.title,e.entity.id);break;case"customers":n=(0,l.customerName)(e.entity.title,e.entity.id);break;case"contacts":n=(0,l.contactName)(e.entity.title)}return o().extend({web_link:"".concat(h+e.id,"/").concat(e.entity.type,"/detail/").concat(e.entity.id,"?t=").concat(e.last_message.last_message_at_msec||e.last_message.last_message_at),body:{title:n,is_talk:!0,last_message_at:(null===(t=e.last_reaction)||void 0===t?void 0:t.created_at)?Math.max(e.last_reaction.created_at,e.last_message.last_message_at):e.last_message.last_message_at,author_title:d,rows:[{style:"default",text:function(){var t;if(o().isEmpty(r)||!c()(i.last_message_at).isBefore(r.created_at)){var n="instagram_business"===e.chat_source&&"secondary"===e.category&&a&&(0,u.isFeatureAvailable)("ig_inbox_comments")?(0,l.i18n)("Commented"):"";return o().compact([d,"".concat(n," ").concat(s("text")||"...").trim()]).join(": ")}switch(!0){case!r.message_author_id:t=(0,l.sprintf)((0,l.i18n)("%s: Reacted %s"),r.author,r.reaction);break;case r.message_author_id===APP.constant("user").id:t=(0,l.sprintf)((0,l.i18n)("%s: Reacted %s to you"),r.author,r.reaction);break;default:t=(0,l.sprintf)((0,l.i18n)("%s: Reacted %s to %s"),r.author,r.reaction,r.message_author)}return t}()}],icon:{sub:e.chat_source,value:s("profile_avatar"),avatar_id:s("id")||e.contact_id}},disable_more_content_button:!0},e)},getIconSub:function(e){var t=!!e.icon&&e.icon.sub;t&&APP.constant("amojo_origins")[t]&&(e.icon_origin=APP.constant("amojo_origins")[t].icon||!1)},getStyleMessage:function(e){o().chain(e).sortBy((function(e){return e.text.length})).reverse().each((function(t,n){switch(e.length){case 1:t.class_height="h3";break;case 2:t.class_height=0===n?"h2":"h1";break;case 3:e[n].class_height=2===n?"h2":"h1"}}))}}),_=a().Collection.extend({model:p,initialize:function(){this.listenTo(this,"change:selected",this.onChangeSelected),a().Collection.prototype.initialize.apply(this,arguments)},preselect:function(e){var t,n=this.findWhere({preselected:!0});switch(n?n.set("preselected",!1):n=this.findWhere({selected:!0}),t=this.indexOf(n)+e,!0){case-1===t:case-2===t:t=0;break;case t===this.length:t=this.length-1}this.at(t).set("preselected",!0)},select:function(){var e=this.findWhere({preselected:!0});e&&e.set({preselected:!1,selected:!0})},setOrder:function(e){this.order_by=e},comparator:function(e){var t=o().propertyOf(e.get("last_message"))("last_message_at"),n=e.get("first_unanswered_message_at"),i=e.get("is_starred"),r=this.order_by||{};if(o().isNull(n)&&(n=f-t),"is_starred"===r.sort_by&&i&&(t+=f),r.sort_by===d.default.EMOTION_FILTER_NAME){var a,s,c,l=e.get(d.default.EMOTION_FILTER_NAME);n+=(null===(a={asc:(s={},h(s,d.default.EMOTIONS.NEGATIVE,-f),h(s,d.default.EMOTIONS.POSITIVE,+f),s),desc:(c={},h(c,d.default.EMOTIONS.NEGATIVE,+f),h(c,d.default.EMOTIONS.POSITIVE,-f),c)}[r.sort_type])||void 0===a?void 0:a[l])||0}switch(!0){case"fake"===e.id&&"user_not_found"===e.get("type"):return 1/0;case"go-to-add-channel"===e.id:return Number.MAX_SAFE_INTEGER;case"is_starred"===r.sort_by:case"last_message_at"===r.sort_by:return"desc"===r.sort_type?-t:t;case"first_unanswered_message_at"===r.sort_by:return"desc"===r.sort_type?n:-n;case r.sort_by===d.default.EMOTION_FILTER_NAME:return n;default:return-t}},onChangeSelected:function(e){if(e.get("selected")){var t=o().find(this.without(e),(function(e){return e.get("selected")})),n=this.findWhere({preselected:!0});t&&t.set("selected",!1),n&&n.set("preselected",!1),this.sort()}}}),g=p},656669:(e,t,n)=>{n.r(t),n.d(t,{get:()=>f,isFilterActive:()=>d,isSearchActive:()=>h,listen:()=>g,set:()=>p,unsubscribeListener:()=>_});var i=n(629133),o=n.n(i),r=n(323344),a=n(661533),s=(0,r.QStoJSON)((0,r.getQueryString)(),{to_arrays:!0})||{},c=!o().isEmpty(s.filter),l=c?s.filter:{},u=function(){var e=(0,r.QStoJSON)((0,r.getQueryString)(),!0),t=a.param(o().extend({},o().omit(e,"filter"),o().isEmpty(l)?{}:{filter:l}));APP.router.navigate("".concat(window.location.pathname).concat(t?"?".concat(t):""),{replace:!0,silent:!0,trigger:!1})},d=function(){return!o().isEmpty(l)&&!l.term},h=function(){return!o().isEmpty(l)&&Boolean(l.term)},f=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).parse;return(void 0===e?c:e)?(0,r.QStoJSON)(a.param(l)):l},p=function(){c=!1,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u()},_=function(){p({}),APP.router.off("route",u)},g=function(){return APP.router.on("route",u),function(){o().find(o().propertyOf(APP.router._events)("route"),{callback:u})&&_()}}},56783:(e,t,n)=>{n.r(t),n.d(t,{MentionsTabContent:()=>b});var i=n(629133),o=n.n(i),r=n(156040),a=n(811149),s=n(445368),c=n(998798),l=n(30514),u=n(778636),d=n(476933),h=n(661533);function f(e,t,n,i,o,r,a){try{var s=e[r](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,o)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){f(r,i,o,a,s,"next",e)}function s(e){f(r,i,o,a,s,"throw",e)}a(void 0)}))}}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}var b=u.default.extend({el:"<div></div>",no_content_text:(0,s.i18n)("No mentions found"),badge_id:"badge_team_union",sound_id:"amo_inbox_sound_mentions",collection:d.default.Collection,api:o().extend({},u.default.prototype.api,{list:"/v3/inbox/list?filter[team_union]=true"}),_selectors:function(){return o().extend({},u.default.prototype._selectors.apply(this,arguments),{inbox:"#inbox_mentions_aside",inbox_container:"#inbox_mentions_list"})},_classes:function(){return o().extend({},u.default.prototype._classes.apply(this,arguments),{hidden_inbox:"inbox-holder_hidden",inbox_tab_counter:"inbox-messaging__tab-counter",list:"inbox-list",list_scrolled:"inbox-list--scrolled"})},events:function(){return o().extend({},o().result(u.default.prototype,"events",{}),{"click .notification-item--go-to-invite-a-user":"onGoToUsersClick"})},initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.is_indestructible,n=void 0===t||t,i=e.getSelectedId,a=void 0===i?o().noop:i,s=e.getOnboardingParams,c=e.getRightContainer,l=e.toggleRightContainer,d=e.onBeforeRightContainerChange,h=e.onRouteChange;return this.getSelectedId=a,this.getRightContainer=c,this.toggleRightContainer=l,this.onBeforeRightContainerChange=d,this.onRouteChange=h,this._is_indestructible=n,this._list_scrolled=!1,(0,r.onPageFullyLoaded)(o().bind(this.initGoToNotification,this,s)),u.default.prototype.initialize.apply(this,arguments)},initGoToNotification:function(e){return p((function(){var t,n;return g(this,(function(i){switch(i.label){case 0:return[4,e()];case 1:return t=i.sent(),n=this,[4,(0,l.subscribeInitGoToNotification)(this.notifications,{id:"go-to-invite-a-user",type:"mentions",params:t})];case 2:return n.unsubscribeInitGoToNotification=i.sent(),[2]}}))})).apply(this)},onGoToUsersClick:function(){APP.router.navigate("/settings/users/#invite-a-user",{trigger:!0})},canNotFoundNotificationBeShown:function(){return 0===this.notifications.length||1===this.notifications.length&&"go-to-invite-a-user"===this.notifications.at(0).get("id")},onSelectItemClick:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=h(e.currentTarget),i=n.attr("data-id"),o=n.find(this._selector("navigation")).attr("href");(0,c.isTeamChatOpened)(o)&&(e.preventDefault(),this.navigateToChat(i,o,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){_(e,t,n[t])}))}return e}({silent:!0},t))),u.default.prototype.onSelectItemClick.apply(this,arguments)},navigateToChat:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==this.onBeforeRightContainerChange()&&(APP.router.navigate(t,{trigger:n.trigger||!1}),n.trigger||this.onRouteChange(null,[e],{silent:n.silent}))},canNotFoundNotificationBeRemoved:function(){var e=this;return!(1===this.notifications.length&&"fake"===this.notifications.at(0).get("id")||2===this.notifications.length&&o().every(["go-to-invite-a-user","fake"],(function(t){return e.notifications.get(t)})))},canMultiactionsBeShown:function(){var e=["fake","go-to-invite-a-user"],t=!0;return this.notifications.length<3&&(t=o().every(this.notifications.models,(function(t){return!1===o().includes(e,t.id)}))),t},createGroupChat:function(){var e=(0,c.getChatsMentionsResourceUrl)("create");!1!==this.onBeforeRightContainerChange()&&(APP.router.navigate(e,{trigger:!1}),this.onRouteChange(null,["mentions","create"],{silent:!0}),u.default.prototype.createGroupChat.apply(this,arguments))},_toggleDirectChatOpenedState:function(e,t){this.toggleRightContainer(e,t)},_getDirectChatContainer:function(){return this.getRightContainer()},onItemSelected:function(){(0,c.isTeamChatOpened)()&&u.default.prototype.onItemSelected.apply(this,arguments)},connect:function(){return p((function(){var e=arguments;return g(this,(function(t){switch(t.label){case 0:return this._is_indestructible?[3,2]:[4,this.afterFilterInit()];case 1:t.sent(),t.label=2;case 2:return[2,u.default.prototype.connect.apply(this,e)]}}))})).apply(this)},initAllPromises:function(){return this.promise_all_init=Promise.all([this.requestBadge(),this.connect(),this.initSource(),this.initMultiaction(),this.requestPushPermission()]),this.promise_all_init},toggle:function(){this._is_opened?this.hide():this.show()},onVirtualizedListScroll:function(e){e<=0&&this._list_scrolled?(this._list_scrolled=!1,this._elem("list").removeClass(this._class("list_scrolled"))):this._list_scrolled||(this._list_scrolled=!0,this._elem("list").addClass(this._class("list_scrolled"))),u.default.prototype.onVirtualizedListScroll.apply(this,arguments)},show:function(){var e=this,t=h.Deferred();return this._is_opened?t.resolve():(this._toggleClass("active","inbox",!0),this._toggleClass("hide_animation","inbox",!1),this._toggleClass("show_animation","inbox",!0),this.$el.one("animationend",(function(){e.showLoading(),e.afterFirstLoad().then((function(){e._onShow(),e.hideLoading(),t.resolve()}))}))),this._is_opened=!0,u.default.prototype.show.apply(this),t.promise()},hide:function(){var e=this;this.destroyQuickActionMenu(),this.closeDirectChat().then((function(){e._onHide(),e._toggleClass("active","inbox",!1),e._toggleClass("hide_animation","inbox",!0),e._toggleClass("show_animation","inbox",!1),u.default.prototype.hide.apply(e),APP.is_touch_device&&e._releaseBodyPosition()})),this._is_opened=!1},_onShow:function(){this.inbox_fully_opened=!0,this.onInboxListModify(),this.autoloadContent(),this.readable_ids.length>0&&this.read({id:this.readable_ids})},_onHide:function(){this.inbox_fully_opened=!1,this.loader&&this.loader.destroy()},initSearch:function(){var e=this;return u.default.prototype.initSearch.call(this,{onFilterToggle:this.options.onFilterToggle||o().noop,onFilterItems:function(t){(0,c.isImboxSection)()&&(e.data=[],e.showLoading(),e.multiactionClose(),e.loadData(t))}})},processNotificationFetch:function(e,t){var n=this,i={};return t.choose_all&&o().contains(["read","delete"],e)&&(i.team=!0),a.default.fetchAction(e,t,i).then((function(e){e._embedded&&e._embedded.clear&&n.resetFilter()}))},addNotification:function(e){return o().propertyOf(e.get("entity"))("id")===this.getSelectedId()&&e.set("selected",!0),u.default.prototype.addNotification.apply(this,arguments)},excludeTypeEntryCheck:function(e){var t=e.get("chat_source"),n=o().propertyOf(e.get("entity"))("type"),i=o().propertyOf(e.get("linked_entity"))("type"),r=o().includes(["chat_group","chat_direct"],n),a=o().includes(["chat","entity_chat"],i);return!((r||a)&&!t)},_getChatView:function(e){return p((function(){return g(this,(function(t){switch(t.label){case 0:switch(o().propertyOf(e)(["click","type"])){case"chat_group":return[3,1];case"chat_group_create":return[3,3];case"chat_direct":return[3,5]}return[3,5];case 1:return[4,Promise.all([n.e(95882),n.e(93671),n.e(5179),n.e(93103),n.e(14095),n.e(15656),n.e(8232),n.e(44897),n.e(17815),n.e(40433),n.e(35969),n.e(40272),n.e(69500),n.e(40681)]).then(n.bind(n,508851))];case 2:return[2,t.sent().default];case 3:return[4,Promise.all([n.e(95882),n.e(93671),n.e(5179),n.e(93103),n.e(14095),n.e(15656),n.e(8232),n.e(44897),n.e(17815),n.e(40433),n.e(35969),n.e(40272),n.e(69500),n.e(66231)]).then(n.bind(n,15208))];case 4:return[2,t.sent().default];case 5:return[4,Promise.all([n.e(95882),n.e(93671),n.e(5179),n.e(93103),n.e(11958),n.e(14095),n.e(15656),n.e(42693),n.e(8232),n.e(52434),n.e(44897),n.e(17815),n.e(40433),n.e(35969),n.e(40272),n.e(69500),n.e(54581),n.e(59306),n.e(50595)]).then(n.bind(n,329856))];case 6:return[2,t.sent().default];case 7:return[2]}}))}))()},getCounterEl:function(){return this._elem("inbox_tab_counter")},destroy:function(){return o().isFunction(this.unsubscribeInitGoToNotification)&&this.unsubscribeInitGoToNotification(),u.default.prototype.destroy.apply(this,arguments)}})},476933:(e,t,n)=>{n.r(t),n.d(t,{Model:()=>b,default:()=>y});var i=n(629133),o=n.n(i),r=n(345839),a=n.n(r),s=n(998798),c=n(641228);function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function h(e,t,n){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n||e):o.value}},h(e,t,n||e)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return _=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_(e,t)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}(this,n)}}var b=function(e){p(n,e);var t=g(n);function n(){return l(this,n),t.apply(this,arguments)}return d(n,[{key:"parseAttributes",value:function(e,t){var i={disable_more_content_button:!0};switch(!0){case!o().isUndefined(e.lead):o().extend(i,{web_link:(0,s.getChatsMentionsResourceUrl)("leads",e.lead)}),"click"===t&&(i.click=null);break;case!o().isUndefined(e.customer):o().extend(i,{web_link:(0,s.getChatsMentionsResourceUrl)("customers",e.customer)}),"click"===t&&(i.click=null);break;case!o().isUndefined(e.chat_direct):o().extend(i,h(f(n.prototype),"parseAttributes",this).apply(this,arguments),{web_link:(0,s.getChatsMentionsResourceUrl)(e.chat_direct)});break;case!o().isUndefined(e.chat_bot):o().extend(i,h(f(n.prototype),"parseAttributes",this).apply(this,arguments),{web_link:(0,s.getChatsMentionsResourceUrl)(e.chat_bot)});break;case!o().isUndefined(e.chat_group):o().extend(i,h(f(n.prototype),"parseAttributes",this).apply(this,arguments),{web_link:(0,s.getChatsMentionsResourceUrl)(e.chat_group)});break;default:o().extend(i,h(f(n.prototype),"parseAttributes",this).apply(this,arguments))}return i}}]),n}(c.Model);const y={Collection:function(e){p(n,e);var t=g(n);function n(){return l(this,n),t.apply(this,arguments)}return d(n,[{key:"model",get:function(){return b}},{key:"comparator",value:function(e){switch(!0){case"fake"===e.id&&"user_not_found"===e.get("type"):return 1/0;case"go-to-invite-a-user"===e.id:return Number.MAX_SAFE_INTEGER;default:return h(f(n.prototype),"comparator",this).apply(this,arguments)}}},{key:"sort",value:function(){return a().Collection.prototype.sort.apply(this,arguments)}}]),n}(c.Collection),Model:b}},701291:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_,getInitialSortOrder:()=>g});var i=n(661533),o=n.n(i),r=n(629133),a=n.n(r),s=n(313981);function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n||e):o.value}},l(e,t,n||e)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=u(e);if(t){var o=u(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}(this,n)}}var f="amo_inbox_messaging_sort",p={sort_by:"last_message_at",sort_type:"desc"},_=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(r,e);var t,n,i=h(r);function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i.apply(this,arguments)}return t=r,n=[{key:"_classes",value:function(){return{sort_buttons:"js-read-sort",selected_sort_option:"search-more__item_active"}}},{key:"_selectors",value:function(){return{selected_sort_by:'.js-read-sort[data-sort-by="%s"][data-sort-type="%s"]'}}},{key:"events",value:function(){return{"click .js-read-sort":"onSortChange","click .search-more__item-header":"onSearchMoreItemHeaderClick"}}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(u(r.prototype),"initialize",this).apply(this,arguments);var t=e.onSelect,n=void 0===t?a().noop:t,i=JSON.parse(localStorage.getItem(f));this.onSelect=n,this.order=i||p,this._prepareSort()}},{key:"onSortChange",value:function(e){this.changeSortState(e),this.onSelect(this.order)}},{key:"changeSortState",value:function(e){var t=o()(e.currentTarget);t.hasClass(this._class("selected_sort_option"))||(this._elem("sort_buttons").removeClass(this._class("selected_sort_option")),t.addClass(this._class("selected_sort_option")),this.order={sort_by:t.attr("data-sort-by"),sort_type:t.attr("data-sort-type")},localStorage.setItem(f,JSON.stringify(this.order)))}},{key:"_prepareSort",value:function(){this._findElem("selected_sort_by",this.order.sort_by,this.order.sort_type).addClass(this._class("selected_sort_option"))}},{key:"onSearchMoreItemHeaderClick",value:function(e){e.stopPropagation()}}],n&&c(t.prototype,n),r}(s.default);function g(){var e,t,n,i;try{if(!(e=JSON.parse(localStorage.getItem(f)))||!a().isObject(e))throw new Error("No sort in LS")}catch(t){e=p}return t={},n=e.sort_by,i=e.sort_type,n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}},962444:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var i=n(629133),o=n.n(i),r=n(987081),a=n(128508),s=n(661533),c={list:"/ajax/v4/inbox/list",default_list:"/ajax/v4/inbox/list",multiaction:"/ajax/v4/inbox/edit"};function l(e){var t,n=!0,i={},l=s.Deferred();return{init:function(u){var d;(t=new r.Subject).pipe(a.switchMap((function(t){return d=t.deferred,u=t.options,h=t.noContent,(u=u||{}).reset&&(n=!0),f=function(t,u){return r.defer((function(){var d;return n?((c.list===c.default_list||t.reset)&&(i={limit:e,order:t.order,filter:t.filter}),t.term&&(i.query={message:t.term}),d=s.ajaxPromisify({url:t.reset?c.default_list:c.list,data:i}),r.from(d).pipe(a.map((function(e){if(l.resolve(o().propertyOf(e)(["filter","presets"])||[]),o().isUndefined(e))return n=!1,[];c.list=e._links.next?e._links.next.href:e._links.self.href;var t=e._embedded.talks;return o().map(t,(function(e){return e}))})),a.flatMap((function(t){return t.length<e&&(n=!1),r.from(t)})),a.tap({next:function(){o().isFunction(u)&&u(!1)},error:function(){return o().isFunction(u)&&u(!0),l.reject(),r.from([])}}))):Promise.reject()}))}(u,h).pipe(a.filter((function(){return!0})),a.take(e)),r.onErrorResumeNext(f).pipe(a.toArray());var u,h,f})),a.catchError((function(e){u({error:e},d)}))).subscribe((function(e){u({items:e},d)}))},onNewOption:function(e,n,i){t.next({options:e,noContent:n,deferred:i})},handleMultiaction:function(e,t){return s.ajax({url:c.multiaction,type:"POST",data:o().extend({action:e},t)})},getPresets:function(){return l.promise()},isFinished:function(){return!n}}}},363119:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var i=n(629133),o=n.n(i),r=n(661533);const a={showMainOverlay:function(e,t){this._$overlay=r('<div class="default-overlay widget-settings__overlay" id="service_overlay" style="z-index: 101"><span class="spinner-icon expanded spinner-icon-abs-center" id="service_loader"></span></div>'),t&&(t.position_absolute&&this._$overlay.css("position","absolute"),o().isNumber(t.z_index)&&this._$overlay.css("z-index",t.z_index),t.offset_left_menu&&this._$overlay.css("left",r("#left_menu").width()),t.isDefaultOverlay&&this._$overlay.removeClass("widget-settings__overlay")),e.append(this._$overlay),this._$overlay.trigger("overlay:show")},hideMainOverlay:function(){this._$overlay&&(this._$overlay.trigger("overlay:hide",{instantly:!0}),this._$overlay.remove(),this._$overlay=null)}};var s="../build/transpiled/interface/settings/widgets/helpers/overlay";window.define(s,(function(){var e="undefined",n=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return n&&n.default||n})),window.require([s])},315243:(e,t,n)=>{var i;n.r(t),n.d(t,{AvailableSearchEntities:()=>i}),function(e){e.INBOX="inbox",e.LEADS="leads",e.TEAM="team"}(i||(i={}))}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_18_50_52"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="94a66cdc-a588-4e93-8853-52e37ff22c8f",e._sentryDebugIdIdentifier="sentry-dbid-94a66cdc-a588-4e93-8853-52e37ff22c8f")}catch(e){}}();
//# sourceMappingURL=93430.bc3b5f01e8055e6213b9.js.map