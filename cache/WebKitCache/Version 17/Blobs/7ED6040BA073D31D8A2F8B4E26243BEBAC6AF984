"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[2836],{897920:(e,t,i)=>{i.r(t),i.d(t,{default:()=>b});var n=i(661533),s=i.n(n),r=i(156040),o=i(402372),a=i(210734);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function c(e,t,i,n,s,r,o){try{var a=e[r](o),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,s)}function h(e){return function(){var t=this,i=arguments;return new Promise((function(n,s){var r=e.apply(t,i);function o(e){c(r,n,s,o,a,"next",e)}function a(e){c(r,n,s,o,a,"throw",e)}o(void 0)}))}}function _(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t,i){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i||e):s.value}},p(e,t,i||e)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,s,r=[],o=!0,a=!1;try{for(i=i.call(e);!(o=(n=i.next()).done)&&(r.push(n.value),!t||r.length!==t);o=!0);}catch(e){a=!0,s=e}finally{try{o||null==i.return||i.return()}finally{if(a)throw s}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?l(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=u(e);if(t){var s=u(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return function(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}(this,i)}}function m(e,t){var i,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}var y=new o.default;s()(document).on("page:entity_changed",(function(){y.clearCache(),y.reset()}));var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(l,e);var t,n,o,a=g(l);function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),a.apply(this,arguments)}return t=l,n=[{key:"_classes",value:function(){return{lottie:"feed-note__sticker-animated",animation_hidden:"feed-note__sticker-animated--hidden",preview_hidden:"feed-note__sticker--preview-hidden"}}},{key:"_selectors",value:function(){return{notes_scroller:".notes-wrapper__scroller"}}},{key:"initialize",value:function(){var e=this;p(u(l.prototype),"initialize",this).apply(this,arguments),this.initPreview(),this.$el.data("animation-url")&&(0,r.onPageFullyLoaded)((function(){e.$el.append('<lottie-player class="'.concat(e._class("lottie")," ").concat(e._class("animation_hidden"),'" loop autoplay></lottie-player>')),e._elem("lottie").on("ready",(function(){e.showAnimation()})),e.watchSticker()}))}},{key:"initPreview",value:function(){var e=this,t=this.$el.data("animation-url");if(!t||!y.get(t)){var i=document.createElement("img"),n=document.createElement("div");n.className="feed-note__sticker_loader",i.src=this.$el.data("media-url"),i.addEventListener("load",(function(){if(t)e.$el.css("background-image","url(".concat(i.src,")"));else{var s=Math.max(i.clientHeight/2/100,1);e.$el.css({backgroundImage:"url(".concat(i.src,")"),width:i.clientWidth/2/s,height:i.clientHeight/2/s})}i.parentNode.removeChild(i),n.parentNode.removeChild(n)})),i.addEventListener("error",(function(){i.parentNode.removeChild(i),n.parentNode.removeChild(n)})),this.el.appendChild(i),this.el.appendChild(n)}}},{key:"watchSticker",value:function(){var e=this;return h((function(){var t,n,r,o,a,l;return m(this,(function(c){switch(c.label){case 0:return[4,Promise.all([i.e(80121).then(i.t.bind(i,380121,23)),i.e(72724).then(i.bind(i,372724))])];case 1:return t=f.apply(void 0,[c.sent(),1]),n=t[0],r=e.$el.data("scroller-selector"),o=e._elem("lottie").get(0),r?(a=n.createContainer(s()(e._selector("notes_scroller"))),(l=a.create(o,250)).enterViewport(h((function(){return m(this,(function(t){switch(t.label){case 0:return[4,e.playAnimation(o)];case 1:return t.sent(),l.destroy(),[2]}}))})))):e.playAnimation(o),[2]}}))}))()}},{key:"playAnimation",value:function(e){var t=this;return h((function(){var i,n;return m(this,(function(s){switch(s.label){case 0:return i=t.$el.data("animation-url"),n=function(){var t=y.get(i);t&&e.load(t.get("animationData"))},y.get(i)?(n(),[3,3]):[3,1];case 1:return[4,y.fetchAnimation(i)];case 2:s.sent(),n(),s.label=3;case 3:return[2]}}))}))()}},{key:"showAnimation",value:function(){this._removeClass("animation_hidden","lottie"),this.$el.addClass(this._class("preview_hidden"))}}],o=[{key:"controlClassName",get:function(){return"js-control-animated-sticker"}}],n&&_(t.prototype,n),o&&_(t,o),l}(a.default);v.extend(v);const b=v;var k="../build/transpiled/interface/notes/controls/animated_sticker";window.define(k,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([k])},829691:(e,t,i)=>{i.r(t),i.d(t,{default:()=>_});var n=i(629133),s=i.n(n),r=i(445368),o=i(23032),a=i(555989),l=i(661533),c={user:"Without system (feed filter)",system:"Only system (feed filter)"},h=a.default.extend({_classes:function(){return s().extend({},s().result(o.default.prototype,"_classes",{}),{search_links:"checkboxes-search__links-wrapper",search_link:"checkboxes-search__link",search_link_js:"js-checkboxes-search-additional"})},events:function(){return s().extend({},s().result(a.default.prototype,"events",{}),(e={},i="onAdditionalFilterClick",(t="click ".concat(this._selector("search_link_js")))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e));var e,t,i},initialize:function(){var e=s().first(s().keys(c));a.default.prototype.initialize.apply(this,arguments),this._elem("search_link_js").length||this._elem("search_links").find("span:last").before(this._generateAdditionalSpan(e))},_generateAdditionalSpan:function(e){return'<span class="'.concat(this._class("search_link")," ").concat(this._class("search_link_js"),'" data-code="').concat(e,'" style="margin-left: 10px;">').concat((0,r.i18n)(c[e]),"</span>")},hide:function(e){this.parrentClose(),e&&this.applyClick(),this.$el.addClass("hidden").find(".checkboxes-search__search-input").val("").trigger("input"),this._findElem("cb_inputs").trigger("change"),this._findElem("cb_ch_inputs").trigger("change"),this.form&&""===this.form.model.get(this.name)&&this.form.revert(),this.updateFormDefaults(),this.callbackHide()},allChangeClear:function(e){s().result(e,"stopPropagation"),a.default.prototype.allChangeClear.apply(this,arguments)},allChangeCheck:function(e){s().result(e,"stopPropagation"),a.default.prototype.allChangeCheck.apply(this,arguments)},onAdditionalFilterClick:function(e){var t=l(e.currentTarget),i=t.attr("data-code");e.stopPropagation(),this.$el.find("input:checkbox").prop("checked",!1),this.$el.find('input:checkbox[data-system="'.concat("system"===i?"y":"n",'"]')).prop("checked",!0).trigger("change"),t.replaceWith(this._generateAdditionalSpan(s().chain(c).keys().without(i).first().value()))}});const _=o.default.extend({controlClassName:"js-feed-filter-event-types",_getOpenWindowComponent:function(){return h},initialize:function(){o.default.prototype.initialize.apply(this,arguments),this.updateMainInput()},_isEmptyEqualsFilled:function(){return!1}});var p="../build/transpiled/interface/notes/controls/checkboxes_search";window.define(p,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([p])},996308:(e,t,i)=>{i.r(t),i.d(t,{default:()=>y});var n=i(629133),s=i.n(n),r=i(162262),o=i.n(r),a=i(313981),l=i(323344),c=i(926168),h=i(769381),_=i(556035),p=i(474564),u=i(661533),d=s().chain(APP.element_types).pick("leads","contacts","companies","customers","catalog_elements").invert().value(),f={types:"type"},g={leads:s().pick(APP.element_types,"contacts","companies"),customers:s().pick(APP.element_types,"contacts","companies"),contacts:s().pick(APP.element_types,"leads","companies","customers"),companies:s().pick(APP.element_types,"leads","customers","contacts")},m=a.default.extend({_selectors:function(){return{filter_wrapper:".list-top-search"}},initialize:function(e){a.default.prototype.initialize.apply(this,arguments),this.options=e||{},this.element_type=this.options.element_type,this.presets=null,this.active_filter=null,this.is_applied=!1},get:function(){var e=this._getFilter(),t={"filter[type][]":this.active_filter&&s().isEmpty(e.types)?0:e.types,without:s().chain(s().difference(this._getPossibleLinked(),e.linked)).map((function(e){return d[e]})).concat([s().contains(e.chats,p.CHAT_INTERNAL_INT)?"":p.CHAT_INTERNAL,s().contains(e.chats,p.CHAT_EXTERNAL_INT)?"":p.CHAT_EXTERNAL]).compact().value()};return APP.data.current_card&&(t.parent_element_type=APP.data.current_card.element_type,t.parent_element_id=APP.data.current_card.id),t},hide:function(e){this.items&&this.items.hasChanges()&&!0!==e&&this.items.apply(),this._destroyComponent(this.items),this.items=null,this.$el.addClass("hidden"),this.trigger("hide")},toggle:function(e){!!this.items||(this.items=this._addComponent(_.default,{element_type:this.element_type,filter:this._getFilter(),linked:this._getPossibleLinked(),types:this._getPossibleTypes(),system:this._getSystem(),getPresets:s().bind(this._getPresets,this),mutatePresetQuery:s().bind(this._mutatePresetQuery,this),parsePresetQueryMutant:s().bind(this._parsePresetQueryMutant,this),getDefaultFilter:s().bind(this._getDefaultFilter,this),getFilledFilter:s().bind(this._getFilledFilter,this),getPossibleLinked:s().bind(this._getPossibleLinked,this),onApply:s().bind(this._onApplyClick,this),onCancel:s().bind(this.hide,this,!0),onOptionsChanged:s().bind(this._onFilterOptionsChanged,this),onPresetAdd:s().bind(this._onPresetAdd,this),onPresetEdit:s().bind(this._onPresetEdit,this),onPresetDelete:s().bind(this._onPresetDelete,this)})),!1!==e&&(this.trigger("show"),this.$el.removeClass("hidden").append(this.items.el))},isApplied:function(){return this.is_applied},initPresets:function(){null===this.presets&&this._setPresets(this._getInitialPresets())},_onFilterOptionsChanged:function(e,t){this.trigger("options:changed",e,t)},_onPresetAdd:function(e){this._setPresets(this.presets.concat([e]))},_onPresetEdit:function(e){var t=this;this._setPresets(s().map(this.presets,(function(i){var n;return i.id.toString()===e.id.toString()?(1===(n=s().extend({},i,e)).sort&&t.setFeedFilterToStorage(t.element_type,t._parsePresetQueryMutant(n.query),{}),n):i})))},_onPresetDelete:function(e){this._setPresets(s().filter(this.presets,(function(t){return t.id.toString()!==e.toString()})))},_onApplyClick:function(e){var t=this;this._updateFilter(e),this.hide(),this.is_applied=!s().isEqual(s().mapObject(e,(function(e){return s().sortBy(e)})),s().mapObject(this._getDefaultFilter(),(function(e){return s().sortBy(e)}))),this.trigger("load:start"),this.options.onFilter().then((function(){t.trigger("load:stop")}),(function(){t.trigger("load:stop")}))},_getInitialPresets:function(){var e=s().propertyOf(this.options.getExtraData())("filter_presets")||[];return s().map(e,(function(e){return s().extend({label:e.name},e)}))},_parsePresetQueryMutant:function(e){var t=s().invert(f),i=(0,l.QStoJSON)(e,!0)||{},n=s().reduce(i.filter,(function(e,i,n){return e[t[n]?t[n]:n]=s().chain(i).values().map((function(e){return parseInt(e)})).sortBy().value(),e}),{});return s().reduce(["chats","linked","types"],(function(e,t){return n[t]?e[t]=n[t]:e[t]=[],e}),{})},_mutatePresetQuery:function(e){var t=s().reduce(e,(function(e,t,i){return e["filter[".concat(f[i]?f[i]:i,"][]")]=t,e}),{});return u.param(t)},_getPossibleTypes:function(){var e=s().propertyOf(this.options.getExtraData())("types")||[];return s().isEmpty(e)||s().isEqual(this._cached_types,e)||(this._cached_types=e),this._cached_types||{}},_getPossibleLinked:function(){return s().values(g[(0,c.convertElementType)(this.element_type,"string")])},_updateFilter:function(e){s().isString(e.linked)&&(e.linked=s().compact([e.linked])),s().isString(e.chats)&&(e.chats=s().compact([e.chats])),s().isString(e.types)&&(e.types=s().compact([e.types]));var t=s().reduce(e,(function(e,t,i){return e[i]=s().map(t,(function(e){return parseInt(e)})),e}),{});this.active_filter=t},_getFilledFilter:function(){return{chats:[p.CHAT_INTERNAL_INT,p.CHAT_EXTERNAL_INT],linked:this._getPossibleLinked(),types:s().pluck(this._getPossibleTypes(),"id")}},_getDefaultFilter:function(){var e={};return e=this.presets&&this.presets.length?this._parsePresetQueryMutant(this.presets[0].query):this._getFilledFilter(),this.element_type===APP.element_types.catalog_elements&&(e=s().omit(e,"chats","linked")),e},_getFilter:function(){var e=this.active_filter;return e?e.chats||(e.chats=[p.CHAT_INTERNAL_INT,p.CHAT_EXTERNAL_INT]):e=this._getDefaultFilter(),e},_getSystem:function(){return this.getFeedSystemFromStorage()},_setPresets:function(e){this.presets=s().sortBy(e,"sort")},_getPresets:function(){return s().reduce(this.presets,(function(e,t){return e["preset_".concat(t.id)]=s().extend({},t,{bookmark:!t.system_type,can_edit:!0,link:t.query}),e}),{})}});o().mixin(m,h.default);const y=m;var v="../build/transpiled/interface/notes/filter/index";window.define(v,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([v])},556035:(e,t,i)=>{i.r(t),i.d(t,{default:()=>d});var n=i(629133),s=i.n(n),r=i(460159),o=i.n(r),a=i(313981),l=i(445368),c=i(926168),h=i(450422),_=i(526471),p=i(999532),u=i(661533);i(829691);const d=_.default.View.extend({_selectors:function(){return{checkbox_wrapper:".feed-notes-filter__checkbox",checkbox:'input[type="checkbox"]:not(.js-form-changes-skip)',linked_checkbox:".js-notes-filter-linked-checkbox",master_checkbox:".js-notes-filter-master",section:".js-notes-filter-section",main_section:".js-notes-filter-main-section",types_empty:".js-notes-filter-types-empty",actions:".modal-body__actions",apply:"#filter_apply",filter_preset_by_id:'.filter__list__item[data-id="%s"]'}},_classes:function(){return{list:"js-notes-filter-list",revert:"js-search-filter-clear",show_all:"js-notes-filter-show-all",ribbon_text:"feed-search__ribbon-text",filter_form:"filter__form",filter_item_wrapper:"filter__custom_settings__item",filter_has_changes:"filter-search_has-changes",filter_item_clear:"js-filter-field-clear",filter_presets:"js-filter-list",filter_preset_item:"filter__list__item",filter_preset_selected:"filter__list__item-selected",filter_preset_save:"filter__list__item-save"}},events:function(){var e=s().extend({},_.default.View.prototype.events||{});return e["click ".concat(this._selector("apply"))]="apply",e["click ".concat(this._selector("revert"))]="cancel",e["click ".concat(this._selector("filter_item_clear"))]="onRevertItemClick",e},initialize:function(e){var t=this;return(e=e||{}).model=_.default.Model,_.default.View.prototype.initialize.apply(this,arguments),this.options=e,this.listenTo(this.model,"change",this._highlightChanges,this),o()._preload(["/tmpl/notes/search/filter.twig"])().then((function(){t.render(),t._highlightChanges()}))},destroy:function(){return a.default.prototype.destroy.call(this,!0)},render:function(){var e=this,t=this._getFieldsData();this.options.element_type===APP.element_types.catalog_elements&&(t=s().omit(t,"chats","linked"));var i=u(o()({ref:"/tmpl/notes/search/filter.twig"}).render({filter:{items:this._getPresets(),custom_fields:s().values(t)},skip_filter_id:!0,is_concat_url_preset:!0,element_type:this.options.element_type,element_type_single:(0,c.convertElementType)(this.options.element_type,"single"),types:this.options.types,current:this.options.filter,system:this.options.system||{}}));this.fields_data=t,this.$el.replaceWith(i),this.setElement(i.removeClass("hidden")),this.form=this._addComponent(a.default,{el:this._elem("filter_form")}),this.form.hasChanges=function(){return e.has_changes},this.initPresets(),this.initModelFromForm(),this.listenTo(this.model,"has_changes has_reverted",s().bind(this._setChanges,this))},onRevertItemClick:function(e){var t=u(e.currentTarget).closest(this._selector("filter_item_wrapper")).attr("data-field-name");this.revertItem(t)},apply:function(){var e=this.model.toJSON();e.types||(e.types=[0]),this.model.defaults=this.model.attributes,this.options.onApply(e)},applyPreset:function(e){var t=this._getPresets()["preset_".concat(e)];t&&(this.model.set(this.options.parsePresetQueryMutant(t.query)),this.apply())},revertItem:function(e){var t=this.options.getDefaultFilter();this.setInputValue(this.$el.find(':input[name="'.concat(e,'"]:not(.js-form-changes-skip)')),t[e],e)},cancel:function(){this.revert(),this.options.onCancel()},setInputValue:function(e,t){var i=this;return e.length>1&&s().isArray(t)?(t=s().map(t,(function(e){return e?e.toString():""})),void e.each((function(){i.setInputValue(u(this),s().contains(t,this.value))}))):_.default.View.prototype.setInputValue.apply(this,arguments)},getPresetEntity:function(){return(0,c.convertElementType)(this.options.element_type,"string")},initPresets:function(){var e=this;this.presets=this._addComponent(p.default,{el:this._elem("filter_presets"),filter:this,can_save:!0,getActiveQuery:function(){return e.options.mutatePresetQuery(e._getActiveFilter())},onPresetAdd:function(t){e.options.onPresetAdd(t),e._highlightChanges()},onPresetEdit:function(t){e.options.onPresetEdit(t),e._highlightChanges()},onPresetDelete:function(t){e.options.onPresetDelete(t),e._highlightChanges()},onPresetLoad:s().bind(this.applyPreset,this)})},_getPresets:function(){return this.options.getPresets()},_getFieldsData:function(){return{chats:{items:[{id:1,option:(0,l.i18n)("External (chats filter)"),is_checked:s().contains(this.options.filter.chats,1)},{id:2,option:(0,l.i18n)("Internal (chats filter)"),is_checked:s().contains(this.options.filter.chats,2)}],name:"chats",template:"checkboxes_dropdown",title:(0,l.i18n)("Chats (chats filter)"),title_numeral:"",name_is_array:!1},linked:{items:s().map(this.options.getPossibleLinked(),(function(e){return{id:e,option:(0,l.i18n)((0,l.capitalize)((0,c.convertElementType)(e,"string"))),is_checked:s().contains(this.options.filter.linked,e)}}),this),name:"linked",template:"checkboxes_dropdown",title:(0,l.i18n)("Linked objects"),title_numeral:"",name_is_array:!1,hidden:(0,h.isAmoChatsFullEnabled)()},types:{items:s().chain(this.options.types).sortBy((function(e){return(e.is_system?"1":"0")+e.name})).map((function(e){return{value:e.id,option:e.name,additional_data:'data-system="'.concat(e.is_system?"y":"n",'"'),checked:s().contains(this.options.filter.types,e.id)}}),this).value(),name:"types",template:"checkboxes_search",control_class_name:"js-feed-filter-event-types",title:(0,l.i18n)("Event types"),title_numeral:(0,l.i18n)("value,values,values")}}},_getActiveFilter:function(){var e=s().reduce(this.model.toJSON(),(function(e,t,i){var n=[];switch(!0){case s().isArray(t):n=t;break;case s().isString(t)&&!s().isEmpty(t):n=[t]}return n=s().chain(n).map((function(e){return parseInt(e)})).sortBy().value(),e[i]=n,e}),{});return s().reduce(this.options.getDefaultFilter(),(function(t,i,n){return e[n]?t[n]=e[n]:t[n]=[],t}),{})},_setChanges:function(e){this.has_changes="has_changes"===e.type,"has_changes"===e.type?(this._addClass("filter_has_changes"),this._findElem("apply").trigger("button:enable")):(this._removeClass("filter_has_changes"),this._findElem("apply").trigger("button:disable"))},_highlightActivePreset:function(){var e=this._getActiveFilter(),t=-1,i=s().find(this._getPresets(),(function(i){return t++,s().isEqual(e,this.options.parsePresetQueryMutant(i.query))}),this);return this._findElem("filter_preset_item").removeClass(this._class("filter_preset_selected")),this._elem("filter_preset_save").addClass("hidden"),i?(this._findElem("filter_preset_by_id",i.id).addClass(this._class("filter_preset_selected")),s().extend({is_default:0===t},i)):(this._elem("filter_preset_save").removeClass("hidden").addClass(this._class("filter_preset_selected")),null)},_highlightChanges:s().throttle((function(){var e=this.options.getDefaultFilter(),t=[];s().each(this._getActiveFilter(),(function(i,n){var r=this.$('[name="'.concat(n,'"]:first')).closest(this._selector("filter_item_wrapper")),o=!s().isEqual(s().sortBy(i),s().sortBy(e[n]));r.toggleClass("glow",o),o&&t.push(this._prepareFieldFilterOptions(n,i))}),this);var i=this._highlightActivePreset();s().isFunction(this.options.onOptionsChanged)&&this.options.onOptionsChanged(t,i)}),50,{leading:!1}),_prepareFieldFilterOptions:function(e,t){var i=this.fields_data[e];return{title:i.title,name:e,items:s().filter(i.items,(function(e){return s().contains(t,e.id)}))}}});var f="../build/transpiled/interface/notes/filter/items";window.define(f,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([f])},999532:(e,t,i)=>{i.r(t),i.d(t,{default:()=>a});var n=i(629133),s=i.n(n),r=i(70744),o=i(661533);const a=r.default.extend({presetLoad:function(e){var t=o(e.currentTarget);e.preventDefault(),e.stopPropagation(),this.$preset_in_edit||this._sorting||s().isFunction(this.options.onPresetLoad)&&this.options.onPresetLoad(t.attr("data-id"))},savePreset:function(e,t){var i=this;t.is_card=!0,!t.id&&!t.selection&&t.query&&s().isFunction(this.options.getActiveQuery)&&(t.query=this.options.getActiveQuery());var n=r.default.prototype.savePreset.call(this,e,t);return n.done((function(e){var n=s().propertyOf(e),r=n(["response","id"]),o=t.id?i.options.onPresetEdit:i.options.onPresetAdd;s().isFunction(o)&&r&&o(s().extend({id:r,label:t.name},s().pick(t,"query","sort")));var a=i.options.onPresetEdit||s().noop;"success"===n(["response","status"])&&t.filter&&s().each(t.filter,(function(e){a(e)}),i)})),n},completeDeletePreset:function(e){return s().isFunction(this.options.onPresetDelete)&&this.options.onPresetDelete(e),r.default.prototype.completeDeletePreset.apply(this,arguments)},sortMode:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return r.default.prototype.sortMode.apply(this,[e,t])},presetSaveRequestRestoreSelection:s().noop})},482857:(e,t,i)=>{i.r(t),i.d(t,{default:()=>k});var n=i(629133),s=i.n(n),r=i(460159),o=i.n(r),a=i(162262),l=i.n(a),c=i(313981),h=i(500034),_=i(445368),p=i(982862),u=i(146521),d=i(39290),f=i(580326),g=i(610577),m=i(661533);function y(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var v="/tmpl/notes/search/wrapper.twig",b=c.default.extend({_classes:function(){return{search:"js-feed-search",search_options_wrapper:"list-top-search",search_options_showed:"list-top-search-options-showed",search_input:"list-top-search__input",search_input_wrapper:"list-top-search__input-block",search_wrapper:"list-top-search__input-wrapper",search_context_menu:"js-feed-search-context-menu",search_preset:"list-top-search__preset",search_preset_showed:"list-top-search__options-showed",need_msec:"js-feed-search-need-msec",need_open_talks_preview:"js-feed-search-need-open-talks-preview",filter:"filter-search",options_wrapper:"search-options-wrapper",search_apply:"list-top-search__apply-block",search_apply_button:"js-filter-apply",search_nav:"js-feed-search-nav",search_nav_button:"feed-search__controls-button",search_nav_button_disabled:"feed-search__controls-button_disabled",search_nav_next:"js-feed-search-next",search_nav_prev:"js-feed-search-prev",search_nav_total:"js-feed-search-total"}},_selectors:function(){return{clear_btn:"#search_clear_button",search_loader:"#search_loader"}},events:function(){var e;return y(e={},"click ".concat(this._selector("search_input_wrapper")),"onClickStopPropagation"),y(e,"click ".concat(this._selector("clear_btn")),"onClearBtnClick"),y(e,"focus ".concat(this._selector("search_input")),"onSearchFocus"),y(e,"click ".concat(this._selector("search_input_wrapper")),"onSearchWrapperClick"),y(e,"click ".concat(this._selector("need_msec")),"onNeedMsecClick"),y(e,"click ".concat(this._selector("need_open_talks_preview")),"onNeedOpenTalksPreviewClick"),y(e,"input ".concat(this._selector("search_input")),"onInputValueChange"),y(e,"keydown ".concat(this._selector("search_input")),"onInputEnterKeyDown"),y(e,"click ".concat(this._selector("search_apply_button")),"_startSearch"),y(e,"click ".concat(this._selector("search_nav")),"onNavClickStopPropagation"),y(e,"click ".concat(this._selector("search_nav_next")),"onSearchNextResultClick"),y(e,"click ".concat(this._selector("search_nav_prev")),"onSearchPrevResultClick"),e},document_events:function(){return{"controls:hide:private":"onControlsHide"}},initialize:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c.default.prototype.initialize.apply(this,arguments),this.element_id=parseInt(t.element_id),this.element_type=t.element_type,this.is_applied=!1,this.filter=t.filter,this.onFilterToggle=t.onFilterToggle||s().noop,this.onSearchScrollToView=t.onSearchScrollToView||s().noop,this.onSearchApply=t.onSearchApply||s().noop,this.onSearchClear=t.onSearchClear||s().noop,this.should_always_show_preset_option=(0,h.isFeatureAvailable)("always_show_preset_option"),this.search_collection=new g.default([],{element_id:this.element_id,element_type:this.element_type}),this.listenTo(this.filter,"options:changed",this._renderFilterOptions),this.listenTo(this.filter,"load:start",(function(){return e.onLoadChanged(!0)})),this.listenTo(this.filter,"load:stop",(function(){return e.onLoadChanged(!1)})),this.listenTo(this.filter,"show",(function(){return e.onSearchFocusToggle(!0)})),this.listenTo(this.filter,"hide",(function(){return e.onSearchFocusToggle(!1)})),this.render(),this._$window.on("resize"+this.ns,(function(){e._elem("options_wrapper").children().length&&(e._getWidthOptionsBlock(!0),e.optionsTransform())})),this._getWidthOptionsBlock(!0)},destroy:function(){return this._$window.off(this.ns),c.default.prototype.destroy.apply(this,arguments)},render:o()._preload([v],"_render"),_render:function(){var e=this.element_type===APP.element_types.catalog_elements,t=o()({ref:v}).render({is_disabled:!(0,h.isFeatureAvailable)("feed_search")||e,placeholder:e?(0,_.i18n)("Filter"):""});this.$el.replaceWith(t),this.setElement(t),this._elem("search_wrapper").append(this.filter.el),this.element_id||this.toggle(!1)},onClearBtnClick:function(e){e.stopPropagation(),this._$document.trigger({type:"controls:hide",target:e.target}),this.is_applied=!1,this.search_value="",this._elem("search_nav").toggleClass("hidden",!0).toggleClass("h-hidden",!1),this._elem("search_input").val(""),this.onSearchClear(),this.filter.isApplied()&&this.filter._onApplyClick(this.filter._getDefaultFilter()),this.should_always_show_preset_option?this._renderFilterOptions([],this.filter.presets[0]):this._renderFilterOptions([])},onFieldClearClick:function(e){if(this.filter.items)this.filter.items.revertItem(e);else{var t=this.filter._getDefaultFilter(),i=this.filter._getFilter();this.filter._onApplyClick(s().extend({},i,y({},"".concat(e),t[e]))),this.actualize()}},onLoadChanged:function(e){this._elem("clear_btn").toggleClass("hidden",e)},onSearchFocusToggle:function(e){this._elem("search").toggleClass("focused",e),this.onFilterToggle(e)},onControlsHide:function(e){this.el===e.target||m.contains(this.el,e.target)||this.filter&&this.filter.hide(e)},onClickStopPropagation:function(e){e.stopPropagation(),this._$document.trigger({type:"controls:hide",target:e.target}),this._elem("search_input").focus()},onSearchWrapperClick:function(e){this._elem("search_input").is(":input")?document.activeElement!==this._elem("search_input").get(0)&&this._elem("search_input").focus():this.onSearchFocus(e)},onSearchFocus:function(e){this.filter&&this.filter.toggle(e)},onNeedMsecClick:function(e){var t=this,i=m(e.currentTarget);i.trigger("context-menu:checkable:toggle"),this.filter.setFeedFilterToStorage(this.element_type,{},{need_msec:!!i.is("[data-checkable-checked]")}).then((function(){t.filter._onApplyClick(t.filter._getFilter())}))},onNeedOpenTalksPreviewClick:function(e){var t=this,i=m(e.currentTarget);i.trigger("context-menu:checkable:toggle"),this.filter.setFeedFilterToStorage(this.element_type,{},{need_open_talks_preview:!!i.is("[data-checkable-checked]")}).then((function(){t.filter._onApplyClick(t.filter._getFilter())}))},onInputValueChange:function(){var e=this._elem("search_input").val(),t=e.length<3||e===this.search_value;this._elem("search_apply").toggleClass("h-hidden",t),this._elem("search_nav").toggleClass("h-hidden",!t)},onInputEnterKeyDown:function(e){13===e.keyCode&&(this._startSearch(),this._elem("search_input").blur())},onSearchNextResultClick:function(e){var t=this.search_collection.length;e.stopPropagation(),this._search_index<t-1&&(this._search_index++,this._navigateToSearchResult(this._search_index))},onSearchPrevResultClick:function(e){e.stopPropagation(),this._search_index>0&&(this._search_index--,this._navigateToSearchResult(this._search_index))},onNavClickStopPropagation:function(e){e.stopPropagation()},_startSearch:function(){var e=this,t=this._elem("search_input").val(),i=t.length>=3&&this.search_value!==t;this._toggleSearchingLoader(i),this.is_applied=i,i?(this.filter.hide(),this.search_value=t,this.search_collection.fetch({reset:!0,data:{term:t,"filter[chat_id]":s().keys(f.AmoJoMediator.get())}}).always(this.onSearchApply).then((function(){e._search_index=0,e.toggle(!0),e.search_collection.length?e._navigateToSearchResult(e._search_index):e._emptySearchResult()}),(function(t){e.processAjaxError(t),e._emptySearchResult()})),this.onInputValueChange()):(this._elem("search_nav").toggleClass("hidden",!0),this._toggleClearButton(),this.onSearchClear())},_toggleSearchingLoader:function(e){this._elem("clear_btn").toggleClass("hidden",e),this._elem("search_loader").toggleClass("h-hidden",!e),e||this._toggleClearButton()},_navigateToSearchResult:function(e){var t=this,i=this.search_collection.at(e);if(i){var n=this.search_collection.length,s=setTimeout((function(){return t._toggleSearchingLoader(!0)}),500);this.onSearchScrollToView(i.id,i.get("created_at"),this._elem("search_input").val()).always((function(){clearTimeout(s),t._toggleSearchingLoader(!1)})),this._elem("search_nav").toggleClass("hidden h-hidden",!1),this._elem("search_nav_total").text("".concat(e+1,"/").concat(n)),this._toggleClass("search_nav_button_disabled","search_nav_next",this._search_index===n-1),this._toggleClass("search_nav_button_disabled","search_nav_prev",0===this._search_index)}},_emptySearchResult:function(){this._elem("search_nav").toggleClass("hidden h-hidden",!1),this._elem("search_nav_total").text((0,_.i18n)("Nothing found")),this._toggleClass("search_nav_button_disabled","search_nav_next",!0),this._toggleClass("search_nav_button_disabled","search_nav_prev",!0),this._toggleSearchingLoader(!1),this.onSearchClear()},_toggleClearButton:function(){this._elem("clear_btn").toggleClass("h-hidden",!this.isApplied())},_renderFilterOptions:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._findElem("options_wrapper"),r=document.createDocumentFragment(),o=null===i?t.length>0:!i.is_default||this.should_always_show_preset_option,a=null!==i&&(!i.is_default||this.should_always_show_preset_option);this._renderContextMenu(),null===i&&s().each(t,(function(t){var i=e._addComponent(d.default,{text:e._getCorrectOptionTitle(t),name_input:t.name,onDestroy:function(t){t&&t.stopPropagation&&t.stopPropagation(),e.onFieldClearClick(m(t.currentTarget).attr("data-input-name"))}});i.render(),r.appendChild(i.el)}),this),this._elem("search_preset").html(a?i.label:"").toggleClass("is-preset",a).toggleClass(this._class("search_preset_showed"),a),n.html(r),this._toggleClass("search_options_showed","search_options_wrapper",o),this._toggleClearButton(),this.optionsTransform()},optionsTransform:function(){var e,t=this._findElem("options_wrapper"),i=m.makeArray(t.find('.list-top-search__options-showed:not(".hidden-options")')).reverse(),n=m.makeArray(m(i).find(".options-text").children('span:not(".name-options")')).reverse(),r=t.find(".hidden-options"),o=this._getWidthOptionsBlock(),a=0,l=0;m(i).removeClass("hidden"),m(n).removeClass("hidden"),r.remove(),s().each(i,(function(e){l+=e.offsetWidth})),l>o&&function e(t){n[t]&&(l-=n[t].offsetWidth,n[t].className+="hidden",l>=o&&t+1<n.length&&e(t+1))}(0),l>o&&((e=document.createElement("div")).className+="list-top-search__options list-top-search__options-showed hidden-options",function n(s){l-=i[s].offsetWidth,i[s].className+=" hidden",a+=1,e.innerHTML='<span class="options_text">+ '+a+"</span>",t.append(e),l>=o&&s+1<i.length&&n(s+1)}(0))},_getWidthOptionsBlock:function(e){return this._width_options_block&&!e||(this._width_options_block=Math.max(0,this._elem("search_options_wrapper").width()-200-200)),this._width_options_block},_getCorrectOptionTitle:function(e){var t='<span class="name-options">'.concat(e.title,"</span>");switch(e.items.length){case 0:return t;case 1:return t+"<span>: ".concat(e.items[0].option,"</span>");default:return t+"<span>: ".concat(e.items.length,"</span>")}},_renderContextMenu:function(){this._elem("search_context_menu").length||(this._elem("search").append(o()({ref:"/tmpl/notes/search/context_menu.twig"}).render(this.filter._getSystem())),this._dropElemCache("search_context_menu"))},toggle:function(e){this._elem("search").toggleClass("hidden",!this.element_id||!e&&!this.isApplied())},isApplied:function(){return this.is_applied||this.filter.isApplied()},actualize:function(){return"absolute"===this.$el.css("position")&&this.$el.css("width","calc(100% - ".concat((0,p.getScrollBarWidth)("custom-scroll"),"px)")),this.filter.toggle(!1)}});l().mixin(b,u.PageLoadErrorHandlerMixin);const k=b;var C="../build/transpiled/interface/notes/filter/search";window.define(C,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([C])},610577:(e,t,i)=>{i.r(t),i.d(t,{default:()=>o});var n=i(974839),s=i.n(n),r=i(926168);const o=s().Collection.extend({itemRel:"events",url:function(){return"/ajax/v4/".concat((0,r.convertElementType)(this.element_type,"string"),"/").concat(this.element_id,"/timeline/search")},initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.element_id=t.element_id,this.element_type=t.element_type}})}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_18_50_52"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5d8a4c49-c3fc-45f2-b4bc-91ed7c2c3a13",e._sentryDebugIdIdentifier="sentry-dbid-5d8a4c49-c3fc-45f2-b4bc-91ed7c2c3a13")}catch(e){}}();
//# sourceMappingURL=2836.3888a70a12e8eedff4ba.js.map