"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[42693],{556986:(e,t,i)=>{i.r(t),i.d(t,{default:()=>p});var n=i(661533),a=i.n(n),o=i(629133),s=i.n(o),r=i(460159),l=i.n(r),d=i(445368),c=i(69991),_=i(845043);i(368439);var u=[{oauth:!0,domain:["gmail.com","googlemail.com"],added_icon_class:"icon icon-gmail-mail",added_mailbox_lang_name:(0,d.i18n)("mailbox_gmail"),additional_help:!0,provider:"gmail",added_mailbox:"gmail"},{oauth:!0,domain:["yandex.ru","ya.ru","yandex.com"],added_icon_class:"icon icon-yandex-mail",added_mailbox_lang_name:(0,d.i18n)("mailbox_yandex"),provider:"yandex",added_mailbox:"yandex"},{domain:["mail.ru","list.ru","inbox.ru","bk.ru"],added_icon_class:"icon icon-mailru-mail",added_mailbox_lang_name:(0,d.i18n)("mailbox_mailru"),provider:"mailru",added_mailbox:"mailru"},{domain:["rambler.ru","autorambler.ru","ro.ru","lenta.ru","myrambler.ru"],added_icon_class:"icon icon-rambler-mail",added_mailbox_lang_name:(0,d.i18n)("mailbox_rambler"),additional_help:!0,provider:"rambler",added_mailbox:"rambler"},{domain:["yahoo.com"],added_icon_class:"icon icon-yahoo-mail",added_mailbox_lang_name:(0,d.i18n)("mailbox_yahoo"),provider:"yahoo",added_mailbox:"yahoo"},{domain:["outlook.com","hotmail.com"],added_icon_class:"icon icon-outlook-mail",added_mailbox_lang_name:(0,d.i18n)("mailbox_outlook"),provider:"outlook",added_mailbox:"outlook"},{domain:["icloud.com"],added_icon_class:"icon icon-icloud-mail",added_mailbox_lang_name:(0,d.i18n)("mailbox_icloud"),provider:"icloud",added_mailbox:"icloud"}],m={validators:{email:function(e){return!/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[\da-z](?:[\da-z-_]*[\da-z])?\.)+[a-z]{2,}$/i.test(e)},server:function(e){return!/^[a-z0-9]+([-.]{1}[a-z0-9]+)*\.[a-z]{2,8}$/i.test(e)},port:function(e){return!/^\d+$/.test(e)}},prevent_code:"mail_settings",_confirmModalConfig:{message:(0,d.i18n)("mailbox_form_on_close"),gray_button:!0,decline:s().noop,accept:s().bind((function(e){APP.router.preventPageChange(!1,m.prevent_code),s().isFunction(e)&&e()}),void 0)},field_map:{email:{selector:"#mailbox-form-email",validator:"email"},imap_login:{selector:"#mailbox-imap-login"},imap_password:{selector:"#mailbox-imap-password"},imap_server:{selector:"#mailbox-imap-server",validator:"server"},imap_port:{selector:"#mailbox-imap-port",validator:"port"},smtp_server:{selector:"#mailbox-smtp-server",validator:"server"},smtp_port:{selector:"#mailbox-smtp-port",validator:"port"},smtp_login:{selector:"#mailbox-smtp-login"},smtp_password:{selector:"#mailbox-smtp-password"}},validateField:function(e,t,i){var n=m.field_map[t];if(s().isUndefined(m.field_map[t]))return!0;var a=e._findElem(t);if(a.length){var o=a.val().trim();if(!o.length)return!!i||"empty";if(n.validator&&m.validators[n.validator]&&m.validators[n.validator](o))return"invalid"}return!0},validateFields:function(e,t,i){var n=[];return s().each(t,(function(t){var a;!0!==(a=m.validateField(e,t,i))&&n.push({code:"".concat(t,"_").concat(a),field:t})})),n},hideErrors:function(e){e._findElem("text_input_invalid").removeClass("validate-has-error"),e._findElem("text_input_invalid__cell_port").removeClass("validate-has-error__cell-port"),e._findElem("mailbox_form__error_input").empty().hide()},showFieldErrors:function(e,t){m.hideErrors(e),s().each(t,(function(t){var i=e._findElem(t.field),n="mailbox_error_".concat(t.code);i.length&&(m.unsetInputValid(i),i.addClass("validate-has-error"),"mailbox_error_imap_port_empty"!==n&&"mailbox_error_smtp_port_empty"!==n||i.addClass("validate-has-error__cell-port"),APP.lang[n]&&i.next().show().append("".concat((0,d.i18n)(n),"<br>")))}))},hideInputError:function(e){e.removeClass("validate-has-error"),e.removeClass("validate-has-error__cell-port"),e.next(".mailbox-form__error-input").hide().empty()},setInputValid:function(e){"checkbox"!==e[0].type&&e.val().length>0&&!e.parent().find(".valid-field").length&&e.parent().append('<div class="icon  icon-valid-field valid-field"></div>')},unsetInputValid:function(e){(e||this.$el.find("input")).parent().find(".valid-field").remove()},getProviderInfo:function(e){var t=e.slice(e.indexOf("@")+1),i=s().find(u,(function(e){return e.domain.indexOf(t)>-1}));if(i)return i},collectSettings:function(e){var t={imap:{},smtp:{}};return s().each({server:"imap_server",port:"imap_port",enc:"imap_enc"},(function(i,n){t.imap[n]=e.get(i)})),s().each({server:"smtp_server",port:"smtp_port",enc:"smtp_enc"},(function(i,n){t.smtp[n]=e.get(i)})),t},enableButton:function(){this.$el&&this.$el.find("#mailbox-button__save, #mailbox-button__enable").trigger("button:save:enable"),this.save_locked=!1},disableButton:function(){this.$el&&this.$el.find("#mailbox-button__save, #mailbox-button__enable").trigger("button:save:disable"),this.save_locked=!0},toggleImapCaptions:function(e,t){var i=t?"new_":"",n=e?"imap_password":"password_field_caption",a=e?"imap_password":"password_email_password";e&&(this._findElem("mailbox__form_row_password").find(".mailbox-form__cell-title").text(APP.lang["mail_setup_".concat(i).concat(n)]),this._findElem("mailbox__form_row_password").find(".password_input").attr("placeholder",APP.lang["mail_setup_".concat(i).concat(a)]))},confirmOwnerChange:function(e){var t=a().Deferred(),i=[{text:(0,d.i18n)("mail_box_settings_change_owner_message")}];return e&&i.push({text:(0,d.i18n)("mail_box_settings_unsorted_cleanup")}),new _.default({class_name:"modal-list",caption:(0,d.i18n)("mail_box_settings_change_owner_caption"),message:i,template:"/tmpl/common/modal/delete.twig",accept_text:(0,d.i18n)("mail_box_settings_change_auth_confirm"),decline_text:(0,d.i18n)("mail_box_settings_change_auth_decline"),button_class:"button-input_blue",destroy:function(){s().isUndefined(this.accepted)||!0!==this.accepted?t.reject():t.resolve(this.accepted)}}),t.promise()},confirmAuthChange:function(){var e=a().Deferred();return new _.default({class_name:"modal-list",text:(0,d.i18n)("mail_box_settings_change_auth_message"),accept_text:(0,d.i18n)("mail_box_settings_change_auth_confirm"),decline_text:(0,d.i18n)("mail_box_settings_change_auth_decline"),button_class:"button-input_blue",destroy:function(){s().isUndefined(this.accepted)||!0!==this.accepted?e.reject():e.resolve(this.accepted)}}),e.promise()},confirmRemoveAction:function(){var e=a().Deferred();return new _.default({class_name:"modal-list",text:(0,d.i18n)("mail_box_settings_remove_box_confirm"),accept_text:(0,d.i18n)("delete_mails_confirm"),decline_text:(0,d.i18n)("button_cancel"),button_class:"button-input_blue",destroy:function(){s().isUndefined(this.accepted)||!0!==this.accepted?e.reject():e.resolve(this.accepted)}}),e.promise()},onMailTipClick:l()._preload(["/tmpl/mail/modal/gmail_instruction.twig","/tmpl/mail/modal/rambler_instruction.twig"],"_onMailTipClick"),_onMailTipClick:function(e,t){var i=e.component.provider||e.component.data.provider.code;t.preventDefault(),new _.default({class_name:"modal-list gmail-modal-instruction",text:(0,d.i18n)("mail_box_settings_generate_password_instruction_title"),accept_text:"OK",init:function(){var e=this,t=APP.constant("is_kommo"),n=t?"kommo":"amocrm",a="pt"===APP.lang_id?"en":APP.lang_id,o=["ru","es","pt"].includes(APP.lang_id)?"en":APP.lang_id,s="/frontend/images/interface/mail_instructions/",r=s+"".concat(n,"/").concat(a,"/instruction"),d=s+"".concat(n,"/").concat(o,"/instruction"),c=t?d:r;this.$modal_body.find(".modal-body__actions").hide().end().find(".modal-body__caption").after(l()({ref:"/tmpl/mail/modal/".concat(i,"_instruction.twig")}).render({images_tmp:c})).end().find("img").on("load",(function(){e.$modal_body.trigger("modal:centrify")}))}})},confirmDisableAction:function(){var e=a().Deferred();return new _.default({class_name:"modal-list",text:(0,d.i18n)("mail_box_settings_remove_all_letters"),accept_text:(0,d.i18n)("mail_box_settings_keep_letters"),decline_text:(0,d.i18n)("mail_box_settings_remove_confirm"),button_class:"button-input_blue",destroy:function(){var t;s().isUndefined(this.accepted)?e.reject():(t=!this.accepted,e.resolve(t))}}),e.promise()},confirmChangeAccess:function(e){var t=a().Deferred(),i=[{text:e?"".concat((0,d.i18n)("You allow the administrator(s) to view and manage all correspondence.")," ").concat((0,d.i18n)("The process of implementing these rights can take awhile, but during the process, your mail will be available.")):(0,d.i18n)("You allow the administrator(s) to view and manage all correspondence.")}];return new _.default({class_name:"modal-list",caption:(0,d.i18n)("mail_box_settings_change_owner_caption"),message:i,accept_text:(0,d.i18n)("mail_box_settings_change_auth_confirm"),decline_text:(0,d.i18n)("mail_box_settings_change_auth_decline"),button_class:"button-input_blue",template:"/tmpl/common/modal/delete.twig",destroy:function(){s().isUndefined(this.accepted)||!0!==this.accepted?t.reject():t.resolve(this.accepted)}}),t.promise()},getBccMailboxes:function(e,t){e=e||APP.constant("account").subdomain,t=t||APP.constant("amomail").bcc_domain;var i={common:{description:"The letter will be displayed in the contact card"},lead:{description:"The letter will create a deal"},contact:{description:"The letter will create contacts"}},n="".concat(e,"{{code}}@").concat(t);return s().each(i,(function(e,t){e.email=n.replace("{{code}}","common"===t?"":"+".concat(t))}))},connectionErrorHandler:c.default.commonErrorConfirm};const p=m;var f="../build/transpiled/interface/mail/mixins/mailbox_base";window.define(f,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([f])},762385:(e,t,i)=>{i.r(t),i.d(t,{default:()=>o});var n=i(727406),a=i(324247);const o=(0,n.wrapCacheCollection)(a.default);var s="../build/transpiled/interface/settings/digital_pipeline/leads_sources/collections/cached_sources";window.define(s,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([s])},334213:(e,t,i)=>{i.r(t),i.d(t,{default:()=>d});var n=i(629133),a=i.n(n),o=i(345839),s=i.n(o),r=i(119199),l=i(611958);const d=s().Collection.extend({model:r.default,sync:function(e,t,i){return l.default.getMailboxes("digital").then(a().bind(i.success))}});var c="../build/transpiled/interface/settings/digital_pipeline/leads_sources/collections/mailboxes";window.define(c,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([c])},324247:(e,t,i)=>{i.r(t),i.d(t,{default:()=>g});var n=i(661533),a=i.n(n),o=i(629133),s=i.n(o),r=i(345839),l=i.n(r),d=i(955026),c=i(445368),_=i(450422),u=i(486823),m=i(149270),p=i(334213),f=i(136675),h=i(556986);const g=l().Collection.extend({sources_urls:{facebook:"/ajax/v1/chats/origin/facebook/list",telegram:"/ajax/v1/chats/origin/telegram/list",vk:"/ajax/v1/chats/origin/vk/list",viber:"/ajax/v1/chats/origin/viber/list",old_chats:"/ajax/amochats/check","bf.skype":"/ajax/v1/chats/origin/bf.skype/list",wechat:"/ajax/v1/chats/origin/wechat/list",instagram:"/ajax/v1/chats/origin/instagram/list",instagram_business:"/ajax/v1/chats/origin/instagram_business/list",avito:"/ajax/v1/chats/origin/avito/list"},success_statuses:{facebook:"FB_PAGE_STATUS_SUCCESS",instagram_business:"FB_PAGE_STATUS_SUCCESS",vk:"VK_GROUP_STATUS_SUCCESS",telegram:"TG_BOT_STATUS_SUCCESS",viber:"VI_BOT_STATUS_SUCCESS","bf.skype":"SKYPE_BOT_STATUS_SUCCESS",wechat:"WECHAT_BOT_STATUS_SUCCESS",avito:"AVITO_BOT_STATUS_SUCCESS"},required_fields:{chat:["name"],fb_forms:["name"],mail:["origin"],vk_form:["name","active"]},initialize:function(e,t){this.pipeline_id=t.pipeline_id,this.is_main_pipeline=t.is_main_pipeline,t={sources:this.where({type:"mail"}),pipeline_id:this.pipeline_id,auto_append_enabled:t.auto_append_enabled},this.total_sources_count=0,this.mail=new p.default([],t),this.setEvents=t.auto_append_enabled?this.setEvents:s().noop,this.single_chat_sources=["avito"],this.setEvents(this)},model:u.default,url:function(){return"/ajax/settings/pipeline/leads/".concat(this.pipeline_id,"/sources")},parse:function(e){var t=s().propertyOf(e.response)("total_sources_on_account");return this.setTotalSourcesCount(t),e.response.lead_sources},setTotalSourcesCount:function(e){this.total_sources_count=parseInt(e)||0},getTotalSourcesCount:function(){return this.total_sources_count||0},check:function(){var e=a().Deferred();return this.syncWithExternal(e,this.needToSync()),e.promise()},checkAll:function(){return a().when(this.syncChats(),this.syncLeadgen(),this.fetchMailboxes(),this.syncVkForms())},update:function(){return this.fetch().then(s().bind((function(e,t){this.checkAll().done(t.resolve).fail(t.reject)}),this))},needToSync:function(){var e=[];return s().each(this.required_fields,(function(t,i){var n=this.where({type:i});s().isUndefined(s().find(n,(function(e){return!s().isUndefined(s().find(t,(function(t){return!e.get(t)})))})))||e.push(i)}),this),e},syncWithExternal:function(e,t){var i=a().Deferred(),n=a().Deferred(),o=a().Deferred(),r=a().Deferred();return s().each(this.required_fields,(function(e,a){switch(a){case"chat":-1===s().indexOf(t,a)?i.resolve():i=this.syncChats();break;case"mail":-1===s().indexOf(t,a)?n.resolve():n=this.fetchMailboxes();break;case"fb_forms":-1===s().indexOf(t,a)?o.resolve():o=this.syncLeadgen();break;case"vk_form":-1===s().indexOf(t,a)?r.resolve():r=this.syncVkForms()}}),this),Promise.all([i,n,o]).then((function(){e.resolve()})),e},setAmojoOriginData:function(e,t){var i,n,a=[],o=s().map(this.where({origin:e}),(function(e){return e.id}));s().each(t,(function(t){this._isOriginEnabled(t)&&(i=this.findWhere({external_id:t.id.toString()}),n=i&&i.get("name")?i.get("name"):t.name,s().isUndefined(i)?this.createSource({id:t.id,name:n,origin:e,type:"chat",button_params:this._makeButtonsParams(e,t)}):this._modelIsFull(i,t,e)||this.updateSource(i.id,{name:n,button_params:this._makeButtonsParams(e,t)}),a.push(t.id.toString()))}),this),s().each(s().difference(o,a),(function(e){i=this.findWhere({external_id:e}),0===t.length||-1!==e.toString().indexOf("disconnected:")?i.set({warning:!0}):i.set({error:!0})}),this)},createSource:function(e){f.default.add(this.pipeline_id,e.type,e).then(s().bind((function(t){e.source_id=t.response.source_add,this.add([e])}),this))},updateSource:function(e,t){var i=this.get(e);i.set(t),f.default.edit(i.get("source_id"),{params:t})},setEvents:function(){this.listenTo(this,"reset",(function(e){s().each(e.models,s().bind(this.createView,this))})),this.listenTo(this,"add",this.createView)},syncChats:function(){var e,t=a().Deferred(),i=0,n=s().uniq(s().map(this.where({type:"chat"}),(function(e){return e.get("origin")})));return s().each(n,(function(n,a,o){this._getOriginData(n,{pipeline_id:this.pipeline_id}).then(s().bind((function(a){a=(0,d.cleanResponse)(a),(0,d.hasKeys)(a,["chats","origin","list",n])&&(e=a.chats.origin.list[n],"avito"===n&&(e=e.items),this._isSingleChatOrigin(n)||this.setAmojoOriginData(n,e),o.length===++i&&t.resolve())}),this))}),this),t},syncVkForms:function(){var e,t=a().Deferred(),i=(0,c.i18n)("VK form"),n=this.where({type:"vk_form"});return s().isEmpty(n)?t.resolve():this._getVkFormsData().then(s().bind((function(a){(a=(0,d.cleanResponse)(a))&&a.settings?s().each(n,s().bind((function(t){(e=a.settings[t.get("id")])?t.get("name")===e.name?t.set({name:e.name,error:!e.active&&t.get("error")}):t.get("name")||this.updateSource(t.id,{name:e.name,error:!e.active&&t.get("error")}):t.set({name:i,error:!0})}),this)):s().each(n,(function(e){e.set({name:i,error:!0})})),t.resolve()}),this),s().bind((function(){s().each(n,(function(e){e.set({name:i,error:!0})})),t.resolve()}))),t},syncLeadgen:function(){var e,t=a().Deferred(),i=(0,c.i18n)("Facebook form"),n=this.where({type:"fb_form"});return n.length>0?this._getFbFormsData().then(s().bind((function(a){(a=(0,d.cleanResponse)(a))&&a.settings?s().each(n,s().bind((function(t){(e=a.settings[t.get("id")])?t.get("name")===e.name?t.set({name:e.name,error:!1}):this.updateSource(t.id,{name:e.name,error:!1}):t.set({name:i,error:!0})}),this)):s().each(n,(function(e){e.set({name:i,error:!0})})),t.resolve()}),this),s().bind((function(){s().each(n,(function(e){e.set({name:i,error:!0})})),t.resolve()}))):t.resolve(),t},createView:function(e){!e.get("hidden")&&this.pipeline_id&&(e.view=new m.default({model:e}))},fetchMailboxes:function(){var e=a().Deferred();return(0,_.isAmoChatsFullEnabled)()?e.resolve():(this.mail.fetch({reset:!0}).then(s().bind((function(){this.syncMailboxes(),e.resolve()}),this)).fail(e.reject),e)},syncMailboxes:function(){var e=this.where({type:"mail"});e=e.concat(this.where({type:"mail_parser"})),s().each(e,s().bind((function(e){var t,i=this.mail.where({id:parseInt(e.get("external_id"))}),n={};i.length?((i=s().first(i)).isValid()?(n={},i.set("name",e.get("name")),this._isMailHasPipeSettings(i)&&!this._isMailForCurrentPipe(i)&&(n={pipeline_id:i.get("settings").pipeline.id}),i.get("email")!==e.get("email")&&(n.params={id:i.get("id"),email:i.get("email")}),s().isEmpty(n)||(f.default.edit(e.get("source_id"),n),s().has(n,"pipeline_id")?this.remove(e):e.set(n)),"mail_parser"!==e.get("type")||i.isSetupCompleted()?"mail_parser"===e.get("type")?(i.set({synced:!0,error:!1}),s().isUndefined(e.get("is_setup"))&&e.get("is_setup")||(this.remove(e),e.set({is_setup:!1}),this.add(e))):(i.set({synced:!0,error:!1}),e.set({is_setup:!1})):e.set({is_setup:!0})):e.set({disabled:!0}),"mail"!==e.get("type")||e.get("origin")||(i.get("provider")&&!s().isEmpty(i.get("provider").code)&&e.set("origin",i.get("provider").code),(t=h.default.getProviderInfo(i.get("email")))&&t.provider&&e.set("origin",t.provider),e.get("origin")&&f.default.edit(e.get("source_id"),{params:s().extend(e.get("params"),{origin:e.get("origin")})}))):"mail_parser"===e.get("type")?e.set({error:!0,deleted:!0}):e.set({error:!0})}),this)),this.mail.each(s().bind((function(e){e.set({available_for_add:!e.get("synced")&&e.isValid()&&"shared"===e.get("type")})}),this))},_isMailHasPipeSettings:function(e){return(0,d.hasKeys)(e.get("settings"),["pipeline","id"])&&!s().isNull(e.get("settings").pipeline.id)},_isMailForCurrentPipe:function(e){var t=!1;return this._isMailHasPipeSettings(e)&&(t=e.get("settings").pipeline.id===this.pipeline_id),t},promiseGetToken:function(){var e=APP.data.current_view.pipeline?APP.data.current_view.pipeline.id:APP.constant("main_pipeline");return this.piper_token?Promise.resolve(this.piper_token):a().ajax("/ajax/settings/pipeline/leads/".concat(e,"/token")).then(s().bind((function(e){return this.piper_token=e.response.token,e.response.token}),this))},_getVkFormsData:function(){return this.promiseGetToken().then(s().bind((function(e){return a().ajax({method:"POST",beforeSend:function(t){t.setRequestHeader("X-Auth-Token",e)},url:"/api/forms/vk/forms"})}),this))},_getFbFormsData:function(){return this.promiseGetToken().then(s().bind((function(e){return a().ajax({method:"POST",beforeSend:function(t){t.setRequestHeader("X-Auth-Token",e)},url:"/api/forms/facebook/forms"})}),this))},_getOriginData:function(e,t){return this.sources_urls[e]?a().ajax({method:"GET",type:"json",data:t,url:this.sources_urls[e]}):Promise.resolve({})},_isOriginEnabled:function(e){return e.enabled&&!e.blocked&&!e.error},_isSingleChatOrigin:function(e){return s().contains(this.single_chat_sources,e)},_makeButtonsParams:function(e,t){var i={type:e,id:t.id,name:t.name};switch(e){case"facebook":case"vk":i.link=t.link,i.ext_id=i.id.toString();break;case"instagram_business":i.link=t.link,i.ext_id=i.id.toString(),t.username&&(i.username=t.username);break;case"telegram":case"viber":i.link=t.unique_name,i.ext_id=i.link;break;case"instagram":i.link=t.id,i.ext_id=t.id}return i},_modelIsFull:function(e,t,i){var n=(e.get("name")===t.source_name||"instagram"===i)&&!s().isNull(e.get("button_params"));return n&&"instagram_business"===i&&t.username&&t.username!==(e.get("button_params")||{}).username&&(n=!1),n}});var v="../build/transpiled/interface/settings/digital_pipeline/leads_sources/collections/sources";window.define(v,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([v])},119199:(e,t,i)=>{i.r(t),i.d(t,{default:()=>a});var n=i(345839);const a=i.n(n)().Model.extend({validate:function(e){if(!1===e.active)return"inactive"},isSetupCompleted:function(){return"completed"===this.get("settings").setup.status}});var o="../build/transpiled/interface/settings/digital_pipeline/leads_sources/models/mailbox";window.define(o,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([o])},486823:(e,t,i)=>{i.r(t),i.d(t,{default:()=>s});var n=i(345839),a=i.n(n),o=i(136675);const s=a().Model.extend({idAttribute:"external_id",sync:function(e){"delete"===e&&o.default.delete(this.get("source_id"))}});var r="../build/transpiled/interface/settings/digital_pipeline/leads_sources/models/source";window.define(r,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([r])},149270:(e,t,i)=>{i.r(t),i.d(t,{default:()=>m});var n=i(629133),a=i.n(n),o=i(460159),s=i.n(o),r=i(810427),l=i.n(r),d=i(982862),c=i(136675),_=i(304483),u=i(661533);const m=l().extend({_selectors:function(){return{subtitle:".dp-source__subtitle"}},selectors:{sources_wrapper:".digital-pipeline__source-block",source:".dp-source",source_name_input:".js-dp-source-name-input",source_caption:".dp-source__caption",source_name_accept:".dp-source-name-accept",source_name_spinner:".dp-source-name-accept-spinner"},events:{"click .js-source_delete":"deleteSource","click .js-source-checkbox":"toggleSourceState","click .js-source-edit-name":"onEditNameClick","click .js-dp-source-name-accept":"onAcceptNameClick","click .js-dp-source-name-input":"onInputNameClick","blur .js-dp-source-name-input":"onInputBlur","mousedown .js-dp-source-name-accept":"onAcceptNameMousedown"},_template:function(){return{widget:"/tmpl/digital_pipeline/lead_sources_templates/widget.twig",mail:"/tmpl/digital_pipeline/lead_sources_templates/mail.twig",mail_parser:"/tmpl/digital_pipeline/lead_sources_templates/mail_parser.twig",form:"/tmpl/digital_pipeline/lead_sources_templates/form.twig",fb_form:"/tmpl/digital_pipeline/lead_sources_templates/fb_form.twig",vk_form:"/tmpl/digital_pipeline/lead_sources_templates/vk_form.twig",chat:"/tmpl/digital_pipeline/lead_sources_templates/chat.twig",google_sheets:"/tmpl/digital_pipeline/lead_sources_templates/google_sheets.twig",button:"/tmpl/digital_pipeline/lead_sources_templates/button.twig",engagement_page:"/tmpl/digital_pipeline/lead_sources_templates/engagement_page.twig",parser:"/tmpl/digital_pipeline/lead_sources_templates/parser.twig",salesbot:"/tmpl/digital_pipeline/lead_sources_templates/salesbot.twig",cbh:"/tmpl/digital_pipeline/lead_sources_templates/cbh.twig",wordpress:"/tmpl/digital_pipeline/lead_sources_templates/wordpress.twig",unknown:"/tmpl/digital_pipeline/lead_sources_templates/unknown.twig"}[this.model.get("type")]||!1},_classes:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a().extend({},l().prototype._classes.apply(this,t),{source_in_edit:"dp-source-in-edit"})},initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.model=e.model,this.linkDOMElement(),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"remove",this.remove)},remove:function(){this.$el.remove(),this.stopListening()},render:function(){var e,t,i,n=this._template(),a=u(this.selectors.sources_wrapper);n&&((t=this.model.toJSON()).external_id=this.model.id,e={source:t},i=u(s()({ref:n}).render(e)),this.findDOMElement().length?this.$el.replaceWith(i):a.append(i),this.setElement(this.findDOMElement()))},linkDOMElement:function(){var e=this.findDOMElement();e.length?this.setElement(e):this.render()},findDOMElement:function(){return this.model.id?u("".concat(this.selectors.source,"[data-external-id='").concat(this.model.id,"']")):u("".concat(this.selectors.source,"[data-source-id='").concat(this.model.get("source_id"),"']"))},deleteSource:function(e){e.stopPropagation(),this.model.trigger("source:error:remove",this.model),this.model.destroy()},toggleSourceState:function(e){var t=e.target.checked;this.model.set("disabled",!t),c.default.edit(this.model.get("source_id"),{params:{enabled:t}})},onEditNameClick:function(e){var t=u(e.target).closest(this.selectors.source),i=t.find(this.selectors.source_name_input),n=t.attr("data-source-id");e.stopPropagation(),n&&(i.val(t.find(this.selectors.source_caption).text().trim()),t.addClass(this._class("source_in_edit")),(0,d.setCursorPosition)(i),i.autosize())},onAcceptNameClick:function(e){var t=u(e.currentTarget).closest(this.selectors.source),i=t.find(this.selectors.source_name_input),n=t.attr("data-source-id"),o=i.val();e.stopPropagation(),o||(o=this.model.get("origin_name")),t.find(this.selectors.source_caption).text()!==o?(t.find(this.selectors.source_name_accept).css("display","none"),t.find(this.selectors.source_name_spinner).show(),u.ajax({method:"PATCH",url:"/ajax/v4/sources/".concat(n),data:{name:o}}).done(a().bind((function(){t.find(this.selectors.source_caption).text(o),this.model.set("name",o)}),this)).fail((function(){(new _.default).showError(!1,!1)})).always(a().bind((function(){t.find(this.selectors.source_name_accept).css("display",""),t.find(this.selectors.source_name_spinner).hide(),t.removeClass(this._class("source_in_edit")),this.blur_prevented=!1}),this))):t.removeClass(this._class("source_in_edit"))},onAcceptNameMousedown:function(){this.blur_prevented=!0},onInputNameClick:function(e){e.stopPropagation()},onInputBlur:function(e){this.blur_prevented?e.preventDefault():u(e.target).closest(this.selectors.source).removeClass(this._class("source_in_edit"))}});var p="../build/transpiled/interface/settings/digital_pipeline/leads_sources/views/source_element";window.define(p,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([p])},142693:(e,t,i)=>{i.r(t),i.d(t,{default:()=>o});var n=i(324247),a=i(762385);const o={createCollectionSource:function(e,t){var i=this.pipeline?this.pipeline.id:e,o=n.default;t||(t={}),t.is_cache_enabled&&(o=a.default),this.leads_sources_collection=new o([],{pipeline_id:i,is_main_pipeline:i===APP.constant("main_pipeline"),auto_append_enabled:!0})},getSourcesByType:function(e,t){return this.leads_sources_collection.filter((function(i){return!(i.get("type")!==e||"chat"!==e&&!t&&i.has("error")&&!0===i.get("error"))}))}};var s="../build/transpiled/interface/settings/digital_pipeline/mixins/source_mixin";window.define(s,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([s])}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_17_08_33"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="dedcb2fd-9c95-41c3-a613-bd94e52a7887",e._sentryDebugIdIdentifier="sentry-dbid-dedcb2fd-9c95-41c3-a613-bd94e52a7887")}catch(e){}}();
//# sourceMappingURL=42693.e99484b23d5ff86b6676.js.map