"use strict";(window.webpackChunk=window.webpackChunk||[]).push([[51520,41542],{451520:(e,t,s)=>{s.r(t),s.d(t,{default:()=>p});var i=s(629133),o=s.n(i),n=s(161320),a=s.n(n),r=s(926168),d=s(859200),l=s(786247),_=s(962118);const p={initFirstTaskView:function(){o().contains(o().values(o().pick(APP.element_types,"leads","customers")),this.params.element_type)&&!(0,d.getRights)("is_free_user")&&(this._first_task_active=!0,this.listenTo(this.notes,"notes:status-changed",this._onFirstTaskStatusChanged,this))},_resort:function(){this._checkFirstTask()},_checkFirstTask:function(){this._first_task_active&&(this.notes.find((function(e){return"tasks"===e.get("object_type").code&&!e.get("status")}),this)?this._destroyFirstTask():this._empty_task||(this.notes.element_id?(this._empty_task=this._addComponent(_.default,{notes:this.notes}),this._elem("filter_and_chat_users").children().prepend(this._empty_task.render().el)):(this._empty_task=this._addComponent(l.default,{element_id:this.notes.element_id,element_type:this.notes.element_type,notes:this.notes,getExtraData:o().bind(this._getExtraData,this),getResponsibleId:o().bind(this.params.getResponsibleId,this),onEdit:o().bind(this._setEdit,this),onAdd:o().bind(this._addNotes,this),onClose:o().bind(this._onFirstTaskStatusChanged,this,!1)}),this._empty_task.model.set("complete_till",a()().tz(APP.system.timezone).hour(23).minute(59).add(1,"day").unix()),this._elem("notes").before(this._empty_task.el),this._empty_task.enterEditMode(),this._updateStickyTasks())))},_destroyFirstTask:function(){this._empty_task&&(this._destroyComponent(this._empty_task),this._empty_task=null)},_onFirstTaskStatusChanged:function(e){this._first_task_active=o().isBoolean(e)?e:!(0,r.isWonLostStatus)(e),this._first_task_active?this._checkFirstTask():this._destroyFirstTask()}};var h="../build/transpiled/interface/notes/mixins/first_task";window.define(h,(function(){var e="undefined",s=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return s&&s.default||s})),window.require([h])},786247:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});var i=s(629133),o=s.n(i),n=s(968924),a=s(741542);const r=a.default.extend({cancel:o().noop,events:o().extend({},a.default.prototype.events||{},{"click .card-task__first-close":"onClickClose"}),initialize:function(e){this.options=e||{},a.default.prototype.initialize.apply(this,arguments),this.listenTo(this.options.notes,"collection:element-id:updated",(function(){this.model.set({element_id:this.options.notes.element_id,element_type:this.options.notes.element_type})}),this)},_getRenderParams:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return o().extend(n.default.prototype._getRenderParams.apply(this,t),{is_first_task:!0})},_getTemplate:function(){return"/tmpl/notes/types/first_task.twig"},_render:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];n.default.prototype._render.apply(this,t),this.$el.addClass("".concat(this.className,"_first-task"))},destroy:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];n.default.prototype.cancel.apply(this,t),a.default.prototype.destroy.apply(this,t),this.remove()},onClickClose:function(){this.options.onClose()}});var d="../build/transpiled/interface/notes/views/add/first_task";window.define(d,(function(){var e="undefined",s=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return s&&s.default||s})),window.require([d])},962118:(e,t,s)=>{s.r(t),s.d(t,{default:()=>o});var i=s(313981);const o=i.default.extend({className:"js-feed-first-task-lite feed-first-task-lite",events:{click:"onClickToOpenTaskCompose"},initialize:function(e){this.options=e||{},i.default.prototype.initialize.apply(this,arguments)},destroy:function(){i.default.prototype.destroy.call(this,!0)},render:function(){return this.$el.html('<div class="feed-first-task-lite__icon"><svg class="svg-icon svg-tasks--clock-dims"><use xlink:href="#tasks--clock"></use></svg></div><div class="feed-first-task-lite__inner">'.concat(APP.lang.tasks_first_text,"</div>")),this},onClickToOpenTaskCompose:function(e){e.stopPropagation(),this.options.notes.trigger("notes:compose:switch","task")}});var n="../build/transpiled/interface/notes/views/add/first_task_lite";window.define(n,(function(){var e="undefined",s=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return s&&s.default||s})),window.require([n])},741542:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var i=s(629133),o=s.n(i),n=s(161320),a=s.n(n),r=s(859200),d=s(960190),l=s(612525),_=s(439182),p=s(968924);function h(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function f(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{},i=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(s).filter((function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})))),i.forEach((function(t){h(e,t,s[t])}))}return e}var c=[d.TaskTypes.FOLLOW_UP,d.TaskTypes.MEET];const u=p.default.extend({_important_save:!1,events:o().extend({},p.default.prototype.events||{},{"keyup [contenteditable]":"onKeyPressed"}),_selectors:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return o().extend({},p.default.prototype._selectors.apply(this,t),{text_input:'[name="body"]',helper:".feed-compose__shortcuts-helper-wrapper",taskTypeText:".task-type-name-with-icon__text",calendar:".tasks-date__caption-date"})},_getTemplate:function(){return"/tmpl/notes/adding/task.twig"},_generateEmptyModel:function(e){return e=e||this.options,new _.default({is_new:!0,object_type:{code:"tasks",id:4},element_id:e.element_id,element_type:e.element_type,editable:!0,completable:!0,visible:!0})},getExistingText:function(){return this._form.model.get("body")},setExistingText:function(){this._elem("textarea").text(this.options.text),this._findElem("comment").trigger("task-comment:refresh"),this.toggleHelper()},setParamsOnSwitch:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!o().isEmpty(t)){var s=t.generalOptions,i=void 0===s?{}:s,n=i.isFromAiHelpers,a=i.taskId;n&&(delete t.generalOptions,this.aiTaskId=a);var r=o().keys(t);if(o().each(r,(function(s){e._form.model.set(s,t[s])})),this._form.model.trigger("has_changes"),this._copyFormToModel(),this._render(),this._elem("text_input").trigger("change"),n){this.aiOfferAttributes=this._getAiMetricsData();var d=t.date,l=t.time;d||l||setTimeout((function(){e._findElem("calendar").trigger("click")}),100)}}},initialize:function(e){e.models=[this._generateEmptyModel(e)],p.default.prototype.initialize.apply(this,arguments),this.options=o().extend({onToggleClassModificator:o().noop,getMainContactId:function(){return 0}},this.options||{}),this.models=[],this.aiOfferAttributes={},this.aiTaskId=null},destroy:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];p.default.prototype.cancel.apply(this,t),p.default.prototype.destroy.apply(this,t)},onKeyPressed:function(e){38===e.keyCode&&this._isToggleSwitchAllowed()&&o().isFunction(this.options.toggleSwitcher)&&this.options.toggleSwitcher(),this.toggleHelper()},onAddDateTimeChange:function(){var e=a()([this._form.model.get("date"),this._form.model.get("time")===APP.lang.tasks_all_day?a()().hour(23).minutes(59).format(APP.system.format.date.time):this._form.model.get("time")].join(" "),APP.system.format.date.full).tz(APP.system.timezone);switch(this.options.onToggleClassModificator("feed-compose_task-future",0),this.options.onToggleClassModificator("feed-compose_task-today",0),this.options.onToggleClassModificator("feed-compose_task-expired",0),this.options.onToggleClassModificator("feed-compose_task-new",0),!0){case e.isSame(a()(),"day"):this.options.onToggleClassModificator("feed-compose_task-today",1);break;case e.isAfter(a()(),"day"):this.options.onToggleClassModificator("feed-compose_task-future",1);break;case e.isBefore(a()()):this.options.onToggleClassModificator("feed-compose_task-expired",1);break;default:this.options.onToggleClassModificator("feed-compose_task-new",1)}},cancel:o().noop,_setEditClick:o().noop,toggleHelper:function(){this._elem("textarea").text()?(this._elem("textarea").addClass("control-contenteditable__area--no-helper"),this._elem("helper").addClass("hidden")):(this._elem("textarea").removeClass("control-contenteditable__area--no-helper"),this._elem("helper").removeClass("hidden"))},_isToggleSwitchAllowed:function(){return!this._getMessageValue()},_getMessageValue:function(){return this._elem("text_input").val()},_getAiMetricsData:function(){var e=[this._form.model.get("date"),this._form.model.get("time")].join(" "),t=this._getTimeStampFromString(e);return{userType:this._form.model.get("type"),userDeadline:t,userText:this._form.model.get("body")}},_markAiTask:function(){if(!o().isEmpty(this.aiOfferAttributes)){var e=this._getAiMetricsData();if(o().isEqual(e,this.aiOfferAttributes)&&this.aiTaskId)(0,l.markTask)({taskId:this.aiTaskId,data:{status:d.TaskUsingStatuses.CORRECT_TASK}});else{var t={taskId:this.aiTaskId,data:f({status:d.TaskUsingStatuses.EDIT_TASK},e)},s=e.userType;if(!o().contains(c,s)){var i,n=null===(i=this._elem("taskTypeText")[0])||void 0===i?void 0:i.innerText;t.data=(a=f({},t.data),r=null!=(r={userType:d.TaskTypes.CUSTOM,userTypeText:n})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):function(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);s.push.apply(s,i)}return s}(Object(r)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(r,e))})),a)}(0,l.markTask)(t)}}var a,r},_render:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];p.default.prototype._render.apply(this,t),this.$el.attr("class","js-note feed-compose_task expanded"),this.initFieldsMention()},edit:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];var i=p.default.prototype.enterEditMode.apply(this,t);return this.onAddDateTimeChange(),this.listenTo(this._form.model,"has_changes",this.onAddDateTimeChange),this.listenTo(this._form.model,"has_reverted",this.onAddDateTimeChange),i},save:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this._markAiTask(),this._important_save=!0,p.default.prototype.save.apply(this,t).then(o().bind((function(){var e=o().pick(this.options,["pipeline_id","status_id"]),t=this.model.toJSON();this._important_save=!1,e.responsible_user_id=this.options.getResponsibleId(),this.model.set({is_new:!1,is_yellow:!1,editable:(0,r.canTask)("edit",t,e),deletable:(0,r.canTask)("delete",t,e)}).unset("visible"),t=this.model.toJSON(),this.options.onAdd(t,{need_cancel:!1}),this.resetCompose()}),this))},_highlightSave:function(){p.default.prototype._highlightSave.apply(this,[!0])},hasChanges:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return!!this._important_save||p.default.prototype.hasChanges.apply(this,t)},resetCompose:function(){this._findElem("comment").trigger("task-comment:refresh"),this._form.revert(),this._setChanges(!1),this.$("textarea").val("").trigger("change"),this.model=this._generateEmptyModel(),this.models=[]}});var m="../build/transpiled/interface/notes/views/add/task";window.define(m,(function(){var e="undefined",s=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return s&&s.default||s})),window.require([m])},612525:(e,t,s)=>{s.r(t),s.d(t,{markTask:()=>o});var i=s(604874),o=function(e){var t=e.data,s=e.taskId;(0,i.mark)({url:"".concat(i.MARK_TASK_URL,"/").concat(s),data:t})}}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_18_50_52"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="9e93c55e-63c2-4153-8791-42de3c678d9f",e._sentryDebugIdIdentifier="sentry-dbid-9e93c55e-63c2-4153-8791-42de3c678d9f")}catch(e){}}();
//# sourceMappingURL=51520.602b43c337b17f1bb99b.js.map