(window.webpackChunk=window.webpackChunk||[]).push([[91291,37634],{937634:(e,t,i)=>{"use strict";var s=i(331542);t.createRoot=s.createRoot,t.hydrateRoot=s.hydrateRoot},398457:e=>{function t(e){if(!e)throw new Error("missing options");if(!e.handler)throw new Error("missing handler parameter");this.scrollElement=e.scrollElement||window,this.conditions=e.conditions||{},this.handler=e.handler,this.values={},this.tracked={},this.success=!1,this.throttleVal=e.throttle||100,this.processing=!1,this.stopped=!1,this._parse(),"pageYOffset"in this.scrollElement?(this._addBottom(),this._addTop()):(this._addBottomEl(),this._addTopEl(),this._addScrollLeft()),this._addWidth(),this._onScroll()}t.prototype.addCondition=function(e,t){this.conditions[e]=t,this._parse()},t.prototype.removeCondition=function(e){delete this.conditions[e],this._parse()},t.prototype.addTracker=function(e,t){this.tracked[e]={cb:t,name:e}},t.prototype._addBottom=function(){this.addTracker("bottom",(function(e){return Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-(e.pageYOffset+e.innerHeight)}))},t.prototype._addTop=function(){this.addTracker("top",(function(e){return e.pageYOffset}))},t.prototype._addBottomEl=function(){this.addTracker("bottom",(function(e){return Math.max(e.scrollHeight,e.offsetHeight)-(e.scrollTop+e.offsetHeight)}))},t.prototype._addTopEl=function(){this.addTracker("top",(function(e){return e.scrollTop}))},t.prototype._addScrollLeft=function(){this.addTracker("scrollLeft",(function(e){return e.scrollLeft}))},t.prototype._addWidth=function(){this.addTracker("width",(function(e){return e.innerWidth}))},t.prototype._parse=function(){for(var e in this._parsed={},this._wantedTrackers=[],this._parsedMax={},this._parsedMin={},this.conditions)if(this.conditions.hasOwnProperty(e))switch(e.substr(0,4)){case"min-":this._wantedTrackers.push(e.substr(4,e.length)),this._parsedMin[e.substr(4,e.length)]=this.conditions[e];break;case"max-":this._wantedTrackers.push(e.substr(4,e.length)),this._parsedMax[e.substr(4,e.length)]=this.conditions[e];break;default:this._wantedTrackers.push(e),this._parsed[e]=this.conditions[e]}},t.prototype._check=function(){var e=[];for(var t in this.values)this._parsed.hasOwnProperty(t)&&e.push(this._parsed[t]==this.values[t]),this._parsedMin.hasOwnProperty(t)&&e.push(this._parsedMin[t]<=this.values[t]),this._parsedMax.hasOwnProperty(t)&&e.push(this._parsedMax[t]>=this.values[t]);if(e.length&&-1==e.indexOf(!1)){this.processing=!0;var i=this._done.bind(this);window.requestAnimationFrame(this.handler.bind(this,this.values,i))}},t.prototype._done=function(){this.processing=!1},t.prototype._onScroll=function(){this._onScrollHandler=this._throttledHandler(),this.scrollElement.addEventListener("scroll",this._onScrollHandler,!1)},t.prototype._throttledHandler=function(){var e=this;return this.throttle((function(t){if(e._wantedTrackers.length&&!e.processing){for(var i=0;i<e._wantedTrackers.length;i++)e.tracked[e._wantedTrackers[i]]&&(e.values[e._wantedTrackers[i]]=e.tracked[e._wantedTrackers[i]].cb(e.scrollElement||window));window.requestAnimationFrame(e._check.bind(e))}}),this.throttleVal)},t.prototype.stop=function(){this.stopped||(this.scrollElement.removeEventListener("scroll",this._onScrollHandler,!1),this.stopped=!0)},t.prototype.resume=function(){this.stopped&&this._onScroll(),this.stopped=!1},t.prototype.throttle=function(e,t){var i,s=!0;return function(){var n=this,o=arguments;if(s)return e.apply(n,o),void(s=!1);i||(i=!0,setTimeout((function(){e.apply(n,o),i=!1}),t))}},e.exports&&(e.exports=t);var i="steady";window.define(i,(function(){var t="undefined",i=typeof __webpack_exports__===t?typeof __WEBPACK_AMD_DEFINE_RESULT__===t?typeof e===t?void 0:e.exports:__WEBPACK_AMD_DEFINE_RESULT__:__webpack_exports__;return i&&i.default||i})),window.require([i])},197896:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var s=i(661533),n=i.n(s),o=i(629133),a=i.n(o),r=i(826632);function l(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}var d=function(e){this.options=n().extend({appendTo:n()(document.body)},e||{}),this.$el=n()(this.options.el),this.$page_holder=n()("#page_holder"),this.$manage=this.options.manage?n()(this.options.manage.el):[],this.$scrollable=this.$el.find(".js-scroll-x-container"),this.$pipeline_content=this.$scrollable.find(".pipeline_wrapper"),this.$window=n()(window),this.$body=n()("body"),this.makeSortable(),this.makeDroppable(),this.hs=new r.default({$wrapper:this.$scrollable.parent(),$scroller:this.$scrollable,$items_container:this.$pipeline_content,static_width:this.options.hs_options&&this.options.hs_options.static_width,hide_scrollbar:this.options.hs_options&&this.options.hs_options.hide_scrollbar,no_boundary:this.options.hs_options&&this.options.hs_options.no_boundary,scroll_map_options:{default_position:{right:26,bottom:9}},fixed_header_options:a().extend({head_cell_selector:".pipeline_cell-head",append_to:"#list__body-right"},this.options.hs_options&&this.options.hs_options.fixed_header_options||{})})};d.prototype.holding=null,d.prototype.freezScroll=!1,d.prototype.setPipelinePosition=function(e,t,i){var s=this,n=0,o=s.$scrollable.scrollLeft(),a=s.$scrollable.width(),r=i.item.outerWidth(),l=s.$scrollable.offset().left,d=s.$scrollable.offset().left+a,c=i.helper.offset().left,p=i.helper.offset().left+r;c<=l+100?n=-(10+Math.floor((100-(c-l))/10)):p>=d-100&&(n=10+Math.floor((100-(d-p))/10)),s.$scrollable.scrollLeft(o+n)},d.prototype.makeSortable=function(e){var t=this,i=this.$el.find(".pipeline_items__list"),s=Math.max(this.$el.find(".js-pipeline-row").closest(".pipeline_row").height(),50),o=n()("html").hasClass("explorer");!1===e||this.options.is_dnd_disabled?this._sortable("destroy"):this.$el.find(".js-pipeline-row").sortable({containment:a().isUndefined(this.options.containment)?document.body:this.options.containment,appendTo:this.options.appendTo,connectWith:".js-pipeline-row",items:".js-pipeline-sortable",forceHelperSizeType:!0,handle:this.options.handle||!1,helper:"clone",tolerance:this.options.tolerance||"pointer",opacity:.7,placeholder:this.options.placeholder||"pipeline-item-placeholder pipeline_leads__item_placeholder",forcePlaceholderSizeType:!0,scroll:!1,zIndex:999,refreshPositions:!0,start:function(e,a){var r;t.$body.css("overflow-x","hidden"),a.item.css({opacity:.2}).show(),t.hs&&t.hs.scroll_map&&(r=t.$manage.find(".js-pipeline-droppable").height(),t.hs.scroll_map.move({bottom:r+9})),t.item_new=n()(this),t.item_old=n()(this),a.placeholder.height(a.item.outerHeight()).width(a.item.outerWidth()).hide(),n()(this).addClass("ui-sorting ui-sorting-this"),t.$manage.length&&t.$page_holder.addClass("pipeline-show-manage"),o&&i.each((function(){n()(this).css("min-height","".concat(s,"px"))})),(l(t.options.appendTo,n())?t.options.appendTo[0]:t.options.appendTo)!==document.body&&n()(this).sortable("refreshPositions"),"function"==typeof t.options.start&&t.options.start.apply(this,[a,t])},beforestop:function(e,i){(l(t.options.appendTo,n())?t.options.appendTo[0]:t.options.appendTo)!==document.body&&i.helper.css("margin-top","")},sort:function(e,i){var s=n()(this);"function"==typeof t.options.sort&&t.options.sort.apply(this,[i,t]),t.options.noHS&&t.$scrollable.parent().scrollLeft(0),t.holding||(t.holding=setInterval((function(){t.freezScroll||(t.setPipelinePosition(this,e,i),a().throttle((function(){(document.contains&&document.contains(s.get(0))||s.closest("body").length)&&s.sortable("refreshPositions")}),50))}),50))},change:function(e,i){t.item_new=i.placeholder.closest(".js-pipeline-row").clone(),t.item_old.attr("data-id")==t.item_new.attr("data-id")||t.item_new.hasClass("js-pipeline-no-drop")?(i.placeholder.hide(),n()(this).addClass("ui-sorting-this")):(i.placeholder.show(),n()(this).removeClass("ui-sorting-this")),t.checkPlaceholderVisibility(i.placeholder)},receive:function(e,i){t.item_new.hasClass("js-pipeline-no-drop")&&i.sender.addClass("cancel").sortable("cancel")},over:function(e,i){t.item_new=n()(this),"function"==typeof t.options.over&&t.options.over.apply(this,[i,t]),n()(this).append(i.placeholder),t.checkPlaceholderVisibility(i.placeholder)},stop:function(e,s){clearInterval(t.holding),t.holding=null,t.freezScroll=!1,t.hs&&t.hs.scroll_map&&t.hs.scroll_map.move(null);var r="".concat(t.item_new.attr("data-id")),l="".concat(t.item_old.attr("data-id"));s.item.removeAttr("style"),t.$body.css("overflow-x",""),n()(this).hasClass("cancel")?(n()(this).removeClass("cancel").sortable("cancel"),t.options.canceled&&t.options.canceled.apply(this,[s,t])):r&&l!==r?t.options.change.apply(this,[s,t]):(n()(this).sortable("cancel"),t.options.immutable&&t.options.immutable.apply(this,[s,t])),n()(this).removeClass("ui-sorting ui-sorting-this"),t.$manage.length&&(t.$page_holder.removeClass("pipeline-show-manage"),a().isFunction(t.options.manageHide)&&a().delay(a().bind(t.options.manageHide,this),500)),o&&i.each((function(){n()(this).css("min-height","")})),"function"==typeof t.options.stop&&t.options.stop.apply(this,[s,t])}})},d.prototype.makeDroppable=function(e){var t=this;this.$manage.length&&(!1===e||this.options.is_dnd_disabled?this.$manage.find(".js-pipeline-droppable").droppable()&&this.$manage.find(".js-pipeline-droppable").droppable("destroy"):this.$manage.find(".js-pipeline-droppable").droppable({refreshPositions:!0,tolerance:this.options.manage.tolerance||"pointer",accept:".js-pipeline-row *",over:function(e,i){t.freezScroll=!0,i.helper.addClass("pipeline-manage-overed pipeline_leads__item-".concat(n()(this).data("status-id")))},out:function(e,i){t.freezScroll=!1,i.helper.removeClass("pipeline-manage-overed pipeline_leads__item-".concat(n()(this).data("status-id")))},drop:function(e,i){e.preventDefault(),e.stopPropagation(),i.draggable.closest(".js-pipeline-row").addClass("cancel"),n()(e.target).hasClass("pipeline_manage__item")&&i.draggable.addClass("h-hidden"),"function"==typeof t.options.manage.drop&&a().delay(a().bind((function(){t.options.manage.drop.apply(this,[i,t])}),this),APP.is_touch_device?50:0)}}))},d.prototype._sortable=function(e){return this.$el.find(".js-pipeline-row").sortable()&&this.$el.find(".js-pipeline-row").sortable(e),this},d.prototype.checkPlaceholderVisibility=function(e){var t,i=0;e.css(Modernizr.prefixed("transform"),""),e.get(0).getBoundingClientRect().top>=0||(i=this.$window.scrollTop()-e.offset().top+65),this.hs&&this.hs.fixed_header&&this.hs.fixed_header.getOffsetBelow&&(t=this.hs.fixed_header.getOffsetBelow(),e.position().top<t&&(i=t-e.position().top)),i&&e.css(Modernizr.prefixed("transform"),"translateY(".concat(i,"px)"))},d.prototype.scrollPause=function(){this.freezScroll=!0,this.hs.scrollPause()},d.prototype.scrollResume=function(){this.freezScroll=!1,this.hs.scrollResume()},d.prototype.enable=function(){return this._sortable("enable")},d.prototype.disable=function(){return this._sortable("disable")},d.prototype.refresh=function(){this.makeSortable()},d.prototype.destroy=function(){this.hs&&this.hs.destroy(),this.pipeline_fixed_header&&(this.pipeline_fixed_header.destroy(),this.pipeline_fixed_header=null),this.makeSortable(!1),this.makeDroppable(!1)};const c=d;var p="../build/transpiled/components/base/pipeline/index";window.define(p,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([p])},281049:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>f});var s=i(629133),n=i.n(s),o=i(128508),a=i(530657),r=i(797078),l=i(323344),d=i(926168),c=i(955026),p=i(214558),h=i(661533);function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}var _=[];const f={events:{"click .context-menu__item-autoupdate":"_onAUTogglerClick"},destroy:function(){this._manageAUSubscription("unsubscribe"),this._auto_update_ws_state&&this._auto_update_ws_state.unsubscribe(),this._$document.off("filter:deserialize:callback.leads-au-filter")},bindExistingItems:function(){this._auto_update_enabled=!1,this._auto_update_entity=(0,d.convertElementType)(APP.element_types[APP.getBaseEntity()],"single"),this.response.pipeline_auto_update&&this._$document.on("filter:deserialize:callback.leads-au-filter",n().bind((function(){var e=n().propertyOf(this)(["search","filter"]),t=(0,l.QStoJSON)(e.getDefaultFilter(),!0),i=e.getCurrentFilter();n().isEqual(t,i.filter)&&!i.term&&(this._auto_update_ws_state||(this._auto_update_enabled=!this.search.filter._getOptionsCount({exclude_entity_defaults:!0}),this._auto_update_ws_state=r.default.status.subscribe(n().bind((function(e){e.state===WebSocket.OPEN&&(this._auto_update&&this._manageAUSubscription("unsubscribe"),this._manageAUSubscription("subscribe"))}),this))),this.listenTo(this._items,"remove:by-socket",this._onModelRemovedByAU))}),this))},_onAUTogglerClick:function(){var e=this.$(".context-menu__item-autoupdate[data-checkable-checked]").length;h.ajax({url:"/ajax/settings/pipeline/auto_update",data:{enable:e?0:1}}).done(n().bind((function(){this._$document.trigger("page:reload")}),this))},_manageAUSubscription:function(e){var t=[this._auto_update_entity,"pipeline",this.pipeline_id||0].join(":");this._auto_update_enabled&&(r.default.send([{method:e,params:{channel:t}}]),"subscribe"===e?this._auto_update=r.default.subscribe(t).pipe(o.filter((function(e){return e.body&&e.body.payload&&"core"===(e.body.payload.service||"core")&&e.body.channel===t})),o.map((function(e){return e.body.payload}))).subscribe(n().bind(this._handleAUMessage,this),n().bind(this._manageAUSubscription,this,"subscribe")):this._auto_update&&(this._auto_update.unsubscribe(),this._auto_update=null))},_mutateCustomFieldsForRender:function(e,t){return n().reduce(e,(function(e,i,s){return e[t]||(e[t]={}),e[t]["cf".concat(s)]=i,e}),{})},_mutateAUPayloadToModel:function(e){var t={};return 7===e.event_type?e:((0,c.hasKeys)(e,["linked","company","custom_fields","items"])&&n().extend(t,this._mutateCustomFieldsForRender(e.linked.company.custom_fields.items,APP.element_types.companies)),(0,c.hasKeys)(e,["linked","contact","custom_fields","items"])&&n().extend(t,this._mutateCustomFieldsForRender(e.linked.contact.custom_fields.items,APP.element_types.contacts)),(0,c.hasKeys)(e,["custom_fields","items"])&&n().extend(t,this._mutateCustomFieldsForRender(e.custom_fields.items,APP.element_types.leads)),{budget:e.budget,can_edit:e.editable,company_name:n().isEmpty(e.linked.company)?"":{id:e.linked.company.id,name:n().escape(e.linked.company.name),url:"/companies/detail/".concat(e.linked.company.id)},date_create:e.created_at,last_message_at:e.last_message_at,last_event_at:e.last_event_at,element_type:e.object_type.id,id:e.id,lead_mark:e.task_mark&&e.task_mark.color,lead_mark_days:e.task_mark&&e.task_mark.days,loss_reason:e.loss_reason,main_contact:n().isEmpty(e.linked.contact)?"":{id:e.linked.contact.id,name:n().escape(e.linked.contact.name),url:"/contacts/detail/".concat(e.linked.contact.id),profile_avatar:e.linked.contact.icon||""},manager:(0,p.getUserName)(e.responsible_user_id),name:{text:n().escape(e.name),url:"/leads/detail/".concat(e.id)},status:e.status,tags:e.tags,last_message:e.last_message,source_data:e.source_data||{},category:e.category||"",cf:t})},_getAUBudgetProp:function(){return"budget"},_toggleAUStatus:function(e,t){var i=!!t&&(0,d.isUnsortedStatus)(t.get("id"));!!e&&(0,d.isUnsortedStatus)(e.get("id"))&&!this.$el.find(".pipeline_cell-unsorted").visible()&&this.$el.find(".pipeline_cell-unsorted").removeClass("h-hidden"),i&&0===this._items.filter((function(e){return parseInt(e.get("status"))===parseInt(t.id)})).length&&this.$el.find(".pipeline_cell-unsorted").addClass("h-hidden")},_handleAUMessage:function(e){69===n().propertyOf(e)("event_type")?this._budgetAUHandler(e):this._defaultAUHandler(e)},_budgetAUHandler:function(e){n().isNaN(parseInt(e.data.params.old_value))||n().isNaN(parseInt(e.data.params.new_value))||(this.updateHeadStatus({status_id:e.status_id,old_budget:e.data.params.old_value,new_budget:e.data.params.new_value}),this._items.get(e.element_id)&&this._items.add({id:e.element_id,budget:e.data.params.new_value},{merge:!0}))},_defaultAUHandler:function(e){var t,i,s,o,r,l=this._mutateAUPayloadToModel(e),p=l.status,f=this._items.get(l.id),m=l.status?this._elem("pipeline_list_by_id",l.status):h(),g=parseInt(f&&f.get("status")||0),y=e.old_status?e.old_status:g,b=this.statuses.get(l.status),v=this.statuses.get(y),k=this.statuses.get(g)&&g!==parseInt(l.status)||14===n().propertyOf(e)("event_type"),w=this._getAUBudgetProp(),C=!!document.getElementById("pipeline_item_".concat(l.id)),E=n().propertyOf(e)("event_type"),T=(new Error).stack;switch(_.push({recordedAt:(new Date).toISOString(),stack:T,model_data:l,new_status:p,old_status:y,status_before_message:g,budget_prop:w,event_type:E,status_col_found:m.length>0}),_.length>10&&_.shift(),n().propertyOf(e)("event_type")){case 7:y=l.status_id,p=void 0;break;case 1:case 13:y=void 0}if(14!==n().propertyOf(e)("event_type")&&1!==n().propertyOf(e)("event_type")&&7!==n().propertyOf(e)("event_type")&&13!==n().propertyOf(e)("event_type")||this.renderHeadStatuses({in_status:p,out_status:y,budget:l[w]||f&&f.get(w),from_auto_update:!0,event_type:n().propertyOf(e)("event_type")}),v&&(0,d.isUnsortedStatus)(v.get("id"))&&n().contains([14,7],n().propertyOf(e)("event_type"))&&(this._items.remove(f),C=!1),(7!==n().propertyOf(e)("event_type")||this._items.get(l.id))&&(f=this._items.add(l,{merge:!0})),i=this._items.where({status:l.status}),s=n().first(i,10*this.page),o=7!==e.event_type&&n().findWhere(s,{id:l.id}),this._toggleAUStatus(b,v),m.length&&o)o&&4!==e.event_type&&(C||(t=this._startComponent((0,d.isUnsortedStatus)(b.get("id"))?"item_unsorted":"item",{},n().extend(l,{tile_config:this.response.tile_config}),{merge:!0}),m.append(t.el),t.render(),n().each(n().difference(i,s),(function(e){this._items.remove(e)}),this)),this._updateViewsSortOnAUReceive(l,k));else if(C)try{f.trigger("remove:by-socket",f)}catch(e){throw(0,c.isDev)()||(0,a.default)({tags:["auto_update_error"]})({message:"origin_model is undefined",data:{history:(r=_,function(e){if(Array.isArray(e))return u(e)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?u(e,t):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}}),e}else f&&this._items.remove(f)},_updateViewsSortOnAUReceive:function(e,t){var i=this._items.where({status:e.status}),s=n().findIndex(i,(function(t){return t.id===e.id})),o=i[s+1],a=document.getElementById("pipeline_item_".concat(e.id)),r=document.getElementById("pipeline_item_".concat(o&&o.id));new Promise(n().bind((function(e){t?(a.classList.add("animated","zoomOut"),n().delay((function(){a.classList.remove("animated","zoomOut"),e()}),300)):e()}),this)).then(n().bind((function(){this._items.get(e.id)&&(o&&r?r.parentNode.insertBefore(a,r):this._elem("pipeline_list_by_id",e.status).get(0).appendChild(a),t&&(a.classList.add("animated","zoomIn"),n().delay((function(){a.classList.remove("animated","zoomIn")}),300)))}),this))},_onModelRemovedByAU:function(e){var t=this._elem("item_by_id",e.id);t.length&&(t.hasClass("animated")?this._items.remove(e):(t.addClass("animated zoomOut"),n().delay(n().bind((function(){this._items.remove(e)}),this),300)))}};var m="../build/transpiled/interface/leads/mixins/auto_update";window.define(m,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([m])},258139:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var s=i(345839),n=i.n(s),o=i(539965);const a=n().Collection.extend({model:o.default,comparator:function(e){var t=this.order_by||["",""],i={date_create:"date_create",price:"budget",last_message:"last_message_at",last_event:"last_event_at","":"date_create"},s=i[t[0]]?e.get(i[t[0]]):e.get("name").text;switch(!0){case"desc"===t[1]:return-s;case"asc"===t[1]:default:return s}},checkedInStatus:function(e){return this.filter((function(t){return parseInt(t.get("status"))===parseInt(e)&&t.get("is_checked")}))},getChecked:function(){return this.filter((function(e){return e.get("is_checked")}))},byStatus:function(e){return this.filter((function(t){return t.get("status")===e}))}});var r="../build/transpiled/interface/leads/pipeline/collection";window.define(r,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([r])},843752:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>_});var s=i(661533),n=i.n(s),o=i(629133),a=i.n(o),r=i(460159),l=i.n(r),d=i(313981),c=i(350562),p=i(926168),h=i(790580),u=i(539965);const _=d.default.extend({model:u.default,className:"pipeline_leads__item pipeline_leads__item_flex js-hs-prevent",_selectors:function(){return{checkbox:'input[type="checkbox"]'}},_classes:function(){return{multiactions:"pipeline_leads__item_multiactions-on",selected:"pipeline_leads__item_selected"}},events:{"lead:status-change":"onStatusChange","lead:delete":"onDelete",click:"onItemClick","click .pipeline_leads__tags-inner":"editTags",'change input[type="checkbox"]':"onCheckboxChange","click .pipeline-unsorted__item-action_decline":"declineClick","click .pipeline-unsorted__item-action_link":"_linkClick","click .pipeline-unsorted__item-action_accept":"acceptClick"},initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return d.default.prototype.initialize.call(this),this.options=e,this.listenTo(this.model,"change:multiactions_on",this.toggleMode),this.listenTo(this.model,"change:is_checked",this.toggleChecked),this.listenTo(this.model,"toggle:checked",this.toggleCheckedVisual),this.listenTo(this.model,"change",this.renderOnModelChange),this.model.collection&&this.listenTo(this.model.collection,"remove",this.onModelRemovedFromCollection),this.toggleChecked(),this},render:function(){var e=this.model.get("id"),t=this.model.get("element_type")||APP.element_types.leads,i=a().invert(APP.element_types)[t];this.$el.attr({id:"pipeline_item_".concat(e),"data-id":e}),this.model.get("can_edit")&&this.$el.addClass("js-pipeline-sortable pipeline_leads__item-sortable"),this.model.get("multiactions_on")&&this._addClass("multiactions");var s=this.getRenderParams(),n="leads"===i?"leads_pipeline":"".concat(i,"/pipeline"),o=l()({ref:"/tmpl/".concat(n,"/item_inner.twig")}).render(s);return this.$el.html(o),this._dropElemCache(),this},getRenderParams:function(){return{item:this.model.toJSON(),tile_config:this.model.get("tile_config"),pipeline_card_hidden_fields:this.options.pipeline_card_hidden_fields,can_edit:this.model.get("can_edit")}},renderOnModelChange:function(e){a().intersection(a().keys(e.changed),["status","loss_reason","contact_company_name","main_contact","name","budget","tags","lead_mark","lead_mark_days"])&&this.render()},onModelRemovedFromCollection:function(e){e===this.model&&this.destroy(!0)},onCheckboxChange:function(e){var t=n()(e.currentTarget);this.model.set("is_checked",t.prop("checked"))},onItemClick:function(e){this.model.get("multiactions_on")&&(this.model.set("is_checked",!this.model.get("is_checked")),this._elem("checkbox").prop("checked",this.model.get("is_checked")),e.preventDefault(),e.stopPropagation())},acceptClick:function(e){e.stopPropagation(),e.preventDefault(),this.$el.trigger("unsorted:accept:click"),this.model.accept()},onStatusChange:function(e,t,i,s){var n=(0,p.isLostStatus)(t);this.model.set("status",+t),(n&&!s||!s.get(t))&&this.onDelete()},onDelete:function(){this.model.trigger("delete")},toggleMode:function(e,t){this._toggleClass("multiactions",t),!1===t&&(this.model.set("is_checked",t,{silent:!0}),this._elem("checkbox").prop("checked",t),this.toggleCheckedVisual())},toggleChecked:function(){this._toggleClass("selected",this.model.get("is_checked"))},toggleCheckedVisual:function(){this.toggleChecked(),this._elem("checkbox").prop("checked",this.model.get("is_checked"))},editTags:function(){!this.model.get("can_edit")||this.fast_tags||this.model.get("multiactions_on")||this._editTags.apply(this,arguments)},_editTags:function(e){var t=this,i=n()(e.currentTarget),s=this.options.$scroller,o=this.options.$topbar,r=this.options.$stats,l=this.options.$page_holder,d=[],p=this.model.get("tags");a().isArray(p.items)&&p.items.length&&(d=a().map(p.items,(function(e){return{id:parseInt(e.id)||0,name:(0,c.getTagName)(e),color:e.color}}))),a().isFunction(t.options.onTagsInit)&&t.options.onTagsInit(),this.fast_tags=this._addComponent(h.default,{$input_container:this.$el,$container:s,class_name:"pipeline-item__multisuggest custom-scroll",id:[+this.model.get("id")],topbar_offset:o.outerHeight(),$relative_to:l,tags:d,area:["list","pipeline"],entity:APP.getBaseEntity(),render_hidden:!0,onInit:function(){var e=this.options.$input_container;this.$el.css({position:"absolute",margin:0,top:-1,left:-1,right:-1,zIndex:100}).removeClass("h-hidden");var t=e.outerHeight();this.$el.css("min-height",t),this.setPositions()},onSetPositions:function(){var e=s.get(0).getBoundingClientRect(),t=r&&r.length?r.outerHeight():0,i=r&&r.length&&r.visible()?o.outerHeight():0;this.$list.css({width:this.$el.outerWidth(),left:parseFloat(this.$list.css("left"))-e.left,top:parseFloat(this.$list.css("top"))+(t+i-(n()(window).scrollTop()+e.top))}).addClass("fast-tags-suggest-pipeline")},onSaveSuccess:function(e){e&&(a().isFunction(t.options.onTagsUpdate)&&t.options.onTagsUpdate(this._tags_for_addition,this._tags_for_deletion),t.model.set("tags",{items:a().map(e,(function(e){return a().extend({label:e.title},e)}))}),t.render())},onDestroy:function(){this.$el.remove(),t.fast_tags=null,a().isFunction(t.options.onTagsDestroy)&&t.options.onTagsDestroy()}}),i.removeAttr("data-loading")}});var f="../build/transpiled/interface/leads/pipeline/item";window.define(f,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([f])},539965:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var s=i(629133),n=i.n(s),o=i(345839),a=i.n(o),r=i(249909);const l=a().Model.extend({defaults:{is_checked:!1,budget:0,entity:"lead",lead_mark:"yellow",main_contact:!1,contact_company_name:!1,date_create:Math.floor(Date.now()/1e3),element_type:APP.element_types.leads},parse:function(e){return n().isObject(e.name)||(e.name={text:e.name||"",url:"/leads/detail/".concat(e.id)}),e.tags&&e.tags.items?n().isArray(e.tags.items)||(e.tags.items=n().map(e.tags.items,(function(e){return e}))):e.tags={items:[]},"customers-pipeline"===APP.data.current_entity?e.id=e.id:(e.status=+e.status,e.id=+e.id),e},initialize:function(){if(!this.get("status"))throw new Error("Lead status is not defined!");this.listenTo(this,"delete",this.remove),this.listenTo(this.collection,"multiactions:toggle_mode",this.toggleMode),this.listenTo(this.collection,"multiactions:checked",this.toggleChecked)},remove:function(){this.collection.remove(this)},toggleMode:function(e){this.set("multiactions_on",e)},toggleChecked:function(e,t){parseInt(this.get("status"))===parseInt(e)&&(this.set("is_checked",t,{silent:!0}),this.trigger("toggle:checked"))},accept:function(e){return this.proceed("accept","accepted",{data:e})},decline:function(){this.proceed("decline","declined")},link:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.proceed("link","linked",{data:e.shift()})},proceed:function(e,t,i){return this.trigger("accept:start",i),r.default[e](this.get("id"),i).then(n().bind((function(i){i.failed&&this.trigger("".concat(t,":failed"),[i.response]),i.finished&&this.trigger("".concat(e,":finished"),i.response),i.success&&this.trigger("".concat(t,":success"),i.response,this)}),this))}})},885041:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var s=i(629133),n=i.n(s),o=i(345839),a=i.n(o),r={};r.Model=a().Model.extend({defaults:{all_checked:!1,checked_matches_visible:!1},initialize:function(){this.ignored_ids=new Set,this.listenTo(this.collection,"multiactions:deselect",this.deselect)},parse:function(e){return n().reduce(e,(function(e,t,i){return n().isString(i)&&(e[i.toLowerCase()]=t),e}),{})},deselect:function(){this.set("all_checked",!1)}}),r.Collection=a().Collection.extend({model:r.Model,comparator:"order",has:function(e){return!n().isNull(this.get(e))},getAllChecked:function(){return this.filter((function(e){return e.get("all_checked")}))},getCheckedAndVisible:function(){return this.filter((function(e){return e.get("all_checked")&&e.get("checked_matches_visible")}))},getToExclude:function(){return this.filter((function(e){return e.get("all_checked")&&!e.get("checked_matches_visible")}))}});const l=r;var d="../build/transpiled/interface/leads/statuses";window.define(d,(function(){var e="undefined",i=typeof t===e?typeof __WEBPACK_AMD_DEFINE_RESULT__===e?typeof module===e?void 0:module.exports:__WEBPACK_AMD_DEFINE_RESULT__:t;return i&&i.default||i})),window.require([d])}}]);var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"build_2025_11_28_17_08_33"},function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="2de7545c-c5ec-4e5f-a76e-1a394c80febf",e._sentryDebugIdIdentifier="sentry-dbid-2de7545c-c5ec-4e5f-a76e-1a394c80febf")}catch(e){}}();
//# sourceMappingURL=91291.ce043ca4492d8933446b.js.map